(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();/**
* @vue/shared v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Y6(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const Ct={},tl=[],js=()=>{},Z_=()=>!1,mg=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),Q6=r=>r.startsWith("onUpdate:"),jr=Object.assign,X6=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},bO=Object.prototype.hasOwnProperty,bt=(r,e)=>bO.call(r,e),je=Array.isArray,rl=r=>yg(r)==="[object Map]",ex=r=>yg(r)==="[object Set]",Je=r=>typeof r=="function",ir=r=>typeof r=="string",ra=r=>typeof r=="symbol",Mt=r=>r!==null&&typeof r=="object",tx=r=>(Mt(r)||Je(r))&&Je(r.then)&&Je(r.catch),rx=Object.prototype.toString,yg=r=>rx.call(r),vO=r=>yg(r).slice(8,-1),nx=r=>yg(r)==="[object Object]",J6=r=>ir(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,Rh=Y6(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),wg=r=>{const e=Object.create(null);return(t=>e[t]||(e[t]=r(t)))},EO=/-\w/g,Fo=wg(r=>r.replace(EO,e=>e.slice(1).toUpperCase())),SO=/\B([A-Z])/g,na=wg(r=>r.replace(SO,"-$1").toLowerCase()),sx=wg(r=>r.charAt(0).toUpperCase()+r.slice(1)),gm=wg(r=>r?`on${sx(r)}`:""),No=(r,e)=>!Object.is(r,e),H1=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},ix=(r,e,t,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:t})},Yy=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let Ab;const bg=()=>Ab||(Ab=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Z6(r){if(je(r)){const e={};for(let t=0;t<r.length;t++){const n=r[t],s=ir(n)?CO(n):Z6(n);if(s)for(const i in s)e[i]=s[i]}return e}else if(ir(r)||Mt(r))return r}const _O=/;(?![^(]*\))/g,xO=/:([^]+)/,AO=/\/\*[^]*?\*\//g;function CO(r){const e={};return r.replace(AO,"").split(_O).forEach(t=>{if(t){const n=t.split(xO);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function ew(r){let e="";if(ir(r))e=r;else if(je(r))for(let t=0;t<r.length;t++){const n=ew(r[t]);n&&(e+=n+" ")}else if(Mt(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const kO="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",IO=Y6(kO);function ox(r){return!!r||r===""}const ax=r=>!!(r&&r.__v_isRef===!0),eh=r=>ir(r)?r:r==null?"":je(r)||Mt(r)&&(r.toString===rx||!Je(r.toString))?ax(r)?eh(r.value):JSON.stringify(r,cx,2):String(r),cx=(r,e)=>ax(e)?cx(r,e.value):rl(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,s],i)=>(t[mm(n,i)+" =>"]=s,t),{})}:ex(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>mm(t))}:ra(e)?mm(e):Mt(e)&&!je(e)&&!nx(e)?String(e):e,mm=(r,e="")=>{var t;return ra(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ln;class TO{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ln,!e&&ln&&(this.index=(ln.scopes||(ln.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=ln;try{return ln=this,e()}finally{ln=t}}}on(){++this._on===1&&(this.prevScope=ln,ln=this)}off(){this._on>0&&--this._on===0&&(ln=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function RO(){return ln}let Rt;const ym=new WeakSet;class lx{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ln&&ln.active&&ln.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,ym.has(this)&&(ym.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||hx(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Cb(this),dx(this);const e=Rt,t=ws;Rt=this,ws=!0;try{return this.fn()}finally{fx(this),Rt=e,ws=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)nw(e);this.deps=this.depsTail=void 0,Cb(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?ym.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Qy(this)&&this.run()}get dirty(){return Qy(this)}}let ux=0,Ph,Dh;function hx(r,e=!1){if(r.flags|=8,e){r.next=Dh,Dh=r;return}r.next=Ph,Ph=r}function tw(){ux++}function rw(){if(--ux>0)return;if(Dh){let e=Dh;for(Dh=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;Ph;){let e=Ph;for(Ph=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=t}}if(r)throw r}function dx(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function fx(r){let e,t=r.depsTail,n=t;for(;n;){const s=n.prevDep;n.version===-1?(n===t&&(t=s),nw(n),PO(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=s}r.deps=e,r.depsTail=t}function Qy(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(px(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function px(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===ad)||(r.globalVersion=ad,!r.isSSR&&r.flags&128&&(!r.deps&&!r._dirty||!Qy(r))))return;r.flags|=2;const e=r.dep,t=Rt,n=ws;Rt=r,ws=!0;try{dx(r);const s=r.fn(r._value);(e.version===0||No(s,r._value))&&(r.flags|=128,r._value=s,e.version++)}catch(s){throw e.version++,s}finally{Rt=t,ws=n,fx(r),r.flags&=-3}}function nw(r,e=!1){const{dep:t,prevSub:n,nextSub:s}=r;if(n&&(n.nextSub=s,r.prevSub=void 0),s&&(s.prevSub=n,r.nextSub=void 0),t.subs===r&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let i=t.computed.deps;i;i=i.nextDep)nw(i,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function PO(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let ws=!0;const gx=[];function Ui(){gx.push(ws),ws=!1}function Fi(){const r=gx.pop();ws=r===void 0?!0:r}function Cb(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=Rt;Rt=void 0;try{e()}finally{Rt=t}}}let ad=0;class DO{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class sw{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Rt||!ws||Rt===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Rt)t=this.activeLink=new DO(Rt,this),Rt.deps?(t.prevDep=Rt.depsTail,Rt.depsTail.nextDep=t,Rt.depsTail=t):Rt.deps=Rt.depsTail=t,mx(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=Rt.depsTail,t.nextDep=void 0,Rt.depsTail.nextDep=t,Rt.depsTail=t,Rt.deps===t&&(Rt.deps=n)}return t}trigger(e){this.version++,ad++,this.notify(e)}notify(e){tw();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{rw()}}}function mx(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)mx(n)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const Xy=new WeakMap,Ra=Symbol(""),Jy=Symbol(""),cd=Symbol("");function Ur(r,e,t){if(ws&&Rt){let n=Xy.get(r);n||Xy.set(r,n=new Map);let s=n.get(t);s||(n.set(t,s=new sw),s.map=n,s.key=t),s.track()}}function Ci(r,e,t,n,s,i){const o=Xy.get(r);if(!o){ad++;return}const a=c=>{c&&c.trigger()};if(tw(),e==="clear")o.forEach(a);else{const c=je(r),l=c&&J6(t);if(c&&t==="length"){const u=Number(n);o.forEach((h,d)=>{(d==="length"||d===cd||!ra(d)&&d>=u)&&a(h)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),l&&a(o.get(cd)),e){case"add":c?l&&a(o.get("length")):(a(o.get(Ra)),rl(r)&&a(o.get(Jy)));break;case"delete":c||(a(o.get(Ra)),rl(r)&&a(o.get(Jy)));break;case"set":rl(r)&&a(o.get(Ra));break}}rw()}function Tc(r){const e=wt(r);return e===r?e:(Ur(e,"iterate",cd),Xn(r)?e:e.map(Sr))}function vg(r){return Ur(r=wt(r),"iterate",cd),r}const NO={__proto__:null,[Symbol.iterator](){return wm(this,Symbol.iterator,Sr)},concat(...r){return Tc(this).concat(...r.map(e=>je(e)?Tc(e):e))},entries(){return wm(this,"entries",r=>(r[1]=Sr(r[1]),r))},every(r,e){return yi(this,"every",r,e,void 0,arguments)},filter(r,e){return yi(this,"filter",r,e,t=>t.map(Sr),arguments)},find(r,e){return yi(this,"find",r,e,Sr,arguments)},findIndex(r,e){return yi(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return yi(this,"findLast",r,e,Sr,arguments)},findLastIndex(r,e){return yi(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return yi(this,"forEach",r,e,void 0,arguments)},includes(...r){return bm(this,"includes",r)},indexOf(...r){return bm(this,"indexOf",r)},join(r){return Tc(this).join(r)},lastIndexOf(...r){return bm(this,"lastIndexOf",r)},map(r,e){return yi(this,"map",r,e,void 0,arguments)},pop(){return $u(this,"pop")},push(...r){return $u(this,"push",r)},reduce(r,...e){return kb(this,"reduce",r,e)},reduceRight(r,...e){return kb(this,"reduceRight",r,e)},shift(){return $u(this,"shift")},some(r,e){return yi(this,"some",r,e,void 0,arguments)},splice(...r){return $u(this,"splice",r)},toReversed(){return Tc(this).toReversed()},toSorted(r){return Tc(this).toSorted(r)},toSpliced(...r){return Tc(this).toSpliced(...r)},unshift(...r){return $u(this,"unshift",r)},values(){return wm(this,"values",Sr)}};function wm(r,e,t){const n=vg(r),s=n[e]();return n!==r&&!Xn(r)&&(s._next=s.next,s.next=()=>{const i=s._next();return i.done||(i.value=t(i.value)),i}),s}const OO=Array.prototype;function yi(r,e,t,n,s,i){const o=vg(r),a=o!==r&&!Xn(r),c=o[e];if(c!==OO[e]){const h=c.apply(r,i);return a?Sr(h):h}let l=t;o!==r&&(a?l=function(h,d){return t.call(this,Sr(h),d,r)}:t.length>2&&(l=function(h,d){return t.call(this,h,d,r)}));const u=c.call(o,l,n);return a&&s?s(u):u}function kb(r,e,t,n){const s=vg(r);let i=t;return s!==r&&(Xn(r)?t.length>3&&(i=function(o,a,c){return t.call(this,o,a,c,r)}):i=function(o,a,c){return t.call(this,o,Sr(a),c,r)}),s[e](i,...n)}function bm(r,e,t){const n=wt(r);Ur(n,"iterate",cd);const s=n[e](...t);return(s===-1||s===!1)&&aw(t[0])?(t[0]=wt(t[0]),n[e](...t)):s}function $u(r,e,t=[]){Ui(),tw();const n=wt(r)[e].apply(r,t);return rw(),Fi(),n}const LO=Y6("__proto__,__v_isRef,__isVue"),yx=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(ra));function BO(r){ra(r)||(r=String(r));const e=wt(this);return Ur(e,"has",r),e.hasOwnProperty(r)}class wx{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const s=this._isReadonly,i=this._isShallow;if(t==="__v_isReactive")return!s;if(t==="__v_isReadonly")return s;if(t==="__v_isShallow")return i;if(t==="__v_raw")return n===(s?i?jO:Sx:i?Ex:vx).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const o=je(e);if(!s){let c;if(o&&(c=NO[t]))return c;if(t==="hasOwnProperty")return BO}const a=Reflect.get(e,t,Hr(e)?e:n);if((ra(t)?yx.has(t):LO(t))||(s||Ur(e,"get",t),i))return a;if(Hr(a)){const c=o&&J6(t)?a:a.value;return s&&Mt(c)?e3(c):c}return Mt(a)?s?e3(a):Eg(a):a}}class bx extends wx{constructor(e=!1){super(!1,e)}set(e,t,n,s){let i=e[t];if(!this._isShallow){const c=Vo(i);if(!Xn(n)&&!Vo(n)&&(i=wt(i),n=wt(n)),!je(e)&&Hr(i)&&!Hr(n))return c||(i.value=n),!0}const o=je(e)&&J6(t)?Number(t)<e.length:bt(e,t),a=Reflect.set(e,t,n,Hr(e)?e:s);return e===wt(s)&&(o?No(n,i)&&Ci(e,"set",t,n):Ci(e,"add",t,n)),a}deleteProperty(e,t){const n=bt(e,t);e[t];const s=Reflect.deleteProperty(e,t);return s&&n&&Ci(e,"delete",t,void 0),s}has(e,t){const n=Reflect.has(e,t);return(!ra(t)||!yx.has(t))&&Ur(e,"has",t),n}ownKeys(e){return Ur(e,"iterate",je(e)?"length":Ra),Reflect.ownKeys(e)}}class MO extends wx{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const $O=new bx,UO=new MO,FO=new bx(!0);const Zy=r=>r,Gf=r=>Reflect.getPrototypeOf(r);function VO(r,e,t){return function(...n){const s=this.__v_raw,i=wt(s),o=rl(i),a=r==="entries"||r===Symbol.iterator&&o,c=r==="keys"&&o,l=s[r](...n),u=t?Zy:e?hp:Sr;return!e&&Ur(i,"iterate",c?Jy:Ra),{next(){const{value:h,done:d}=l.next();return d?{value:h,done:d}:{value:a?[u(h[0]),u(h[1])]:u(h),done:d}},[Symbol.iterator](){return this}}}}function Yf(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function zO(r,e){const t={get(s){const i=this.__v_raw,o=wt(i),a=wt(s);r||(No(s,a)&&Ur(o,"get",s),Ur(o,"get",a));const{has:c}=Gf(o),l=e?Zy:r?hp:Sr;if(c.call(o,s))return l(i.get(s));if(c.call(o,a))return l(i.get(a));i!==o&&i.get(s)},get size(){const s=this.__v_raw;return!r&&Ur(wt(s),"iterate",Ra),s.size},has(s){const i=this.__v_raw,o=wt(i),a=wt(s);return r||(No(s,a)&&Ur(o,"has",s),Ur(o,"has",a)),s===a?i.has(s):i.has(s)||i.has(a)},forEach(s,i){const o=this,a=o.__v_raw,c=wt(a),l=e?Zy:r?hp:Sr;return!r&&Ur(c,"iterate",Ra),a.forEach((u,h)=>s.call(i,l(u),l(h),o))}};return jr(t,r?{add:Yf("add"),set:Yf("set"),delete:Yf("delete"),clear:Yf("clear")}:{add(s){!e&&!Xn(s)&&!Vo(s)&&(s=wt(s));const i=wt(this);return Gf(i).has.call(i,s)||(i.add(s),Ci(i,"add",s,s)),this},set(s,i){!e&&!Xn(i)&&!Vo(i)&&(i=wt(i));const o=wt(this),{has:a,get:c}=Gf(o);let l=a.call(o,s);l||(s=wt(s),l=a.call(o,s));const u=c.call(o,s);return o.set(s,i),l?No(i,u)&&Ci(o,"set",s,i):Ci(o,"add",s,i),this},delete(s){const i=wt(this),{has:o,get:a}=Gf(i);let c=o.call(i,s);c||(s=wt(s),c=o.call(i,s)),a&&a.call(i,s);const l=i.delete(s);return c&&Ci(i,"delete",s,void 0),l},clear(){const s=wt(this),i=s.size!==0,o=s.clear();return i&&Ci(s,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(s=>{t[s]=VO(s,r,e)}),t}function iw(r,e){const t=zO(r,e);return(n,s,i)=>s==="__v_isReactive"?!r:s==="__v_isReadonly"?r:s==="__v_raw"?n:Reflect.get(bt(t,s)&&s in n?t:n,s,i)}const HO={get:iw(!1,!1)},qO={get:iw(!1,!0)},KO={get:iw(!0,!1)};const vx=new WeakMap,Ex=new WeakMap,Sx=new WeakMap,jO=new WeakMap;function WO(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function GO(r){return r.__v_skip||!Object.isExtensible(r)?0:WO(vO(r))}function Eg(r){return Vo(r)?r:ow(r,!1,$O,HO,vx)}function _x(r){return ow(r,!1,FO,qO,Ex)}function e3(r){return ow(r,!0,UO,KO,Sx)}function ow(r,e,t,n,s){if(!Mt(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const i=GO(r);if(i===0)return r;const o=s.get(r);if(o)return o;const a=new Proxy(r,i===2?n:t);return s.set(r,a),a}function nl(r){return Vo(r)?nl(r.__v_raw):!!(r&&r.__v_isReactive)}function Vo(r){return!!(r&&r.__v_isReadonly)}function Xn(r){return!!(r&&r.__v_isShallow)}function aw(r){return r?!!r.__v_raw:!1}function wt(r){const e=r&&r.__v_raw;return e?wt(e):r}function YO(r){return!bt(r,"__v_skip")&&Object.isExtensible(r)&&ix(r,"__v_skip",!0),r}const Sr=r=>Mt(r)?Eg(r):r,hp=r=>Mt(r)?e3(r):r;function Hr(r){return r?r.__v_isRef===!0:!1}function Nh(r){return xx(r,!1)}function QO(r){return xx(r,!0)}function xx(r,e){return Hr(r)?r:new XO(r,e)}class XO{constructor(e,t){this.dep=new sw,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:wt(e),this._value=t?e:Sr(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||Xn(e)||Vo(e);e=n?e:wt(e),No(e,t)&&(this._rawValue=e,this._value=n?e:Sr(e),this.dep.trigger())}}function Pa(r){return Hr(r)?r.value:r}const JO={get:(r,e,t)=>e==="__v_raw"?r:Pa(Reflect.get(r,e,t)),set:(r,e,t,n)=>{const s=r[e];return Hr(s)&&!Hr(t)?(s.value=t,!0):Reflect.set(r,e,t,n)}};function Ax(r){return nl(r)?r:new Proxy(r,JO)}class ZO{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new sw(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=ad-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&Rt!==this)return hx(this,!0),!0}get value(){const e=this.dep.track();return px(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function eL(r,e,t=!1){let n,s;return Je(r)?n=r:(n=r.get,s=r.set),new ZO(n,s,t)}const Qf={},dp=new WeakMap;let ma;function tL(r,e=!1,t=ma){if(t){let n=dp.get(t);n||dp.set(t,n=[]),n.push(r)}}function rL(r,e,t=Ct){const{immediate:n,deep:s,once:i,scheduler:o,augmentJob:a,call:c}=t,l=E=>s?E:Xn(E)||s===!1||s===0?ki(E,1):ki(E);let u,h,d,f,g=!1,m=!1;if(Hr(r)?(h=()=>r.value,g=Xn(r)):nl(r)?(h=()=>l(r),g=!0):je(r)?(m=!0,g=r.some(E=>nl(E)||Xn(E)),h=()=>r.map(E=>{if(Hr(E))return E.value;if(nl(E))return l(E);if(Je(E))return c?c(E,2):E()})):Je(r)?e?h=c?()=>c(r,2):r:h=()=>{if(d){Ui();try{d()}finally{Fi()}}const E=ma;ma=u;try{return c?c(r,3,[f]):r(f)}finally{ma=E}}:h=js,e&&s){const E=h,x=s===!0?1/0:s;h=()=>ki(E(),x)}const b=RO(),v=()=>{u.stop(),b&&b.active&&X6(b.effects,u)};if(i&&e){const E=e;e=(...x)=>{E(...x),v()}}let A=m?new Array(r.length).fill(Qf):Qf;const w=E=>{if(!(!(u.flags&1)||!u.dirty&&!E))if(e){const x=u.run();if(s||g||(m?x.some((P,T)=>No(P,A[T])):No(x,A))){d&&d();const P=ma;ma=u;try{const T=[x,A===Qf?void 0:m&&A[0]===Qf?[]:A,f];A=x,c?c(e,3,T):e(...T)}finally{ma=P}}}else u.run()};return a&&a(w),u=new lx(h),u.scheduler=o?()=>o(w,!1):w,f=E=>tL(E,!1,u),d=u.onStop=()=>{const E=dp.get(u);if(E){if(c)c(E,4);else for(const x of E)x();dp.delete(u)}},e?n?w(!0):A=u.run():o?o(w.bind(null,!0),!0):u.run(),v.pause=u.pause.bind(u),v.resume=u.resume.bind(u),v.stop=v,v}function ki(r,e=1/0,t){if(e<=0||!Mt(r)||r.__v_skip||(t=t||new Map,(t.get(r)||0)>=e))return r;if(t.set(r,e),e--,Hr(r))ki(r.value,e,t);else if(je(r))for(let n=0;n<r.length;n++)ki(r[n],e,t);else if(ex(r)||rl(r))r.forEach(n=>{ki(n,e,t)});else if(nx(r)){for(const n in r)ki(r[n],e,t);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&ki(r[n],e,t)}return r}/**
* @vue/runtime-core v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function cf(r,e,t,n){try{return n?r(...n):r()}catch(s){Sg(s,e,t)}}function ti(r,e,t,n){if(Je(r)){const s=cf(r,e,t,n);return s&&tx(s)&&s.catch(i=>{Sg(i,e,t)}),s}if(je(r)){const s=[];for(let i=0;i<r.length;i++)s.push(ti(r[i],e,t,n));return s}}function Sg(r,e,t,n=!0){const s=e?e.vnode:null,{errorHandler:i,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||Ct;if(e){let a=e.parent;const c=e.proxy,l=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const u=a.ec;if(u){for(let h=0;h<u.length;h++)if(u[h](r,c,l)===!1)return}a=a.parent}if(i){Ui(),cf(i,null,10,[r,c,l]),Fi();return}}nL(r,t,s,n,o)}function nL(r,e,t,n=!0,s=!1){if(s)throw r;console.error(r)}const Xr=[];let $s=-1;const sl=[];let yo=null,Uc=0;const Cx=Promise.resolve();let fp=null;function cw(r){const e=fp||Cx;return r?e.then(this?r.bind(this):r):e}function sL(r){let e=$s+1,t=Xr.length;for(;e<t;){const n=e+t>>>1,s=Xr[n],i=ld(s);i<r||i===r&&s.flags&2?e=n+1:t=n}return e}function lw(r){if(!(r.flags&1)){const e=ld(r),t=Xr[Xr.length-1];!t||!(r.flags&2)&&e>=ld(t)?Xr.push(r):Xr.splice(sL(e),0,r),r.flags|=1,kx()}}function kx(){fp||(fp=Cx.then(Tx))}function iL(r){je(r)?sl.push(...r):yo&&r.id===-1?yo.splice(Uc+1,0,r):r.flags&1||(sl.push(r),r.flags|=1),kx()}function Ib(r,e,t=$s+1){for(;t<Xr.length;t++){const n=Xr[t];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;Xr.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function Ix(r){if(sl.length){const e=[...new Set(sl)].sort((t,n)=>ld(t)-ld(n));if(sl.length=0,yo){yo.push(...e);return}for(yo=e,Uc=0;Uc<yo.length;Uc++){const t=yo[Uc];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}yo=null,Uc=0}}const ld=r=>r.id==null?r.flags&2?-1:1/0:r.id;function Tx(r){try{for($s=0;$s<Xr.length;$s++){const e=Xr[$s];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),cf(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;$s<Xr.length;$s++){const e=Xr[$s];e&&(e.flags&=-2)}$s=-1,Xr.length=0,Ix(),fp=null,(Xr.length||sl.length)&&Tx()}}let Kn=null,Rx=null;function pp(r){const e=Kn;return Kn=r,Rx=r&&r.type.__scopeId||null,e}function oL(r,e=Kn,t){if(!e||r._n)return r;const n=(...s)=>{n._d&&yp(-1);const i=pp(e);let o;try{o=r(...s)}finally{pp(i),n._d&&yp(1)}return o};return n._n=!0,n._c=!0,n._d=!0,n}function aL(r,e){if(Kn===null)return r;const t=Cg(Kn),n=r.dirs||(r.dirs=[]);for(let s=0;s<e.length;s++){let[i,o,a,c=Ct]=e[s];i&&(Je(i)&&(i={mounted:i,updated:i}),i.deep&&ki(o),n.push({dir:i,instance:t,value:o,oldValue:void 0,arg:a,modifiers:c}))}return r}function ua(r,e,t,n){const s=r.dirs,i=e&&e.dirs;for(let o=0;o<s.length;o++){const a=s[o];i&&(a.oldValue=i[o].value);let c=a.dir[n];c&&(Ui(),ti(c,t,8,[r.el,a,r,e]),Fi())}}const cL=Symbol("_vte"),lL=r=>r.__isTeleport,uL=Symbol("_leaveCb");function uw(r,e){r.shapeFlag&6&&r.component?(r.transition=e,uw(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function hw(r,e){return Je(r)?jr({name:r.name},e,{setup:r}):r}function Px(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}const gp=new WeakMap;function Oh(r,e,t,n,s=!1){if(je(r)){r.forEach((g,m)=>Oh(g,e&&(je(e)?e[m]:e),t,n,s));return}if(Lh(n)&&!s){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&Oh(r,e,t,n.component.subTree);return}const i=n.shapeFlag&4?Cg(n.component):n.el,o=s?null:i,{i:a,r:c}=r,l=e&&e.r,u=a.refs===Ct?a.refs={}:a.refs,h=a.setupState,d=wt(h),f=h===Ct?Z_:g=>bt(d,g);if(l!=null&&l!==c){if(Tb(e),ir(l))u[l]=null,f(l)&&(h[l]=null);else if(Hr(l)){l.value=null;const g=e;g.k&&(u[g.k]=null)}}if(Je(c))cf(c,a,12,[o,u]);else{const g=ir(c),m=Hr(c);if(g||m){const b=()=>{if(r.f){const v=g?f(c)?h[c]:u[c]:c.value;if(s)je(v)&&X6(v,i);else if(je(v))v.includes(i)||v.push(i);else if(g)u[c]=[i],f(c)&&(h[c]=u[c]);else{const A=[i];c.value=A,r.k&&(u[r.k]=A)}}else g?(u[c]=o,f(c)&&(h[c]=o)):m&&(c.value=o,r.k&&(u[r.k]=o))};if(o){const v=()=>{b(),gp.delete(r)};v.id=-1,gp.set(r,v),vn(v,t)}else Tb(r),b()}}}function Tb(r){const e=gp.get(r);e&&(e.flags|=8,gp.delete(r))}bg().requestIdleCallback;bg().cancelIdleCallback;const Lh=r=>!!r.type.__asyncLoader,Dx=r=>r.type.__isKeepAlive;function hL(r,e){Nx(r,"a",e)}function dL(r,e){Nx(r,"da",e)}function Nx(r,e,t=en){const n=r.__wdc||(r.__wdc=()=>{let s=t;for(;s;){if(s.isDeactivated)return;s=s.parent}return r()});if(_g(e,n,t),t){let s=t.parent;for(;s&&s.parent;)Dx(s.parent.vnode)&&fL(n,e,t,s),s=s.parent}}function fL(r,e,t,n){const s=_g(e,r,n,!0);Lx(()=>{X6(n[e],s)},t)}function _g(r,e,t=en,n=!1){if(t){const s=t[r]||(t[r]=[]),i=e.__weh||(e.__weh=(...o)=>{Ui();const a=lf(t),c=ti(e,t,r,o);return a(),Fi(),c});return n?s.unshift(i):s.push(i),i}}const Ji=r=>(e,t=en)=>{(!hd||r==="sp")&&_g(r,(...n)=>e(...n),t)},pL=Ji("bm"),Ox=Ji("m"),gL=Ji("bu"),mL=Ji("u"),yL=Ji("bum"),Lx=Ji("um"),wL=Ji("sp"),bL=Ji("rtg"),vL=Ji("rtc");function EL(r,e=en){_g("ec",r,e)}const SL=Symbol.for("v-ndc");function _L(r,e,t,n){let s;const i=t,o=je(r);if(o||ir(r)){const a=o&&nl(r);let c=!1,l=!1;a&&(c=!Xn(r),l=Vo(r),r=vg(r)),s=new Array(r.length);for(let u=0,h=r.length;u<h;u++)s[u]=e(c?l?hp(Sr(r[u])):Sr(r[u]):r[u],u,void 0,i)}else if(typeof r=="number"){s=new Array(r);for(let a=0;a<r;a++)s[a]=e(a+1,a,void 0,i)}else if(Mt(r))if(r[Symbol.iterator])s=Array.from(r,(a,c)=>e(a,c,void 0,i));else{const a=Object.keys(r);s=new Array(a.length);for(let c=0,l=a.length;c<l;c++){const u=a[c];s[c]=e(r[u],u,c,i)}}else s=[];return s}const t3=r=>r?tA(r)?Cg(r):t3(r.parent):null,Bh=jr(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>t3(r.parent),$root:r=>t3(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>Mx(r),$forceUpdate:r=>r.f||(r.f=()=>{lw(r.update)}),$nextTick:r=>r.n||(r.n=cw.bind(r.proxy)),$watch:r=>qL.bind(r)}),vm=(r,e)=>r!==Ct&&!r.__isScriptSetup&&bt(r,e),xL={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:s,props:i,accessCache:o,type:a,appContext:c}=r;let l;if(e[0]!=="$"){const f=o[e];if(f!==void 0)switch(f){case 1:return n[e];case 2:return s[e];case 4:return t[e];case 3:return i[e]}else{if(vm(n,e))return o[e]=1,n[e];if(s!==Ct&&bt(s,e))return o[e]=2,s[e];if((l=r.propsOptions[0])&&bt(l,e))return o[e]=3,i[e];if(t!==Ct&&bt(t,e))return o[e]=4,t[e];r3&&(o[e]=0)}}const u=Bh[e];let h,d;if(u)return e==="$attrs"&&Ur(r.attrs,"get",""),u(r);if((h=a.__cssModules)&&(h=h[e]))return h;if(t!==Ct&&bt(t,e))return o[e]=4,t[e];if(d=c.config.globalProperties,bt(d,e))return d[e]},set({_:r},e,t){const{data:n,setupState:s,ctx:i}=r;return vm(s,e)?(s[e]=t,!0):n!==Ct&&bt(n,e)?(n[e]=t,!0):bt(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(i[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:n,appContext:s,propsOptions:i,type:o}},a){let c,l;return!!(t[a]||r!==Ct&&a[0]!=="$"&&bt(r,a)||vm(e,a)||(c=i[0])&&bt(c,a)||bt(n,a)||bt(Bh,a)||bt(s.config.globalProperties,a)||(l=o.__cssModules)&&l[a])},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:bt(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function Rb(r){return je(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let r3=!0;function AL(r){const e=Mx(r),t=r.proxy,n=r.ctx;r3=!1,e.beforeCreate&&Pb(e.beforeCreate,r,"bc");const{data:s,computed:i,methods:o,watch:a,provide:c,inject:l,created:u,beforeMount:h,mounted:d,beforeUpdate:f,updated:g,activated:m,deactivated:b,beforeDestroy:v,beforeUnmount:A,destroyed:w,unmounted:E,render:x,renderTracked:P,renderTriggered:T,errorCaptured:D,serverPrefetch:C,expose:R,inheritAttrs:O,components:V,directives:B,filters:z}=e;if(l&&CL(l,n,null),o)for(const X in o){const te=o[X];Je(te)&&(n[X]=te.bind(t))}if(s){const X=s.call(t,t);Mt(X)&&(r.data=Eg(X))}if(r3=!0,i)for(const X in i){const te=i[X],W=Je(te)?te.bind(t,t):Je(te.get)?te.get.bind(t,t):js,ie=!Je(te)&&Je(te.set)?te.set.bind(t):js,ce=zn({get:W,set:ie});Object.defineProperty(n,X,{enumerable:!0,configurable:!0,get:()=>ce.value,set:de=>ce.value=de})}if(a)for(const X in a)Bx(a[X],n,t,X);if(c){const X=Je(c)?c.call(t):c;Reflect.ownKeys(X).forEach(te=>{q1(te,X[te])})}u&&Pb(u,r,"c");function K(X,te){je(te)?te.forEach(W=>X(W.bind(t))):te&&X(te.bind(t))}if(K(pL,h),K(Ox,d),K(gL,f),K(mL,g),K(hL,m),K(dL,b),K(EL,D),K(vL,P),K(bL,T),K(yL,A),K(Lx,E),K(wL,C),je(R))if(R.length){const X=r.exposed||(r.exposed={});R.forEach(te=>{Object.defineProperty(X,te,{get:()=>t[te],set:W=>t[te]=W,enumerable:!0})})}else r.exposed||(r.exposed={});x&&r.render===js&&(r.render=x),O!=null&&(r.inheritAttrs=O),V&&(r.components=V),B&&(r.directives=B),C&&Px(r)}function CL(r,e,t=js){je(r)&&(r=n3(r));for(const n in r){const s=r[n];let i;Mt(s)?"default"in s?i=Pi(s.from||n,s.default,!0):i=Pi(s.from||n):i=Pi(s),Hr(i)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>i.value,set:o=>i.value=o}):e[n]=i}}function Pb(r,e,t){ti(je(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,t)}function Bx(r,e,t,n){let s=n.includes(".")?Qx(t,n):()=>t[n];if(ir(r)){const i=e[r];Je(i)&&Mh(s,i)}else if(Je(r))Mh(s,r.bind(t));else if(Mt(r))if(je(r))r.forEach(i=>Bx(i,e,t,n));else{const i=Je(r.handler)?r.handler.bind(t):e[r.handler];Je(i)&&Mh(s,i,r)}}function Mx(r){const e=r.type,{mixins:t,extends:n}=e,{mixins:s,optionsCache:i,config:{optionMergeStrategies:o}}=r.appContext,a=i.get(e);let c;return a?c=a:!s.length&&!t&&!n?c=e:(c={},s.length&&s.forEach(l=>mp(c,l,o,!0)),mp(c,e,o)),Mt(e)&&i.set(e,c),c}function mp(r,e,t,n=!1){const{mixins:s,extends:i}=e;i&&mp(r,i,t,!0),s&&s.forEach(o=>mp(r,o,t,!0));for(const o in e)if(!(n&&o==="expose")){const a=kL[o]||t&&t[o];r[o]=a?a(r[o],e[o]):e[o]}return r}const kL={data:Db,props:Nb,emits:Nb,methods:th,computed:th,beforeCreate:Yr,created:Yr,beforeMount:Yr,mounted:Yr,beforeUpdate:Yr,updated:Yr,beforeDestroy:Yr,beforeUnmount:Yr,destroyed:Yr,unmounted:Yr,activated:Yr,deactivated:Yr,errorCaptured:Yr,serverPrefetch:Yr,components:th,directives:th,watch:TL,provide:Db,inject:IL};function Db(r,e){return e?r?function(){return jr(Je(r)?r.call(this,this):r,Je(e)?e.call(this,this):e)}:e:r}function IL(r,e){return th(n3(r),n3(e))}function n3(r){if(je(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function Yr(r,e){return r?[...new Set([].concat(r,e))]:e}function th(r,e){return r?jr(Object.create(null),r,e):e}function Nb(r,e){return r?je(r)&&je(e)?[...new Set([...r,...e])]:jr(Object.create(null),Rb(r),Rb(e??{})):e}function TL(r,e){if(!r)return e;if(!e)return r;const t=jr(Object.create(null),r);for(const n in e)t[n]=Yr(r[n],e[n]);return t}function $x(){return{app:null,config:{isNativeTag:Z_,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let RL=0;function PL(r,e){return function(n,s=null){Je(n)||(n=jr({},n)),s!=null&&!Mt(s)&&(s=null);const i=$x(),o=new WeakSet,a=[];let c=!1;const l=i.app={_uid:RL++,_component:n,_props:s,_container:null,_context:i,_instance:null,version:pB,get config(){return i.config},set config(u){},use(u,...h){return o.has(u)||(u&&Je(u.install)?(o.add(u),u.install(l,...h)):Je(u)&&(o.add(u),u(l,...h))),l},mixin(u){return i.mixins.includes(u)||i.mixins.push(u),l},component(u,h){return h?(i.components[u]=h,l):i.components[u]},directive(u,h){return h?(i.directives[u]=h,l):i.directives[u]},mount(u,h,d){if(!c){const f=l._ceVNode||Cn(n,s);return f.appContext=i,d===!0?d="svg":d===!1&&(d=void 0),r(f,u,d),c=!0,l._container=u,u.__vue_app__=l,Cg(f.component)}},onUnmount(u){a.push(u)},unmount(){c&&(ti(a,l._instance,16),r(null,l._container),delete l._container.__vue_app__)},provide(u,h){return i.provides[u]=h,l},runWithContext(u){const h=il;il=l;try{return u()}finally{il=h}}};return l}}let il=null;function q1(r,e){if(en){let t=en.provides;const n=en.parent&&en.parent.provides;n===t&&(t=en.provides=Object.create(n)),t[r]=e}}function Pi(r,e,t=!1){const n=cB();if(n||il){let s=il?il._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(s&&r in s)return s[r];if(arguments.length>1)return t&&Je(e)?e.call(n&&n.proxy):e}}const Ux={},Fx=()=>Object.create(Ux),Vx=r=>Object.getPrototypeOf(r)===Ux;function DL(r,e,t,n=!1){const s={},i=Fx();r.propsDefaults=Object.create(null),zx(r,e,s,i);for(const o in r.propsOptions[0])o in s||(s[o]=void 0);t?r.props=n?s:_x(s):r.type.props?r.props=s:r.props=i,r.attrs=i}function NL(r,e,t,n){const{props:s,attrs:i,vnode:{patchFlag:o}}=r,a=wt(s),[c]=r.propsOptions;let l=!1;if((n||o>0)&&!(o&16)){if(o&8){const u=r.vnode.dynamicProps;for(let h=0;h<u.length;h++){let d=u[h];if(xg(r.emitsOptions,d))continue;const f=e[d];if(c)if(bt(i,d))f!==i[d]&&(i[d]=f,l=!0);else{const g=Fo(d);s[g]=s3(c,a,g,f,r,!1)}else f!==i[d]&&(i[d]=f,l=!0)}}}else{zx(r,e,s,i)&&(l=!0);let u;for(const h in a)(!e||!bt(e,h)&&((u=na(h))===h||!bt(e,u)))&&(c?t&&(t[h]!==void 0||t[u]!==void 0)&&(s[h]=s3(c,a,h,void 0,r,!0)):delete s[h]);if(i!==a)for(const h in i)(!e||!bt(e,h))&&(delete i[h],l=!0)}l&&Ci(r.attrs,"set","")}function zx(r,e,t,n){const[s,i]=r.propsOptions;let o=!1,a;if(e)for(let c in e){if(Rh(c))continue;const l=e[c];let u;s&&bt(s,u=Fo(c))?!i||!i.includes(u)?t[u]=l:(a||(a={}))[u]=l:xg(r.emitsOptions,c)||(!(c in n)||l!==n[c])&&(n[c]=l,o=!0)}if(i){const c=wt(t),l=a||Ct;for(let u=0;u<i.length;u++){const h=i[u];t[h]=s3(s,c,h,l[h],r,!bt(l,h))}}return o}function s3(r,e,t,n,s,i){const o=r[t];if(o!=null){const a=bt(o,"default");if(a&&n===void 0){const c=o.default;if(o.type!==Function&&!o.skipFactory&&Je(c)){const{propsDefaults:l}=s;if(t in l)n=l[t];else{const u=lf(s);n=l[t]=c.call(null,e),u()}}else n=c;s.ce&&s.ce._setProp(t,n)}o[0]&&(i&&!a?n=!1:o[1]&&(n===""||n===na(t))&&(n=!0))}return n}const OL=new WeakMap;function Hx(r,e,t=!1){const n=t?OL:e.propsCache,s=n.get(r);if(s)return s;const i=r.props,o={},a=[];let c=!1;if(!Je(r)){const u=h=>{c=!0;const[d,f]=Hx(h,e,!0);jr(o,d),f&&a.push(...f)};!t&&e.mixins.length&&e.mixins.forEach(u),r.extends&&u(r.extends),r.mixins&&r.mixins.forEach(u)}if(!i&&!c)return Mt(r)&&n.set(r,tl),tl;if(je(i))for(let u=0;u<i.length;u++){const h=Fo(i[u]);Ob(h)&&(o[h]=Ct)}else if(i)for(const u in i){const h=Fo(u);if(Ob(h)){const d=i[u],f=o[h]=je(d)||Je(d)?{type:d}:jr({},d),g=f.type;let m=!1,b=!0;if(je(g))for(let v=0;v<g.length;++v){const A=g[v],w=Je(A)&&A.name;if(w==="Boolean"){m=!0;break}else w==="String"&&(b=!1)}else m=Je(g)&&g.name==="Boolean";f[0]=m,f[1]=b,(m||bt(f,"default"))&&a.push(h)}}const l=[o,a];return Mt(r)&&n.set(r,l),l}function Ob(r){return r[0]!=="$"&&!Rh(r)}const dw=r=>r==="_"||r==="_ctx"||r==="$stable",fw=r=>je(r)?r.map(zs):[zs(r)],LL=(r,e,t)=>{if(e._n)return e;const n=oL((...s)=>fw(e(...s)),t);return n._c=!1,n},qx=(r,e,t)=>{const n=r._ctx;for(const s in r){if(dw(s))continue;const i=r[s];if(Je(i))e[s]=LL(s,i,n);else if(i!=null){const o=fw(i);e[s]=()=>o}}},Kx=(r,e)=>{const t=fw(e);r.slots.default=()=>t},jx=(r,e,t)=>{for(const n in e)(t||!dw(n))&&(r[n]=e[n])},BL=(r,e,t)=>{const n=r.slots=Fx();if(r.vnode.shapeFlag&32){const s=e._;s?(jx(n,e,t),t&&ix(n,"_",s,!0)):qx(e,n)}else e&&Kx(r,e)},ML=(r,e,t)=>{const{vnode:n,slots:s}=r;let i=!0,o=Ct;if(n.shapeFlag&32){const a=e._;a?t&&a===1?i=!1:jx(s,e,t):(i=!e.$stable,qx(e,s)),o=e}else e&&(Kx(r,e),o={default:1});if(i)for(const a in s)!dw(a)&&o[a]==null&&delete s[a]},vn=JL;function $L(r){return UL(r)}function UL(r,e){const t=bg();t.__VUE__=!0;const{insert:n,remove:s,patchProp:i,createElement:o,createText:a,createComment:c,setText:l,setElementText:u,parentNode:h,nextSibling:d,setScopeId:f=js,insertStaticContent:g}=r,m=(M,F,G,L=null,U=null,q=null,re=void 0,k=null,p=!!F.dynamicChildren)=>{if(M===F)return;M&&!Uu(M,F)&&(L=ee(M),de(M,U,q,!0),M=null),F.patchFlag===-2&&(p=!1,F.dynamicChildren=null);const{type:y,ref:_,shapeFlag:N}=F;switch(y){case Ag:b(M,F,G,L);break;case zo:v(M,F,G,L);break;case Sm:M==null&&A(F,G,L,re);break;case Vs:V(M,F,G,L,U,q,re,k,p);break;default:N&1?x(M,F,G,L,U,q,re,k,p):N&6?B(M,F,G,L,U,q,re,k,p):(N&64||N&128)&&y.process(M,F,G,L,U,q,re,k,p,ye)}_!=null&&U?Oh(_,M&&M.ref,q,F||M,!F):_==null&&M&&M.ref!=null&&Oh(M.ref,null,q,M,!0)},b=(M,F,G,L)=>{if(M==null)n(F.el=a(F.children),G,L);else{const U=F.el=M.el;F.children!==M.children&&l(U,F.children)}},v=(M,F,G,L)=>{M==null?n(F.el=c(F.children||""),G,L):F.el=M.el},A=(M,F,G,L)=>{[M.el,M.anchor]=g(M.children,F,G,L,M.el,M.anchor)},w=({el:M,anchor:F},G,L)=>{let U;for(;M&&M!==F;)U=d(M),n(M,G,L),M=U;n(F,G,L)},E=({el:M,anchor:F})=>{let G;for(;M&&M!==F;)G=d(M),s(M),M=G;s(F)},x=(M,F,G,L,U,q,re,k,p)=>{F.type==="svg"?re="svg":F.type==="math"&&(re="mathml"),M==null?P(F,G,L,U,q,re,k,p):C(M,F,U,q,re,k,p)},P=(M,F,G,L,U,q,re,k)=>{let p,y;const{props:_,shapeFlag:N,transition:H,dirs:Q}=M;if(p=M.el=o(M.type,q,_&&_.is,_),N&8?u(p,M.children):N&16&&D(M.children,p,null,L,U,Em(M,q),re,k),Q&&ua(M,null,L,"created"),T(p,M,M.scopeId,re,L),_){for(const Ce in _)Ce!=="value"&&!Rh(Ce)&&i(p,Ce,null,_[Ce],q,L);"value"in _&&i(p,"value",null,_.value,q),(y=_.onVnodeBeforeMount)&&Os(y,L,M)}Q&&ua(M,null,L,"beforeMount");const ge=FL(U,H);ge&&H.beforeEnter(p),n(p,F,G),((y=_&&_.onVnodeMounted)||ge||Q)&&vn(()=>{y&&Os(y,L,M),ge&&H.enter(p),Q&&ua(M,null,L,"mounted")},U)},T=(M,F,G,L,U)=>{if(G&&f(M,G),L)for(let q=0;q<L.length;q++)f(M,L[q]);if(U){let q=U.subTree;if(F===q||Jx(q.type)&&(q.ssContent===F||q.ssFallback===F)){const re=U.vnode;T(M,re,re.scopeId,re.slotScopeIds,U.parent)}}},D=(M,F,G,L,U,q,re,k,p=0)=>{for(let y=p;y<M.length;y++){const _=M[y]=k?wo(M[y]):zs(M[y]);m(null,_,F,G,L,U,q,re,k)}},C=(M,F,G,L,U,q,re)=>{const k=F.el=M.el;let{patchFlag:p,dynamicChildren:y,dirs:_}=F;p|=M.patchFlag&16;const N=M.props||Ct,H=F.props||Ct;let Q;if(G&&ha(G,!1),(Q=H.onVnodeBeforeUpdate)&&Os(Q,G,F,M),_&&ua(F,M,G,"beforeUpdate"),G&&ha(G,!0),(N.innerHTML&&H.innerHTML==null||N.textContent&&H.textContent==null)&&u(k,""),y?R(M.dynamicChildren,y,k,G,L,Em(F,U),q):re||te(M,F,k,null,G,L,Em(F,U),q,!1),p>0){if(p&16)O(k,N,H,G,U);else if(p&2&&N.class!==H.class&&i(k,"class",null,H.class,U),p&4&&i(k,"style",N.style,H.style,U),p&8){const ge=F.dynamicProps;for(let Ce=0;Ce<ge.length;Ce++){const Me=ge[Ce],Fe=N[Me],$e=H[Me];($e!==Fe||Me==="value")&&i(k,Me,Fe,$e,U,G)}}p&1&&M.children!==F.children&&u(k,F.children)}else!re&&y==null&&O(k,N,H,G,U);((Q=H.onVnodeUpdated)||_)&&vn(()=>{Q&&Os(Q,G,F,M),_&&ua(F,M,G,"updated")},L)},R=(M,F,G,L,U,q,re)=>{for(let k=0;k<F.length;k++){const p=M[k],y=F[k],_=p.el&&(p.type===Vs||!Uu(p,y)||p.shapeFlag&198)?h(p.el):G;m(p,y,_,null,L,U,q,re,!0)}},O=(M,F,G,L,U)=>{if(F!==G){if(F!==Ct)for(const q in F)!Rh(q)&&!(q in G)&&i(M,q,F[q],null,U,L);for(const q in G){if(Rh(q))continue;const re=G[q],k=F[q];re!==k&&q!=="value"&&i(M,q,k,re,U,L)}"value"in G&&i(M,"value",F.value,G.value,U)}},V=(M,F,G,L,U,q,re,k,p)=>{const y=F.el=M?M.el:a(""),_=F.anchor=M?M.anchor:a("");let{patchFlag:N,dynamicChildren:H,slotScopeIds:Q}=F;Q&&(k=k?k.concat(Q):Q),M==null?(n(y,G,L),n(_,G,L),D(F.children||[],G,_,U,q,re,k,p)):N>0&&N&64&&H&&M.dynamicChildren?(R(M.dynamicChildren,H,G,U,q,re,k),(F.key!=null||U&&F===U.subTree)&&Wx(M,F,!0)):te(M,F,G,_,U,q,re,k,p)},B=(M,F,G,L,U,q,re,k,p)=>{F.slotScopeIds=k,M==null?F.shapeFlag&512?U.ctx.activate(F,G,L,re,p):z(F,G,L,U,q,re,p):$(M,F,p)},z=(M,F,G,L,U,q,re)=>{const k=M.component=aB(M,L,U);if(Dx(M)&&(k.ctx.renderer=ye),lB(k,!1,re),k.asyncDep){if(U&&U.registerDep(k,K,re),!M.el){const p=k.subTree=Cn(zo);v(null,p,F,G),M.placeholder=p.el}}else K(k,M,F,G,U,q,re)},$=(M,F,G)=>{const L=F.component=M.component;if(QL(M,F,G))if(L.asyncDep&&!L.asyncResolved){X(L,F,G);return}else L.next=F,L.update();else F.el=M.el,L.vnode=F},K=(M,F,G,L,U,q,re)=>{const k=()=>{if(M.isMounted){let{next:N,bu:H,u:Q,parent:ge,vnode:Ce}=M;{const Y=Gx(M);if(Y){N&&(N.el=Ce.el,X(M,N,re)),Y.asyncDep.then(()=>{M.isUnmounted||k()});return}}let Me=N,Fe;ha(M,!1),N?(N.el=Ce.el,X(M,N,re)):N=Ce,H&&H1(H),(Fe=N.props&&N.props.onVnodeBeforeUpdate)&&Os(Fe,ge,N,Ce),ha(M,!0);const $e=Bb(M),ft=M.subTree;M.subTree=$e,m(ft,$e,h(ft.el),ee(ft),M,U,q),N.el=$e.el,Me===null&&XL(M,$e.el),Q&&vn(Q,U),(Fe=N.props&&N.props.onVnodeUpdated)&&vn(()=>Os(Fe,ge,N,Ce),U)}else{let N;const{el:H,props:Q}=F,{bm:ge,m:Ce,parent:Me,root:Fe,type:$e}=M,ft=Lh(F);ha(M,!1),ge&&H1(ge),!ft&&(N=Q&&Q.onVnodeBeforeMount)&&Os(N,Me,F),ha(M,!0);{Fe.ce&&Fe.ce._def.shadowRoot!==!1&&Fe.ce._injectChildStyle($e);const Y=M.subTree=Bb(M);m(null,Y,G,L,M,U,q),F.el=Y.el}if(Ce&&vn(Ce,U),!ft&&(N=Q&&Q.onVnodeMounted)){const Y=F;vn(()=>Os(N,Me,Y),U)}(F.shapeFlag&256||Me&&Lh(Me.vnode)&&Me.vnode.shapeFlag&256)&&M.a&&vn(M.a,U),M.isMounted=!0,F=G=L=null}};M.scope.on();const p=M.effect=new lx(k);M.scope.off();const y=M.update=p.run.bind(p),_=M.job=p.runIfDirty.bind(p);_.i=M,_.id=M.uid,p.scheduler=()=>lw(_),ha(M,!0),y()},X=(M,F,G)=>{F.component=M;const L=M.vnode.props;M.vnode=F,M.next=null,NL(M,F.props,L,G),ML(M,F.children,G),Ui(),Ib(M),Fi()},te=(M,F,G,L,U,q,re,k,p=!1)=>{const y=M&&M.children,_=M?M.shapeFlag:0,N=F.children,{patchFlag:H,shapeFlag:Q}=F;if(H>0){if(H&128){ie(y,N,G,L,U,q,re,k,p);return}else if(H&256){W(y,N,G,L,U,q,re,k,p);return}}Q&8?(_&16&&xe(y,U,q),N!==y&&u(G,N)):_&16?Q&16?ie(y,N,G,L,U,q,re,k,p):xe(y,U,q,!0):(_&8&&u(G,""),Q&16&&D(N,G,L,U,q,re,k,p))},W=(M,F,G,L,U,q,re,k,p)=>{M=M||tl,F=F||tl;const y=M.length,_=F.length,N=Math.min(y,_);let H;for(H=0;H<N;H++){const Q=F[H]=p?wo(F[H]):zs(F[H]);m(M[H],Q,G,null,U,q,re,k,p)}y>_?xe(M,U,q,!0,!1,N):D(F,G,L,U,q,re,k,p,N)},ie=(M,F,G,L,U,q,re,k,p)=>{let y=0;const _=F.length;let N=M.length-1,H=_-1;for(;y<=N&&y<=H;){const Q=M[y],ge=F[y]=p?wo(F[y]):zs(F[y]);if(Uu(Q,ge))m(Q,ge,G,null,U,q,re,k,p);else break;y++}for(;y<=N&&y<=H;){const Q=M[N],ge=F[H]=p?wo(F[H]):zs(F[H]);if(Uu(Q,ge))m(Q,ge,G,null,U,q,re,k,p);else break;N--,H--}if(y>N){if(y<=H){const Q=H+1,ge=Q<_?F[Q].el:L;for(;y<=H;)m(null,F[y]=p?wo(F[y]):zs(F[y]),G,ge,U,q,re,k,p),y++}}else if(y>H)for(;y<=N;)de(M[y],U,q,!0),y++;else{const Q=y,ge=y,Ce=new Map;for(y=ge;y<=H;y++){const fe=F[y]=p?wo(F[y]):zs(F[y]);fe.key!=null&&Ce.set(fe.key,y)}let Me,Fe=0;const $e=H-ge+1;let ft=!1,Y=0;const Z=new Array($e);for(y=0;y<$e;y++)Z[y]=0;for(y=Q;y<=N;y++){const fe=M[y];if(Fe>=$e){de(fe,U,q,!0);continue}let Te;if(fe.key!=null)Te=Ce.get(fe.key);else for(Me=ge;Me<=H;Me++)if(Z[Me-ge]===0&&Uu(fe,F[Me])){Te=Me;break}Te===void 0?de(fe,U,q,!0):(Z[Te-ge]=y+1,Te>=Y?Y=Te:ft=!0,m(fe,F[Te],G,null,U,q,re,k,p),Fe++)}const ne=ft?VL(Z):tl;for(Me=ne.length-1,y=$e-1;y>=0;y--){const fe=ge+y,Te=F[fe],Ut=F[fe+1],Gt=fe+1<_?Ut.el||Ut.placeholder:L;Z[y]===0?m(null,Te,G,Gt,U,q,re,k,p):ft&&(Me<0||y!==ne[Me]?ce(Te,G,Gt,2):Me--)}}},ce=(M,F,G,L,U=null)=>{const{el:q,type:re,transition:k,children:p,shapeFlag:y}=M;if(y&6){ce(M.component.subTree,F,G,L);return}if(y&128){M.suspense.move(F,G,L);return}if(y&64){re.move(M,F,G,ye);return}if(re===Vs){n(q,F,G);for(let N=0;N<p.length;N++)ce(p[N],F,G,L);n(M.anchor,F,G);return}if(re===Sm){w(M,F,G);return}if(L!==2&&y&1&&k)if(L===0)k.beforeEnter(q),n(q,F,G),vn(()=>k.enter(q),U);else{const{leave:N,delayLeave:H,afterLeave:Q}=k,ge=()=>{M.ctx.isUnmounted?s(q):n(q,F,G)},Ce=()=>{q._isLeaving&&q[uL](!0),N(q,()=>{ge(),Q&&Q()})};H?H(q,ge,Ce):Ce()}else n(q,F,G)},de=(M,F,G,L=!1,U=!1)=>{const{type:q,props:re,ref:k,children:p,dynamicChildren:y,shapeFlag:_,patchFlag:N,dirs:H,cacheIndex:Q}=M;if(N===-2&&(U=!1),k!=null&&(Ui(),Oh(k,null,G,M,!0),Fi()),Q!=null&&(F.renderCache[Q]=void 0),_&256){F.ctx.deactivate(M);return}const ge=_&1&&H,Ce=!Lh(M);let Me;if(Ce&&(Me=re&&re.onVnodeBeforeUnmount)&&Os(Me,F,M),_&6)Le(M.component,G,L);else{if(_&128){M.suspense.unmount(G,L);return}ge&&ua(M,null,F,"beforeUnmount"),_&64?M.type.remove(M,F,G,ye,L):y&&!y.hasOnce&&(q!==Vs||N>0&&N&64)?xe(y,F,G,!1,!0):(q===Vs&&N&384||!U&&_&16)&&xe(p,F,G),L&&oe(M)}(Ce&&(Me=re&&re.onVnodeUnmounted)||ge)&&vn(()=>{Me&&Os(Me,F,M),ge&&ua(M,null,F,"unmounted")},G)},oe=M=>{const{type:F,el:G,anchor:L,transition:U}=M;if(F===Vs){Se(G,L);return}if(F===Sm){E(M);return}const q=()=>{s(G),U&&!U.persisted&&U.afterLeave&&U.afterLeave()};if(M.shapeFlag&1&&U&&!U.persisted){const{leave:re,delayLeave:k}=U,p=()=>re(G,q);k?k(M.el,q,p):p()}else q()},Se=(M,F)=>{let G;for(;M!==F;)G=d(M),s(M),M=G;s(F)},Le=(M,F,G)=>{const{bum:L,scope:U,job:q,subTree:re,um:k,m:p,a:y}=M;Lb(p),Lb(y),L&&H1(L),U.stop(),q&&(q.flags|=8,de(re,M,F,G)),k&&vn(k,F),vn(()=>{M.isUnmounted=!0},F)},xe=(M,F,G,L=!1,U=!1,q=0)=>{for(let re=q;re<M.length;re++)de(M[re],F,G,L,U)},ee=M=>{if(M.shapeFlag&6)return ee(M.component.subTree);if(M.shapeFlag&128)return M.suspense.next();const F=d(M.anchor||M.el),G=F&&F[cL];return G?d(G):F};let pe=!1;const se=(M,F,G)=>{M==null?F._vnode&&de(F._vnode,null,null,!0):m(F._vnode||null,M,F,null,null,null,G),F._vnode=M,pe||(pe=!0,Ib(),Ix(),pe=!1)},ye={p:m,um:de,m:ce,r:oe,mt:z,mc:D,pc:te,pbc:R,n:ee,o:r};return{render:se,hydrate:void 0,createApp:PL(se)}}function Em({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function ha({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function FL(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function Wx(r,e,t=!1){const n=r.children,s=e.children;if(je(n)&&je(s))for(let i=0;i<n.length;i++){const o=n[i];let a=s[i];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[i]=wo(s[i]),a.el=o.el),!t&&a.patchFlag!==-2&&Wx(o,a)),a.type===Ag&&a.patchFlag!==-1&&(a.el=o.el),a.type===zo&&!a.el&&(a.el=o.el)}}function VL(r){const e=r.slice(),t=[0];let n,s,i,o,a;const c=r.length;for(n=0;n<c;n++){const l=r[n];if(l!==0){if(s=t[t.length-1],r[s]<l){e[n]=s,t.push(n);continue}for(i=0,o=t.length-1;i<o;)a=i+o>>1,r[t[a]]<l?i=a+1:o=a;l<r[t[i]]&&(i>0&&(e[n]=t[i-1]),t[i]=n)}}for(i=t.length,o=t[i-1];i-- >0;)t[i]=o,o=e[o];return t}function Gx(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Gx(e)}function Lb(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const zL=Symbol.for("v-scx"),HL=()=>Pi(zL);function Mh(r,e,t){return Yx(r,e,t)}function Yx(r,e,t=Ct){const{immediate:n,deep:s,flush:i,once:o}=t,a=jr({},t),c=e&&n||!e&&i!=="post";let l;if(hd){if(i==="sync"){const f=HL();l=f.__watcherHandles||(f.__watcherHandles=[])}else if(!c){const f=()=>{};return f.stop=js,f.resume=js,f.pause=js,f}}const u=en;a.call=(f,g,m)=>ti(f,u,g,m);let h=!1;i==="post"?a.scheduler=f=>{vn(f,u&&u.suspense)}:i!=="sync"&&(h=!0,a.scheduler=(f,g)=>{g?f():lw(f)}),a.augmentJob=f=>{e&&(f.flags|=4),h&&(f.flags|=2,u&&(f.id=u.uid,f.i=u))};const d=rL(r,e,a);return hd&&(l?l.push(d):c&&d()),d}function qL(r,e,t){const n=this.proxy,s=ir(r)?r.includes(".")?Qx(n,r):()=>n[r]:r.bind(n,n);let i;Je(e)?i=e:(i=e.handler,t=e);const o=lf(this),a=Yx(s,i.bind(n),t);return o(),a}function Qx(r,e){const t=e.split(".");return()=>{let n=r;for(let s=0;s<t.length&&n;s++)n=n[t[s]];return n}}const KL=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${Fo(e)}Modifiers`]||r[`${na(e)}Modifiers`];function jL(r,e,...t){if(r.isUnmounted)return;const n=r.vnode.props||Ct;let s=t;const i=e.startsWith("update:"),o=i&&KL(n,e.slice(7));o&&(o.trim&&(s=t.map(u=>ir(u)?u.trim():u)),o.number&&(s=t.map(Yy)));let a,c=n[a=gm(e)]||n[a=gm(Fo(e))];!c&&i&&(c=n[a=gm(na(e))]),c&&ti(c,r,6,s);const l=n[a+"Once"];if(l){if(!r.emitted)r.emitted={};else if(r.emitted[a])return;r.emitted[a]=!0,ti(l,r,6,s)}}const WL=new WeakMap;function Xx(r,e,t=!1){const n=t?WL:e.emitsCache,s=n.get(r);if(s!==void 0)return s;const i=r.emits;let o={},a=!1;if(!Je(r)){const c=l=>{const u=Xx(l,e,!0);u&&(a=!0,jr(o,u))};!t&&e.mixins.length&&e.mixins.forEach(c),r.extends&&c(r.extends),r.mixins&&r.mixins.forEach(c)}return!i&&!a?(Mt(r)&&n.set(r,null),null):(je(i)?i.forEach(c=>o[c]=null):jr(o,i),Mt(r)&&n.set(r,o),o)}function xg(r,e){return!r||!mg(e)?!1:(e=e.slice(2).replace(/Once$/,""),bt(r,e[0].toLowerCase()+e.slice(1))||bt(r,na(e))||bt(r,e))}function Bb(r){const{type:e,vnode:t,proxy:n,withProxy:s,propsOptions:[i],slots:o,attrs:a,emit:c,render:l,renderCache:u,props:h,data:d,setupState:f,ctx:g,inheritAttrs:m}=r,b=pp(r);let v,A;try{if(t.shapeFlag&4){const E=s||n,x=E;v=zs(l.call(x,E,u,h,f,d,g)),A=a}else{const E=e;v=zs(E.length>1?E(h,{attrs:a,slots:o,emit:c}):E(h,null)),A=e.props?a:GL(a)}}catch(E){$h.length=0,Sg(E,r,1),v=Cn(zo)}let w=v;if(A&&m!==!1){const E=Object.keys(A),{shapeFlag:x}=w;E.length&&x&7&&(i&&E.some(Q6)&&(A=YL(A,i)),w=El(w,A,!1,!0))}return t.dirs&&(w=El(w,null,!1,!0),w.dirs=w.dirs?w.dirs.concat(t.dirs):t.dirs),t.transition&&uw(w,t.transition),v=w,pp(b),v}const GL=r=>{let e;for(const t in r)(t==="class"||t==="style"||mg(t))&&((e||(e={}))[t]=r[t]);return e},YL=(r,e)=>{const t={};for(const n in r)(!Q6(n)||!(n.slice(9)in e))&&(t[n]=r[n]);return t};function QL(r,e,t){const{props:n,children:s,component:i}=r,{props:o,children:a,patchFlag:c}=e,l=i.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&c>=0){if(c&1024)return!0;if(c&16)return n?Mb(n,o,l):!!o;if(c&8){const u=e.dynamicProps;for(let h=0;h<u.length;h++){const d=u[h];if(o[d]!==n[d]&&!xg(l,d))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:n===o?!1:n?o?Mb(n,o,l):!0:!!o;return!1}function Mb(r,e,t){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let s=0;s<n.length;s++){const i=n[s];if(e[i]!==r[i]&&!xg(t,i))return!0}return!1}function XL({vnode:r,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=t,e=e.parent;else break}}const Jx=r=>r.__isSuspense;function JL(r,e){e&&e.pendingBranch?je(r)?e.effects.push(...r):e.effects.push(r):iL(r)}const Vs=Symbol.for("v-fgt"),Ag=Symbol.for("v-txt"),zo=Symbol.for("v-cmt"),Sm=Symbol.for("v-stc"),$h=[];let An=null;function ya(r=!1){$h.push(An=r?null:[])}function ZL(){$h.pop(),An=$h[$h.length-1]||null}let ud=1;function yp(r,e=!1){ud+=r,r<0&&An&&e&&(An.hasOnce=!0)}function Zx(r){return r.dynamicChildren=ud>0?An||tl:null,ZL(),ud>0&&An&&An.push(r),r}function Rc(r,e,t,n,s,i){return Zx(ls(r,e,t,n,s,i,!0))}function eB(r,e,t,n,s){return Zx(Cn(r,e,t,n,s,!0))}function wp(r){return r?r.__v_isVNode===!0:!1}function Uu(r,e){return r.type===e.type&&r.key===e.key}const eA=({key:r})=>r??null,K1=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?ir(r)||Hr(r)||Je(r)?{i:Kn,r,k:e,f:!!t}:r:null);function ls(r,e=null,t=null,n=0,s=null,i=r===Vs?0:1,o=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&eA(e),ref:e&&K1(e),scopeId:Rx,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Kn};return a?(pw(c,t),i&128&&r.normalize(c)):t&&(c.shapeFlag|=ir(t)?8:16),ud>0&&!o&&An&&(c.patchFlag>0||i&6)&&c.patchFlag!==32&&An.push(c),c}const Cn=tB;function tB(r,e=null,t=null,n=0,s=null,i=!1){if((!r||r===SL)&&(r=zo),wp(r)){const a=El(r,e,!0);return t&&pw(a,t),ud>0&&!i&&An&&(a.shapeFlag&6?An[An.indexOf(r)]=a:An.push(a)),a.patchFlag=-2,a}if(fB(r)&&(r=r.__vccOpts),e){e=rB(e);let{class:a,style:c}=e;a&&!ir(a)&&(e.class=ew(a)),Mt(c)&&(aw(c)&&!je(c)&&(c=jr({},c)),e.style=Z6(c))}const o=ir(r)?1:Jx(r)?128:lL(r)?64:Mt(r)?4:Je(r)?2:0;return ls(r,e,t,n,s,o,i,!0)}function rB(r){return r?aw(r)||Vx(r)?jr({},r):r:null}function El(r,e,t=!1,n=!1){const{props:s,ref:i,patchFlag:o,children:a,transition:c}=r,l=e?sB(s||{},e):s,u={__v_isVNode:!0,__v_skip:!0,type:r.type,props:l,key:l&&eA(l),ref:e&&e.ref?t&&i?je(i)?i.concat(K1(e)):[i,K1(e)]:K1(e):i,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:a,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==Vs?o===-1?16:o|16:o,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:c,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&El(r.ssContent),ssFallback:r.ssFallback&&El(r.ssFallback),placeholder:r.placeholder,el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return c&&n&&uw(u,c.clone(u)),u}function nB(r=" ",e=0){return Cn(Ag,null,r,e)}function $b(r="",e=!1){return e?(ya(),eB(zo,null,r)):Cn(zo,null,r)}function zs(r){return r==null||typeof r=="boolean"?Cn(zo):je(r)?Cn(Vs,null,r.slice()):wp(r)?wo(r):Cn(Ag,null,String(r))}function wo(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:El(r)}function pw(r,e){let t=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(je(e))t=16;else if(typeof e=="object")if(n&65){const s=e.default;s&&(s._c&&(s._d=!1),pw(r,s()),s._c&&(s._d=!0));return}else{t=32;const s=e._;!s&&!Vx(e)?e._ctx=Kn:s===3&&Kn&&(Kn.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else Je(e)?(e={default:e,_ctx:Kn},t=32):(e=String(e),n&64?(t=16,e=[nB(e)]):t=8);r.children=e,r.shapeFlag|=t}function sB(...r){const e={};for(let t=0;t<r.length;t++){const n=r[t];for(const s in n)if(s==="class")e.class!==n.class&&(e.class=ew([e.class,n.class]));else if(s==="style")e.style=Z6([e.style,n.style]);else if(mg(s)){const i=e[s],o=n[s];o&&i!==o&&!(je(i)&&i.includes(o))&&(e[s]=i?[].concat(i,o):o)}else s!==""&&(e[s]=n[s])}return e}function Os(r,e,t,n=null){ti(r,e,7,[t,n])}const iB=$x();let oB=0;function aB(r,e,t){const n=r.type,s=(e?e.appContext:r.appContext)||iB,i={uid:oB++,vnode:r,type:n,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new TO(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Hx(n,s),emitsOptions:Xx(n,s),emit:null,emitted:null,propsDefaults:Ct,inheritAttrs:n.inheritAttrs,ctx:Ct,data:Ct,props:Ct,attrs:Ct,slots:Ct,refs:Ct,setupState:Ct,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return i.ctx={_:i},i.root=e?e.root:i,i.emit=jL.bind(null,i),r.ce&&r.ce(i),i}let en=null;const cB=()=>en||Kn;let bp,i3;{const r=bg(),e=(t,n)=>{let s;return(s=r[t])||(s=r[t]=[]),s.push(n),i=>{s.length>1?s.forEach(o=>o(i)):s[0](i)}};bp=e("__VUE_INSTANCE_SETTERS__",t=>en=t),i3=e("__VUE_SSR_SETTERS__",t=>hd=t)}const lf=r=>{const e=en;return bp(r),r.scope.on(),()=>{r.scope.off(),bp(e)}},Ub=()=>{en&&en.scope.off(),bp(null)};function tA(r){return r.vnode.shapeFlag&4}let hd=!1;function lB(r,e=!1,t=!1){e&&i3(e);const{props:n,children:s}=r.vnode,i=tA(r);DL(r,n,i,e),BL(r,s,t||e);const o=i?uB(r,e):void 0;return e&&i3(!1),o}function uB(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,xL);const{setup:n}=t;if(n){Ui();const s=r.setupContext=n.length>1?dB(r):null,i=lf(r),o=cf(n,r,0,[r.props,s]),a=tx(o);if(Fi(),i(),(a||r.sp)&&!Lh(r)&&Px(r),a){if(o.then(Ub,Ub),e)return o.then(c=>{Fb(r,c)}).catch(c=>{Sg(c,r,0)});r.asyncDep=o}else Fb(r,o)}else rA(r)}function Fb(r,e,t){Je(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Mt(e)&&(r.setupState=Ax(e)),rA(r)}function rA(r,e,t){const n=r.type;r.render||(r.render=n.render||js);{const s=lf(r);Ui();try{AL(r)}finally{Fi(),s()}}}const hB={get(r,e){return Ur(r,"get",""),r[e]}};function dB(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,hB),slots:r.slots,emit:r.emit,expose:e}}function Cg(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(Ax(YO(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in Bh)return Bh[t](r)},has(e,t){return t in e||t in Bh}})):r.proxy}function fB(r){return Je(r)&&"__vccOpts"in r}const zn=(r,e)=>eL(r,e,hd);function nA(r,e,t){try{yp(-1);const n=arguments.length;return n===2?Mt(e)&&!je(e)?wp(e)?Cn(r,null,[e]):Cn(r,e):Cn(r,null,e):(n>3?t=Array.prototype.slice.call(arguments,2):n===3&&wp(t)&&(t=[t]),Cn(r,e,t))}finally{yp(1)}}const pB="3.5.22";/**
* @vue/runtime-dom v3.5.22
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let o3;const Vb=typeof window<"u"&&window.trustedTypes;if(Vb)try{o3=Vb.createPolicy("vue",{createHTML:r=>r})}catch{}const sA=o3?r=>o3.createHTML(r):r=>r,gB="http://www.w3.org/2000/svg",mB="http://www.w3.org/1998/Math/MathML",xi=typeof document<"u"?document:null,zb=xi&&xi.createElement("template"),yB={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,n)=>{const s=e==="svg"?xi.createElementNS(gB,r):e==="mathml"?xi.createElementNS(mB,r):t?xi.createElement(r,{is:t}):xi.createElement(r);return r==="select"&&n&&n.multiple!=null&&s.setAttribute("multiple",n.multiple),s},createText:r=>xi.createTextNode(r),createComment:r=>xi.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>xi.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,n,s,i){const o=t?t.previousSibling:e.lastChild;if(s&&(s===i||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),t),!(s===i||!(s=s.nextSibling)););else{zb.innerHTML=sA(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const a=zb.content;if(n==="svg"||n==="mathml"){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},wB=Symbol("_vtc");function bB(r,e,t){const n=r[wB];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const Hb=Symbol("_vod"),vB=Symbol("_vsh"),EB=Symbol(""),SB=/(?:^|;)\s*display\s*:/;function _B(r,e,t){const n=r.style,s=ir(t);let i=!1;if(t&&!s){if(e)if(ir(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&j1(n,a,"")}else for(const o in e)t[o]==null&&j1(n,o,"");for(const o in t)o==="display"&&(i=!0),j1(n,o,t[o])}else if(s){if(e!==t){const o=n[EB];o&&(t+=";"+o),n.cssText=t,i=SB.test(t)}}else e&&r.removeAttribute("style");Hb in r&&(r[Hb]=i?n.display:"",r[vB]&&(n.display="none"))}const qb=/\s*!important$/;function j1(r,e,t){if(je(t))t.forEach(n=>j1(r,e,n));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const n=xB(r,e);qb.test(t)?r.setProperty(na(n),t.replace(qb,""),"important"):r[n]=t}}const Kb=["Webkit","Moz","ms"],_m={};function xB(r,e){const t=_m[e];if(t)return t;let n=Fo(e);if(n!=="filter"&&n in r)return _m[e]=n;n=sx(n);for(let s=0;s<Kb.length;s++){const i=Kb[s]+n;if(i in r)return _m[e]=i}return e}const jb="http://www.w3.org/1999/xlink";function Wb(r,e,t,n,s,i=IO(e)){n&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(jb,e.slice(6,e.length)):r.setAttributeNS(jb,e,t):t==null||i&&!ox(t)?r.removeAttribute(e):r.setAttribute(e,i?"":ra(t)?String(t):t)}function Gb(r,e,t,n,s){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?sA(t):t);return}const i=r.tagName;if(e==="value"&&i!=="PROGRESS"&&!i.includes("-")){const a=i==="OPTION"?r.getAttribute("value")||"":r.value,c=t==null?r.type==="checkbox"?"on":"":String(t);(a!==c||!("_value"in r))&&(r.value=c),t==null&&r.removeAttribute(e),r._value=t;return}let o=!1;if(t===""||t==null){const a=typeof r[e];a==="boolean"?t=ox(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{r[e]=t}catch{}o&&r.removeAttribute(s||e)}function Fc(r,e,t,n){r.addEventListener(e,t,n)}function AB(r,e,t,n){r.removeEventListener(e,t,n)}const Yb=Symbol("_vei");function CB(r,e,t,n,s=null){const i=r[Yb]||(r[Yb]={}),o=i[e];if(n&&o)o.value=n;else{const[a,c]=kB(e);if(n){const l=i[e]=RB(n,s);Fc(r,a,l,c)}else o&&(AB(r,a,o,c),i[e]=void 0)}}const Qb=/(?:Once|Passive|Capture)$/;function kB(r){let e;if(Qb.test(r)){e={};let n;for(;n=r.match(Qb);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):na(r.slice(2)),e]}let xm=0;const IB=Promise.resolve(),TB=()=>xm||(IB.then(()=>xm=0),xm=Date.now());function RB(r,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;ti(PB(n,t.value),e,5,[n])};return t.value=r,t.attached=TB(),t}function PB(r,e){if(je(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(n=>s=>!s._stopped&&n&&n(s))}else return e}const Xb=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,DB=(r,e,t,n,s,i)=>{const o=s==="svg";e==="class"?bB(r,n,o):e==="style"?_B(r,t,n):mg(e)?Q6(e)||CB(r,e,t,n,i):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):NB(r,e,n,o))?(Gb(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Wb(r,e,n,o,i,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!ir(n))?Gb(r,Fo(e),n,i,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),Wb(r,e,n,o))};function NB(r,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&Xb(e)&&Je(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=r.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Xb(e)&&ir(t)?!1:e in r}const Jb=r=>{const e=r.props["onUpdate:modelValue"]||!1;return je(e)?t=>H1(e,t):e};function OB(r){r.target.composing=!0}function Zb(r){const e=r.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const Am=Symbol("_assign"),LB={created(r,{modifiers:{lazy:e,trim:t,number:n}},s){r[Am]=Jb(s);const i=n||s.props&&s.props.type==="number";Fc(r,e?"change":"input",o=>{if(o.target.composing)return;let a=r.value;t&&(a=a.trim()),i&&(a=Yy(a)),r[Am](a)}),t&&Fc(r,"change",()=>{r.value=r.value.trim()}),e||(Fc(r,"compositionstart",OB),Fc(r,"compositionend",Zb),Fc(r,"change",Zb))},mounted(r,{value:e}){r.value=e??""},beforeUpdate(r,{value:e,oldValue:t,modifiers:{lazy:n,trim:s,number:i}},o){if(r[Am]=Jb(o),r.composing)return;const a=(i||r.type==="number")&&!/^0\d/.test(r.value)?Yy(r.value):r.value,c=e??"";a!==c&&(document.activeElement===r&&r.type!=="range"&&(n&&e===t||s&&r.value.trim()===c)||(r.value=c))}},BB={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},MB=(r,e)=>{const t=r._withKeys||(r._withKeys={}),n=e.join(".");return t[n]||(t[n]=(s=>{if(!("key"in s))return;const i=na(s.key);if(e.some(o=>o===i||BB[o]===i))return r(s)}))},$B=jr({patchProp:DB},yB);let e7;function UB(){return e7||(e7=$L($B))}const FB=((...r)=>{const e=UB().createApp(...r),{mount:t}=e;return e.mount=n=>{const s=zB(n);if(!s)return;const i=e._component;!Je(i)&&!i.render&&!i.template&&(i.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const o=t(s,!1,VB(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e});function VB(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function zB(r){return ir(r)?document.querySelector(r):r}const pn=()=>new Map,a3=r=>{const e=pn();return r.forEach((t,n)=>{e.set(n,t)}),e},Rn=(r,e,t)=>{let n=r.get(e);return n===void 0&&r.set(e,n=t()),n},HB=(r,e)=>{const t=[];for(const[n,s]of r)t.push(e(s,n));return t},qB=(r,e)=>{for(const[t,n]of r)if(e(n,t))return!0;return!1},Ho=()=>new Set,Cm=r=>r[r.length-1],KB=(r,e)=>{for(let t=0;t<e.length;t++)r.push(e[t])},Vi=Array.from,jB=Array.isArray;class iA{constructor(){this._observers=pn()}on(e,t){return Rn(this._observers,e,Ho).add(t),t}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);n!==void 0&&(n.delete(t),n.size===0&&this._observers.delete(e))}emit(e,t){return Vi((this._observers.get(e)||pn()).values()).forEach(n=>n(...t))}destroy(){this._observers=pn()}}class gw{constructor(){this._observers=pn()}on(e,t){Rn(this._observers,e,Ho).add(t)}once(e,t){const n=(...s)=>{this.off(e,n),t(...s)};this.on(e,n)}off(e,t){const n=this._observers.get(e);n!==void 0&&(n.delete(t),n.size===0&&this._observers.delete(e))}emit(e,t){return Vi((this._observers.get(e)||pn()).values()).forEach(n=>n(...t))}destroy(){this._observers=pn()}}const ri=Math.floor,W1=Math.abs,WB=Math.log10,mw=(r,e)=>r<e?r:e,fc=(r,e)=>r>e?r:e,oA=r=>r!==0?r<0:1/r<0,t7=1,r7=2,km=4,Im=8,dd=32,Di=64,Tn=128,kg=31,c3=63,Da=127,GB=2147483647,aA=Number.MAX_SAFE_INTEGER,YB=Number.isInteger||(r=>typeof r=="number"&&isFinite(r)&&ri(r)===r),QB=String.fromCharCode,XB=r=>r.toLowerCase(),JB=/^\s*/g,ZB=r=>r.replace(JB,""),eM=/([A-Z])/g,n7=(r,e)=>ZB(r.replace(eM,t=>`${e}${XB(t)}`)),tM=r=>{const e=unescape(encodeURIComponent(r)),t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.codePointAt(s);return n},fd=typeof TextEncoder<"u"?new TextEncoder:null,rM=r=>fd.encode(r),l3=fd?rM:tM;let Uh=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Uh&&Uh.decode(new Uint8Array).length===1&&(Uh=null);let uf=class{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}};const pr=()=>new uf,nM=r=>{let e=r.cpos;for(let t=0;t<r.bufs.length;t++)e+=r.bufs[t].length;return e},jt=r=>{const e=new Uint8Array(nM(r));let t=0;for(let n=0;n<r.bufs.length;n++){const s=r.bufs[n];e.set(s,t),t+=s.length}return e.set(new Uint8Array(r.cbuf.buffer,0,r.cpos),t),e},sM=(r,e)=>{const t=r.cbuf.length;t-r.cpos<e&&(r.bufs.push(new Uint8Array(r.cbuf.buffer,0,r.cpos)),r.cbuf=new Uint8Array(fc(t,e)*2),r.cpos=0)},hr=(r,e)=>{const t=r.cbuf.length;r.cpos===t&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(t*2),r.cpos=0),r.cbuf[r.cpos++]=e},pd=hr,Ue=(r,e)=>{for(;e>Da;)hr(r,Tn|Da&e),e=ri(e/128);hr(r,Da&e)},yw=(r,e)=>{const t=oA(e);for(t&&(e=-e),hr(r,(e>c3?Tn:0)|(t?Di:0)|c3&e),e=ri(e/64);e>0;)hr(r,(e>Da?Tn:0)|Da&e),e=ri(e/128)},u3=new Uint8Array(3e4),iM=u3.length/3,oM=(r,e)=>{if(e.length<iM){const t=fd.encodeInto(e,u3).written||0;Ue(r,t);for(let n=0;n<t;n++)hr(r,u3[n])}else Yt(r,l3(e))},aM=(r,e)=>{const t=unescape(encodeURIComponent(e)),n=t.length;Ue(r,n);for(let s=0;s<n;s++)hr(r,t.codePointAt(s))},Ws=fd&&fd.encodeInto?oM:aM,Ig=(r,e)=>{const t=r.cbuf.length,n=r.cpos,s=mw(t-n,e.length),i=e.length-s;r.cbuf.set(e.subarray(0,s),n),r.cpos+=s,i>0&&(r.bufs.push(r.cbuf),r.cbuf=new Uint8Array(fc(t*2,i)),r.cbuf.set(e.subarray(s)),r.cpos=i)},Yt=(r,e)=>{Ue(r,e.byteLength),Ig(r,e)},ww=(r,e)=>{sM(r,e);const t=new DataView(r.cbuf.buffer,r.cpos,e);return r.cpos+=e,t},cM=(r,e)=>ww(r,4).setFloat32(0,e,!1),lM=(r,e)=>ww(r,8).setFloat64(0,e,!1),uM=(r,e)=>ww(r,8).setBigInt64(0,e,!1),s7=new DataView(new ArrayBuffer(4)),hM=r=>(s7.setFloat32(0,r),s7.getFloat32(0)===r),Sl=(r,e)=>{switch(typeof e){case"string":hr(r,119),Ws(r,e);break;case"number":YB(e)&&W1(e)<=GB?(hr(r,125),yw(r,e)):hM(e)?(hr(r,124),cM(r,e)):(hr(r,123),lM(r,e));break;case"bigint":hr(r,122),uM(r,e);break;case"object":if(e===null)hr(r,126);else if(jB(e)){hr(r,117),Ue(r,e.length);for(let t=0;t<e.length;t++)Sl(r,e[t])}else if(e instanceof Uint8Array)hr(r,116),Yt(r,e);else{hr(r,118);const t=Object.keys(e);Ue(r,t.length);for(let n=0;n<t.length;n++){const s=t[n];Ws(r,s),Sl(r,e[s])}}break;case"boolean":hr(r,e?120:121);break;default:hr(r,127)}};class i7 extends uf{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&Ue(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const o7=r=>{r.count>0&&(yw(r.encoder,r.count===1?r.s:-r.s),r.count>1&&Ue(r.encoder,r.count-2))};class G1{constructor(){this.encoder=new uf,this.s=0,this.count=0}write(e){this.s===e?this.count++:(o7(this),this.count=1,this.s=e)}toUint8Array(){return o7(this),jt(this.encoder)}}const a7=r=>{if(r.count>0){const e=r.diff*2+(r.count===1?0:1);yw(r.encoder,e),r.count>1&&Ue(r.encoder,r.count-2)}};class Tm{constructor(){this.encoder=new uf,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(a7(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return a7(this),jt(this.encoder)}}class dM{constructor(){this.sarr=[],this.s="",this.lensE=new G1}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new uf;return this.sarr.push(this.s),this.s="",Ws(e,this.sarr.join("")),Ig(e,this.lensE.toUint8Array()),jt(e)}}const xs=r=>new Error(r),Gs=()=>{throw xs("Method unimplemented")},ni=()=>{throw xs("Unexpected case")},cA=xs("Unexpected end of array"),lA=xs("Integer out of Range");let Tg=class{constructor(e){this.arr=e,this.pos=0}};const hi=r=>new Tg(r),fM=r=>r.pos!==r.arr.length,pM=(r,e)=>{const t=new Uint8Array(r.arr.buffer,r.pos+r.arr.byteOffset,e);return r.pos+=e,t},dr=r=>pM(r,Ge(r)),Fa=r=>r.arr[r.pos++],Ge=r=>{let e=0,t=1;const n=r.arr.length;for(;r.pos<n;){const s=r.arr[r.pos++];if(e=e+(s&Da)*t,t*=128,s<Tn)return e;if(e>aA)throw lA}throw cA},bw=r=>{let e=r.arr[r.pos++],t=e&c3,n=64;const s=(e&Di)>0?-1:1;if((e&Tn)===0)return s*t;const i=r.arr.length;for(;r.pos<i;){if(e=r.arr[r.pos++],t=t+(e&Da)*n,n*=128,e<Tn)return s*t;if(t>aA)throw lA}throw cA},gM=r=>{let e=Ge(r);if(e===0)return"";{let t=String.fromCodePoint(Fa(r));if(--e<100)for(;e--;)t+=String.fromCodePoint(Fa(r));else for(;e>0;){const n=e<1e4?e:1e4,s=r.arr.subarray(r.pos,r.pos+n);r.pos+=n,t+=String.fromCodePoint.apply(null,s),e-=n}return decodeURIComponent(escape(t))}},mM=r=>Uh.decode(dr(r)),Ni=Uh?mM:gM,vw=(r,e)=>{const t=new DataView(r.arr.buffer,r.arr.byteOffset+r.pos,e);return r.pos+=e,t},yM=r=>vw(r,4).getFloat32(0,!1),wM=r=>vw(r,8).getFloat64(0,!1),bM=r=>vw(r,8).getBigInt64(0,!1),vM=[r=>{},r=>null,bw,yM,wM,bM,r=>!1,r=>!0,Ni,r=>{const e=Ge(r),t={};for(let n=0;n<e;n++){const s=Ni(r);t[s]=_l(r)}return t},r=>{const e=Ge(r),t=[];for(let n=0;n<e;n++)t.push(_l(r));return t},dr],_l=r=>vM[127-Fa(r)](r);class c7 extends Tg{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),fM(this)?this.count=Ge(this)+1:this.count=-1),this.count--,this.s}}class Y1 extends Tg{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=bw(this);const e=oA(this.s);this.count=1,e&&(this.s=-this.s,this.count=Ge(this)+2)}return this.count--,this.s}}class Rm extends Tg{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=bw(this),t=e&1;this.diff=ri(e/2),this.count=1,t&&(this.count=Ge(this)+2)}return this.s+=this.diff,this.count--,this.s}}class EM{constructor(e){this.decoder=new Y1(e),this.str=Ni(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}const SM=crypto.getRandomValues.bind(crypto),_M=Math.random,uA=()=>SM(new Uint32Array(1))[0],xM="10000000-1000-4000-8000"+-1e11,hA=()=>xM.replace(/[018]/g,r=>(r^uA()&15>>r/4).toString(16)),zi=Date.now,xl=r=>new Promise(r);Promise.all.bind(Promise);const AM=r=>Promise.reject(r),Ew=r=>Promise.resolve(r),l7=r=>r===void 0?null:r;class CM{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let dA=new CM,Sw=!0;try{typeof localStorage<"u"&&localStorage&&(dA=localStorage,Sw=!1)}catch{}const fA=dA,kM=r=>Sw||addEventListener("storage",r),IM=r=>Sw||removeEventListener("storage",r),TM=Object.assign,pA=Object.keys,RM=(r,e)=>{for(const t in r)e(r[t],t)},u7=r=>pA(r).length,h7=r=>pA(r).length,PM=r=>{for(const e in r)return!1;return!0},DM=(r,e)=>{for(const t in r)if(!e(r[t],t))return!1;return!0},gA=(r,e)=>Object.prototype.hasOwnProperty.call(r,e),NM=(r,e)=>r===e||h7(r)===h7(e)&&DM(r,(t,n)=>(t!==void 0||gA(e,n))&&e[n]===t),OM=Object.freeze,mA=r=>{for(const e in r){const t=r[e];(typeof t=="object"||typeof t=="function")&&mA(r[e])}return OM(r)},d7=Symbol("Equality"),_w=(r,e,t=0)=>{try{for(;t<r.length;t++)r[t](...e)}finally{t<r.length&&_w(r,e,t+1)}},LM=()=>{},BM=r=>r,Fh=(r,e)=>{if(r===e)return!0;if(r==null||e==null||r.constructor!==e.constructor)return!1;if(r[d7]!=null)return r[d7](e);switch(r.constructor){case ArrayBuffer:r=new Uint8Array(r),e=new Uint8Array(e);case Uint8Array:{if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;break}case Set:{if(r.size!==e.size)return!1;for(const t of r)if(!e.has(t))return!1;break}case Map:{if(r.size!==e.size)return!1;for(const t of r.keys())if(!e.has(t)||!Fh(r.get(t),e.get(t)))return!1;break}case Object:if(u7(r)!==u7(e))return!1;for(const t in r)if(!gA(r,t)||!Fh(r[t],e[t]))return!1;break;case Array:if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(!Fh(r[t],e[t]))return!1;break;default:return!1}return!0},MM=(r,e)=>e.includes(r);var yA={};const Al=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name)&&Object.prototype.toString.call(typeof process<"u"?process:0)==="[object process]",wA=typeof window<"u"&&typeof document<"u"&&!Al;let Ls;const $M=()=>{if(Ls===void 0)if(Al){Ls=pn();const r=process.argv;let e=null;for(let t=0;t<r.length;t++){const n=r[t];n[0]==="-"?(e!==null&&Ls.set(e,""),e=n):e!==null&&(Ls.set(e,n),e=null)}e!==null&&Ls.set(e,"")}else typeof location=="object"?(Ls=pn(),(location.search||"?").slice(1).split("&").forEach(r=>{if(r.length!==0){const[e,t]=r.split("=");Ls.set(`--${n7(e,"-")}`,t),Ls.set(`-${n7(e,"-")}`,t)}})):Ls=pn();return Ls},h3=r=>$M().has(r),gd=r=>l7(Al?yA[r.toUpperCase().replaceAll("-","_")]:fA.getItem(r)),bA=r=>h3("--"+r)||gd(r)!==null;bA("production");const UM=Al&&MM(yA.FORCE_COLOR,["true","1","2"]),FM=UM||!h3("--no-colors")&&!bA("no-color")&&(!Al||process.stdout.isTTY)&&(!Al||h3("--color")||gd("COLORTERM")!==null||(gd("TERM")||"").includes("color")),vA=r=>new Uint8Array(r),VM=(r,e,t)=>new Uint8Array(r,e,t),zM=r=>new Uint8Array(r),HM=r=>{let e="";for(let t=0;t<r.byteLength;t++)e+=QB(r[t]);return btoa(e)},qM=r=>Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("base64"),KM=r=>{const e=atob(r),t=vA(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t},jM=r=>{const e=Buffer.from(r,"base64");return VM(e.buffer,e.byteOffset,e.byteLength)},EA=wA?HM:qM,SA=wA?KM:jM,WM=r=>{const e=vA(r.byteLength);return e.set(r),e};class GM{constructor(e,t){this.left=e,this.right=t}}const wi=(r,e)=>new GM(r,e);typeof DOMParser<"u"&&new DOMParser;const YM=r=>HB(r,(e,t)=>`${t}:${e};`).join(""),QM=JSON.stringify,Zi=Symbol,jn=Zi(),Va=Zi(),_A=Zi(),xw=Zi(),xA=Zi(),AA=Zi(),CA=Zi(),Rg=Zi(),Pg=Zi(),XM=r=>{r.length===1&&r[0]?.constructor===Function&&(r=r[0]());const e=[],t=[];let n=0;for(;n<r.length;n++){const s=r[n];if(s===void 0)break;if(s.constructor===String||s.constructor===Number)e.push(s);else if(s.constructor===Object)break}for(n>0&&t.push(e.join(""));n<r.length;n++){const s=r[n];s instanceof Symbol||t.push(s)}return t},f7=[xA,CA,Rg,_A];let Pm=0,p7=zi();const JM=(r,e)=>{const t=f7[Pm],n=gd("log"),s=n!==null&&(n==="*"||n==="true"||new RegExp(n,"gi").test(e));return Pm=(Pm+1)%f7.length,e+=": ",s?(...i)=>{i.length===1&&i[0]?.constructor===Function&&(i=i[0]());const o=zi(),a=o-p7;p7=o,r(t,e,Pg,...i.map(c=>{switch(c!=null&&c.constructor===Uint8Array&&(c=Array.from(c)),typeof c){case"string":case"symbol":return c;default:return QM(c)}}),t," +"+a+"ms")}:LM},ZM={[jn]:wi("font-weight","bold"),[Va]:wi("font-weight","normal"),[_A]:wi("color","blue"),[xA]:wi("color","green"),[xw]:wi("color","grey"),[AA]:wi("color","red"),[CA]:wi("color","purple"),[Rg]:wi("color","orange"),[Pg]:wi("color","black")},e$=r=>{r.length===1&&r[0]?.constructor===Function&&(r=r[0]());const e=[],t=[],n=pn();let s=[],i=0;for(;i<r.length;i++){const o=r[i],a=ZM[o];if(a!==void 0)n.set(a.left,a.right);else{if(o===void 0)break;if(o.constructor===String||o.constructor===Number){const c=YM(n);i>0||c.length>0?(e.push("%c"+o),t.push(c)):e.push(o)}else break}}for(i>0&&(s=t,s.unshift(e.join("")));i<r.length;i++){const o=r[i];o instanceof Symbol||s.push(o)}return s},kA=FM?e$:XM,IA=(...r)=>{console.log(...kA(r)),TA.forEach(e=>e.print(r))},t$=(...r)=>{console.warn(...kA(r)),r.unshift(Rg),TA.forEach(e=>e.print(r))},TA=Ho(),r$=r=>JM(IA,r),RA=r=>({[Symbol.iterator](){return this},next:r}),n$=(r,e)=>RA(()=>{let t;do t=r.next();while(!t.done&&!e(t.value));return t}),Dm=(r,e)=>RA(()=>{const{done:t,value:n}=r.next();return{done:t,value:t?void 0:e(n)}});class Aw{constructor(e,t){this.clock=e,this.len=t}}class hf{constructor(){this.clients=new Map}}const PA=(r,e,t)=>e.clients.forEach((n,s)=>{const i=r.doc.store.clients.get(s);if(i!=null){const o=i[i.length-1],a=o.id.clock+o.length;for(let c=0,l=n[c];c<n.length&&l.clock<a;l=n[++c])KA(r,i,l.clock,l.len,t)}}),s$=(r,e)=>{let t=0,n=r.length-1;for(;t<=n;){const s=ri((t+n)/2),i=r[s],o=i.clock;if(o<=e){if(e<o+i.len)return s;t=s+1}else n=s-1}return null},DA=(r,e)=>{const t=r.clients.get(e.client);return t!==void 0&&s$(t,e.clock)!==null},Cw=r=>{r.clients.forEach(e=>{e.sort((s,i)=>s.clock-i.clock);let t,n;for(t=1,n=1;t<e.length;t++){const s=e[n-1],i=e[t];s.clock+s.len>=i.clock?s.len=fc(s.len,i.clock+i.len-s.clock):(n<t&&(e[n]=i),n++)}e.length=n})},i$=r=>{const e=new hf;for(let t=0;t<r.length;t++)r[t].clients.forEach((n,s)=>{if(!e.clients.has(s)){const i=n.slice();for(let o=t+1;o<r.length;o++)KB(i,r[o].clients.get(s)||[]);e.clients.set(s,i)}});return Cw(e),e},vp=(r,e,t,n)=>{Rn(r.clients,e,()=>[]).push(new Aw(t,n))},o$=()=>new hf,a$=r=>{const e=o$();return r.clients.forEach((t,n)=>{const s=[];for(let i=0;i<t.length;i++){const o=t[i];if(o.deleted){const a=o.id.clock;let c=o.length;if(i+1<t.length)for(let l=t[i+1];i+1<t.length&&l.deleted;l=t[++i+1])c+=l.length;s.push(new Aw(a,c))}}s.length>0&&e.clients.set(n,s)}),e},hu=(r,e)=>{Ue(r.restEncoder,e.clients.size),Vi(e.clients.entries()).sort((t,n)=>n[0]-t[0]).forEach(([t,n])=>{r.resetDsCurVal(),Ue(r.restEncoder,t);const s=n.length;Ue(r.restEncoder,s);for(let i=0;i<s;i++){const o=n[i];r.writeDsClock(o.clock),r.writeDsLen(o.len)}})},kw=r=>{const e=new hf,t=Ge(r.restDecoder);for(let n=0;n<t;n++){r.resetDsCurVal();const s=Ge(r.restDecoder),i=Ge(r.restDecoder);if(i>0){const o=Rn(e.clients,s,()=>[]);for(let a=0;a<i;a++)o.push(new Aw(r.readDsClock(),r.readDsLen()))}}return e},g7=(r,e,t)=>{const n=new hf,s=Ge(r.restDecoder);for(let i=0;i<s;i++){r.resetDsCurVal();const o=Ge(r.restDecoder),a=Ge(r.restDecoder),c=t.clients.get(o)||[],l=mr(t,o);for(let u=0;u<a;u++){const h=r.readDsClock(),d=h+r.readDsLen();if(h<l){l<d&&vp(n,o,l,d-l);let f=si(c,h),g=c[f];for(!g.deleted&&g.id.clock<h&&(c.splice(f+1,0,kp(e,g,h-g.id.clock)),f++);f<c.length&&(g=c[f++],g.id.clock<d);)g.deleted||(d<g.id.clock+g.length&&c.splice(f,0,kp(e,g,d-g.id.clock)),g.delete(e))}else vp(n,o,h,d-h)}}if(n.clients.size>0){const i=new za;return Ue(i.restEncoder,0),hu(i,n),i.toUint8Array()}return null},NA=uA;class du extends iA{constructor({guid:e=hA(),collectionid:t=null,gc:n=!0,gcFilter:s=()=>!0,meta:i=null,autoLoad:o=!1,shouldLoad:a=!0}={}){super(),this.gc=n,this.gcFilter=s,this.clientID=NA(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new HA,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=o,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.isDestroyed=!1,this.whenLoaded=xl(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>xl(l=>{const u=h=>{(h===void 0||h===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isSynced&&!this.isLoaded&&this.emit("load",[this])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&kt(e.parent.doc,t=>{t.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(Vi(this.subdocs).map(e=>e.guid))}transact(e,t=null){return kt(this,e,t)}get(e,t=Cr){const n=Rn(this.share,e,()=>{const i=new t;return i._integrate(this,null),i}),s=n.constructor;if(t!==Cr&&s!==t)if(s===Cr){const i=new t;i._map=n._map,n._map.forEach(o=>{for(;o!==null;o=o.left)o.parent=i}),i._start=n._start;for(let o=i._start;o!==null;o=o.right)o.parent=i;return i._length=n._length,this.share.set(e,i),i._integrate(this,null),i}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return n}getArray(e=""){return this.get(e,al)}getText(e=""){return this.get(e,Il)}getMap(e=""){return this.get(e,kl)}getXmlElement(e=""){return this.get(e,Tl)}getXmlFragment(e=""){return this.get(e,Ha)}toJSON(){const e={};return this.share.forEach((t,n)=>{e[n]=t.toJSON()}),e}destroy(){this.isDestroyed=!0,Vi(this.subdocs).forEach(t=>t.destroy());const e=this._item;if(e!==null){this._item=null;const t=e.content;t.doc=new du({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,kt(e.parent.doc,n=>{const s=t.doc;e.deleted||n.subdocsAdded.add(s),n.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}}class OA{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return Ge(this.restDecoder)}readDsLen(){return Ge(this.restDecoder)}}class LA extends OA{readLeftID(){return at(Ge(this.restDecoder),Ge(this.restDecoder))}readRightID(){return at(Ge(this.restDecoder),Ge(this.restDecoder))}readClient(){return Ge(this.restDecoder)}readInfo(){return Fa(this.restDecoder)}readString(){return Ni(this.restDecoder)}readParentInfo(){return Ge(this.restDecoder)===1}readTypeRef(){return Ge(this.restDecoder)}readLen(){return Ge(this.restDecoder)}readAny(){return _l(this.restDecoder)}readBuf(){return WM(dr(this.restDecoder))}readJSON(){return JSON.parse(Ni(this.restDecoder))}readKey(){return Ni(this.restDecoder)}}class c${constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=Ge(this.restDecoder),this.dsCurrVal}readDsLen(){const e=Ge(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class Cl extends c${constructor(e){super(e),this.keys=[],Ge(e),this.keyClockDecoder=new Rm(dr(e)),this.clientDecoder=new Y1(dr(e)),this.leftClockDecoder=new Rm(dr(e)),this.rightClockDecoder=new Rm(dr(e)),this.infoDecoder=new c7(dr(e),Fa),this.stringDecoder=new EM(dr(e)),this.parentInfoDecoder=new c7(dr(e),Fa),this.typeRefDecoder=new Y1(dr(e)),this.lenDecoder=new Y1(dr(e))}readLeftID(){return new ol(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new ol(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return _l(this.restDecoder)}readBuf(){return dr(this.restDecoder)}readJSON(){return _l(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class BA{constructor(){this.restEncoder=pr()}toUint8Array(){return jt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){Ue(this.restEncoder,e)}writeDsLen(e){Ue(this.restEncoder,e)}}class df extends BA{writeLeftID(e){Ue(this.restEncoder,e.client),Ue(this.restEncoder,e.clock)}writeRightID(e){Ue(this.restEncoder,e.client),Ue(this.restEncoder,e.clock)}writeClient(e){Ue(this.restEncoder,e)}writeInfo(e){pd(this.restEncoder,e)}writeString(e){Ws(this.restEncoder,e)}writeParentInfo(e){Ue(this.restEncoder,e?1:0)}writeTypeRef(e){Ue(this.restEncoder,e)}writeLen(e){Ue(this.restEncoder,e)}writeAny(e){Sl(this.restEncoder,e)}writeBuf(e){Yt(this.restEncoder,e)}writeJSON(e){Ws(this.restEncoder,JSON.stringify(e))}writeKey(e){Ws(this.restEncoder,e)}}class MA{constructor(){this.restEncoder=pr(),this.dsCurrVal=0}toUint8Array(){return jt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,Ue(this.restEncoder,t)}writeDsLen(e){e===0&&ni(),Ue(this.restEncoder,e-1),this.dsCurrVal+=e}}class za extends MA{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new Tm,this.clientEncoder=new G1,this.leftClockEncoder=new Tm,this.rightClockEncoder=new Tm,this.infoEncoder=new i7(pd),this.stringEncoder=new dM,this.parentInfoEncoder=new i7(pd),this.typeRefEncoder=new G1,this.lenEncoder=new G1}toUint8Array(){const e=pr();return Ue(e,0),Yt(e,this.keyClockEncoder.toUint8Array()),Yt(e,this.clientEncoder.toUint8Array()),Yt(e,this.leftClockEncoder.toUint8Array()),Yt(e,this.rightClockEncoder.toUint8Array()),Yt(e,jt(this.infoEncoder)),Yt(e,this.stringEncoder.toUint8Array()),Yt(e,jt(this.parentInfoEncoder)),Yt(e,this.typeRefEncoder.toUint8Array()),Yt(e,this.lenEncoder.toUint8Array()),Ig(e,jt(this.restEncoder)),jt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){Sl(this.restEncoder,e)}writeBuf(e){Yt(this.restEncoder,e)}writeJSON(e){Sl(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);t===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const l$=(r,e,t,n)=>{n=fc(n,e[0].id.clock);const s=si(e,n);Ue(r.restEncoder,e.length-s),r.writeClient(t),Ue(r.restEncoder,n);const i=e[s];i.write(r,n-i.id.clock);for(let o=s+1;o<e.length;o++)e[o].write(r,0)},Iw=(r,e,t)=>{const n=new Map;t.forEach((s,i)=>{mr(e,i)>s&&n.set(i,s)}),Dg(e).forEach((s,i)=>{t.has(i)||n.set(i,0)}),Ue(r.restEncoder,n.size),Vi(n.entries()).sort((s,i)=>i[0]-s[0]).forEach(([s,i])=>{l$(r,e.clients.get(s),s,i)})},u$=(r,e)=>{const t=pn(),n=Ge(r.restDecoder);for(let s=0;s<n;s++){const i=Ge(r.restDecoder),o=new Array(i),a=r.readClient();let c=Ge(r.restDecoder);t.set(a,{i:0,refs:o});for(let l=0;l<i;l++){const u=r.readInfo();switch(kg&u){case 0:{const h=r.readLen();o[l]=new Hn(at(a,c),h),c+=h;break}case 10:{const h=Ge(r.restDecoder);o[l]=new qn(at(a,c),h),c+=h;break}default:{const h=(u&(Di|Tn))===0,d=new ar(at(a,c),null,(u&Tn)===Tn?r.readLeftID():null,null,(u&Di)===Di?r.readRightID():null,h?r.readParentInfo()?e.get(r.readString()):r.readLeftID():null,h&&(u&dd)===dd?r.readString():null,hC(r,u));o[l]=d,c+=d.length}}}}return t},h$=(r,e,t)=>{const n=[];let s=Vi(t.keys()).sort((f,g)=>f-g);if(s.length===0)return null;const i=()=>{if(s.length===0)return null;let f=t.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=t.get(s[s.length-1]);else return null;return f};let o=i();if(o===null)return null;const a=new HA,c=new Map,l=(f,g)=>{const m=c.get(f);(m==null||m>g)&&c.set(f,g)};let u=o.refs[o.i++];const h=new Map,d=()=>{for(const f of n){const g=f.id.client,m=t.get(g);m?(m.i--,a.clients.set(g,m.refs.slice(m.i)),t.delete(g),m.i=0,m.refs=[]):a.clients.set(g,[f]),s=s.filter(b=>b!==g)}n.length=0};for(;;){if(u.constructor!==qn){const g=Rn(h,u.id.client,()=>mr(e,u.id.client))-u.id.clock;if(g<0)n.push(u),l(u.id.client,u.id.clock-1),d();else{const m=u.getMissing(r,e);if(m!==null){n.push(u);const b=t.get(m)||{refs:[],i:0};if(b.refs.length===b.i)l(m,mr(e,m)),d();else{u=b.refs[b.i++];continue}}else(g===0||g<u.length)&&(u.integrate(r,g),h.set(u.id.client,u.id.clock+u.length))}}if(n.length>0)u=n.pop();else if(o!==null&&o.i<o.refs.length)u=o.refs[o.i++];else{if(o=i(),o===null)break;u=o.refs[o.i++]}}if(a.clients.size>0){const f=new za;return Iw(f,a,new Map),Ue(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},d$=(r,e)=>Iw(r,e.doc.store,e.beforeState),f$=(r,e,t,n=new Cl(r))=>kt(e,s=>{s.local=!1;let i=!1;const o=s.doc,a=o.store,c=u$(n,o),l=h$(s,a,c),u=a.pendingStructs;if(u){for(const[d,f]of u.missing)if(f<mr(a,d)){i=!0;break}if(l){for(const[d,f]of l.missing){const g=u.missing.get(d);(g==null||g>f)&&u.missing.set(d,f)}u.update=Ep([u.update,l.update])}}else a.pendingStructs=l;const h=g7(n,s,a);if(a.pendingDs){const d=new Cl(hi(a.pendingDs));Ge(d.restDecoder);const f=g7(d,s,a);h&&f?a.pendingDs=Ep([h,f]):a.pendingDs=h||f}else a.pendingDs=h;if(i){const d=a.pendingStructs.update;a.pendingStructs=null,$A(s.doc,d)}},t,!1),$A=(r,e,t,n=Cl)=>{const s=hi(e);f$(s,r,t,new n(s))},UA=(r,e,t)=>$A(r,e,t,LA),p$=(r,e,t=new Map)=>{Iw(r,e.store,t),hu(r,a$(e.store))},g$=(r,e=new Uint8Array([0]),t=new za)=>{const n=FA(e);p$(t,r,n);const s=[t.toUint8Array()];if(r.store.pendingDs&&s.push(r.store.pendingDs),r.store.pendingStructs&&s.push(R$(r.store.pendingStructs.update,e)),s.length>1){if(t.constructor===df)return I$(s.map((i,o)=>o===0?i:D$(i)));if(t.constructor===za)return Ep(s)}return s[0]},Tw=(r,e)=>g$(r,e,new df),m$=r=>{const e=new Map,t=Ge(r.restDecoder);for(let n=0;n<t;n++){const s=Ge(r.restDecoder),i=Ge(r.restDecoder);e.set(s,i)}return e},FA=r=>m$(new OA(hi(r))),VA=(r,e)=>(Ue(r.restEncoder,e.size),Vi(e.entries()).sort((t,n)=>n[0]-t[0]).forEach(([t,n])=>{Ue(r.restEncoder,t),Ue(r.restEncoder,n)}),r),y$=(r,e)=>VA(r,Dg(e.store)),w$=(r,e=new MA)=>(r instanceof Map?VA(e,r):y$(e,r),e.toUint8Array()),b$=r=>w$(r,new BA);class v${constructor(){this.l=[]}}const m7=()=>new v$,y7=(r,e)=>r.l.push(e),w7=(r,e)=>{const t=r.l,n=t.length;r.l=t.filter(s=>e!==s),n===r.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},zA=(r,e,t)=>_w(r.l,[e,t]);class ol{constructor(e,t){this.client=e,this.clock=t}}const Xf=(r,e)=>r===e||r!==null&&e!==null&&r.client===e.client&&r.clock===e.clock,at=(r,e)=>new ol(r,e),E$=r=>{for(const[e,t]of r.doc.share.entries())if(t===r)return e;throw ni()},Vc=(r,e)=>e===void 0?!r.deleted:e.sv.has(r.id.client)&&(e.sv.get(r.id.client)||0)>r.id.clock&&!DA(e.ds,r.id),d3=(r,e)=>{const t=Rn(r.meta,d3,Ho),n=r.doc.store;t.has(e)||(e.sv.forEach((s,i)=>{s<mr(n,i)&&qo(r,at(i,s))}),PA(r,e.ds,s=>{}),t.add(e))};class HA{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Dg=r=>{const e=new Map;return r.clients.forEach((t,n)=>{const s=t[t.length-1];e.set(n,s.id.clock+s.length)}),e},mr=(r,e)=>{const t=r.clients.get(e);if(t===void 0)return 0;const n=t[t.length-1];return n.id.clock+n.length},qA=(r,e)=>{let t=r.clients.get(e.id.client);if(t===void 0)t=[],r.clients.set(e.id.client,t);else{const n=t[t.length-1];if(n.id.clock+n.length!==e.id.clock)throw ni()}t.push(e)},si=(r,e)=>{let t=0,n=r.length-1,s=r[n],i=s.id.clock;if(i===e)return n;let o=ri(e/(i+s.length-1)*n);for(;t<=n;){if(s=r[o],i=s.id.clock,i<=e){if(e<i+s.length)return o;t=o+1}else n=o-1;o=ri((t+n)/2)}throw ni()},S$=(r,e)=>{const t=r.clients.get(e.client);return t[si(t,e.clock)]},Nm=S$,f3=(r,e,t)=>{const n=si(e,t),s=e[n];return s.id.clock<t&&s instanceof ar?(e.splice(n+1,0,kp(r,s,t-s.id.clock)),n+1):n},qo=(r,e)=>{const t=r.doc.store.clients.get(e.client);return t[f3(r,t,e.clock)]},b7=(r,e,t)=>{const n=e.clients.get(t.client),s=si(n,t.clock),i=n[s];return t.clock!==i.id.clock+i.length-1&&i.constructor!==Hn&&n.splice(s+1,0,kp(r,i,t.clock-i.id.clock+1)),i},_$=(r,e,t)=>{const n=r.clients.get(e.id.client);n[si(n,e.id.clock)]=t},KA=(r,e,t,n,s)=>{if(n===0)return;const i=t+n;let o=f3(r,e,t),a;do a=e[o++],i<a.id.clock+a.length&&f3(r,e,i),s(a);while(o<e.length&&e[o].id.clock<i)};class x${constructor(e,t,n){this.doc=e,this.deleteSet=new hf,this.beforeState=Dg(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const v7=(r,e)=>e.deleteSet.clients.size===0&&!qB(e.afterState,(t,n)=>e.beforeState.get(n)!==t)?!1:(Cw(e.deleteSet),d$(r,e),hu(r,e.deleteSet),!0),E7=(r,e,t)=>{const n=e._item;(n===null||n.id.clock<(r.beforeState.get(n.id.client)||0)&&!n.deleted)&&Rn(r.changed,e,Ho).add(t)},Q1=(r,e)=>{let t=r[e],n=r[e-1],s=e;for(;s>0;t=n,n=r[--s-1]){if(n.deleted===t.deleted&&n.constructor===t.constructor&&n.mergeWith(t)){t instanceof ar&&t.parentSub!==null&&t.parent._map.get(t.parentSub)===t&&t.parent._map.set(t.parentSub,n);continue}break}const i=e-s;return i&&r.splice(e+1-i,i),i},A$=(r,e,t)=>{for(const[n,s]of r.clients.entries()){const i=e.clients.get(n);for(let o=s.length-1;o>=0;o--){const a=s[o],c=a.clock+a.len;for(let l=si(i,a.clock),u=i[l];l<i.length&&u.id.clock<c;u=i[++l]){const h=i[l];if(a.clock+a.len<=h.id.clock)break;h instanceof ar&&h.deleted&&!h.keep&&t(h)&&h.gc(e,!1)}}}},C$=(r,e)=>{r.clients.forEach((t,n)=>{const s=e.clients.get(n);for(let i=t.length-1;i>=0;i--){const o=t[i],a=mw(s.length-1,1+si(s,o.clock+o.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=o.clock;l=s[c])c-=1+Q1(s,c)}})},jA=(r,e)=>{if(e<r.length){const t=r[e],n=t.doc,s=n.store,i=t.deleteSet,o=t._mergeStructs;try{Cw(i),t.afterState=Dg(t.doc.store),n.emit("beforeObserverCalls",[t,n]);const a=[];t.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(t,c)})),a.push(()=>{t.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,h)=>u.path.length-h.path.length),zA(l._dEH,c,t))})}),a.push(()=>n.emit("afterTransaction",[t,n])),_w(a,[]),t._needFormattingCleanup&&j$(t)}finally{n.gc&&A$(i,s,n.gcFilter),C$(i,s),t.afterState.forEach((u,h)=>{const d=t.beforeState.get(h)||0;if(d!==u){const f=s.clients.get(h),g=fc(si(f,d),1);for(let m=f.length-1;m>=g;)m-=1+Q1(f,m)}});for(let u=o.length-1;u>=0;u--){const{client:h,clock:d}=o[u].id,f=s.clients.get(h),g=si(f,d);g+1<f.length&&Q1(f,g+1)>1||g>0&&Q1(f,g)}if(!t.local&&t.afterState.get(n.clientID)!==t.beforeState.get(n.clientID)&&(IA(Rg,jn,"[yjs] ",Va,AA,"Changed the client-id because another client seems to be using it."),n.clientID=NA()),n.emit("afterTransactionCleanup",[t,n]),n._observers.has("update")){const u=new df;v7(u,t)&&n.emit("update",[u.toUint8Array(),t.origin,n,t])}if(n._observers.has("updateV2")){const u=new za;v7(u,t)&&n.emit("updateV2",[u.toUint8Array(),t.origin,n,t])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=t;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=n.clientID,u.collectionid==null&&(u.collectionid=n.collectionid),n.subdocs.add(u)}),l.forEach(u=>n.subdocs.delete(u)),n.emit("subdocs",[{loaded:c,added:a,removed:l},n,t]),l.forEach(u=>u.destroy())),r.length<=e+1?(n._transactionCleanups=[],n.emit("afterAllTransactions",[n,r])):jA(r,e+1)}}},kt=(r,e,t=null,n=!0)=>{const s=r._transactionCleanups;let i=!1,o=null;r._transaction===null&&(i=!0,r._transaction=new x$(r,t,n),s.push(r._transaction),s.length===1&&r.emit("beforeAllTransactions",[r]),r.emit("beforeTransaction",[r._transaction,r]));try{o=e(r._transaction)}finally{if(i){const a=r._transaction===s[0];r._transaction=null,a&&jA(s,0)}}return o};function*k$(r){const e=Ge(r.restDecoder);for(let t=0;t<e;t++){const n=Ge(r.restDecoder),s=r.readClient();let i=Ge(r.restDecoder);for(let o=0;o<n;o++){const a=r.readInfo();if(a===10){const c=Ge(r.restDecoder);yield new qn(at(s,i),c),i+=c}else if((kg&a)!==0){const c=(a&(Di|Tn))===0,l=new ar(at(s,i),null,(a&Tn)===Tn?r.readLeftID():null,null,(a&Di)===Di?r.readRightID():null,c?r.readParentInfo()?r.readString():r.readLeftID():null,c&&(a&dd)===dd?r.readString():null,hC(r,a));yield l,i+=l.length}else{const c=r.readLen();yield new Hn(at(s,i),c),i+=c}}}}class Rw{constructor(e,t){this.gen=k$(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===qn);return this.curr}}class Pw{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const I$=r=>Ep(r,LA,df),T$=(r,e)=>{if(r.constructor===Hn){const{client:t,clock:n}=r.id;return new Hn(at(t,n+e),r.length-e)}else if(r.constructor===qn){const{client:t,clock:n}=r.id;return new qn(at(t,n+e),r.length-e)}else{const t=r,{client:n,clock:s}=t.id;return new ar(at(n,s+e),null,at(n,s+e-1),null,t.rightOrigin,t.parent,t.parentSub,t.content.splice(e))}},Ep=(r,e=Cl,t=za)=>{if(r.length===1)return r[0];const n=r.map(u=>new e(hi(u)));let s=n.map(u=>new Rw(u,!0)),i=null;const o=new t,a=new Pw(o);for(;s=s.filter(d=>d.curr!==null),s.sort((d,f)=>{if(d.curr.id.client===f.curr.id.client){const g=d.curr.id.clock-f.curr.id.clock;return g===0?d.curr.constructor===f.curr.constructor?0:d.curr.constructor===qn?1:-1:g}else return f.curr.id.client-d.curr.id.client}),s.length!==0;){const u=s[0],h=u.curr.id.client;if(i!==null){let d=u.curr,f=!1;for(;d!==null&&d.id.clock+d.length<=i.struct.id.clock+i.struct.length&&d.id.client>=i.struct.id.client;)d=u.next(),f=!0;if(d===null||d.id.client!==h||f&&d.id.clock>i.struct.id.clock+i.struct.length)continue;if(h!==i.struct.id.client)_o(a,i.struct,i.offset),i={struct:d,offset:0},u.next();else if(i.struct.id.clock+i.struct.length<d.id.clock)if(i.struct.constructor===qn)i.struct.length=d.id.clock+d.length-i.struct.id.clock;else{_o(a,i.struct,i.offset);const g=d.id.clock-i.struct.id.clock-i.struct.length;i={struct:new qn(at(h,i.struct.id.clock+i.struct.length),g),offset:0}}else{const g=i.struct.id.clock+i.struct.length-d.id.clock;g>0&&(i.struct.constructor===qn?i.struct.length-=g:d=T$(d,g)),i.struct.mergeWith(d)||(_o(a,i.struct,i.offset),i={struct:d,offset:0},u.next())}}else i={struct:u.curr,offset:0},u.next();for(let d=u.curr;d!==null&&d.id.client===h&&d.id.clock===i.struct.id.clock+i.struct.length&&d.constructor!==qn;d=u.next())_o(a,i.struct,i.offset),i={struct:d,offset:0}}i!==null&&(_o(a,i.struct,i.offset),i=null),Dw(a);const c=n.map(u=>kw(u)),l=i$(c);return hu(o,l),o.toUint8Array()},R$=(r,e,t=Cl,n=za)=>{const s=FA(e),i=new n,o=new Pw(i),a=new t(hi(r)),c=new Rw(a,!1);for(;c.curr;){const u=c.curr,h=u.id.client,d=s.get(h)||0;if(c.curr.constructor===qn){c.next();continue}if(u.id.clock+u.length>d)for(_o(o,u,fc(d-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===h;)_o(o,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===h&&c.curr.id.clock+c.curr.length<=d;)c.next()}Dw(o);const l=kw(a);return hu(i,l),i.toUint8Array()},WA=r=>{r.written>0&&(r.clientStructs.push({written:r.written,restEncoder:jt(r.encoder.restEncoder)}),r.encoder.restEncoder=pr(),r.written=0)},_o=(r,e,t)=>{r.written>0&&r.currClient!==e.id.client&&WA(r),r.written===0&&(r.currClient=e.id.client,r.encoder.writeClient(e.id.client),Ue(r.encoder.restEncoder,e.id.clock+t)),e.write(r.encoder,t),r.written++},Dw=r=>{WA(r);const e=r.encoder.restEncoder;Ue(e,r.clientStructs.length);for(let t=0;t<r.clientStructs.length;t++){const n=r.clientStructs[t];Ue(e,n.written),Ig(e,n.restEncoder)}},P$=(r,e,t,n)=>{const s=new t(hi(r)),i=new Rw(s,!1),o=new n,a=new Pw(o);for(let l=i.curr;l!==null;l=i.next())_o(a,e(l),0);Dw(a);const c=kw(s);return hu(o,c),o.toUint8Array()},D$=r=>P$(r,BM,Cl,df),S7="You must not compute changes after the event-handler fired.";class Ng{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=N$(this.currentTarget,this.target))}deletes(e){return DA(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw xs(S7);const e=new Map,t=this.target;this.transaction.changed.get(t).forEach(s=>{if(s!==null){const i=t._map.get(s);let o,a;if(this.adds(i)){let c=i.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(i))if(c!==null&&this.deletes(c))o="delete",a=Cm(c.content.getContent());else return;else c!==null&&this.deletes(c)?(o="update",a=Cm(c.content.getContent())):(o="add",a=void 0)}else if(this.deletes(i))o="delete",a=Cm(i.content.getContent());else return;e.set(s,{action:o,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw xs(S7);const t=this.target,n=Ho(),s=Ho(),i=[];if(e={added:n,deleted:s,delta:i,keys:this.keys},this.transaction.changed.get(t).has(null)){let a=null;const c=()=>{a&&i.push(a)};for(let l=t._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),n.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const N$=(r,e)=>{const t=[];for(;e._item!==null&&e!==r;){if(e._item.parentSub!==null)t.unshift(e._item.parentSub);else{let n=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)!s.deleted&&s.countable&&(n+=s.length),s=s.right;t.unshift(n)}e=e._item.parent}return t},qr=()=>{t$("Invalid access: Add Yjs type to a document before reading data.")},GA=80;let Nw=0;class O${constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=Nw++}}const L$=r=>{r.timestamp=Nw++},YA=(r,e,t)=>{r.p.marker=!1,r.p=e,e.marker=!0,r.index=t,r.timestamp=Nw++},B$=(r,e,t)=>{if(r.length>=GA){const n=r.reduce((s,i)=>s.timestamp<i.timestamp?s:i);return YA(n,e,t),n}else{const n=new O$(e,t);return r.push(n),n}},Og=(r,e)=>{if(r._start===null||e===0||r._searchMarker===null)return null;const t=r._searchMarker.length===0?null:r._searchMarker.reduce((i,o)=>W1(e-i.index)<W1(e-o.index)?i:o);let n=r._start,s=0;for(t!==null&&(n=t.p,s=t.index,L$(t));n.right!==null&&s<e;){if(!n.deleted&&n.countable){if(e<s+n.length)break;s+=n.length}n=n.right}for(;n.left!==null&&s>e;)n=n.left,!n.deleted&&n.countable&&(s-=n.length);for(;n.left!==null&&n.left.id.client===n.id.client&&n.left.id.clock+n.left.length===n.id.clock;)n=n.left,!n.deleted&&n.countable&&(s-=n.length);return t!==null&&W1(t.index-s)<n.parent.length/GA?(YA(t,n,s),t):B$(r._searchMarker,n,s)},md=(r,e,t)=>{for(let n=r.length-1;n>=0;n--){const s=r[n];if(t>0){let i=s.p;for(i.marker=!1;i&&(i.deleted||!i.countable);)i=i.left,i&&!i.deleted&&i.countable&&(s.index-=i.length);if(i===null||i.marker===!0){r.splice(n,1);continue}s.p=i,i.marker=!0}(e<s.index||t>0&&e===s.index)&&(s.index=fc(e,s.index+t))}},Lg=(r,e,t)=>{const n=r,s=e.changedParentTypes;for(;Rn(s,r,()=>[]).push(t),r._item!==null;)r=r._item.parent;zA(n._eH,t,e)};class Cr{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=m7(),this._dEH=m7(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw Gs()}clone(){throw Gs()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){y7(this._eH,e)}observeDeep(e){y7(this._dEH,e)}unobserve(e){w7(this._eH,e)}unobserveDeep(e){w7(this._dEH,e)}toJSON(){}}const QA=(r,e,t)=>{r.doc??qr(),e<0&&(e=r._length+e),t<0&&(t=r._length+t);let n=t-e;const s=[];let i=r._start;for(;i!==null&&n>0;){if(i.countable&&!i.deleted){const o=i.content.getContent();if(o.length<=e)e-=o.length;else{for(let a=e;a<o.length&&n>0;a++)s.push(o[a]),n--;e=0}}i=i.right}return s},XA=r=>{r.doc??qr();const e=[];let t=r._start;for(;t!==null;){if(t.countable&&!t.deleted){const n=t.content.getContent();for(let s=0;s<n.length;s++)e.push(n[s])}t=t.right}return e},yd=(r,e)=>{let t=0,n=r._start;for(r.doc??qr();n!==null;){if(n.countable&&!n.deleted){const s=n.content.getContent();for(let i=0;i<s.length;i++)e(s[i],t++,r)}n=n.right}},JA=(r,e)=>{const t=[];return yd(r,(n,s)=>{t.push(e(n,s,r))}),t},M$=r=>{let e=r._start,t=null,n=0;return{[Symbol.iterator](){return this},next:()=>{if(t===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};t=e.content.getContent(),n=0,e=e.right}const s=t[n++];return t.length<=n&&(t=null),{done:!1,value:s}}}},ZA=(r,e)=>{r.doc??qr();const t=Og(r,e);let n=r._start;for(t!==null&&(n=t.p,e-=t.index);n!==null;n=n.right)if(!n.deleted&&n.countable){if(e<n.length)return n.content.getContent()[e];e-=n.length}},Sp=(r,e,t,n)=>{let s=t;const i=r.doc,o=i.clientID,a=i.store,c=t===null?e._start:t.right;let l=[];const u=()=>{l.length>0&&(s=new ar(at(o,mr(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new qa(l)),s.integrate(r,0),l=[])};n.forEach(h=>{if(h===null)l.push(h);else switch(h.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(h);break;default:switch(u(),h.constructor){case Uint8Array:case ArrayBuffer:s=new ar(at(o,mr(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new ff(new Uint8Array(h))),s.integrate(r,0);break;case du:s=new ar(at(o,mr(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new pf(h)),s.integrate(r,0);break;default:if(h instanceof Cr)s=new ar(at(o,mr(a,o)),s,s&&s.lastId,c,c&&c.id,e,null,new gc(h)),s.integrate(r,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},eC=()=>xs("Length exceeded!"),tC=(r,e,t,n)=>{if(t>e._length)throw eC();if(t===0)return e._searchMarker&&md(e._searchMarker,t,n.length),Sp(r,e,null,n);const s=t,i=Og(e,t);let o=e._start;for(i!==null&&(o=i.p,t-=i.index,t===0&&(o=o.prev,t+=o&&o.countable&&!o.deleted?o.length:0));o!==null;o=o.right)if(!o.deleted&&o.countable){if(t<=o.length){t<o.length&&qo(r,at(o.id.client,o.id.clock+t));break}t-=o.length}return e._searchMarker&&md(e._searchMarker,s,n.length),Sp(r,e,o,n)},$$=(r,e,t)=>{let s=(e._searchMarker||[]).reduce((i,o)=>o.index>i.index?o:i,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Sp(r,e,s,t)},rC=(r,e,t,n)=>{if(n===0)return;const s=t,i=n,o=Og(e,t);let a=e._start;for(o!==null&&(a=o.p,t-=o.index);a!==null&&t>0;a=a.right)!a.deleted&&a.countable&&(t<a.length&&qo(r,at(a.id.client,a.id.clock+t)),t-=a.length);for(;n>0&&a!==null;)a.deleted||(n<a.length&&qo(r,at(a.id.client,a.id.clock+n)),a.delete(r),n-=a.length),a=a.right;if(n>0)throw eC();e._searchMarker&&md(e._searchMarker,s,-i+n)},_p=(r,e,t)=>{const n=e._map.get(t);n!==void 0&&n.delete(r)},Ow=(r,e,t,n)=>{const s=e._map.get(t)||null,i=r.doc,o=i.clientID;let a;if(n==null)a=new qa([n]);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:case Date:case BigInt:a=new qa([n]);break;case Uint8Array:a=new ff(n);break;case du:a=new pf(n);break;default:if(n instanceof Cr)a=new gc(n);else throw new Error("Unexpected content type")}new ar(at(o,mr(i.store,o)),s,s&&s.lastId,null,null,e,t,a).integrate(r,0)},Lw=(r,e)=>{r.doc??qr();const t=r._map.get(e);return t!==void 0&&!t.deleted?t.content.getContent()[t.length-1]:void 0},nC=r=>{const e={};return r.doc??qr(),r._map.forEach((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])}),e},sC=(r,e)=>{r.doc??qr();const t=r._map.get(e);return t!==void 0&&!t.deleted},U$=(r,e)=>{const t={};return r._map.forEach((n,s)=>{let i=n;for(;i!==null&&(!e.sv.has(i.id.client)||i.id.clock>=(e.sv.get(i.id.client)||0));)i=i.left;i!==null&&Vc(i,e)&&(t[s]=i.content.getContent()[i.length-1])}),t},Jf=r=>(r.doc??qr(),n$(r._map.entries(),e=>!e[1].deleted));class F$ extends Ng{}class al extends Cr{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new al;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new al}clone(){const e=new al;return e.insert(0,this.toArray().map(t=>t instanceof Cr?t.clone():t)),e}get length(){return this.doc??qr(),this._length}_callObserver(e,t){super._callObserver(e,t),Lg(this,e,new F$(this,e))}insert(e,t){this.doc!==null?kt(this.doc,n=>{tC(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}push(e){this.doc!==null?kt(this.doc,t=>{$$(t,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){this.doc!==null?kt(this.doc,n=>{rC(n,this,e,t)}):this._prelimContent.splice(e,t)}get(e){return ZA(this,e)}toArray(){return XA(this)}slice(e=0,t=this.length){return QA(this,e,t)}toJSON(){return this.map(e=>e instanceof Cr?e.toJSON():e)}map(e){return JA(this,e)}forEach(e){yd(this,e)}[Symbol.iterator](){return M$(this)}_write(e){e.writeTypeRef(hU)}}const V$=r=>new al;class z$ extends Ng{constructor(e,t,n){super(e,t),this.keysChanged=n}}class kl extends Cr{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach((n,s)=>{this.set(s,n)}),this._prelimContent=null}_copy(){return new kl}clone(){const e=new kl;return this.forEach((t,n)=>{e.set(n,t instanceof Cr?t.clone():t)}),e}_callObserver(e,t){Lg(this,e,new z$(this,e,t))}toJSON(){this.doc??qr();const e={};return this._map.forEach((t,n)=>{if(!t.deleted){const s=t.content.getContent()[t.length-1];e[n]=s instanceof Cr?s.toJSON():s}}),e}get size(){return[...Jf(this)].length}keys(){return Dm(Jf(this),e=>e[0])}values(){return Dm(Jf(this),e=>e[1].content.getContent()[e[1].length-1])}entries(){return Dm(Jf(this),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this.doc??qr(),this._map.forEach((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?kt(this.doc,t=>{_p(t,this,e)}):this._prelimContent.delete(e)}set(e,t){return this.doc!==null?kt(this.doc,n=>{Ow(n,this,e,t)}):this._prelimContent.set(e,t),t}get(e){return Lw(this,e)}has(e){return sC(this,e)}clear(){this.doc!==null?kt(this.doc,e=>{this.forEach(function(t,n,s){_p(e,s,n)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(dU)}}const H$=r=>new kl,Ao=(r,e)=>r===e||typeof r=="object"&&typeof e=="object"&&r&&e&&NM(r,e);class p3{constructor(e,t,n,s){this.left=e,this.right=t,this.index=n,this.currentAttributes=s}forward(){switch(this.right===null&&ni(),this.right.content.constructor){case cr:this.right.deleted||fu(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const _7=(r,e,t)=>{for(;e.right!==null&&t>0;){switch(e.right.content.constructor){case cr:e.right.deleted||fu(e.currentAttributes,e.right.content);break;default:e.right.deleted||(t<e.right.length&&qo(r,at(e.right.id.client,e.right.id.clock+t)),e.index+=e.right.length,t-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Zf=(r,e,t,n)=>{const s=new Map,i=n?Og(e,t):null;if(i){const o=new p3(i.p.left,i.p,i.index,s);return _7(r,o,t-i.index)}else{const o=new p3(null,e._start,0,s);return _7(r,o,t)}},iC=(r,e,t,n)=>{for(;t.right!==null&&(t.right.deleted===!0||t.right.content.constructor===cr&&Ao(n.get(t.right.content.key),t.right.content.value));)t.right.deleted||n.delete(t.right.content.key),t.forward();const s=r.doc,i=s.clientID;n.forEach((o,a)=>{const c=t.left,l=t.right,u=new ar(at(i,mr(s.store,i)),c,c&&c.lastId,l,l&&l.id,e,null,new cr(a,o));u.integrate(r,0),t.right=u,t.forward()})},fu=(r,e)=>{const{key:t,value:n}=e;n===null?r.delete(t):r.set(t,n)},oC=(r,e)=>{for(;r.right!==null;){if(!(r.right.deleted||r.right.content.constructor===cr&&Ao(e[r.right.content.key]??null,r.right.content.value)))break;r.forward()}},aC=(r,e,t,n)=>{const s=r.doc,i=s.clientID,o=new Map;for(const a in n){const c=n[a],l=t.currentAttributes.get(a)??null;if(!Ao(l,c)){o.set(a,l);const{left:u,right:h}=t;t.right=new ar(at(i,mr(s.store,i)),u,u&&u.lastId,h,h&&h.id,e,null,new cr(a,c)),t.right.integrate(r,0),t.forward()}}return o},Om=(r,e,t,n,s)=>{t.currentAttributes.forEach((d,f)=>{s[f]===void 0&&(s[f]=null)});const i=r.doc,o=i.clientID;oC(t,s);const a=aC(r,e,t,s),c=n.constructor===String?new ii(n):n instanceof Cr?new gc(n):new pc(n);let{left:l,right:u,index:h}=t;e._searchMarker&&md(e._searchMarker,t.index,c.getLength()),u=new ar(at(o,mr(i.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(r,0),t.right=u,t.index=h,t.forward(),iC(r,e,t,a)},x7=(r,e,t,n,s)=>{const i=r.doc,o=i.clientID;oC(t,s);const a=aC(r,e,t,s);e:for(;t.right!==null&&(n>0||a.size>0&&(t.right.deleted||t.right.content.constructor===cr));){if(!t.right.deleted)switch(t.right.content.constructor){case cr:{const{key:c,value:l}=t.right.content,u=s[c];if(u!==void 0){if(Ao(u,l))a.delete(c);else{if(n===0)break e;a.set(c,l)}t.right.delete(r)}else t.currentAttributes.set(c,l);break}default:n<t.right.length&&qo(r,at(t.right.id.client,t.right.id.clock+n)),n-=t.right.length;break}t.forward()}if(n>0){let c="";for(;n>0;n--)c+=`
`;t.right=new ar(at(o,mr(i.store,o)),t.left,t.left&&t.left.lastId,t.right,t.right&&t.right.id,e,null,new ii(c)),t.right.integrate(r,0),t.forward()}iC(r,e,t,a)},cC=(r,e,t,n,s)=>{let i=e;const o=pn();for(;i&&(!i.countable||i.deleted);){if(!i.deleted&&i.content.constructor===cr){const l=i.content;o.set(l.key,l)}i=i.right}let a=0,c=!1;for(;e!==i;){if(t===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case cr:{const{key:u,value:h}=l,d=n.get(u)??null;(o.get(u)!==l||d===h)&&(e.delete(r),a++,!c&&(s.get(u)??null)===h&&d!==h&&(d===null?s.delete(u):s.set(u,d))),!c&&!e.deleted&&fu(s,l);break}}}e=e.right}return a},q$=(r,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const t=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===cr){const n=e.content.key;t.has(n)?e.delete(r):t.add(n)}e=e.left}},K$=r=>{let e=0;return kt(r.doc,t=>{let n=r._start,s=r._start,i=pn();const o=a3(i);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case cr:fu(o,s.content);break;default:e+=cC(t,n,s,i,o),i=a3(o),n=s;break}s=s.right}}),e},j$=r=>{const e=new Set,t=r.doc;for(const[n,s]of r.afterState.entries()){const i=r.beforeState.get(n)||0;s!==i&&KA(r,t.store.clients.get(n),i,s,o=>{!o.deleted&&o.content.constructor===cr&&o.constructor!==Hn&&e.add(o.parent)})}kt(t,n=>{PA(r,r.deleteSet,s=>{if(s instanceof Hn||!s.parent._hasFormatting||e.has(s.parent))return;const i=s.parent;s.content.constructor===cr?e.add(i):q$(n,s)});for(const s of e)K$(s)})},A7=(r,e,t)=>{const n=t,s=a3(e.currentAttributes),i=e.right;for(;t>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case gc:case pc:case ii:t<e.right.length&&qo(r,at(e.right.id.client,e.right.id.clock+t)),t-=e.right.length,e.right.delete(r);break}e.forward()}i&&cC(r,i,e.right,s,e.currentAttributes);const o=(e.left||e.right).parent;return o._searchMarker&&md(o._searchMarker,e.index,-n+t),e};class W$ extends Ng{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,t=[];kt(e,n=>{const s=new Map,i=new Map;let o=this.target._start,a=null;const c={};let l="",u=0,h=0;const d=()=>{if(a!==null){let f=null;switch(a){case"delete":h>0&&(f={delete:h}),h=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((g,m)=>{g!==null&&(f.attributes[m]=g)}))),l="";break;case"retain":u>0&&(f={retain:u},PM(c)||(f.attributes=TM({},c))),u=0;break}f&&t.push(f),a=null}};for(;o!==null;){switch(o.content.constructor){case gc:case pc:this.adds(o)?this.deletes(o)||(d(),a="insert",l=o.content.getContent()[0],d()):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=1):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=1);break;case ii:this.adds(o)?this.deletes(o)||(a!=="insert"&&(d(),a="insert"),l+=o.content.str):this.deletes(o)?(a!=="delete"&&(d(),a="delete"),h+=o.length):o.deleted||(a!=="retain"&&(d(),a="retain"),u+=o.length);break;case cr:{const{key:f,value:g}=o.content;if(this.adds(o)){if(!this.deletes(o)){const m=s.get(f)??null;Ao(m,g)?g!==null&&o.delete(n):(a==="retain"&&d(),Ao(g,i.get(f)??null)?delete c[f]:c[f]=g)}}else if(this.deletes(o)){i.set(f,g);const m=s.get(f)??null;Ao(m,g)||(a==="retain"&&d(),c[f]=m)}else if(!o.deleted){i.set(f,g);const m=c[f];m!==void 0&&(Ao(m,g)?m!==null&&o.delete(n):(a==="retain"&&d(),g===null?delete c[f]:c[f]=g))}o.deleted||(a==="insert"&&d(),fu(s,o.content));break}}o=o.right}for(d();t.length>0;){const f=t[t.length-1];if(f.retain!==void 0&&f.attributes===void 0)t.pop();else break}}),this._delta=t}return this._delta}}class Il extends Cr{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this.doc??qr(),this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach(n=>n())}catch(n){console.error(n)}this._pending=null}_copy(){return new Il}clone(){const e=new Il;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new W$(this,e,t);Lg(this,e,n),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){this.doc??qr();let e="",t=this._start;for(;t!==null;)!t.deleted&&t.countable&&t.content.constructor===ii&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){this.doc!==null?kt(this.doc,n=>{const s=new p3(null,this._start,0,new Map);for(let i=0;i<e.length;i++){const o=e[i];if(o.insert!==void 0){const a=!t&&typeof o.insert=="string"&&i===e.length-1&&s.right===null&&o.insert.slice(-1)===`
`?o.insert.slice(0,-1):o.insert;(typeof a!="string"||a.length>0)&&Om(n,this,s,a,o.attributes||{})}else o.retain!==void 0?x7(n,this,s,o.retain,o.attributes||{}):o.delete!==void 0&&A7(n,s,o.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,t,n){this.doc??qr();const s=[],i=new Map,o=this.doc;let a="",c=this._start;function l(){if(a.length>0){const h={};let d=!1;i.forEach((g,m)=>{d=!0,h[m]=g});const f={insert:a};d&&(f.attributes=h),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Vc(c,e)||t!==void 0&&Vc(c,t))switch(c.content.constructor){case ii:{const h=i.get("ychange");e!==void 0&&!Vc(c,e)?(h===void 0||h.user!==c.id.client||h.type!=="removed")&&(l(),i.set("ychange",n?n("removed",c.id):{type:"removed"})):t!==void 0&&!Vc(c,t)?(h===void 0||h.user!==c.id.client||h.type!=="added")&&(l(),i.set("ychange",n?n("added",c.id):{type:"added"})):h!==void 0&&(l(),i.delete("ychange")),a+=c.content.str;break}case gc:case pc:{l();const h={insert:c.content.getContent()[0]};if(i.size>0){const d={};h.attributes=d,i.forEach((f,g)=>{d[g]=f})}s.push(h);break}case cr:Vc(c,e)&&(l(),fu(i,c.content));break}c=c.right}l()};return e||t?kt(o,h=>{e&&d3(h,e),t&&d3(h,t),u()},"cleanup"):u(),s}insert(e,t,n){if(t.length<=0)return;const s=this.doc;s!==null?kt(s,i=>{const o=Zf(i,this,e,!n);n||(n={},o.currentAttributes.forEach((a,c)=>{n[c]=a})),Om(i,this,o,t,n)}):this._pending.push(()=>this.insert(e,t,n))}insertEmbed(e,t,n){const s=this.doc;s!==null?kt(s,i=>{const o=Zf(i,this,e,!n);Om(i,this,o,t,n||{})}):this._pending.push(()=>this.insertEmbed(e,t,n||{}))}delete(e,t){if(t===0)return;const n=this.doc;n!==null?kt(n,s=>{A7(s,Zf(s,this,e,!0),t)}):this._pending.push(()=>this.delete(e,t))}format(e,t,n){if(t===0)return;const s=this.doc;s!==null?kt(s,i=>{const o=Zf(i,this,e,!1);o.right!==null&&x7(i,this,o,t,n)}):this._pending.push(()=>this.format(e,t,n))}removeAttribute(e){this.doc!==null?kt(this.doc,t=>{_p(t,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,t){this.doc!==null?kt(this.doc,n=>{Ow(n,this,e,t)}):this._pending.push(()=>this.setAttribute(e,t))}getAttribute(e){return Lw(this,e)}getAttributes(){return nC(this)}_write(e){e.writeTypeRef(fU)}}const G$=r=>new Il;class Lm{constructor(e,t=()=>!0){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0,e.doc??qr()}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(t)))do if(t=e.content.type,!e.deleted&&(t.constructor===Tl||t.constructor===Ha)&&t._start!==null)e=t._start;else for(;e!==null;){const n=e.next;if(n!==null){e=n;break}else e.parent===this._root?e=null:e=e.parent._item}while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Ha extends Cr{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Ha}clone(){const e=new Ha;return e.insert(0,this.toArray().map(t=>t instanceof Cr?t.clone():t)),e}get length(){return this.doc??qr(),this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new Lm(this,e)}querySelector(e){e=e.toUpperCase();const n=new Lm(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),Vi(new Lm(this,t=>t.nodeName&&t.nodeName.toUpperCase()===e))}_callObserver(e,t){Lg(this,e,new X$(this,t,e))}toString(){return JA(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const s=e.createDocumentFragment();return n!==void 0&&n._createAssociation(s,this),yd(this,i=>{s.insertBefore(i.toDOM(e,t,n),null)}),s}insert(e,t){this.doc!==null?kt(this.doc,n=>{tC(n,this,e,t)}):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(this.doc!==null)kt(this.doc,n=>{const s=e&&e instanceof Cr?e._item:e;Sp(n,this,s,t)});else{const n=this._prelimContent,s=e===null?0:n.findIndex(i=>i===e)+1;if(s===0&&e!==null)throw xs("Reference item not found");n.splice(s,0,...t)}}delete(e,t=1){this.doc!==null?kt(this.doc,n=>{rC(n,this,e,t)}):this._prelimContent.splice(e,t)}toArray(){return XA(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return ZA(this,e)}slice(e=0,t=this.length){return QA(this,e,t)}forEach(e){yd(this,e)}_write(e){e.writeTypeRef(gU)}}const Y$=r=>new Ha;class Tl extends Ha{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach((n,s)=>{this.setAttribute(s,n)}),this._prelimAttrs=null}_copy(){return new Tl(this.nodeName)}clone(){const e=new Tl(this.nodeName),t=this.getAttributes();return RM(t,(n,s)=>{typeof n=="string"&&e.setAttribute(s,n)}),e.insert(0,this.toArray().map(n=>n instanceof Cr?n.clone():n)),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const a in e)n.push(a);n.sort();const s=n.length;for(let a=0;a<s;a++){const c=n[a];t.push(c+'="'+e[c]+'"')}const i=this.nodeName.toLocaleLowerCase(),o=t.length>0?" "+t.join(" "):"";return`<${i}${o}>${super.toString()}</${i}>`}removeAttribute(e){this.doc!==null?kt(this.doc,t=>{_p(t,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,t){this.doc!==null?kt(this.doc,n=>{Ow(n,this,e,t)}):this._prelimAttrs.set(e,t)}getAttribute(e){return Lw(this,e)}hasAttribute(e){return sC(this,e)}getAttributes(e){return e?U$(this,e):nC(this)}toDOM(e=document,t={},n){const s=e.createElement(this.nodeName),i=this.getAttributes();for(const o in i){const a=i[o];typeof a=="string"&&s.setAttribute(o,a)}return yd(this,o=>{s.appendChild(o.toDOM(e,t,n))}),n!==void 0&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(pU),e.writeKey(this.nodeName)}}const Q$=r=>new Tl(r.readKey());class X$ extends Ng{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class xp extends kl{constructor(e){super(),this.hookName=e}_copy(){return new xp(this.hookName)}clone(){const e=new xp(this.hookName);return this.forEach((t,n)=>{e.set(n,t)}),e}toDOM(e=document,t={},n){const s=t[this.hookName];let i;return s!==void 0?i=s.createDom(this):i=document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),n!==void 0&&n._createAssociation(i,this),i}_write(e){e.writeTypeRef(mU),e.writeKey(this.hookName)}}const J$=r=>new xp(r.readKey());class Ap extends Il{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new Ap}clone(){const e=new Ap;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const s=e.createTextNode(this.toString());return n!==void 0&&n._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const t=[];for(const s in e.attributes){const i=[];for(const o in e.attributes[s])i.push({key:o,value:e.attributes[s][o]});i.sort((o,a)=>o.key<a.key?-1:1),t.push({nodeName:s,attrs:i})}t.sort((s,i)=>s.nodeName<i.nodeName?-1:1);let n="";for(let s=0;s<t.length;s++){const i=t[s];n+=`<${i.nodeName}`;for(let o=0;o<i.attrs.length;o++){const a=i.attrs[o];n+=` ${a.key}="${a.value}"`}n+=">"}n+=e.insert;for(let s=t.length-1;s>=0;s--)n+=`</${t[s].nodeName}>`;return n}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(yU)}}const Z$=r=>new Ap;class Bw{constructor(e,t){this.id=e,this.length=t}get deleted(){throw Gs()}mergeWith(e){return!1}write(e,t,n){throw Gs()}integrate(e,t){throw Gs()}}const eU=0;class Hn extends Bw{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),qA(e.doc.store,this)}write(e,t){e.writeInfo(eU),e.writeLen(this.length-t)}getMissing(e,t){return null}}class ff{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new ff(this.content)}splice(e){throw Gs()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const tU=r=>new ff(r.readBuf());class wd{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new wd(this.len)}splice(e){const t=new wd(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){vp(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const rU=r=>new wd(r.readLen()),lC=(r,e)=>new du({guid:r,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class pf{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),e.meta!==null&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new pf(lC(this.doc.guid,this.opts))}splice(e){throw Gs()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const nU=r=>new pf(lC(r.readString(),r.readAny()));class pc{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new pc(this.embed)}splice(e){throw Gs()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const sU=r=>new pc(r.readJSON());class cr{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new cr(this.key,this.value)}splice(e){throw Gs()}mergeWith(e){return!1}integrate(e,t){const n=t.parent;n._searchMarker=null,n._hasFormatting=!0}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const iU=r=>new cr(r.readKey(),r.readJSON());class Cp{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Cp(this.arr)}splice(e){const t=new Cp(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let s=t;s<n;s++){const i=this.arr[s];e.writeString(i===void 0?"undefined":JSON.stringify(i))}}getRef(){return 2}}const oU=r=>{const e=r.readLen(),t=[];for(let n=0;n<e;n++){const s=r.readString();s==="undefined"?t.push(void 0):t.push(JSON.parse(s))}return new Cp(t)},aU=gd("node_env")==="development";class qa{constructor(e){this.arr=e,aU&&mA(e)}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new qa(this.arr)}splice(e){const t=new qa(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let s=t;s<n;s++){const i=this.arr[s];e.writeAny(i)}}getRef(){return 8}}const cU=r=>{const e=r.readLen(),t=[];for(let n=0;n<e;n++)t.push(r.readAny());return new qa(t)};class ii{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new ii(this.str)}splice(e){const t=new ii(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(t===0?this.str:this.str.slice(t))}getRef(){return 4}}const lU=r=>new ii(r.readString()),uU=[V$,H$,G$,Q$,Y$,J$,Z$],hU=0,dU=1,fU=2,pU=3,gU=4,mU=5,yU=6;let gc=class uC{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new uC(this.type._copy())}splice(e){throw Gs()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;for(;t!==null;)t.deleted?t.id.clock<(e.beforeState.get(t.id.client)||0)&&e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach(n=>{n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e)}),e.changed.delete(this.type)}gc(e){let t=this.type._start;for(;t!==null;)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach(n=>{for(;n!==null;)n.gc(e,!0),n=n.left}),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}};const wU=r=>new gc(uU[r.readTypeRef()](r)),kp=(r,e,t)=>{const{client:n,clock:s}=e.id,i=new ar(at(n,s+t),e,at(n,s+t-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(t));return e.deleted&&i.markDeleted(),e.keep&&(i.keep=!0),e.redone!==null&&(i.redone=at(e.redone.client,e.redone.clock+t)),e.right=i,i.right!==null&&(i.right.left=i),r._mergeStructs.push(i),i.parentSub!==null&&i.right===null&&i.parent._map.set(i.parentSub,i),e.length=t,i};class ar extends Bw{constructor(e,t,n,s,i,o,a,c){super(e,c.getLength()),this.origin=n,this.left=t,this.right=s,this.rightOrigin=i,this.parent=o,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?r7:0}set marker(e){(this.info&Im)>0!==e&&(this.info^=Im)}get marker(){return(this.info&Im)>0}get keep(){return(this.info&t7)>0}set keep(e){this.keep!==e&&(this.info^=t7)}get countable(){return(this.info&r7)>0}get deleted(){return(this.info&km)>0}set deleted(e){this.deleted!==e&&(this.info^=km)}markDeleted(){this.info|=km}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=mr(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=mr(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===ol&&this.id.client!==this.parent.client&&this.parent.clock>=mr(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=b7(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=qo(e,this.rightOrigin),this.rightOrigin=this.right.id),this.left&&this.left.constructor===Hn||this.right&&this.right.constructor===Hn)this.parent=null;else if(!this.parent)this.left&&this.left.constructor===ar?(this.parent=this.left.parent,this.parentSub=this.left.parentSub):this.right&&this.right.constructor===ar&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===ol){const n=Nm(t,this.parent);n.constructor===Hn?this.parent=null:this.parent=n.content.type}return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=b7(e,e.doc.store,at(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let n=this.left,s;if(n!==null)s=n.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const i=new Set,o=new Set;for(;s!==null&&s!==this.right;){if(o.add(s),i.add(s),Xf(this.origin,s.origin)){if(s.id.client<this.id.client)n=s,i.clear();else if(Xf(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&o.has(Nm(e.doc.store,s.origin)))i.has(Nm(e.doc.store,s.origin))||(n=s,i.clear());else break;s=s.right}this.left=n}if(this.left!==null){const n=this.left.right;this.right=n,this.left.right=this}else{let n;if(this.parentSub!==null)for(n=this.parent._map.get(this.parentSub)||null;n!==null&&n.left!==null;)n=n.left;else n=this.parent._start,this.parent._start=this;this.right=n}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),qA(e.doc.store,this),this.content.integrate(e,this),E7(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new Hn(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:at(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Xf(e.origin,this.lastId)&&this.right===e&&Xf(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach(n=>{n.p===e&&(n.p=this,!this.deleted&&this.countable&&(n.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&this.parentSub===null&&(t._length-=this.length),this.markDeleted(),vp(e.deleteSet,this.id.client,this.id.clock,this.length),E7(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw ni();this.content.gc(e),t?_$(e,this,new Hn(this.id,this.length)):this.content=new wd(this.length)}write(e,t){const n=t>0?at(this.id.client,this.id.clock+t-1):this.origin,s=this.rightOrigin,i=this.parentSub,o=this.content.getRef()&kg|(n===null?0:Tn)|(s===null?0:Di)|(i===null?0:dd);if(e.writeInfo(o),n!==null&&e.writeLeftID(n),s!==null&&e.writeRightID(s),n===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=E$(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===ol?(e.writeParentInfo(!1),e.writeLeftID(a)):ni();i!==null&&e.writeString(i)}this.content.write(e,t)}}const hC=(r,e)=>bU[e&kg](r),bU=[()=>{ni()},rU,oU,tU,lU,sU,iU,wU,cU,nU,()=>{ni()}],vU=10;class qn extends Bw{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,t){ni()}write(e,t){e.writeInfo(vU),Ue(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const dC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},fC="__ $YJS$ __";dC[fC]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");dC[fC]=!0;const EU=1200,SU=2500,Ip=3e4,g3=r=>{if(r.shouldConnect&&r.ws===null){const e=new WebSocket(r.url),t=r.binaryType;let n=null;t&&(e.binaryType=t),r.ws=e,r.connecting=!0,r.connected=!1,e.onmessage=o=>{r.lastMessageReceived=zi();const a=o.data,c=typeof a=="string"?JSON.parse(a):a;c&&c.type==="pong"&&(clearTimeout(n),n=setTimeout(i,Ip/2)),r.emit("message",[c,r])};const s=o=>{r.ws!==null&&(r.ws=null,r.connecting=!1,r.connected?(r.connected=!1,r.emit("disconnect",[{type:"disconnect",error:o},r])):r.unsuccessfulReconnects++,setTimeout(g3,mw(WB(r.unsuccessfulReconnects+1)*EU,SU),r)),clearTimeout(n)},i=()=>{r.ws===e&&r.send({type:"ping"})};e.onclose=()=>s(null),e.onerror=o=>s(o),e.onopen=()=>{r.lastMessageReceived=zi(),r.connecting=!1,r.connected=!0,r.unsuccessfulReconnects=0,r.emit("connect",[{type:"connect"},r]),n=setTimeout(i,Ip/2)}}};class _U extends gw{constructor(e,{binaryType:t}={}){super(),this.url=e,this.ws=null,this.binaryType=t||null,this.connected=!1,this.connecting=!1,this.unsuccessfulReconnects=0,this.lastMessageReceived=0,this.shouldConnect=!0,this._checkInterval=setInterval(()=>{this.connected&&Ip<zi()-this.lastMessageReceived&&this.ws.close()},Ip/2),g3(this)}send(e){this.ws&&this.ws.send(JSON.stringify(e))}destroy(){clearInterval(this._checkInterval),this.disconnect(),super.destroy()}disconnect(){this.shouldConnect=!1,this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.connected&&this.ws===null&&g3(this)}}const pC=new Map;class xU{constructor(e){this.room=e,this.onmessage=null,this._onChange=t=>t.key===e&&this.onmessage!==null&&this.onmessage({data:SA(t.newValue||"")}),kM(this._onChange)}postMessage(e){fA.setItem(this.room,EA(zM(e)))}close(){IM(this._onChange)}}const AU=typeof BroadcastChannel>"u"?xU:BroadcastChannel,Mw=r=>Rn(pC,r,()=>{const e=Ho(),t=new AU(r);return t.onmessage=n=>e.forEach(s=>s(n.data,"broadcastchannel")),{bc:t,subs:e}}),CU=(r,e)=>(Mw(r).subs.add(e),e),kU=(r,e)=>{const t=Mw(r),n=t.subs.delete(e);return n&&t.subs.size===0&&(t.bc.close(),pC.delete(r)),n},IU=(r,e,t=null)=>{const n=Mw(r);n.bc.postMessage(e),n.subs.forEach(s=>s(e,t))},TU=()=>{let r=!0;return(e,t)=>{if(r){r=!1;try{e()}finally{r=!0}}else t!==void 0&&t()}};var Un=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sa(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function e1(r){throw new Error('Could not dynamically require "'+r+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bm={exports:{}},C7;function RU(){return C7||(C7=1,(function(r,e){(function(t){r.exports=t()})(function(){var t=Math.floor,n=Math.abs,s=Math.pow;return(function(){function i(o,a,c){function l(d,f){if(!a[d]){if(!o[d]){var g=typeof e1=="function"&&e1;if(!f&&g)return g(d,!0);if(u)return u(d,!0);var m=new Error("Cannot find module '"+d+"'");throw m.code="MODULE_NOT_FOUND",m}var b=a[d]={exports:{}};o[d][0].call(b.exports,function(v){var A=o[d][1][v];return l(A||v)},b,b.exports,i,o,a,c)}return a[d].exports}for(var u=typeof e1=="function"&&e1,h=0;h<c.length;h++)l(c[h]);return l}return i})()({1:[function(i,o,a){function c(E){var x=E.length;if(0<x%4)throw new Error("Invalid string. Length must be a multiple of 4");var P=E.indexOf("=");P===-1&&(P=x);var T=P===x?0:4-P%4;return[P,T]}function l(E,x,P){return 3*(x+P)/4-P}function u(E){var x,P,T=c(E),D=T[0],C=T[1],R=new b(l(E,D,C)),O=0,V=0<C?D-4:D;for(P=0;P<V;P+=4)x=m[E.charCodeAt(P)]<<18|m[E.charCodeAt(P+1)]<<12|m[E.charCodeAt(P+2)]<<6|m[E.charCodeAt(P+3)],R[O++]=255&x>>16,R[O++]=255&x>>8,R[O++]=255&x;return C===2&&(x=m[E.charCodeAt(P)]<<2|m[E.charCodeAt(P+1)]>>4,R[O++]=255&x),C===1&&(x=m[E.charCodeAt(P)]<<10|m[E.charCodeAt(P+1)]<<4|m[E.charCodeAt(P+2)]>>2,R[O++]=255&x>>8,R[O++]=255&x),R}function h(E){return g[63&E>>18]+g[63&E>>12]+g[63&E>>6]+g[63&E]}function d(E,x,P){for(var T,D=[],C=x;C<P;C+=3)T=(16711680&E[C]<<16)+(65280&E[C+1]<<8)+(255&E[C+2]),D.push(h(T));return D.join("")}function f(E){for(var x,P=E.length,T=P%3,D=[],C=16383,R=0,O=P-T;R<O;R+=C)D.push(d(E,R,R+C>O?O:R+C));return T===1?(x=E[P-1],D.push(g[x>>2]+g[63&x<<4]+"==")):T===2&&(x=(E[P-2]<<8)+E[P-1],D.push(g[x>>10]+g[63&x>>4]+g[63&x<<2]+"=")),D.join("")}a.byteLength=function(E){var x=c(E),P=x[0],T=x[1];return 3*(P+T)/4-T},a.toByteArray=u,a.fromByteArray=f;for(var g=[],m=[],b=typeof Uint8Array>"u"?Array:Uint8Array,v="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",A=0,w=v.length;A<w;++A)g[A]=v[A],m[v.charCodeAt(A)]=A;m[45]=62,m[95]=63},{}],2:[function(){},{}],3:[function(i,o,a){(function(){(function(){var c=String.fromCharCode,l=Math.min;function u(p){if(2147483647<p)throw new RangeError('The value "'+p+'" is invalid for option "size"');var y=new Uint8Array(p);return y.__proto__=h.prototype,y}function h(p,y,_){if(typeof p=="number"){if(typeof y=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return m(p)}return d(p,y,_)}function d(p,y,_){if(typeof p=="string")return b(p,y);if(ArrayBuffer.isView(p))return v(p);if(p==null)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p);if(L(p,ArrayBuffer)||p&&L(p.buffer,ArrayBuffer))return A(p,y,_);if(typeof p=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');var N=p.valueOf&&p.valueOf();if(N!=null&&N!==p)return h.from(N,y,_);var H=w(p);if(H)return H;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof p[Symbol.toPrimitive]=="function")return h.from(p[Symbol.toPrimitive]("string"),y,_);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof p)}function f(p){if(typeof p!="number")throw new TypeError('"size" argument must be of type number');if(0>p)throw new RangeError('The value "'+p+'" is invalid for option "size"')}function g(p,y,_){return f(p),0>=p||y===void 0?u(p):typeof _=="string"?u(p).fill(y,_):u(p).fill(y)}function m(p){return f(p),u(0>p?0:0|E(p))}function b(p,y){if((typeof y!="string"||y==="")&&(y="utf8"),!h.isEncoding(y))throw new TypeError("Unknown encoding: "+y);var _=0|x(p,y),N=u(_),H=N.write(p,y);return H!==_&&(N=N.slice(0,H)),N}function v(p){for(var y=0>p.length?0:0|E(p.length),_=u(y),N=0;N<y;N+=1)_[N]=255&p[N];return _}function A(p,y,_){if(0>y||p.byteLength<y)throw new RangeError('"offset" is outside of buffer bounds');if(p.byteLength<y+(_||0))throw new RangeError('"length" is outside of buffer bounds');var N;return N=y===void 0&&_===void 0?new Uint8Array(p):_===void 0?new Uint8Array(p,y):new Uint8Array(p,y,_),N.__proto__=h.prototype,N}function w(p){if(h.isBuffer(p)){var y=0|E(p.length),_=u(y);return _.length===0||p.copy(_,0,0,y),_}return p.length===void 0?p.type==="Buffer"&&Array.isArray(p.data)?v(p.data):void 0:typeof p.length!="number"||U(p.length)?u(0):v(p)}function E(p){if(p>=2147483647)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|p}function x(p,y){if(h.isBuffer(p))return p.length;if(ArrayBuffer.isView(p)||L(p,ArrayBuffer))return p.byteLength;if(typeof p!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof p);var _=p.length,N=2<arguments.length&&arguments[2]===!0;if(!N&&_===0)return 0;for(var H=!1;;)switch(y){case"ascii":case"latin1":case"binary":return _;case"utf8":case"utf-8":return ye(p).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*_;case"hex":return _>>>1;case"base64":return F(p).length;default:if(H)return N?-1:ye(p).length;y=(""+y).toLowerCase(),H=!0}}function P(p,y,_){var N=!1;if((y===void 0||0>y)&&(y=0),y>this.length||((_===void 0||_>this.length)&&(_=this.length),0>=_)||(_>>>=0,y>>>=0,_<=y))return"";for(p||(p="utf8");;)switch(p){case"hex":return ce(this,y,_);case"utf8":case"utf-8":return X(this,y,_);case"ascii":return W(this,y,_);case"latin1":case"binary":return ie(this,y,_);case"base64":return K(this,y,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return de(this,y,_);default:if(N)throw new TypeError("Unknown encoding: "+p);p=(p+"").toLowerCase(),N=!0}}function T(p,y,_){var N=p[y];p[y]=p[_],p[_]=N}function D(p,y,_,N,H){if(p.length===0)return-1;if(typeof _=="string"?(N=_,_=0):2147483647<_?_=2147483647:-2147483648>_&&(_=-2147483648),_=+_,U(_)&&(_=H?0:p.length-1),0>_&&(_=p.length+_),_>=p.length){if(H)return-1;_=p.length-1}else if(0>_)if(H)_=0;else return-1;if(typeof y=="string"&&(y=h.from(y,N)),h.isBuffer(y))return y.length===0?-1:C(p,y,_,N,H);if(typeof y=="number")return y&=255,typeof Uint8Array.prototype.indexOf=="function"?H?Uint8Array.prototype.indexOf.call(p,y,_):Uint8Array.prototype.lastIndexOf.call(p,y,_):C(p,[y],_,N,H);throw new TypeError("val must be string, number or Buffer")}function C(p,y,_,N,H){function Q(Z,ne){return ge===1?Z[ne]:Z.readUInt16BE(ne*ge)}var ge=1,Ce=p.length,Me=y.length;if(N!==void 0&&(N=(N+"").toLowerCase(),N==="ucs2"||N==="ucs-2"||N==="utf16le"||N==="utf-16le")){if(2>p.length||2>y.length)return-1;ge=2,Ce/=2,Me/=2,_/=2}var Fe;if(H){var $e=-1;for(Fe=_;Fe<Ce;Fe++)if(Q(p,Fe)!==Q(y,$e===-1?0:Fe-$e))$e!==-1&&(Fe-=Fe-$e),$e=-1;else if($e===-1&&($e=Fe),Fe-$e+1===Me)return $e*ge}else for(_+Me>Ce&&(_=Ce-Me),Fe=_;0<=Fe;Fe--){for(var ft=!0,Y=0;Y<Me;Y++)if(Q(p,Fe+Y)!==Q(y,Y)){ft=!1;break}if(ft)return Fe}return-1}function R(p,y,_,N){_=+_||0;var H=p.length-_;N?(N=+N,N>H&&(N=H)):N=H;var Q=y.length;N>Q/2&&(N=Q/2);for(var ge,Ce=0;Ce<N;++Ce){if(ge=parseInt(y.substr(2*Ce,2),16),U(ge))return Ce;p[_+Ce]=ge}return Ce}function O(p,y,_,N){return G(ye(y,p.length-_),p,_,N)}function V(p,y,_,N){return G(He(y),p,_,N)}function B(p,y,_,N){return V(p,y,_,N)}function z(p,y,_,N){return G(F(y),p,_,N)}function $(p,y,_,N){return G(M(y,p.length-_),p,_,N)}function K(p,y,_){return y===0&&_===p.length?q.fromByteArray(p):q.fromByteArray(p.slice(y,_))}function X(p,y,_){_=l(p.length,_);for(var N=[],H=y;H<_;){var Q=p[H],ge=null,Ce=239<Q?4:223<Q?3:191<Q?2:1;if(H+Ce<=_){var Me,Fe,$e,ft;Ce===1?128>Q&&(ge=Q):Ce===2?(Me=p[H+1],(192&Me)==128&&(ft=(31&Q)<<6|63&Me,127<ft&&(ge=ft))):Ce===3?(Me=p[H+1],Fe=p[H+2],(192&Me)==128&&(192&Fe)==128&&(ft=(15&Q)<<12|(63&Me)<<6|63&Fe,2047<ft&&(55296>ft||57343<ft)&&(ge=ft))):Ce===4&&(Me=p[H+1],Fe=p[H+2],$e=p[H+3],(192&Me)==128&&(192&Fe)==128&&(192&$e)==128&&(ft=(15&Q)<<18|(63&Me)<<12|(63&Fe)<<6|63&$e,65535<ft&&1114112>ft&&(ge=ft)))}ge===null?(ge=65533,Ce=1):65535<ge&&(ge-=65536,N.push(55296|1023&ge>>>10),ge=56320|1023&ge),N.push(ge),H+=Ce}return te(N)}function te(p){var y=p.length;if(y<=4096)return c.apply(String,p);for(var _="",N=0;N<y;)_+=c.apply(String,p.slice(N,N+=4096));return _}function W(p,y,_){var N="";_=l(p.length,_);for(var H=y;H<_;++H)N+=c(127&p[H]);return N}function ie(p,y,_){var N="";_=l(p.length,_);for(var H=y;H<_;++H)N+=c(p[H]);return N}function ce(p,y,_){var N=p.length;(!y||0>y)&&(y=0),(!_||0>_||_>N)&&(_=N);for(var H="",Q=y;Q<_;++Q)H+=se(p[Q]);return H}function de(p,y,_){for(var N=p.slice(y,_),H="",Q=0;Q<N.length;Q+=2)H+=c(N[Q]+256*N[Q+1]);return H}function oe(p,y,_){if(p%1!=0||0>p)throw new RangeError("offset is not uint");if(p+y>_)throw new RangeError("Trying to access beyond buffer length")}function Se(p,y,_,N,H,Q){if(!h.isBuffer(p))throw new TypeError('"buffer" argument must be a Buffer instance');if(y>H||y<Q)throw new RangeError('"value" argument is out of bounds');if(_+N>p.length)throw new RangeError("Index out of range")}function Le(p,y,_,N){if(_+N>p.length)throw new RangeError("Index out of range");if(0>_)throw new RangeError("Index out of range")}function xe(p,y,_,N,H){return y=+y,_>>>=0,H||Le(p,y,_,4),re.write(p,y,_,N,23,4),_+4}function ee(p,y,_,N,H){return y=+y,_>>>=0,H||Le(p,y,_,8),re.write(p,y,_,N,52,8),_+8}function pe(p){if(p=p.split("=")[0],p=p.trim().replace(k,""),2>p.length)return"";for(;p.length%4!=0;)p+="=";return p}function se(p){return 16>p?"0"+p.toString(16):p.toString(16)}function ye(p,y){y=y||1/0;for(var _,N=p.length,H=null,Q=[],ge=0;ge<N;++ge){if(_=p.charCodeAt(ge),55295<_&&57344>_){if(!H){if(56319<_){-1<(y-=3)&&Q.push(239,191,189);continue}else if(ge+1===N){-1<(y-=3)&&Q.push(239,191,189);continue}H=_;continue}if(56320>_){-1<(y-=3)&&Q.push(239,191,189),H=_;continue}_=(H-55296<<10|_-56320)+65536}else H&&-1<(y-=3)&&Q.push(239,191,189);if(H=null,128>_){if(0>(y-=1))break;Q.push(_)}else if(2048>_){if(0>(y-=2))break;Q.push(192|_>>6,128|63&_)}else if(65536>_){if(0>(y-=3))break;Q.push(224|_>>12,128|63&_>>6,128|63&_)}else if(1114112>_){if(0>(y-=4))break;Q.push(240|_>>18,128|63&_>>12,128|63&_>>6,128|63&_)}else throw new Error("Invalid code point")}return Q}function He(p){for(var y=[],_=0;_<p.length;++_)y.push(255&p.charCodeAt(_));return y}function M(p,y){for(var _,N,H,Q=[],ge=0;ge<p.length&&!(0>(y-=2));++ge)_=p.charCodeAt(ge),N=_>>8,H=_%256,Q.push(H),Q.push(N);return Q}function F(p){return q.toByteArray(pe(p))}function G(p,y,_,N){for(var H=0;H<N&&!(H+_>=y.length||H>=p.length);++H)y[H+_]=p[H];return H}function L(p,y){return p instanceof y||p!=null&&p.constructor!=null&&p.constructor.name!=null&&p.constructor.name===y.name}function U(p){return p!==p}var q=i("base64-js"),re=i("ieee754");a.Buffer=h,a.SlowBuffer=function(p){return+p!=p&&(p=0),h.alloc(+p)},a.INSPECT_MAX_BYTES=50,a.kMaxLength=2147483647,h.TYPED_ARRAY_SUPPORT=(function(){try{var p=new Uint8Array(1);return p.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},p.foo()===42}catch{return!1}})(),h.TYPED_ARRAY_SUPPORT||typeof console>"u"||typeof console.error!="function"||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(h.prototype,"parent",{enumerable:!0,get:function(){return h.isBuffer(this)?this.buffer:void 0}}),Object.defineProperty(h.prototype,"offset",{enumerable:!0,get:function(){return h.isBuffer(this)?this.byteOffset:void 0}}),typeof Symbol<"u"&&Symbol.species!=null&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192,h.from=function(p,y,_){return d(p,y,_)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array,h.alloc=function(p,y,_){return g(p,y,_)},h.allocUnsafe=function(p){return m(p)},h.allocUnsafeSlow=function(p){return m(p)},h.isBuffer=function(p){return p!=null&&p._isBuffer===!0&&p!==h.prototype},h.compare=function(p,y){if(L(p,Uint8Array)&&(p=h.from(p,p.offset,p.byteLength)),L(y,Uint8Array)&&(y=h.from(y,y.offset,y.byteLength)),!h.isBuffer(p)||!h.isBuffer(y))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(p===y)return 0;for(var _=p.length,N=y.length,H=0,Q=l(_,N);H<Q;++H)if(p[H]!==y[H]){_=p[H],N=y[H];break}return _<N?-1:N<_?1:0},h.isEncoding=function(p){switch((p+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(p,y){if(!Array.isArray(p))throw new TypeError('"list" argument must be an Array of Buffers');if(p.length===0)return h.alloc(0);var _;if(y===void 0)for(y=0,_=0;_<p.length;++_)y+=p[_].length;var N=h.allocUnsafe(y),H=0;for(_=0;_<p.length;++_){var Q=p[_];if(L(Q,Uint8Array)&&(Q=h.from(Q)),!h.isBuffer(Q))throw new TypeError('"list" argument must be an Array of Buffers');Q.copy(N,H),H+=Q.length}return N},h.byteLength=x,h.prototype._isBuffer=!0,h.prototype.swap16=function(){var p=this.length;if(p%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var y=0;y<p;y+=2)T(this,y,y+1);return this},h.prototype.swap32=function(){var p=this.length;if(p%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var y=0;y<p;y+=4)T(this,y,y+3),T(this,y+1,y+2);return this},h.prototype.swap64=function(){var p=this.length;if(p%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var y=0;y<p;y+=8)T(this,y,y+7),T(this,y+1,y+6),T(this,y+2,y+5),T(this,y+3,y+4);return this},h.prototype.toString=function(){var p=this.length;return p===0?"":arguments.length===0?X(this,0,p):P.apply(this,arguments)},h.prototype.toLocaleString=h.prototype.toString,h.prototype.equals=function(p){if(!h.isBuffer(p))throw new TypeError("Argument must be a Buffer");return this===p||h.compare(this,p)===0},h.prototype.inspect=function(){var p="",y=a.INSPECT_MAX_BYTES;return p=this.toString("hex",0,y).replace(/(.{2})/g,"$1 ").trim(),this.length>y&&(p+=" ... "),"<Buffer "+p+">"},h.prototype.compare=function(p,y,_,N,H){if(L(p,Uint8Array)&&(p=h.from(p,p.offset,p.byteLength)),!h.isBuffer(p))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof p);if(y===void 0&&(y=0),_===void 0&&(_=p?p.length:0),N===void 0&&(N=0),H===void 0&&(H=this.length),0>y||_>p.length||0>N||H>this.length)throw new RangeError("out of range index");if(N>=H&&y>=_)return 0;if(N>=H)return-1;if(y>=_)return 1;if(y>>>=0,_>>>=0,N>>>=0,H>>>=0,this===p)return 0;for(var Q=H-N,ge=_-y,Ce=l(Q,ge),Me=this.slice(N,H),Fe=p.slice(y,_),$e=0;$e<Ce;++$e)if(Me[$e]!==Fe[$e]){Q=Me[$e],ge=Fe[$e];break}return Q<ge?-1:ge<Q?1:0},h.prototype.includes=function(p,y,_){return this.indexOf(p,y,_)!==-1},h.prototype.indexOf=function(p,y,_){return D(this,p,y,_,!0)},h.prototype.lastIndexOf=function(p,y,_){return D(this,p,y,_,!1)},h.prototype.write=function(p,y,_,N){if(y===void 0)N="utf8",_=this.length,y=0;else if(_===void 0&&typeof y=="string")N=y,_=this.length,y=0;else if(isFinite(y))y>>>=0,isFinite(_)?(_>>>=0,N===void 0&&(N="utf8")):(N=_,_=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var H=this.length-y;if((_===void 0||_>H)&&(_=H),0<p.length&&(0>_||0>y)||y>this.length)throw new RangeError("Attempt to write outside buffer bounds");N||(N="utf8");for(var Q=!1;;)switch(N){case"hex":return R(this,p,y,_);case"utf8":case"utf-8":return O(this,p,y,_);case"ascii":return V(this,p,y,_);case"latin1":case"binary":return B(this,p,y,_);case"base64":return z(this,p,y,_);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,p,y,_);default:if(Q)throw new TypeError("Unknown encoding: "+N);N=(""+N).toLowerCase(),Q=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},h.prototype.slice=function(p,y){var _=this.length;p=~~p,y=y===void 0?_:~~y,0>p?(p+=_,0>p&&(p=0)):p>_&&(p=_),0>y?(y+=_,0>y&&(y=0)):y>_&&(y=_),y<p&&(y=p);var N=this.subarray(p,y);return N.__proto__=h.prototype,N},h.prototype.readUIntLE=function(p,y,_){p>>>=0,y>>>=0,_||oe(p,y,this.length);for(var N=this[p],H=1,Q=0;++Q<y&&(H*=256);)N+=this[p+Q]*H;return N},h.prototype.readUIntBE=function(p,y,_){p>>>=0,y>>>=0,_||oe(p,y,this.length);for(var N=this[p+--y],H=1;0<y&&(H*=256);)N+=this[p+--y]*H;return N},h.prototype.readUInt8=function(p,y){return p>>>=0,y||oe(p,1,this.length),this[p]},h.prototype.readUInt16LE=function(p,y){return p>>>=0,y||oe(p,2,this.length),this[p]|this[p+1]<<8},h.prototype.readUInt16BE=function(p,y){return p>>>=0,y||oe(p,2,this.length),this[p]<<8|this[p+1]},h.prototype.readUInt32LE=function(p,y){return p>>>=0,y||oe(p,4,this.length),(this[p]|this[p+1]<<8|this[p+2]<<16)+16777216*this[p+3]},h.prototype.readUInt32BE=function(p,y){return p>>>=0,y||oe(p,4,this.length),16777216*this[p]+(this[p+1]<<16|this[p+2]<<8|this[p+3])},h.prototype.readIntLE=function(p,y,_){p>>>=0,y>>>=0,_||oe(p,y,this.length);for(var N=this[p],H=1,Q=0;++Q<y&&(H*=256);)N+=this[p+Q]*H;return H*=128,N>=H&&(N-=s(2,8*y)),N},h.prototype.readIntBE=function(p,y,_){p>>>=0,y>>>=0,_||oe(p,y,this.length);for(var N=y,H=1,Q=this[p+--N];0<N&&(H*=256);)Q+=this[p+--N]*H;return H*=128,Q>=H&&(Q-=s(2,8*y)),Q},h.prototype.readInt8=function(p,y){return p>>>=0,y||oe(p,1,this.length),128&this[p]?-1*(255-this[p]+1):this[p]},h.prototype.readInt16LE=function(p,y){p>>>=0,y||oe(p,2,this.length);var _=this[p]|this[p+1]<<8;return 32768&_?4294901760|_:_},h.prototype.readInt16BE=function(p,y){p>>>=0,y||oe(p,2,this.length);var _=this[p+1]|this[p]<<8;return 32768&_?4294901760|_:_},h.prototype.readInt32LE=function(p,y){return p>>>=0,y||oe(p,4,this.length),this[p]|this[p+1]<<8|this[p+2]<<16|this[p+3]<<24},h.prototype.readInt32BE=function(p,y){return p>>>=0,y||oe(p,4,this.length),this[p]<<24|this[p+1]<<16|this[p+2]<<8|this[p+3]},h.prototype.readFloatLE=function(p,y){return p>>>=0,y||oe(p,4,this.length),re.read(this,p,!0,23,4)},h.prototype.readFloatBE=function(p,y){return p>>>=0,y||oe(p,4,this.length),re.read(this,p,!1,23,4)},h.prototype.readDoubleLE=function(p,y){return p>>>=0,y||oe(p,8,this.length),re.read(this,p,!0,52,8)},h.prototype.readDoubleBE=function(p,y){return p>>>=0,y||oe(p,8,this.length),re.read(this,p,!1,52,8)},h.prototype.writeUIntLE=function(p,y,_,N){if(p=+p,y>>>=0,_>>>=0,!N){var H=s(2,8*_)-1;Se(this,p,y,_,H,0)}var Q=1,ge=0;for(this[y]=255&p;++ge<_&&(Q*=256);)this[y+ge]=255&p/Q;return y+_},h.prototype.writeUIntBE=function(p,y,_,N){if(p=+p,y>>>=0,_>>>=0,!N){var H=s(2,8*_)-1;Se(this,p,y,_,H,0)}var Q=_-1,ge=1;for(this[y+Q]=255&p;0<=--Q&&(ge*=256);)this[y+Q]=255&p/ge;return y+_},h.prototype.writeUInt8=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,1,255,0),this[y]=255&p,y+1},h.prototype.writeUInt16LE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,2,65535,0),this[y]=255&p,this[y+1]=p>>>8,y+2},h.prototype.writeUInt16BE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,2,65535,0),this[y]=p>>>8,this[y+1]=255&p,y+2},h.prototype.writeUInt32LE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,4,4294967295,0),this[y+3]=p>>>24,this[y+2]=p>>>16,this[y+1]=p>>>8,this[y]=255&p,y+4},h.prototype.writeUInt32BE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,4,4294967295,0),this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p,y+4},h.prototype.writeIntLE=function(p,y,_,N){if(p=+p,y>>>=0,!N){var H=s(2,8*_-1);Se(this,p,y,_,H-1,-H)}var Q=0,ge=1,Ce=0;for(this[y]=255&p;++Q<_&&(ge*=256);)0>p&&Ce===0&&this[y+Q-1]!==0&&(Ce=1),this[y+Q]=255&(p/ge>>0)-Ce;return y+_},h.prototype.writeIntBE=function(p,y,_,N){if(p=+p,y>>>=0,!N){var H=s(2,8*_-1);Se(this,p,y,_,H-1,-H)}var Q=_-1,ge=1,Ce=0;for(this[y+Q]=255&p;0<=--Q&&(ge*=256);)0>p&&Ce===0&&this[y+Q+1]!==0&&(Ce=1),this[y+Q]=255&(p/ge>>0)-Ce;return y+_},h.prototype.writeInt8=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,1,127,-128),0>p&&(p=255+p+1),this[y]=255&p,y+1},h.prototype.writeInt16LE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,2,32767,-32768),this[y]=255&p,this[y+1]=p>>>8,y+2},h.prototype.writeInt16BE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,2,32767,-32768),this[y]=p>>>8,this[y+1]=255&p,y+2},h.prototype.writeInt32LE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,4,2147483647,-2147483648),this[y]=255&p,this[y+1]=p>>>8,this[y+2]=p>>>16,this[y+3]=p>>>24,y+4},h.prototype.writeInt32BE=function(p,y,_){return p=+p,y>>>=0,_||Se(this,p,y,4,2147483647,-2147483648),0>p&&(p=4294967295+p+1),this[y]=p>>>24,this[y+1]=p>>>16,this[y+2]=p>>>8,this[y+3]=255&p,y+4},h.prototype.writeFloatLE=function(p,y,_){return xe(this,p,y,!0,_)},h.prototype.writeFloatBE=function(p,y,_){return xe(this,p,y,!1,_)},h.prototype.writeDoubleLE=function(p,y,_){return ee(this,p,y,!0,_)},h.prototype.writeDoubleBE=function(p,y,_){return ee(this,p,y,!1,_)},h.prototype.copy=function(p,y,_,N){if(!h.isBuffer(p))throw new TypeError("argument should be a Buffer");if(_||(_=0),N||N===0||(N=this.length),y>=p.length&&(y=p.length),y||(y=0),0<N&&N<_&&(N=_),N===_||p.length===0||this.length===0)return 0;if(0>y)throw new RangeError("targetStart out of bounds");if(0>_||_>=this.length)throw new RangeError("Index out of range");if(0>N)throw new RangeError("sourceEnd out of bounds");N>this.length&&(N=this.length),p.length-y<N-_&&(N=p.length-y+_);var H=N-_;if(this===p&&typeof Uint8Array.prototype.copyWithin=="function")this.copyWithin(y,_,N);else if(this===p&&_<y&&y<N)for(var Q=H-1;0<=Q;--Q)p[Q+y]=this[Q+_];else Uint8Array.prototype.set.call(p,this.subarray(_,N),y);return H},h.prototype.fill=function(p,y,_,N){if(typeof p=="string"){if(typeof y=="string"?(N=y,y=0,_=this.length):typeof _=="string"&&(N=_,_=this.length),N!==void 0&&typeof N!="string")throw new TypeError("encoding must be a string");if(typeof N=="string"&&!h.isEncoding(N))throw new TypeError("Unknown encoding: "+N);if(p.length===1){var H=p.charCodeAt(0);(N==="utf8"&&128>H||N==="latin1")&&(p=H)}}else typeof p=="number"&&(p&=255);if(0>y||this.length<y||this.length<_)throw new RangeError("Out of range index");if(_<=y)return this;y>>>=0,_=_===void 0?this.length:_>>>0,p||(p=0);var Q;if(typeof p=="number")for(Q=y;Q<_;++Q)this[Q]=p;else{var ge=h.isBuffer(p)?p:h.from(p,N),Ce=ge.length;if(Ce===0)throw new TypeError('The value "'+p+'" is invalid for argument "value"');for(Q=0;Q<_-y;++Q)this[Q+y]=ge[Q%Ce]}return this};var k=/[^+/0-9A-Za-z-_]/g}).call(this)}).call(this,i("buffer").Buffer)},{"base64-js":1,buffer:3,ieee754:9}],4:[function(i,o,a){(function(c){(function(){function l(){let h;try{h=a.storage.getItem("debug")}catch{}return!h&&typeof c<"u"&&"env"in c&&(h=c.env.DEBUG),h}a.formatArgs=function(h){if(h[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+h[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;const d="color: "+this.color;h.splice(1,0,d,"color: inherit");let f=0,g=0;h[0].replace(/%[a-zA-Z%]/g,m=>{m==="%%"||(f++,m==="%c"&&(g=f))}),h.splice(g,0,d)},a.save=function(h){try{h?a.storage.setItem("debug",h):a.storage.removeItem("debug")}catch{}},a.load=l,a.useColors=function(){return!!(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))||!(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},a.storage=(function(){try{return localStorage}catch{}})(),a.destroy=(()=>{let h=!1;return()=>{h||(h=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),a.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],a.log=console.debug||console.log||(()=>{}),o.exports=i("./common")(a);const{formatters:u}=o.exports;u.j=function(h){try{return JSON.stringify(h)}catch(d){return"[UnexpectedJSONParseError]: "+d.message}}}).call(this)}).call(this,i("_process"))},{"./common":5,_process:12}],5:[function(i,o){o.exports=function(a){function c(h){function d(...m){if(!d.enabled)return;const b=d,v=+new Date,A=v-(f||v);b.diff=A,b.prev=f,b.curr=v,f=v,m[0]=c.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let w=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(x,P)=>{if(x==="%%")return"%";w++;const T=c.formatters[P];if(typeof T=="function"){const D=m[w];x=T.call(b,D),m.splice(w,1),w--}return x}),c.formatArgs.call(b,m),(b.log||c.log).apply(b,m)}let f,g=null;return d.namespace=h,d.useColors=c.useColors(),d.color=c.selectColor(h),d.extend=l,d.destroy=c.destroy,Object.defineProperty(d,"enabled",{enumerable:!0,configurable:!1,get:()=>g===null?c.enabled(h):g,set:m=>{g=m}}),typeof c.init=="function"&&c.init(d),d}function l(h,d){const f=c(this.namespace+(typeof d>"u"?":":d)+h);return f.log=this.log,f}function u(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}return c.debug=c,c.default=c,c.coerce=function(h){return h instanceof Error?h.stack||h.message:h},c.disable=function(){const h=[...c.names.map(u),...c.skips.map(u).map(d=>"-"+d)].join(",");return c.enable(""),h},c.enable=function(h){c.save(h),c.names=[],c.skips=[];let d;const f=(typeof h=="string"?h:"").split(/[\s,]+/),g=f.length;for(d=0;d<g;d++)f[d]&&(h=f[d].replace(/\*/g,".*?"),h[0]==="-"?c.skips.push(new RegExp("^"+h.substr(1)+"$")):c.names.push(new RegExp("^"+h+"$")))},c.enabled=function(h){if(h[h.length-1]==="*")return!0;let d,f;for(d=0,f=c.skips.length;d<f;d++)if(c.skips[d].test(h))return!1;for(d=0,f=c.names.length;d<f;d++)if(c.names[d].test(h))return!0;return!1},c.humanize=i("ms"),c.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(a).forEach(h=>{c[h]=a[h]}),c.names=[],c.skips=[],c.formatters={},c.selectColor=function(h){let d=0;for(let f=0;f<h.length;f++)d=(d<<5)-d+h.charCodeAt(f),d|=0;return c.colors[n(d)%c.colors.length]},c.enable(c.load()),c}},{ms:11}],6:[function(i,o){function a(c,l){for(const u in l)Object.defineProperty(c,u,{value:l[u],enumerable:!0,configurable:!0});return c}o.exports=function(c,l,u){if(!c||typeof c=="string")throw new TypeError("Please pass an Error to err-code");u||(u={}),typeof l=="object"&&(u=l,l=""),l&&(u.code=l);try{return a(c,u)}catch{u.message=c.message,u.stack=c.stack;const d=function(){};return d.prototype=Object.create(Object.getPrototypeOf(c)),a(new d,u)}}},{}],7:[function(i,o){function a(R){console&&console.warn&&console.warn(R)}function c(){c.init.call(this)}function l(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function u(R){return R._maxListeners===void 0?c.defaultMaxListeners:R._maxListeners}function h(R,O,V,B){var z,$,K;if(l(V),$=R._events,$===void 0?($=R._events=Object.create(null),R._eventsCount=0):($.newListener!==void 0&&(R.emit("newListener",O,V.listener?V.listener:V),$=R._events),K=$[O]),K===void 0)K=$[O]=V,++R._eventsCount;else if(typeof K=="function"?K=$[O]=B?[V,K]:[K,V]:B?K.unshift(V):K.push(V),z=u(R),0<z&&K.length>z&&!K.warned){K.warned=!0;var X=new Error("Possible EventEmitter memory leak detected. "+K.length+" "+(O+" listeners added. Use emitter.setMaxListeners() to increase limit"));X.name="MaxListenersExceededWarning",X.emitter=R,X.type=O,X.count=K.length,a(X)}return R}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(R,O,V){var B={fired:!1,wrapFn:void 0,target:R,type:O,listener:V},z=d.bind(B);return z.listener=V,B.wrapFn=z,z}function g(R,O,V){var B=R._events;if(B===void 0)return[];var z=B[O];return z===void 0?[]:typeof z=="function"?V?[z.listener||z]:[z]:V?A(z):b(z,z.length)}function m(R){var O=this._events;if(O!==void 0){var V=O[R];if(typeof V=="function")return 1;if(V!==void 0)return V.length}return 0}function b(R,O){for(var V=Array(O),B=0;B<O;++B)V[B]=R[B];return V}function v(R,O){for(;O+1<R.length;O++)R[O]=R[O+1];R.pop()}function A(R){for(var O=Array(R.length),V=0;V<O.length;++V)O[V]=R[V].listener||R[V];return O}function w(R,O,V){typeof R.on=="function"&&E(R,"error",O,V)}function E(R,O,V,B){if(typeof R.on=="function")B.once?R.once(O,V):R.on(O,V);else if(typeof R.addEventListener=="function")R.addEventListener(O,function z($){B.once&&R.removeEventListener(O,z),V($)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R)}var x,P=typeof Reflect=="object"?Reflect:null,T=P&&typeof P.apply=="function"?P.apply:function(R,O,V){return Function.prototype.apply.call(R,O,V)};x=P&&typeof P.ownKeys=="function"?P.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var D=Number.isNaN||function(R){return R!==R};o.exports=c,o.exports.once=function(R,O){return new Promise(function(V,B){function z(K){R.removeListener(O,$),B(K)}function $(){typeof R.removeListener=="function"&&R.removeListener("error",z),V([].slice.call(arguments))}E(R,O,$,{once:!0}),O!=="error"&&w(R,z,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var C=10;Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return C},set:function(R){if(typeof R!="number"||0>R||D(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");C=R}}),c.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(R){if(typeof R!="number"||0>R||D(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},c.prototype.getMaxListeners=function(){return u(this)},c.prototype.emit=function(R){for(var O=[],V=1;V<arguments.length;V++)O.push(arguments[V]);var B=R==="error",z=this._events;if(z!==void 0)B=B&&z.error===void 0;else if(!B)return!1;if(B){var $;if(0<O.length&&($=O[0]),$ instanceof Error)throw $;var K=new Error("Unhandled error."+($?" ("+$.message+")":""));throw K.context=$,K}var X=z[R];if(X===void 0)return!1;if(typeof X=="function")T(X,this,O);else for(var te=X.length,W=b(X,te),V=0;V<te;++V)T(W[V],this,O);return!0},c.prototype.addListener=function(R,O){return h(this,R,O,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(R,O){return h(this,R,O,!0)},c.prototype.once=function(R,O){return l(O),this.on(R,f(this,R,O)),this},c.prototype.prependOnceListener=function(R,O){return l(O),this.prependListener(R,f(this,R,O)),this},c.prototype.removeListener=function(R,O){var V,B,z,$,K;if(l(O),B=this._events,B===void 0)return this;if(V=B[R],V===void 0)return this;if(V===O||V.listener===O)--this._eventsCount==0?this._events=Object.create(null):(delete B[R],B.removeListener&&this.emit("removeListener",R,V.listener||O));else if(typeof V!="function"){for(z=-1,$=V.length-1;0<=$;$--)if(V[$]===O||V[$].listener===O){K=V[$].listener,z=$;break}if(0>z)return this;z===0?V.shift():v(V,z),V.length===1&&(B[R]=V[0]),B.removeListener!==void 0&&this.emit("removeListener",R,K||O)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(R){var O,V,B;if(V=this._events,V===void 0)return this;if(V.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):V[R]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete V[R]),this;if(arguments.length===0){var z,$=Object.keys(V);for(B=0;B<$.length;++B)z=$[B],z!=="removeListener"&&this.removeAllListeners(z);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(O=V[R],typeof O=="function")this.removeListener(R,O);else if(O!==void 0)for(B=O.length-1;0<=B;B--)this.removeListener(R,O[B]);return this},c.prototype.listeners=function(R){return g(this,R,!0)},c.prototype.rawListeners=function(R){return g(this,R,!1)},c.listenerCount=function(R,O){return typeof R.listenerCount=="function"?R.listenerCount(O):m.call(R,O)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return 0<this._eventsCount?x(this._events):[]}},{}],8:[function(i,o){o.exports=function(){if(typeof globalThis>"u")return null;var a={RTCPeerConnection:globalThis.RTCPeerConnection||globalThis.mozRTCPeerConnection||globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription||globalThis.mozRTCSessionDescription||globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate||globalThis.mozRTCIceCandidate||globalThis.webkitRTCIceCandidate};return a.RTCPeerConnection?a:null}},{}],9:[function(i,o,a){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */a.read=function(c,l,u,h,d){var f,g,m=8*d-h-1,b=(1<<m)-1,v=b>>1,A=-7,w=u?d-1:0,E=u?-1:1,x=c[l+w];for(w+=E,f=x&(1<<-A)-1,x>>=-A,A+=m;0<A;f=256*f+c[l+w],w+=E,A-=8);for(g=f&(1<<-A)-1,f>>=-A,A+=h;0<A;g=256*g+c[l+w],w+=E,A-=8);if(f===0)f=1-v;else{if(f===b)return g?NaN:(x?-1:1)*(1/0);g+=s(2,h),f-=v}return(x?-1:1)*g*s(2,f-h)},a.write=function(c,l,u,h,d,f){var g,m,b,v=Math.LN2,A=Math.log,w=8*f-d-1,E=(1<<w)-1,x=E>>1,P=d===23?s(2,-24)-s(2,-77):0,T=h?0:f-1,D=h?1:-1,C=0>l||l===0&&0>1/l?1:0;for(l=n(l),isNaN(l)||l===1/0?(m=isNaN(l)?1:0,g=E):(g=t(A(l)/v),1>l*(b=s(2,-g))&&(g--,b*=2),l+=1<=g+x?P/b:P*s(2,1-x),2<=l*b&&(g++,b/=2),g+x>=E?(m=0,g=E):1<=g+x?(m=(l*b-1)*s(2,d),g+=x):(m=l*s(2,x-1)*s(2,d),g=0));8<=d;c[u+T]=255&m,T+=D,m/=256,d-=8);for(g=g<<d|m,w+=d;0<w;c[u+T]=255&g,T+=D,g/=256,w-=8);c[u+T-D]|=128*C}},{}],10:[function(i,o){o.exports=typeof Object.create=="function"?function(a,c){c&&(a.super_=c,a.prototype=Object.create(c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}))}:function(a,c){if(c){a.super_=c;var l=function(){};l.prototype=c.prototype,a.prototype=new l,a.prototype.constructor=a}}},{}],11:[function(i,o){var a=Math.round;function c(d){if(d+="",!(100<d.length)){var f=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(d);if(f){var g=parseFloat(f[1]),m=(f[2]||"ms").toLowerCase();return m==="years"||m==="year"||m==="yrs"||m==="yr"||m==="y"?315576e5*g:m==="weeks"||m==="week"||m==="w"?6048e5*g:m==="days"||m==="day"||m==="d"?864e5*g:m==="hours"||m==="hour"||m==="hrs"||m==="hr"||m==="h"?36e5*g:m==="minutes"||m==="minute"||m==="mins"||m==="min"||m==="m"?6e4*g:m==="seconds"||m==="second"||m==="secs"||m==="sec"||m==="s"?1e3*g:m==="milliseconds"||m==="millisecond"||m==="msecs"||m==="msec"||m==="ms"?g:void 0}}}function l(d){var f=n(d);return 864e5<=f?a(d/864e5)+"d":36e5<=f?a(d/36e5)+"h":6e4<=f?a(d/6e4)+"m":1e3<=f?a(d/1e3)+"s":d+"ms"}function u(d){var f=n(d);return 864e5<=f?h(d,f,864e5,"day"):36e5<=f?h(d,f,36e5,"hour"):6e4<=f?h(d,f,6e4,"minute"):1e3<=f?h(d,f,1e3,"second"):d+" ms"}function h(d,f,g,m){return a(d/g)+" "+m+(f>=1.5*g?"s":"")}o.exports=function(d,f){f=f||{};var g=typeof d;if(g=="string"&&0<d.length)return c(d);if(g==="number"&&isFinite(d))return f.long?u(d):l(d);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(d))}},{}],12:[function(i,o){function a(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function l(P){if(m===setTimeout)return setTimeout(P,0);if((m===a||!m)&&setTimeout)return m=setTimeout,setTimeout(P,0);try{return m(P,0)}catch{try{return m.call(null,P,0)}catch{return m.call(this,P,0)}}}function u(P){if(b===clearTimeout)return clearTimeout(P);if((b===c||!b)&&clearTimeout)return b=clearTimeout,clearTimeout(P);try{return b(P)}catch{try{return b.call(null,P)}catch{return b.call(this,P)}}}function h(){E&&A&&(E=!1,A.length?w=A.concat(w):x=-1,w.length&&d())}function d(){if(!E){var P=l(h);E=!0;for(var T=w.length;T;){for(A=w,w=[];++x<T;)A&&A[x].run();x=-1,T=w.length}A=null,E=!1,u(P)}}function f(P,T){this.fun=P,this.array=T}function g(){}var m,b,v=o.exports={};(function(){try{m=typeof setTimeout=="function"?setTimeout:a}catch{m=a}try{b=typeof clearTimeout=="function"?clearTimeout:c}catch{b=c}})();var A,w=[],E=!1,x=-1;v.nextTick=function(P){var T=Array(arguments.length-1);if(1<arguments.length)for(var D=1;D<arguments.length;D++)T[D-1]=arguments[D];w.push(new f(P,T)),w.length!==1||E||l(d)},f.prototype.run=function(){this.fun.apply(null,this.array)},v.title="browser",v.browser=!0,v.env={},v.argv=[],v.version="",v.versions={},v.on=g,v.addListener=g,v.once=g,v.off=g,v.removeListener=g,v.removeAllListeners=g,v.emit=g,v.prependListener=g,v.prependOnceListener=g,v.listeners=function(){return[]},v.binding=function(){throw new Error("process.binding is not supported")},v.cwd=function(){return"/"},v.chdir=function(){throw new Error("process.chdir is not supported")},v.umask=function(){return 0}},{}],13:[function(i,o){(function(a){(function(){/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */let c;o.exports=typeof queueMicrotask=="function"?queueMicrotask.bind(typeof window>"u"?a:window):l=>(c||(c=Promise.resolve())).then(l).catch(u=>setTimeout(()=>{throw u},0))}).call(this)}).call(this,typeof Un>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Un)},{}],14:[function(i,o){(function(a,c){(function(){var l=i("safe-buffer").Buffer,u=c.crypto||c.msCrypto;o.exports=u&&u.getRandomValues?function(h,d){if(h>4294967295)throw new RangeError("requested too many random bytes");var f=l.allocUnsafe(h);if(0<h)if(65536<h)for(var g=0;g<h;g+=65536)u.getRandomValues(f.slice(g,g+65536));else u.getRandomValues(f);return typeof d=="function"?a.nextTick(function(){d(null,f)}):f}:function(){throw new Error(`Secure random number generation is not supported by this browser.
Use Chrome, Firefox or Internet Explorer 11`)}}).call(this)}).call(this,i("_process"),typeof Un>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Un)},{_process:12,"safe-buffer":30}],15:[function(i,o){function a(g,m){g.prototype=Object.create(m.prototype),g.prototype.constructor=g,g.__proto__=m}function c(g,m,b){function v(w,E,x){return typeof m=="string"?m:m(w,E,x)}b||(b=Error);var A=(function(w){function E(x,P,T){return w.call(this,v(x,P,T))||this}return a(E,w),E})(b);A.prototype.name=b.name,A.prototype.code=g,f[g]=A}function l(g,m){if(Array.isArray(g)){var b=g.length;return g=g.map(function(v){return v+""}),2<b?"one of ".concat(m," ").concat(g.slice(0,b-1).join(", "),", or ")+g[b-1]:b===2?"one of ".concat(m," ").concat(g[0]," or ").concat(g[1]):"of ".concat(m," ").concat(g[0])}return"of ".concat(m," ").concat(g+"")}function u(g,m,b){return g.substr(0,m.length)===m}function h(g,m,b){return(b===void 0||b>g.length)&&(b=g.length),g.substring(b-m.length,b)===m}function d(g,m,b){return typeof b!="number"&&(b=0),!(b+m.length>g.length)&&g.indexOf(m,b)!==-1}var f={};c("ERR_INVALID_OPT_VALUE",function(g,m){return'The value "'+m+'" is invalid for option "'+g+'"'},TypeError),c("ERR_INVALID_ARG_TYPE",function(g,m,b){var v;typeof m=="string"&&u(m,"not ")?(v="must not be",m=m.replace(/^not /,"")):v="must be";var A;if(h(g," argument"))A="The ".concat(g," ").concat(v," ").concat(l(m,"type"));else{var w=d(g,".")?"property":"argument";A='The "'.concat(g,'" ').concat(w," ").concat(v," ").concat(l(m,"type"))}return A+=". Received type ".concat(typeof b),A},TypeError),c("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),c("ERR_METHOD_NOT_IMPLEMENTED",function(g){return"The "+g+" method is not implemented"}),c("ERR_STREAM_PREMATURE_CLOSE","Premature close"),c("ERR_STREAM_DESTROYED",function(g){return"Cannot call "+g+" after a stream was destroyed"}),c("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),c("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),c("ERR_STREAM_WRITE_AFTER_END","write after end"),c("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),c("ERR_UNKNOWN_ENCODING",function(g){return"Unknown encoding: "+g},TypeError),c("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),o.exports.codes=f},{}],16:[function(i,o){(function(a){(function(){function c(v){return this instanceof c?(d.call(this,v),f.call(this,v),this.allowHalfOpen=!0,void(v&&(v.readable===!1&&(this.readable=!1),v.writable===!1&&(this.writable=!1),v.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",l))))):new c(v)}function l(){this._writableState.ended||a.nextTick(u,this)}function u(v){v.end()}var h=Object.keys||function(v){var A=[];for(var w in v)A.push(w);return A};o.exports=c;var d=i("./_stream_readable"),f=i("./_stream_writable");i("inherits")(c,d);for(var g,m=h(f.prototype),b=0;b<m.length;b++)g=m[b],c.prototype[g]||(c.prototype[g]=f.prototype[g]);Object.defineProperty(c.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(c.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(c.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(c.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._writableState!==void 0&&this._readableState.destroyed&&this._writableState.destroyed},set:function(v){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=v,this._writableState.destroyed=v)}})}).call(this)}).call(this,i("_process"))},{"./_stream_readable":18,"./_stream_writable":20,_process:12,inherits:10}],17:[function(i,o){function a(l){return this instanceof a?void c.call(this,l):new a(l)}o.exports=a;var c=i("./_stream_transform");i("inherits")(a,c),a.prototype._transform=function(l,u,h){h(null,l)}},{"./_stream_transform":19,inherits:10}],18:[function(i,o){(function(a,c){(function(){function l(k){return de.from(k)}function u(k){return de.isBuffer(k)||k instanceof oe}function h(k,p,y){return typeof k.prependListener=="function"?k.prependListener(p,y):void(k._events&&k._events[p]?Array.isArray(k._events[p])?k._events[p].unshift(y):k._events[p]=[y,k._events[p]]:k.on(p,y))}function d(k,p,y){te=te||i("./_stream_duplex"),k=k||{},typeof y!="boolean"&&(y=p instanceof te),this.objectMode=!!k.objectMode,y&&(this.objectMode=this.objectMode||!!k.readableObjectMode),this.highWaterMark=He(this,k,"readableHighWaterMark",y),this.buffer=new pe,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=k.emitClose!==!1,this.autoDestroy=!!k.autoDestroy,this.destroyed=!1,this.defaultEncoding=k.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,k.encoding&&(!Le&&(Le=i("string_decoder/").StringDecoder),this.decoder=new Le(k.encoding),this.encoding=k.encoding)}function f(k){if(te=te||i("./_stream_duplex"),!(this instanceof f))return new f(k);var p=this instanceof te;this._readableState=new d(k,this,p),this.readable=!0,k&&(typeof k.read=="function"&&(this._read=k.read),typeof k.destroy=="function"&&(this._destroy=k.destroy)),ce.call(this)}function g(k,p,y,_,N){W("readableAddChunk",p);var H=k._readableState;if(p===null)H.reading=!1,w(k,H);else{var Q;if(N||(Q=b(H,p)),Q)q(k,Q);else if(!(H.objectMode||p&&0<p.length))_||(H.reading=!1,P(k,H));else if(typeof p=="string"||H.objectMode||Object.getPrototypeOf(p)===de.prototype||(p=l(p)),_)H.endEmitted?q(k,new U):m(k,H,p,!0);else if(H.ended)q(k,new G);else{if(H.destroyed)return!1;H.reading=!1,H.decoder&&!y?(p=H.decoder.write(p),H.objectMode||p.length!==0?m(k,H,p,!1):P(k,H)):m(k,H,p,!1)}}return!H.ended&&(H.length<H.highWaterMark||H.length===0)}function m(k,p,y,_){p.flowing&&p.length===0&&!p.sync?(p.awaitDrain=0,k.emit("data",y)):(p.length+=p.objectMode?1:y.length,_?p.buffer.unshift(y):p.buffer.push(y),p.needReadable&&E(k)),P(k,p)}function b(k,p){var y;return u(p)||typeof p=="string"||p===void 0||k.objectMode||(y=new F("chunk",["string","Buffer","Uint8Array"],p)),y}function v(k){return 1073741824<=k?k=1073741824:(k--,k|=k>>>1,k|=k>>>2,k|=k>>>4,k|=k>>>8,k|=k>>>16,k++),k}function A(k,p){return 0>=k||p.length===0&&p.ended?0:p.objectMode?1:k===k?(k>p.highWaterMark&&(p.highWaterMark=v(k)),k<=p.length?k:p.ended?p.length:(p.needReadable=!0,0)):p.flowing&&p.length?p.buffer.head.data.length:p.length}function w(k,p){if(W("onEofChunk"),!p.ended){if(p.decoder){var y=p.decoder.end();y&&y.length&&(p.buffer.push(y),p.length+=p.objectMode?1:y.length)}p.ended=!0,p.sync?E(k):(p.needReadable=!1,!p.emittedReadable&&(p.emittedReadable=!0,x(k)))}}function E(k){var p=k._readableState;W("emitReadable",p.needReadable,p.emittedReadable),p.needReadable=!1,p.emittedReadable||(W("emitReadable",p.flowing),p.emittedReadable=!0,a.nextTick(x,k))}function x(k){var p=k._readableState;W("emitReadable_",p.destroyed,p.length,p.ended),!p.destroyed&&(p.length||p.ended)&&(k.emit("readable"),p.emittedReadable=!1),p.needReadable=!p.flowing&&!p.ended&&p.length<=p.highWaterMark,B(k)}function P(k,p){p.readingMore||(p.readingMore=!0,a.nextTick(T,k,p))}function T(k,p){for(;!p.reading&&!p.ended&&(p.length<p.highWaterMark||p.flowing&&p.length===0);){var y=p.length;if(W("maybeReadMore read 0"),k.read(0),y===p.length)break}p.readingMore=!1}function D(k){return function(){var p=k._readableState;W("pipeOnDrain",p.awaitDrain),p.awaitDrain&&p.awaitDrain--,p.awaitDrain===0&&ie(k,"data")&&(p.flowing=!0,B(k))}}function C(k){var p=k._readableState;p.readableListening=0<k.listenerCount("readable"),p.resumeScheduled&&!p.paused?p.flowing=!0:0<k.listenerCount("data")&&k.resume()}function R(k){W("readable nexttick read 0"),k.read(0)}function O(k,p){p.resumeScheduled||(p.resumeScheduled=!0,a.nextTick(V,k,p))}function V(k,p){W("resume",p.reading),p.reading||k.read(0),p.resumeScheduled=!1,k.emit("resume"),B(k),p.flowing&&!p.reading&&k.read(0)}function B(k){var p=k._readableState;for(W("flow",p.flowing);p.flowing&&k.read()!==null;);}function z(k,p){if(p.length===0)return null;var y;return p.objectMode?y=p.buffer.shift():!k||k>=p.length?(y=p.decoder?p.buffer.join(""):p.buffer.length===1?p.buffer.first():p.buffer.concat(p.length),p.buffer.clear()):y=p.buffer.consume(k,p.decoder),y}function $(k){var p=k._readableState;W("endReadable",p.endEmitted),p.endEmitted||(p.ended=!0,a.nextTick(K,p,k))}function K(k,p){if(W("endReadableNT",k.endEmitted,k.length),!k.endEmitted&&k.length===0&&(k.endEmitted=!0,p.readable=!1,p.emit("end"),k.autoDestroy)){var y=p._writableState;(!y||y.autoDestroy&&y.finished)&&p.destroy()}}function X(k,p){for(var y=0,_=k.length;y<_;y++)if(k[y]===p)return y;return-1}o.exports=f;var te;f.ReadableState=d;var W;i("events").EventEmitter;var ie=function(k,p){return k.listeners(p).length},ce=i("./internal/streams/stream"),de=i("buffer").Buffer,oe=c.Uint8Array||function(){},Se=i("util");W=Se&&Se.debuglog?Se.debuglog("stream"):function(){};var Le,xe,ee,pe=i("./internal/streams/buffer_list"),se=i("./internal/streams/destroy"),ye=i("./internal/streams/state"),He=ye.getHighWaterMark,M=i("../errors").codes,F=M.ERR_INVALID_ARG_TYPE,G=M.ERR_STREAM_PUSH_AFTER_EOF,L=M.ERR_METHOD_NOT_IMPLEMENTED,U=M.ERR_STREAM_UNSHIFT_AFTER_END_EVENT;i("inherits")(f,ce);var q=se.errorOrDestroy,re=["error","close","destroy","pause","resume"];Object.defineProperty(f.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState!==void 0&&this._readableState.destroyed},set:function(k){this._readableState&&(this._readableState.destroyed=k)}}),f.prototype.destroy=se.destroy,f.prototype._undestroy=se.undestroy,f.prototype._destroy=function(k,p){p(k)},f.prototype.push=function(k,p){var y,_=this._readableState;return _.objectMode?y=!0:typeof k=="string"&&(p=p||_.defaultEncoding,p!==_.encoding&&(k=de.from(k,p),p=""),y=!0),g(this,k,p,!1,y)},f.prototype.unshift=function(k){return g(this,k,null,!0,!1)},f.prototype.isPaused=function(){return this._readableState.flowing===!1},f.prototype.setEncoding=function(k){Le||(Le=i("string_decoder/").StringDecoder);var p=new Le(k);this._readableState.decoder=p,this._readableState.encoding=this._readableState.decoder.encoding;for(var y=this._readableState.buffer.head,_="";y!==null;)_+=p.write(y.data),y=y.next;return this._readableState.buffer.clear(),_!==""&&this._readableState.buffer.push(_),this._readableState.length=_.length,this},f.prototype.read=function(k){W("read",k),k=parseInt(k,10);var p=this._readableState,y=k;if(k!==0&&(p.emittedReadable=!1),k===0&&p.needReadable&&((p.highWaterMark===0?0<p.length:p.length>=p.highWaterMark)||p.ended))return W("read: emitReadable",p.length,p.ended),p.length===0&&p.ended?$(this):E(this),null;if(k=A(k,p),k===0&&p.ended)return p.length===0&&$(this),null;var _=p.needReadable;W("need readable",_),(p.length===0||p.length-k<p.highWaterMark)&&(_=!0,W("length less than watermark",_)),p.ended||p.reading?(_=!1,W("reading or ended",_)):_&&(W("do read"),p.reading=!0,p.sync=!0,p.length===0&&(p.needReadable=!0),this._read(p.highWaterMark),p.sync=!1,!p.reading&&(k=A(y,p)));var N;return N=0<k?z(k,p):null,N===null?(p.needReadable=p.length<=p.highWaterMark,k=0):(p.length-=k,p.awaitDrain=0),p.length===0&&(!p.ended&&(p.needReadable=!0),y!==k&&p.ended&&$(this)),N!==null&&this.emit("data",N),N},f.prototype._read=function(){q(this,new L("_read()"))},f.prototype.pipe=function(k,p){function y(fe,Te){W("onunpipe"),fe===Fe&&Te&&Te.hasUnpiped===!1&&(Te.hasUnpiped=!0,N())}function _(){W("onend"),k.end()}function N(){W("cleanup"),k.removeListener("close",ge),k.removeListener("finish",Ce),k.removeListener("drain",Z),k.removeListener("error",Q),k.removeListener("unpipe",y),Fe.removeListener("end",_),Fe.removeListener("end",Me),Fe.removeListener("data",H),ne=!0,$e.awaitDrain&&(!k._writableState||k._writableState.needDrain)&&Z()}function H(fe){W("ondata");var Te=k.write(fe);W("dest.write",Te),Te===!1&&(($e.pipesCount===1&&$e.pipes===k||1<$e.pipesCount&&X($e.pipes,k)!==-1)&&!ne&&(W("false write response, pause",$e.awaitDrain),$e.awaitDrain++),Fe.pause())}function Q(fe){W("onerror",fe),Me(),k.removeListener("error",Q),ie(k,"error")===0&&q(k,fe)}function ge(){k.removeListener("finish",Ce),Me()}function Ce(){W("onfinish"),k.removeListener("close",ge),Me()}function Me(){W("unpipe"),Fe.unpipe(k)}var Fe=this,$e=this._readableState;switch($e.pipesCount){case 0:$e.pipes=k;break;case 1:$e.pipes=[$e.pipes,k];break;default:$e.pipes.push(k)}$e.pipesCount+=1,W("pipe count=%d opts=%j",$e.pipesCount,p);var ft=(!p||p.end!==!1)&&k!==a.stdout&&k!==a.stderr,Y=ft?_:Me;$e.endEmitted?a.nextTick(Y):Fe.once("end",Y),k.on("unpipe",y);var Z=D(Fe);k.on("drain",Z);var ne=!1;return Fe.on("data",H),h(k,"error",Q),k.once("close",ge),k.once("finish",Ce),k.emit("pipe",Fe),$e.flowing||(W("pipe resume"),Fe.resume()),k},f.prototype.unpipe=function(k){var p=this._readableState,y={hasUnpiped:!1};if(p.pipesCount===0)return this;if(p.pipesCount===1)return k&&k!==p.pipes?this:(k||(k=p.pipes),p.pipes=null,p.pipesCount=0,p.flowing=!1,k&&k.emit("unpipe",this,y),this);if(!k){var _=p.pipes,N=p.pipesCount;p.pipes=null,p.pipesCount=0,p.flowing=!1;for(var H=0;H<N;H++)_[H].emit("unpipe",this,{hasUnpiped:!1});return this}var Q=X(p.pipes,k);return Q===-1?this:(p.pipes.splice(Q,1),p.pipesCount-=1,p.pipesCount===1&&(p.pipes=p.pipes[0]),k.emit("unpipe",this,y),this)},f.prototype.on=function(k,p){var y=ce.prototype.on.call(this,k,p),_=this._readableState;return k==="data"?(_.readableListening=0<this.listenerCount("readable"),_.flowing!==!1&&this.resume()):k=="readable"&&!_.endEmitted&&!_.readableListening&&(_.readableListening=_.needReadable=!0,_.flowing=!1,_.emittedReadable=!1,W("on readable",_.length,_.reading),_.length?E(this):!_.reading&&a.nextTick(R,this)),y},f.prototype.addListener=f.prototype.on,f.prototype.removeListener=function(k,p){var y=ce.prototype.removeListener.call(this,k,p);return k==="readable"&&a.nextTick(C,this),y},f.prototype.removeAllListeners=function(k){var p=ce.prototype.removeAllListeners.apply(this,arguments);return(k==="readable"||k===void 0)&&a.nextTick(C,this),p},f.prototype.resume=function(){var k=this._readableState;return k.flowing||(W("resume"),k.flowing=!k.readableListening,O(this,k)),k.paused=!1,this},f.prototype.pause=function(){return W("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(W("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this},f.prototype.wrap=function(k){var p=this,y=this._readableState,_=!1;for(var N in k.on("end",function(){if(W("wrapped end"),y.decoder&&!y.ended){var Q=y.decoder.end();Q&&Q.length&&p.push(Q)}p.push(null)}),k.on("data",function(Q){if(W("wrapped data"),y.decoder&&(Q=y.decoder.write(Q)),!(y.objectMode&&Q==null)&&(y.objectMode||Q&&Q.length)){var ge=p.push(Q);ge||(_=!0,k.pause())}}),k)this[N]===void 0&&typeof k[N]=="function"&&(this[N]=(function(Q){return function(){return k[Q].apply(k,arguments)}})(N));for(var H=0;H<re.length;H++)k.on(re[H],this.emit.bind(this,re[H]));return this._read=function(Q){W("wrapped _read",Q),_&&(_=!1,k.resume())},this},typeof Symbol=="function"&&(f.prototype[Symbol.asyncIterator]=function(){return xe===void 0&&(xe=i("./internal/streams/async_iterator")),xe(this)}),Object.defineProperty(f.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(f.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(f.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(k){this._readableState&&(this._readableState.flowing=k)}}),f._fromList=z,Object.defineProperty(f.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}}),typeof Symbol=="function"&&(f.from=function(k,p){return ee===void 0&&(ee=i("./internal/streams/from")),ee(f,k,p)})}).call(this)}).call(this,i("_process"),typeof Un>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Un)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/async_iterator":21,"./internal/streams/buffer_list":22,"./internal/streams/destroy":23,"./internal/streams/from":25,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,events:7,inherits:10,"string_decoder/":31,util:2}],19:[function(i,o){function a(v,A){var w=this._transformState;w.transforming=!1;var E=w.writecb;if(E===null)return this.emit("error",new f);w.writechunk=null,w.writecb=null,A!=null&&this.push(A),E(v);var x=this._readableState;x.reading=!1,(x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}function c(v){return this instanceof c?(b.call(this,v),this._transformState={afterTransform:a.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,v&&(typeof v.transform=="function"&&(this._transform=v.transform),typeof v.flush=="function"&&(this._flush=v.flush)),void this.on("prefinish",l)):new c(v)}function l(){var v=this;typeof this._flush!="function"||this._readableState.destroyed?u(this,null,null):this._flush(function(A,w){u(v,A,w)})}function u(v,A,w){if(A)return v.emit("error",A);if(w!=null&&v.push(w),v._writableState.length)throw new m;if(v._transformState.transforming)throw new g;return v.push(null)}o.exports=c;var h=i("../errors").codes,d=h.ERR_METHOD_NOT_IMPLEMENTED,f=h.ERR_MULTIPLE_CALLBACK,g=h.ERR_TRANSFORM_ALREADY_TRANSFORMING,m=h.ERR_TRANSFORM_WITH_LENGTH_0,b=i("./_stream_duplex");i("inherits")(c,b),c.prototype.push=function(v,A){return this._transformState.needTransform=!1,b.prototype.push.call(this,v,A)},c.prototype._transform=function(v,A,w){w(new d("_transform()"))},c.prototype._write=function(v,A,w){var E=this._transformState;if(E.writecb=w,E.writechunk=v,E.writeencoding=A,!E.transforming){var x=this._readableState;(E.needTransform||x.needReadable||x.length<x.highWaterMark)&&this._read(x.highWaterMark)}},c.prototype._read=function(){var v=this._transformState;v.writechunk===null||v.transforming?v.needTransform=!0:(v.transforming=!0,this._transform(v.writechunk,v.writeencoding,v.afterTransform))},c.prototype._destroy=function(v,A){b.prototype._destroy.call(this,v,function(w){A(w)})}},{"../errors":15,"./_stream_duplex":16,inherits:10}],20:[function(i,o){(function(a,c){(function(){function l(L){var U=this;this.next=null,this.entry=null,this.finish=function(){$(U,L)}}function u(L){return W.from(L)}function h(L){return W.isBuffer(L)||L instanceof ie}function d(){}function f(L,U,q){K=K||i("./_stream_duplex"),L=L||{},typeof q!="boolean"&&(q=U instanceof K),this.objectMode=!!L.objectMode,q&&(this.objectMode=this.objectMode||!!L.writableObjectMode),this.highWaterMark=oe(this,L,"writableHighWaterMark",q),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var re=L.decodeStrings===!1;this.decodeStrings=!re,this.defaultEncoding=L.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(k){P(U,k)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=L.emitClose!==!1,this.autoDestroy=!!L.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new l(this)}function g(L){K=K||i("./_stream_duplex");var U=this instanceof K;return U||G.call(g,this)?(this._writableState=new f(L,this,U),this.writable=!0,L&&(typeof L.write=="function"&&(this._write=L.write),typeof L.writev=="function"&&(this._writev=L.writev),typeof L.destroy=="function"&&(this._destroy=L.destroy),typeof L.final=="function"&&(this._final=L.final)),void te.call(this)):new g(L)}function m(L,U){var q=new He;F(L,q),a.nextTick(U,q)}function b(L,U,q,re){var k;return q===null?k=new ye:typeof q!="string"&&!U.objectMode&&(k=new Le("chunk",["string","Buffer"],q)),!k||(F(L,k),a.nextTick(re,k),!1)}function v(L,U,q){return L.objectMode||L.decodeStrings===!1||typeof U!="string"||(U=W.from(U,q)),U}function A(L,U,q,re,k,p){if(!q){var y=v(U,re,k);re!==y&&(q=!0,k="buffer",re=y)}var _=U.objectMode?1:re.length;U.length+=_;var N=U.length<U.highWaterMark;if(N||(U.needDrain=!0),U.writing||U.corked){var H=U.lastBufferedRequest;U.lastBufferedRequest={chunk:re,encoding:k,isBuf:q,callback:p,next:null},H?H.next=U.lastBufferedRequest:U.bufferedRequest=U.lastBufferedRequest,U.bufferedRequestCount+=1}else w(L,U,!1,_,re,k,p);return N}function w(L,U,q,re,k,p,y){U.writelen=re,U.writecb=y,U.writing=!0,U.sync=!0,U.destroyed?U.onwrite(new se("write")):q?L._writev(k,U.onwrite):L._write(k,p,U.onwrite),U.sync=!1}function E(L,U,q,re,k){--U.pendingcb,q?(a.nextTick(k,re),a.nextTick(B,L,U),L._writableState.errorEmitted=!0,F(L,re)):(k(re),L._writableState.errorEmitted=!0,F(L,re),B(L,U))}function x(L){L.writing=!1,L.writecb=null,L.length-=L.writelen,L.writelen=0}function P(L,U){var q=L._writableState,re=q.sync,k=q.writecb;if(typeof k!="function")throw new ee;if(x(q),U)E(L,q,re,U,k);else{var p=R(q)||L.destroyed;p||q.corked||q.bufferProcessing||!q.bufferedRequest||C(L,q),re?a.nextTick(T,L,q,p,k):T(L,q,p,k)}}function T(L,U,q,re){q||D(L,U),U.pendingcb--,re(),B(L,U)}function D(L,U){U.length===0&&U.needDrain&&(U.needDrain=!1,L.emit("drain"))}function C(L,U){U.bufferProcessing=!0;var q=U.bufferedRequest;if(L._writev&&q&&q.next){var re=U.bufferedRequestCount,k=Array(re),p=U.corkedRequestsFree;p.entry=q;for(var y=0,_=!0;q;)k[y]=q,q.isBuf||(_=!1),q=q.next,y+=1;k.allBuffers=_,w(L,U,!0,U.length,k,"",p.finish),U.pendingcb++,U.lastBufferedRequest=null,p.next?(U.corkedRequestsFree=p.next,p.next=null):U.corkedRequestsFree=new l(U),U.bufferedRequestCount=0}else{for(;q;){var N=q.chunk,H=q.encoding,Q=q.callback,ge=U.objectMode?1:N.length;if(w(L,U,!1,ge,N,H,Q),q=q.next,U.bufferedRequestCount--,U.writing)break}q===null&&(U.lastBufferedRequest=null)}U.bufferedRequest=q,U.bufferProcessing=!1}function R(L){return L.ending&&L.length===0&&L.bufferedRequest===null&&!L.finished&&!L.writing}function O(L,U){L._final(function(q){U.pendingcb--,q&&F(L,q),U.prefinished=!0,L.emit("prefinish"),B(L,U)})}function V(L,U){U.prefinished||U.finalCalled||(typeof L._final!="function"||U.destroyed?(U.prefinished=!0,L.emit("prefinish")):(U.pendingcb++,U.finalCalled=!0,a.nextTick(O,L,U)))}function B(L,U){var q=R(U);if(q&&(V(L,U),U.pendingcb===0&&(U.finished=!0,L.emit("finish"),U.autoDestroy))){var re=L._readableState;(!re||re.autoDestroy&&re.endEmitted)&&L.destroy()}return q}function z(L,U,q){U.ending=!0,B(L,U),q&&(U.finished?a.nextTick(q):L.once("finish",q)),U.ended=!0,L.writable=!1}function $(L,U,q){var re=L.entry;for(L.entry=null;re;){var k=re.callback;U.pendingcb--,k(q),re=re.next}U.corkedRequestsFree.next=L}o.exports=g;var K;g.WritableState=f;var X={deprecate:i("util-deprecate")},te=i("./internal/streams/stream"),W=i("buffer").Buffer,ie=c.Uint8Array||function(){},ce=i("./internal/streams/destroy"),de=i("./internal/streams/state"),oe=de.getHighWaterMark,Se=i("../errors").codes,Le=Se.ERR_INVALID_ARG_TYPE,xe=Se.ERR_METHOD_NOT_IMPLEMENTED,ee=Se.ERR_MULTIPLE_CALLBACK,pe=Se.ERR_STREAM_CANNOT_PIPE,se=Se.ERR_STREAM_DESTROYED,ye=Se.ERR_STREAM_NULL_VALUES,He=Se.ERR_STREAM_WRITE_AFTER_END,M=Se.ERR_UNKNOWN_ENCODING,F=ce.errorOrDestroy;i("inherits")(g,te),f.prototype.getBuffer=function(){for(var L=this.bufferedRequest,U=[];L;)U.push(L),L=L.next;return U},(function(){try{Object.defineProperty(f.prototype,"buffer",{get:X.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}})();var G;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(G=Function.prototype[Symbol.hasInstance],Object.defineProperty(g,Symbol.hasInstance,{value:function(L){return!!G.call(this,L)||this===g&&L&&L._writableState instanceof f}})):G=function(L){return L instanceof this},g.prototype.pipe=function(){F(this,new pe)},g.prototype.write=function(L,U,q){var re=this._writableState,k=!1,p=!re.objectMode&&h(L);return p&&!W.isBuffer(L)&&(L=u(L)),typeof U=="function"&&(q=U,U=null),p?U="buffer":!U&&(U=re.defaultEncoding),typeof q!="function"&&(q=d),re.ending?m(this,q):(p||b(this,re,L,q))&&(re.pendingcb++,k=A(this,re,p,L,U,q)),k},g.prototype.cork=function(){this._writableState.corked++},g.prototype.uncork=function(){var L=this._writableState;L.corked&&(L.corked--,!L.writing&&!L.corked&&!L.bufferProcessing&&L.bufferedRequest&&C(this,L))},g.prototype.setDefaultEncoding=function(L){if(typeof L=="string"&&(L=L.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((L+"").toLowerCase())))throw new M(L);return this._writableState.defaultEncoding=L,this},Object.defineProperty(g.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(g.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),g.prototype._write=function(L,U,q){q(new xe("_write()"))},g.prototype._writev=null,g.prototype.end=function(L,U,q){var re=this._writableState;return typeof L=="function"?(q=L,L=null,U=null):typeof U=="function"&&(q=U,U=null),L!=null&&this.write(L,U),re.corked&&(re.corked=1,this.uncork()),re.ending||z(this,re,q),this},Object.defineProperty(g.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}}),Object.defineProperty(g.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState!==void 0&&this._writableState.destroyed},set:function(L){this._writableState&&(this._writableState.destroyed=L)}}),g.prototype.destroy=ce.destroy,g.prototype._undestroy=ce.undestroy,g.prototype._destroy=function(L,U){U(L)}}).call(this)}).call(this,i("_process"),typeof Un>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Un)},{"../errors":15,"./_stream_duplex":16,"./internal/streams/destroy":23,"./internal/streams/state":27,"./internal/streams/stream":28,_process:12,buffer:3,inherits:10,"util-deprecate":32}],21:[function(i,o){(function(a){(function(){function c(D,C,R){return C in D?Object.defineProperty(D,C,{value:R,enumerable:!0,configurable:!0,writable:!0}):D[C]=R,D}function l(D,C){return{value:D,done:C}}function u(D){var C=D[m];if(C!==null){var R=D[x].read();R!==null&&(D[w]=null,D[m]=null,D[b]=null,C(l(R,!1)))}}function h(D){a.nextTick(u,D)}function d(D,C){return function(R,O){D.then(function(){return C[A]?void R(l(void 0,!0)):void C[E](R,O)},O)}}var f,g=i("./end-of-stream"),m=Symbol("lastResolve"),b=Symbol("lastReject"),v=Symbol("error"),A=Symbol("ended"),w=Symbol("lastPromise"),E=Symbol("handlePromise"),x=Symbol("stream"),P=Object.getPrototypeOf(function(){}),T=Object.setPrototypeOf((f={get stream(){return this[x]},next:function(){var D=this,C=this[v];if(C!==null)return Promise.reject(C);if(this[A])return Promise.resolve(l(void 0,!0));if(this[x].destroyed)return new Promise(function(B,z){a.nextTick(function(){D[v]?z(D[v]):B(l(void 0,!0))})});var R,O=this[w];if(O)R=new Promise(d(O,this));else{var V=this[x].read();if(V!==null)return Promise.resolve(l(V,!1));R=new Promise(this[E])}return this[w]=R,R}},c(f,Symbol.asyncIterator,function(){return this}),c(f,"return",function(){var D=this;return new Promise(function(C,R){D[x].destroy(null,function(O){return O?void R(O):void C(l(void 0,!0))})})}),f),P);o.exports=function(D){var C,R=Object.create(T,(C={},c(C,x,{value:D,writable:!0}),c(C,m,{value:null,writable:!0}),c(C,b,{value:null,writable:!0}),c(C,v,{value:null,writable:!0}),c(C,A,{value:D._readableState.endEmitted,writable:!0}),c(C,E,{value:function(O,V){var B=R[x].read();B?(R[w]=null,R[m]=null,R[b]=null,O(l(B,!1))):(R[m]=O,R[b]=V)},writable:!0}),C));return R[w]=null,g(D,function(O){if(O&&O.code!=="ERR_STREAM_PREMATURE_CLOSE"){var V=R[b];return V!==null&&(R[w]=null,R[m]=null,R[b]=null,V(O)),void(R[v]=O)}var B=R[m];B!==null&&(R[w]=null,R[m]=null,R[b]=null,B(l(void 0,!0))),R[A]=!0}),D.on("readable",h.bind(null,R)),R}}).call(this)}).call(this,i("_process"))},{"./end-of-stream":24,_process:12}],22:[function(i,o){function a(w,E){var x=Object.keys(w);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(w);E&&(P=P.filter(function(T){return Object.getOwnPropertyDescriptor(w,T).enumerable})),x.push.apply(x,P)}return x}function c(w){for(var E,x=1;x<arguments.length;x++)E=arguments[x]==null?{}:arguments[x],x%2?a(Object(E),!0).forEach(function(P){l(w,P,E[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(E)):a(Object(E)).forEach(function(P){Object.defineProperty(w,P,Object.getOwnPropertyDescriptor(E,P))});return w}function l(w,E,x){return E in w?Object.defineProperty(w,E,{value:x,enumerable:!0,configurable:!0,writable:!0}):w[E]=x,w}function u(w,E){if(!(w instanceof E))throw new TypeError("Cannot call a class as a function")}function h(w,E){for(var x,P=0;P<E.length;P++)x=E[P],x.enumerable=x.enumerable||!1,x.configurable=!0,"value"in x&&(x.writable=!0),Object.defineProperty(w,x.key,x)}function d(w,E,x){return E&&h(w.prototype,E),w}function f(w,E,x){m.prototype.copy.call(w,E,x)}var g=i("buffer"),m=g.Buffer,b=i("util"),v=b.inspect,A=v&&v.custom||"inspect";o.exports=(function(){function w(){u(this,w),this.head=null,this.tail=null,this.length=0}return d(w,[{key:"push",value:function(E){var x={data:E,next:null};0<this.length?this.tail.next=x:this.head=x,this.tail=x,++this.length}},{key:"unshift",value:function(E){var x={data:E,next:this.head};this.length===0&&(this.tail=x),this.head=x,++this.length}},{key:"shift",value:function(){if(this.length!==0){var E=this.head.data;return this.head=this.length===1?this.tail=null:this.head.next,--this.length,E}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(E){if(this.length===0)return"";for(var x=this.head,P=""+x.data;x=x.next;)P+=E+x.data;return P}},{key:"concat",value:function(E){if(this.length===0)return m.alloc(0);for(var x=m.allocUnsafe(E>>>0),P=this.head,T=0;P;)f(P.data,x,T),T+=P.data.length,P=P.next;return x}},{key:"consume",value:function(E,x){var P;return E<this.head.data.length?(P=this.head.data.slice(0,E),this.head.data=this.head.data.slice(E)):E===this.head.data.length?P=this.shift():P=x?this._getString(E):this._getBuffer(E),P}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(E){var x=this.head,P=1,T=x.data;for(E-=T.length;x=x.next;){var D=x.data,C=E>D.length?D.length:E;if(T+=C===D.length?D:D.slice(0,E),E-=C,E===0){C===D.length?(++P,this.head=x.next?x.next:this.tail=null):(this.head=x,x.data=D.slice(C));break}++P}return this.length-=P,T}},{key:"_getBuffer",value:function(E){var x=m.allocUnsafe(E),P=this.head,T=1;for(P.data.copy(x),E-=P.data.length;P=P.next;){var D=P.data,C=E>D.length?D.length:E;if(D.copy(x,x.length-E,0,C),E-=C,E===0){C===D.length?(++T,this.head=P.next?P.next:this.tail=null):(this.head=P,P.data=D.slice(C));break}++T}return this.length-=T,x}},{key:A,value:function(E,x){return v(this,c({},x,{depth:0,customInspect:!1}))}}]),w})()},{buffer:3,util:2}],23:[function(i,o){(function(a){(function(){function c(h,d){u(h,d),l(h)}function l(h){h._writableState&&!h._writableState.emitClose||h._readableState&&!h._readableState.emitClose||h.emit("close")}function u(h,d){h.emit("error",d)}o.exports={destroy:function(h,d){var f=this,g=this._readableState&&this._readableState.destroyed,m=this._writableState&&this._writableState.destroyed;return g||m?(d?d(h):h&&(this._writableState?!this._writableState.errorEmitted&&(this._writableState.errorEmitted=!0,a.nextTick(u,this,h)):a.nextTick(u,this,h)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(h||null,function(b){!d&&b?f._writableState?f._writableState.errorEmitted?a.nextTick(l,f):(f._writableState.errorEmitted=!0,a.nextTick(c,f,b)):a.nextTick(c,f,b):d?(a.nextTick(l,f),d(b)):a.nextTick(l,f)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)},errorOrDestroy:function(h,d){var f=h._readableState,g=h._writableState;f&&f.autoDestroy||g&&g.autoDestroy?h.destroy(d):h.emit("error",d)}}}).call(this)}).call(this,i("_process"))},{_process:12}],24:[function(i,o){function a(d){var f=!1;return function(){if(!f){f=!0;for(var g=arguments.length,m=Array(g),b=0;b<g;b++)m[b]=arguments[b];d.apply(this,m)}}}function c(){}function l(d){return d.setHeader&&typeof d.abort=="function"}function u(d,f,g){if(typeof f=="function")return u(d,null,f);f||(f={}),g=a(g||c);var m=f.readable||f.readable!==!1&&d.readable,b=f.writable||f.writable!==!1&&d.writable,v=function(){d.writable||w()},A=d._writableState&&d._writableState.finished,w=function(){b=!1,A=!0,m||g.call(d)},E=d._readableState&&d._readableState.endEmitted,x=function(){m=!1,E=!0,b||g.call(d)},P=function(C){g.call(d,C)},T=function(){var C;return m&&!E?(d._readableState&&d._readableState.ended||(C=new h),g.call(d,C)):b&&!A?(d._writableState&&d._writableState.ended||(C=new h),g.call(d,C)):void 0},D=function(){d.req.on("finish",w)};return l(d)?(d.on("complete",w),d.on("abort",T),d.req?D():d.on("request",D)):b&&!d._writableState&&(d.on("end",v),d.on("close",v)),d.on("end",x),d.on("finish",w),f.error!==!1&&d.on("error",P),d.on("close",T),function(){d.removeListener("complete",w),d.removeListener("abort",T),d.removeListener("request",D),d.req&&d.req.removeListener("finish",w),d.removeListener("end",v),d.removeListener("close",v),d.removeListener("finish",w),d.removeListener("end",x),d.removeListener("error",P),d.removeListener("close",T)}}var h=i("../../../errors").codes.ERR_STREAM_PREMATURE_CLOSE;o.exports=u},{"../../../errors":15}],25:[function(i,o){o.exports=function(){throw new Error("Readable.from is not available in the browser")}},{}],26:[function(i,o){function a(A){var w=!1;return function(){w||(w=!0,A.apply(void 0,arguments))}}function c(A){if(A)throw A}function l(A){return A.setHeader&&typeof A.abort=="function"}function u(A,w,E,x){x=a(x);var P=!1;A.on("close",function(){P=!0}),g===void 0&&(g=i("./end-of-stream")),g(A,{readable:w,writable:E},function(D){return D?x(D):(P=!0,void x())});var T=!1;return function(D){if(!P)return T?void 0:(T=!0,l(A)?A.abort():typeof A.destroy=="function"?A.destroy():void x(D||new v("pipe")))}}function h(A){A()}function d(A,w){return A.pipe(w)}function f(A){return A.length&&typeof A[A.length-1]=="function"?A.pop():c}var g,m=i("../../../errors").codes,b=m.ERR_MISSING_ARGS,v=m.ERR_STREAM_DESTROYED;o.exports=function(){for(var A=arguments.length,w=Array(A),E=0;E<A;E++)w[E]=arguments[E];var x=f(w);if(Array.isArray(w[0])&&(w=w[0]),2>w.length)throw new b("streams");var P,T=w.map(function(D,C){var R=C<w.length-1;return u(D,R,0<C,function(O){P||(P=O),O&&T.forEach(h),R||(T.forEach(h),x(P))})});return w.reduce(d)}},{"../../../errors":15,"./end-of-stream":24}],27:[function(i,o){function a(l,u,h){return l.highWaterMark==null?u?l[h]:null:l.highWaterMark}var c=i("../../../errors").codes.ERR_INVALID_OPT_VALUE;o.exports={getHighWaterMark:function(l,u,h,d){var f=a(u,d,h);if(f!=null){if(!(isFinite(f)&&t(f)===f)||0>f){var g=d?h:"highWaterMark";throw new c(g,f)}return t(f)}return l.objectMode?16:16384}}},{"../../../errors":15}],28:[function(i,o){o.exports=i("events").EventEmitter},{events:7}],29:[function(i,o,a){a=o.exports=i("./lib/_stream_readable.js"),a.Stream=a,a.Readable=a,a.Writable=i("./lib/_stream_writable.js"),a.Duplex=i("./lib/_stream_duplex.js"),a.Transform=i("./lib/_stream_transform.js"),a.PassThrough=i("./lib/_stream_passthrough.js"),a.finished=i("./lib/internal/streams/end-of-stream.js"),a.pipeline=i("./lib/internal/streams/pipeline.js")},{"./lib/_stream_duplex.js":16,"./lib/_stream_passthrough.js":17,"./lib/_stream_readable.js":18,"./lib/_stream_transform.js":19,"./lib/_stream_writable.js":20,"./lib/internal/streams/end-of-stream.js":24,"./lib/internal/streams/pipeline.js":26}],30:[function(i,o,a){function c(d,f){for(var g in d)f[g]=d[g]}function l(d,f,g){return h(d,f,g)}/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var u=i("buffer"),h=u.Buffer;h.from&&h.alloc&&h.allocUnsafe&&h.allocUnsafeSlow?o.exports=u:(c(u,a),a.Buffer=l),l.prototype=Object.create(h.prototype),c(h,l),l.from=function(d,f,g){if(typeof d=="number")throw new TypeError("Argument must not be a number");return h(d,f,g)},l.alloc=function(d,f,g){if(typeof d!="number")throw new TypeError("Argument must be a number");var m=h(d);return f===void 0?m.fill(0):typeof g=="string"?m.fill(f,g):m.fill(f),m},l.allocUnsafe=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return h(d)},l.allocUnsafeSlow=function(d){if(typeof d!="number")throw new TypeError("Argument must be a number");return u.SlowBuffer(d)}},{buffer:3}],31:[function(i,o,a){function c(T){if(!T)return"utf8";for(var D;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(D)return;T=(""+T).toLowerCase(),D=!0}}function l(T){var D=c(T);if(typeof D!="string"&&(x.isEncoding===P||!P(T)))throw new Error("Unknown encoding: "+T);return D||T}function u(T){this.encoding=l(T);var D;switch(this.encoding){case"utf16le":this.text=m,this.end=b,D=4;break;case"utf8":this.fillLast=g,D=4;break;case"base64":this.text=v,this.end=A,D=3;break;default:return this.write=w,void(this.end=E)}this.lastNeed=0,this.lastTotal=0,this.lastChar=x.allocUnsafe(D)}function h(T){return 127>=T?0:T>>5==6?2:T>>4==14?3:T>>3==30?4:T>>6==2?-1:-2}function d(T,D,C){var R=D.length-1;if(R<C)return 0;var O=h(D[R]);return 0<=O?(0<O&&(T.lastNeed=O-1),O):--R<C||O===-2?0:(O=h(D[R]),0<=O?(0<O&&(T.lastNeed=O-2),O):--R<C||O===-2?0:(O=h(D[R]),0<=O?(0<O&&(O===2?O=0:T.lastNeed=O-3),O):0))}function f(T,D){if((192&D[0])!=128)return T.lastNeed=0,"�";if(1<T.lastNeed&&1<D.length){if((192&D[1])!=128)return T.lastNeed=1,"�";if(2<T.lastNeed&&2<D.length&&(192&D[2])!=128)return T.lastNeed=2,"�"}}function g(T){var D=this.lastTotal-this.lastNeed,C=f(this,T);return C===void 0?this.lastNeed<=T.length?(T.copy(this.lastChar,D,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(T.copy(this.lastChar,D,0,T.length),void(this.lastNeed-=T.length)):C}function m(T,D){if((T.length-D)%2==0){var C=T.toString("utf16le",D);if(C){var R=C.charCodeAt(C.length-1);if(55296<=R&&56319>=R)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1],C.slice(0,-1)}return C}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=T[T.length-1],T.toString("utf16le",D,T.length-1)}function b(T){var D=T&&T.length?this.write(T):"";if(this.lastNeed){var C=this.lastTotal-this.lastNeed;return D+this.lastChar.toString("utf16le",0,C)}return D}function v(T,D){var C=(T.length-D)%3;return C==0?T.toString("base64",D):(this.lastNeed=3-C,this.lastTotal=3,C==1?this.lastChar[0]=T[T.length-1]:(this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1]),T.toString("base64",D,T.length-C))}function A(T){var D=T&&T.length?this.write(T):"";return this.lastNeed?D+this.lastChar.toString("base64",0,3-this.lastNeed):D}function w(T){return T.toString(this.encoding)}function E(T){return T&&T.length?this.write(T):""}var x=i("safe-buffer").Buffer,P=x.isEncoding||function(T){switch(T=""+T,T&&T.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};a.StringDecoder=u,u.prototype.write=function(T){if(T.length===0)return"";var D,C;if(this.lastNeed){if(D=this.fillLast(T),D===void 0)return"";C=this.lastNeed,this.lastNeed=0}else C=0;return C<T.length?D?D+this.text(T,C):this.text(T,C):D||""},u.prototype.end=function(T){var D=T&&T.length?this.write(T):"";return this.lastNeed?D+"�":D},u.prototype.text=function(T,D){var C=d(this,T,D);if(!this.lastNeed)return T.toString("utf8",D);this.lastTotal=C;var R=T.length-(C-this.lastNeed);return T.copy(this.lastChar,0,R),T.toString("utf8",D,R)},u.prototype.fillLast=function(T){return this.lastNeed<=T.length?(T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,T.length),void(this.lastNeed-=T.length))}},{"safe-buffer":30}],32:[function(i,o){(function(a){(function(){function c(l){try{if(!a.localStorage)return!1}catch{return!1}var u=a.localStorage[l];return u!=null&&(u+"").toLowerCase()==="true"}o.exports=function(l,u){function h(){if(!d){if(c("throwDeprecation"))throw new Error(u);c("traceDeprecation")?console.trace(u):console.warn(u),d=!0}return l.apply(this,arguments)}if(c("noDeprecation"))return l;var d=!1;return h}}).call(this)}).call(this,typeof Un>"u"?typeof self>"u"?typeof window>"u"?{}:window:self:Un)},{}],"/":[function(i,o){function a(A){return A.replace(/a=ice-options:trickle\s\n/g,"")}function c(A){console.warn(A)}/*! simple-peer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */const l=i("debug")("simple-peer"),u=i("get-browser-rtc"),h=i("randombytes"),d=i("readable-stream"),f=i("queue-microtask"),g=i("err-code"),{Buffer:m}=i("buffer"),b=65536;class v extends d.Duplex{constructor(w){if(w=Object.assign({allowHalfOpen:!1},w),super(w),this._id=h(4).toString("hex").slice(0,7),this._debug("new peer %o",w),this.channelName=w.initiator?w.channelName||h(20).toString("hex"):null,this.initiator=w.initiator||!1,this.channelConfig=w.channelConfig||v.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},v.config,w.config),this.offerOptions=w.offerOptions||{},this.answerOptions=w.answerOptions||{},this.sdpTransform=w.sdpTransform||(E=>E),this.streams=w.streams||(w.stream?[w.stream]:[]),this.trickle=w.trickle===void 0||w.trickle,this.allowHalfTrickle=w.allowHalfTrickle!==void 0&&w.allowHalfTrickle,this.iceCompleteTimeout=w.iceCompleteTimeout||5e3,this.destroyed=!1,this.destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,this._wrtc=w.wrtc&&typeof w.wrtc=="object"?w.wrtc:u(),!this._wrtc)throw g(typeof window>"u"?new Error("No WebRTC support: Specify `opts.wrtc` option in this environment"):new Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._senderMap=new Map,this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new this._wrtc.RTCPeerConnection(this.config)}catch(E){return void this.destroy(g(E,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc=typeof this._pc._peerConnectionId=="number",this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=E=>{this._onIceCandidate(E)},typeof this._pc.peerIdentity=="object"&&this._pc.peerIdentity.catch(E=>{this.destroy(g(E,"ERR_PC_PEER_IDENTITY"))}),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=E=>{this._setupData(E)},this.streams&&this.streams.forEach(E=>{this.addStream(E)}),this._pc.ontrack=E=>{this._onTrack(E)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&this._channel.readyState==="open"}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if(typeof w=="string")try{w=JSON.parse(w)}catch{w={}}this._debug("signal()"),w.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),w.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(w.transceiverRequest.kind,w.transceiverRequest.init)),w.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(w.candidate):this._pendingCandidates.push(w.candidate)),w.sdp&&this._pc.setRemoteDescription(new this._wrtc.RTCSessionDescription(w)).then(()=>{this.destroyed||(this._pendingCandidates.forEach(E=>{this._addIceCandidate(E)}),this._pendingCandidates=[],this._pc.remoteDescription.type==="offer"&&this._createAnswer())}).catch(E=>{this.destroy(g(E,"ERR_SET_REMOTE_DESCRIPTION"))}),w.sdp||w.candidate||w.renegotiate||w.transceiverRequest||this.destroy(g(new Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(w){const E=new this._wrtc.RTCIceCandidate(w);this._pc.addIceCandidate(E).catch(x=>{!E.address||E.address.endsWith(".local")?c("Ignoring unsupported ICE candidate."):this.destroy(g(x,"ERR_ADD_ICE_CANDIDATE"))})}send(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(w)}}addTransceiver(w,E){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(w,E),this._needsNegotiation()}catch(x){this.destroy(g(x,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:w,init:E}})}}addStream(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),w.getTracks().forEach(E=>{this.addTrack(E,w)})}}addTrack(w,E){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const x=this._senderMap.get(w)||new Map;let P=x.get(E);if(!P)P=this._pc.addTrack(w,E),x.set(E,P),this._senderMap.set(w,x),this._needsNegotiation();else throw P.removed?g(new Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):g(new Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED")}replaceTrack(w,E,x){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const P=this._senderMap.get(w),T=P?P.get(x):null;if(!T)throw g(new Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");E&&this._senderMap.set(E,P),T.replaceTrack==null?this.destroy(g(new Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK")):T.replaceTrack(E)}removeTrack(w,E){if(this.destroying)return;if(this.destroyed)throw g(new Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const x=this._senderMap.get(w),P=x?x.get(E):null;if(!P)throw g(new Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{P.removed=!0,this._pc.removeTrack(P)}catch(T){T.name==="NS_ERROR_UNEXPECTED"?this._sendersAwaitingStable.push(P):this.destroy(g(T,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(w){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),w.getTracks().forEach(E=>{this.removeTrack(E,w)})}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,f(()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1}))}negotiate(){if(!this.destroying){if(this.destroyed)throw g(new Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout(()=>{this._createOffer()},0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}destroy(w){this._destroy(w,()=>{})}_destroy(w,E){this.destroyed||this.destroying||(this.destroying=!0,this._debug("destroying (error: %s)",w&&(w.message||w)),f(()=>{if(this.destroyed=!0,this.destroying=!1,this._debug("destroy (error: %s)",w&&(w.message||w)),this.readable=this.writable=!1,this._readableState.ended||this.push(null),this._writableState.finished||this.end(),this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch{}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch{}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,w&&this.emit("error",w),this.emit("close"),E()}))}_setupData(w){if(!w.channel)return this.destroy(g(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=w.channel,this._channel.binaryType="arraybuffer",typeof this._channel.bufferedAmountLowThreshold=="number"&&(this._channel.bufferedAmountLowThreshold=b),this.channelName=this._channel.label,this._channel.onmessage=x=>{this._onChannelMessage(x)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=x=>{const P=x.error instanceof Error?x.error:new Error(`Datachannel error: ${x.message} ${x.filename}:${x.lineno}:${x.colno}`);this.destroy(g(P,"ERR_DATA_CHANNEL"))};let E=!1;this._closingInterval=setInterval(()=>{this._channel&&this._channel.readyState==="closing"?(E&&this._onChannelClose(),E=!0):E=!1},5e3)}_read(){}_write(w,E,x){if(this.destroyed)return x(g(new Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(w)}catch(P){return this.destroy(g(P,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>b?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=x):x(null)}else this._debug("write before connect"),this._chunk=w,this._cb=x}_onFinish(){if(!this.destroyed){const w=()=>{setTimeout(()=>this.destroy(),1e3)};this._connected?w():this.once("connect",w)}}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout(()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))},this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then(w=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(w.sdp=a(w.sdp)),w.sdp=this.sdpTransform(w.sdp);const E=()=>{if(!this.destroyed){const x=this._pc.localDescription||w;this._debug("signal"),this.emit("signal",{type:x.type,sdp:x.sdp})}};this._pc.setLocalDescription(w).then(()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?E():this.once("_iceComplete",E))}).catch(x=>{this.destroy(g(x,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(w=>{this.destroy(g(w,"ERR_CREATE_OFFER"))})}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach(w=>{w.mid||!w.sender.track||w.requested||(w.requested=!0,this.addTransceiver(w.sender.track.kind))})}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then(w=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(w.sdp=a(w.sdp)),w.sdp=this.sdpTransform(w.sdp);const E=()=>{if(!this.destroyed){const x=this._pc.localDescription||w;this._debug("signal"),this.emit("signal",{type:x.type,sdp:x.sdp}),this.initiator||this._requestMissingTransceivers()}};this._pc.setLocalDescription(w).then(()=>{this.destroyed||(this.trickle||this._iceComplete?E():this.once("_iceComplete",E))}).catch(x=>{this.destroy(g(x,"ERR_SET_LOCAL_DESCRIPTION"))})}).catch(w=>{this.destroy(g(w,"ERR_CREATE_ANSWER"))})}_onConnectionStateChange(){this.destroyed||this._pc.connectionState==="failed"&&this.destroy(g(new Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const w=this._pc.iceConnectionState,E=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",w,E),this.emit("iceStateChange",w,E),(w==="connected"||w==="completed")&&(this._pcReady=!0,this._maybeReady()),w==="failed"&&this.destroy(g(new Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),w==="closed"&&this.destroy(g(new Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(w){const E=x=>(Object.prototype.toString.call(x.values)==="[object Array]"&&x.values.forEach(P=>{Object.assign(x,P)}),x);this._pc.getStats.length===0||this._isReactNativeWebrtc?this._pc.getStats().then(x=>{const P=[];x.forEach(T=>{P.push(E(T))}),w(null,P)},x=>w(x)):0<this._pc.getStats.length?this._pc.getStats(x=>{if(this.destroyed)return;const P=[];x.result().forEach(T=>{const D={};T.names().forEach(C=>{D[C]=T.stat(C)}),D.id=T.id,D.type=T.type,D.timestamp=T.timestamp,P.push(E(D))}),w(null,P)},x=>w(x)):w(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const w=()=>{this.destroyed||this.getStats((E,x)=>{if(this.destroyed)return;E&&(x=[]);const P={},T={},D={};let C=!1;x.forEach(O=>{(O.type==="remotecandidate"||O.type==="remote-candidate")&&(P[O.id]=O),(O.type==="localcandidate"||O.type==="local-candidate")&&(T[O.id]=O),(O.type==="candidatepair"||O.type==="candidate-pair")&&(D[O.id]=O)});const R=O=>{C=!0;let V=T[O.localCandidateId];V&&(V.ip||V.address)?(this.localAddress=V.ip||V.address,this.localPort=+V.port):V&&V.ipAddress?(this.localAddress=V.ipAddress,this.localPort=+V.portNumber):typeof O.googLocalAddress=="string"&&(V=O.googLocalAddress.split(":"),this.localAddress=V[0],this.localPort=+V[1]),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let B=P[O.remoteCandidateId];B&&(B.ip||B.address)?(this.remoteAddress=B.ip||B.address,this.remotePort=+B.port):B&&B.ipAddress?(this.remoteAddress=B.ipAddress,this.remotePort=+B.portNumber):typeof O.googRemoteAddress=="string"&&(B=O.googRemoteAddress.split(":"),this.remoteAddress=B[0],this.remotePort=+B[1]),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(x.forEach(O=>{O.type==="transport"&&O.selectedCandidatePairId&&R(D[O.selectedCandidatePairId]),(O.type==="googCandidatePair"&&O.googActiveConnection==="true"||(O.type==="candidatepair"||O.type==="candidate-pair")&&O.selected)&&R(O)}),!C&&(!Object.keys(D).length||Object.keys(T).length))return void setTimeout(w,100);if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(V){return this.destroy(g(V,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const O=this._cb;this._cb=null,O(null)}typeof this._channel.bufferedAmountLowThreshold!="number"&&(this._interval=setInterval(()=>this._onInterval(),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")})};w()}_onInterval(){this._cb&&this._channel&&!(this._channel.bufferedAmount>b)&&this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||(this._pc.signalingState==="stable"&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach(w=>{this._pc.removeTrack(w),this._queuedNegotiation=!0}),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(w){this.destroyed||(w.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:w.candidate.candidate,sdpMLineIndex:w.candidate.sdpMLineIndex,sdpMid:w.candidate.sdpMid}}):!w.candidate&&!this._iceComplete&&(this._iceComplete=!0,this.emit("_iceComplete")),w.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(w){if(this.destroyed)return;let E=w.data;E instanceof ArrayBuffer&&(E=m.from(E)),this.push(E)}_onChannelBufferedAmountLow(){if(!this.destroyed&&this._cb){this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const w=this._cb;this._cb=null,w(null)}}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.destroy())}_onTrack(w){this.destroyed||w.streams.forEach(E=>{this._debug("on track"),this.emit("track",w.track,E),this._remoteTracks.push({track:w.track,stream:E}),this._remoteStreams.some(x=>x.id===E.id)||(this._remoteStreams.push(E),f(()=>{this._debug("on stream"),this.emit("stream",E)}))})}_debug(){const w=[].slice.call(arguments);w[0]="["+this._id+"] "+w[0],l.apply(null,w)}}v.WEBRTC_SUPPORT=!!u(),v.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},v.channelConfig={},o.exports=v},{buffer:3,debug:4,"err-code":6,"get-browser-rtc":8,"queue-microtask":13,randombytes:14,"readable-stream":29}]},{},[])("/")})})(Bm)),Bm.exports}var PU=RU();const DU=sa(PU),$w=0,Uw=1,gC=2,mC=(r,e)=>{Ue(r,$w);const t=b$(e);Yt(r,t)},yC=(r,e,t)=>{Ue(r,Uw),Yt(r,Tw(e,t))},NU=(r,e,t)=>yC(e,t,dr(r)),wC=(r,e,t)=>{try{UA(e,dr(r),t)}catch(n){console.error("Caught error while handling a Yjs update",n)}},OU=(r,e)=>{Ue(r,gC),Yt(r,e)},LU=wC,BU=(r,e,t,n)=>{const s=Ge(r);switch(s){case $w:NU(r,e,t);break;case Uw:wC(r,t,n);break;case gC:LU(r,t,n);break;default:throw new Error("Unknown message type")}return s},Mm=3e4;class MU extends gw{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const t=zi();this.getLocalState()!==null&&Mm/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const n=[];this.meta.forEach((s,i)=>{i!==this.clientID&&Mm<=t-s.lastUpdated&&this.states.has(i)&&n.push(i)}),n.length>0&&m3(this,n,"timeout")},ri(Mm/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),s=n===void 0?0:n.clock+1,i=this.states.get(t);e===null?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:s,lastUpdated:zi()});const o=[],a=[],c=[],l=[];e===null?l.push(t):i==null?e!=null&&o.push(t):(a.push(t),Fh(i,e)||c.push(t)),(o.length>0||c.length>0||l.length>0)&&this.emit("change",[{added:o,updated:c,removed:l},"local"]),this.emit("update",[{added:o,updated:a,removed:l},"local"])}setLocalStateField(e,t){const n=this.getLocalState();n!==null&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const m3=(r,e,t)=>{const n=[];for(let s=0;s<e.length;s++){const i=e[s];if(r.states.has(i)){if(r.states.delete(i),i===r.clientID){const o=r.meta.get(i);r.meta.set(i,{clock:o.clock+1,lastUpdated:zi()})}n.push(i)}}n.length>0&&(r.emit("change",[{added:[],updated:[],removed:n},t]),r.emit("update",[{added:[],updated:[],removed:n},t]))},Tp=(r,e,t=r.states)=>{const n=e.length,s=pr();Ue(s,n);for(let i=0;i<n;i++){const o=e[i],a=t.get(o)||null,c=r.meta.get(o).clock;Ue(s,o),Ue(s,c),Ws(s,JSON.stringify(a))}return jt(s)},$U=(r,e,t)=>{const n=hi(e),s=zi(),i=[],o=[],a=[],c=[],l=Ge(n);for(let u=0;u<l;u++){const h=Ge(n);let d=Ge(n);const f=JSON.parse(Ni(n)),g=r.meta.get(h),m=r.states.get(h),b=g===void 0?0:g.clock;(b<d||b===d&&f===null&&r.states.has(h))&&(f===null?h===r.clientID&&r.getLocalState()!=null?d++:r.states.delete(h):r.states.set(h,f),r.meta.set(h,{clock:d,lastUpdated:s}),g===void 0&&f!==null?i.push(h):g!==void 0&&f===null?c.push(h):f!==null&&(Fh(f,m)||a.push(h),o.push(h)))}(i.length>0||a.length>0||c.length>0)&&r.emit("change",[{added:i,updated:a,removed:c},t]),(i.length>0||o.length>0||c.length>0)&&r.emit("update",[{added:i,updated:o,removed:c},t])},UU=(r,e)=>{const t=l3(r).buffer,n=l3(e).buffer;return crypto.subtle.importKey("raw",t,"PBKDF2",!1,["deriveKey"]).then(s=>crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-256"},s,{name:"AES-GCM",length:256},!0,["encrypt","decrypt"]))},bC=(r,e)=>{if(!e)return Ew(r);const t=crypto.getRandomValues(new Uint8Array(12));return crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,r).then(n=>{const s=pr();return Ws(s,"AES-GCM"),Yt(s,t),Yt(s,new Uint8Array(n)),jt(s)})},FU=(r,e)=>{const t=pr();return Sl(t,r),bC(jt(t),e)},vC=(r,e)=>{if(!e)return Ew(r);const t=hi(r);Ni(t)!=="AES-GCM"&&AM(xs("Unknown encryption algorithm"));const s=dr(t),i=dr(t);return crypto.subtle.decrypt({name:"AES-GCM",iv:s},e,i).then(o=>new Uint8Array(o))},VU=(r,e)=>vC(r,e).then(t=>_l(hi(new Uint8Array(t)))),kn=r$("y-webrtc"),cl=0,EC=3,bd=1,Fw=4,Rp=new Map,Na=new Map,SC=r=>{let e=!0;r.webrtcConns.forEach(t=>{t.synced||(e=!1)}),(!e&&r.synced||e&&!r.synced)&&(r.synced=e,r.provider.emit("synced",[{synced:e}]),kn("synced ",jn,r.name,Va," with all peers"))},_C=(r,e,t)=>{const n=hi(e),s=pr(),i=Ge(n);if(r===void 0)return null;const o=r.awareness,a=r.doc;let c=!1;switch(i){case cl:{Ue(s,cl);const l=BU(n,s,a,r);l===Uw&&!r.synced&&t(),l===$w&&(c=!0);break}case EC:Ue(s,bd),Yt(s,Tp(o,Array.from(o.getStates().keys()))),c=!0;break;case bd:$U(o,dr(n),r);break;case Fw:{const l=Fa(n)===1,u=Ni(n);if(u!==r.peerId&&(r.bcConns.has(u)&&!l||!r.bcConns.has(u)&&l)){const h=[],d=[];l?(r.bcConns.add(u),d.push(u)):(r.bcConns.delete(u),h.push(u)),r.provider.emit("peers",[{added:d,removed:h,webrtcPeers:Array.from(r.webrtcConns.keys()),bcPeers:Array.from(r.bcConns)}]),xC(r)}break}default:return console.error("Unable to compute message"),s}return c?s:null},zU=(r,e)=>{const t=r.room;return kn("received message from ",jn,r.remotePeerId,xw," (",t.name,")",Va,Pg),_C(t,e,()=>{r.synced=!0,kn("synced ",jn,t.name,Va," with ",jn,r.remotePeerId),SC(t)})},$m=(r,e)=>{kn("send message to ",jn,r.remotePeerId,Va,xw," (",r.room.name,")",Pg);try{r.peer.send(jt(e))}catch{}},HU=(r,e)=>{kn("broadcast message in ",jn,r.name,Va),r.webrtcConns.forEach(t=>{try{t.peer.send(e)}catch{}})};class k7{constructor(e,t,n,s){kn("establishing connection to ",jn,n),this.room=s,this.remotePeerId=n,this.glareToken=void 0,this.closed=!1,this.connected=!1,this.synced=!1,this.peer=new DU({initiator:t,...s.provider.peerOpts}),this.peer.on("signal",i=>{this.glareToken===void 0&&(this.glareToken=Date.now()+Math.random()),Vw(e,s,{to:n,from:s.peerId,type:"signal",token:this.glareToken,signal:i})}),this.peer.on("connect",()=>{kn("connected to ",jn,n),this.connected=!0;const o=s.provider.doc,a=s.awareness,c=pr();Ue(c,cl),mC(c,o),$m(this,c);const l=a.getStates();if(l.size>0){const u=pr();Ue(u,bd),Yt(u,Tp(a,Array.from(l.keys()))),$m(this,u)}}),this.peer.on("close",()=>{this.connected=!1,this.closed=!0,s.webrtcConns.has(this.remotePeerId)&&(s.webrtcConns.delete(this.remotePeerId),s.provider.emit("peers",[{removed:[this.remotePeerId],added:[],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}])),SC(s),this.peer.destroy(),kn("closed connection to ",jn,n),y3(s)}),this.peer.on("error",i=>{kn("Error in connection to ",jn,n,": ",i),y3(s)}),this.peer.on("data",i=>{const o=zU(this,i);o!==null&&$m(this,o)})}destroy(){this.peer.destroy()}}const bo=(r,e)=>bC(e,r.key).then(t=>r.mux(()=>IU(r.name,t))),I7=(r,e)=>{r.bcconnected&&bo(r,e),HU(r,e)},y3=r=>{Rp.forEach(e=>{e.connected&&(e.send({type:"subscribe",topics:[r.name]}),r.webrtcConns.size<r.provider.maxConns&&Vw(e,r,{type:"announce",from:r.peerId}))})},xC=r=>{if(r.provider.filterBcConns){const e=pr();Ue(e,Fw),pd(e,1),Ws(e,r.peerId),bo(r,jt(e))}};class qU{constructor(e,t,n,s){this.peerId=hA(),this.doc=e,this.awareness=t.awareness,this.provider=t,this.synced=!1,this.name=n,this.key=s,this.webrtcConns=new Map,this.bcConns=new Set,this.mux=TU(),this.bcconnected=!1,this._bcSubscriber=i=>vC(new Uint8Array(i),s).then(o=>this.mux(()=>{const a=_C(this,o,()=>{});a&&bo(this,jt(a))})),this._docUpdateHandler=(i,o)=>{const a=pr();Ue(a,cl),OU(a,i),I7(this,jt(a))},this._awarenessUpdateHandler=({added:i,updated:o,removed:a},c)=>{const l=i.concat(o).concat(a),u=pr();Ue(u,bd),Yt(u,Tp(this.awareness,l)),I7(this,jt(u))},this._beforeUnloadHandler=()=>{m3(this.awareness,[e.clientID],"window unload"),Na.forEach(i=>{i.disconnect()})},typeof window<"u"?window.addEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.on("exit",this._beforeUnloadHandler)}connect(){this.doc.on("update",this._docUpdateHandler),this.awareness.on("update",this._awarenessUpdateHandler),y3(this);const e=this.name;CU(e,this._bcSubscriber),this.bcconnected=!0,xC(this);const t=pr();Ue(t,cl),mC(t,this.doc),bo(this,jt(t));const n=pr();Ue(n,cl),yC(n,this.doc),bo(this,jt(n));const s=pr();Ue(s,EC),bo(this,jt(s));const i=pr();Ue(i,bd),Yt(i,Tp(this.awareness,[this.doc.clientID])),bo(this,jt(i))}disconnect(){Rp.forEach(t=>{t.connected&&t.send({type:"unsubscribe",topics:[this.name]})}),m3(this.awareness,[this.doc.clientID],"disconnect");const e=pr();Ue(e,Fw),pd(e,0),Ws(e,this.peerId),bo(this,jt(e)),kU(this.name,this._bcSubscriber),this.bcconnected=!1,this.doc.off("update",this._docUpdateHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.webrtcConns.forEach(t=>t.destroy())}destroy(){this.disconnect(),typeof window<"u"?window.removeEventListener("beforeunload",this._beforeUnloadHandler):typeof process<"u"&&process.off("exit",this._beforeUnloadHandler)}}const KU=(r,e,t,n)=>{if(Na.has(t))throw xs(`A Yjs Doc connected to room "${t}" already exists!`);const s=new qU(r,e,t,n);return Na.set(t,s),s},Vw=(r,e,t)=>{e.key?FU(t,e.key).then(n=>{r.send({type:"publish",topic:e.name,data:EA(n)})}):r.send({type:"publish",topic:e.name,data:t})};class jU extends _U{constructor(e){super(e),this.providers=new Set,this.on("connect",()=>{kn(`connected (${e})`);const t=Array.from(Na.keys());this.send({type:"subscribe",topics:t}),Na.forEach(n=>Vw(this,n,{type:"announce",from:n.peerId}))}),this.on("message",t=>{switch(t.type){case"publish":{const n=t.topic,s=Na.get(n);if(s==null||typeof n!="string")return;const i=o=>{const a=s.webrtcConns,c=s.peerId;if(o==null||o.from===c||o.to!==void 0&&o.to!==c||s.bcConns.has(o.from))return;const l=a.has(o.from)?()=>{}:()=>s.provider.emit("peers",[{removed:[],added:[o.from],webrtcPeers:Array.from(s.webrtcConns.keys()),bcPeers:Array.from(s.bcConns)}]);switch(o.type){case"announce":a.size<s.provider.maxConns&&(Rn(a,o.from,()=>new k7(this,!0,o.from,s)),l());break;case"signal":if(o.signal.type==="offer"){const u=a.get(o.from);if(u){const h=o.token,d=u.glareToken;if(d&&d>h){kn("offer rejected: ",o.from);return}u.glareToken=void 0}}if(o.signal.type==="answer"){kn("offer answered by: ",o.from);const u=a.get(o.from);u.glareToken=void 0}o.to===c&&(Rn(a,o.from,()=>new k7(this,!1,o.from,s)).peer.signal(o.signal),l());break}};s.key?typeof t.data=="string"&&VU(SA(t.data),s.key).then(i):i(t.data)}}}),this.on("disconnect",()=>kn(`disconnect (${e})`))}}const Um=r=>{r.emit("status",[{connected:r.connected}])};class WU extends iA{constructor(e,t,{signaling:n=["wss://y-webrtc-eu.fly.dev"],password:s=null,awareness:i=new MU(t),maxConns:o=20+ri(_M()*15),filterBcConns:a=!0,peerOpts:c={}}={}){super(),this.roomName=e,this.doc=t,this.filterBcConns=a,this.awareness=i,this.shouldConnect=!1,this.signalingUrls=n,this.signalingConns=[],this.maxConns=o,this.peerOpts=c,this.key=s?UU(s,e):Ew(null),this.room=null,this.key.then(l=>{this.room=KU(t,this,e,l),this.shouldConnect?this.room.connect():this.room.disconnect(),Um(this)}),this.connect(),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}get connected(){return this.room!==null&&this.shouldConnect}connect(){this.shouldConnect=!0,this.signalingUrls.forEach(e=>{const t=Rn(Rp,e,()=>new jU(e));this.signalingConns.push(t),t.providers.add(this)}),this.room&&(this.room.connect(),Um(this))}disconnect(){this.shouldConnect=!1,this.signalingConns.forEach(e=>{e.providers.delete(this),e.providers.size===0&&(e.destroy(),Rp.delete(e.url))}),this.room&&(this.room.disconnect(),Um(this))}destroy(){this.doc.off("destroy",this.destroy),this.key.then(()=>{this.room.destroy(),Na.delete(this.roomName)}),super.destroy()}}const mc=r=>xl((e,t)=>{r.onerror=n=>t(new Error(n.target.error)),r.onsuccess=n=>e(n.target.result)}),GU=(r,e)=>xl((t,n)=>{const s=indexedDB.open(r);s.onupgradeneeded=i=>e(i.target.result),s.onerror=i=>n(xs(i.target.error)),s.onsuccess=i=>{const o=i.target.result;o.onversionchange=()=>{o.close()},t(o)}}),YU=r=>mc(indexedDB.deleteDatabase(r)),QU=(r,e)=>e.forEach(t=>r.createObjectStore.apply(r,t)),rh=(r,e,t="readwrite")=>{const n=r.transaction(e,t);return e.map(s=>sF(n,s))},AC=(r,e)=>mc(r.count(e)),XU=(r,e)=>mc(r.get(e)),CC=(r,e)=>mc(r.delete(e)),JU=(r,e,t)=>mc(r.put(e,t)),w3=(r,e)=>mc(r.add(e)),ZU=(r,e,t)=>mc(r.getAll(e,t)),eF=(r,e,t)=>{let n=null;return nF(r,e,s=>(n=s,!1),t).then(()=>n)},tF=(r,e=null)=>eF(r,e,"prev"),rF=(r,e)=>xl((t,n)=>{r.onerror=n,r.onsuccess=async s=>{const i=s.target.result;if(i===null||await e(i)===!1)return t();i.continue()}}),nF=(r,e,t,n="next")=>rF(r.openKeyCursor(e,n),s=>t(s.key)),sF=(r,e)=>r.objectStore(e),iF=(r,e)=>IDBKeyRange.upperBound(r,e),oF=(r,e)=>IDBKeyRange.lowerBound(r,e),Fm="custom",kC="updates",IC=500,TC=(r,e=()=>{},t=()=>{})=>{const[n]=rh(r.db,[kC]);return ZU(n,oF(r._dbref,!1)).then(s=>{r._destroyed||(e(n),kt(r.doc,()=>{s.forEach(i=>UA(r.doc,i))},r,!1),t(n))}).then(()=>tF(n).then(s=>{r._dbref=s+1})).then(()=>AC(n).then(s=>{r._dbsize=s})).then(()=>n)},aF=(r,e=!0)=>TC(r).then(t=>{(e||r._dbsize>=IC)&&w3(t,Tw(r.doc)).then(()=>CC(t,iF(r._dbref,!0))).then(()=>AC(t).then(n=>{r._dbsize=n}))});class cF extends gw{constructor(e,t){super(),this.doc=t,this.name=e,this._dbref=0,this._dbsize=0,this._destroyed=!1,this.db=null,this.synced=!1,this._db=GU(e,n=>QU(n,[["updates",{autoIncrement:!0}],["custom"]])),this.whenSynced=xl(n=>this.on("synced",()=>n(this))),this._db.then(n=>{this.db=n,TC(this,o=>w3(o,Tw(t)),()=>{if(this._destroyed)return this;this.synced=!0,this.emit("synced",[this])})}),this._storeTimeout=1e3,this._storeTimeoutId=null,this._storeUpdate=(n,s)=>{if(this.db&&s!==this){const[i]=rh(this.db,[kC]);w3(i,n),++this._dbsize>=IC&&(this._storeTimeoutId!==null&&clearTimeout(this._storeTimeoutId),this._storeTimeoutId=setTimeout(()=>{aF(this,!1),this._storeTimeoutId=null},this._storeTimeout))}},t.on("update",this._storeUpdate),this.destroy=this.destroy.bind(this),t.on("destroy",this.destroy)}destroy(){return this._storeTimeoutId&&clearTimeout(this._storeTimeoutId),this.doc.off("update",this._storeUpdate),this.doc.off("destroy",this.destroy),this._destroyed=!0,this._db.then(e=>{e.close()})}clearData(){return this.destroy().then(()=>{YU(this.name)})}get(e){return this._db.then(t=>{const[n]=rh(t,[Fm],"readonly");return XU(n,e)})}set(e,t){return this._db.then(n=>{const[s]=rh(n,[Fm]);return JU(s,t,e)})}del(e){return this._db.then(t=>{const[n]=rh(t,[Fm]);return CC(n,e)})}}const lF="wss://signal.gongbbu.com/ws".split(",").map(r=>r.trim()).filter(Boolean),uF=[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:turn.gongbbu.com:3478",username:"gongbbu",credential:"gongbbu"},{urls:"turns:turn.gongbbu.com:5349",username:"gongbbu",credential:"gongbbu"}],T7="default-room";function hF(){const r=new du,e=r.getArray("messages"),t=r.getMap("files"),n=Nh(e.toArray());try{e.observe(()=>{n.value=e.toArray()})}catch(c){console.debug("[useYjs] messages.observe not available",c)}const s=new WU(T7,r,{signaling:lF,peerOpts:{config:{iceServers:uF}}}),i=new cF(`ydb-${T7}`,r);function o(c,l){if(!l.trim())return;const u={id:crypto.randomUUID(),author:c,text:l,ts:Date.now()};console.debug("[useYjs] sendTextMessage ->",u),e.push([u])}function a(c,l,u){console.debug("[useYjs] attachFileMeta ->",{cid:c,meta:l,author:u}),t.set(c,l);const h={id:crypto.randomUUID(),author:u,cid:c,ts:Date.now()};e.push([h])}return{doc:r,provider:s,persistence:i,messages:e,messagesRef:n,files:t,sendTextMessage:o,attachFileMeta:a}}const dF=Symbol.for("@libp2p/connection"),vd=Symbol.for("@libp2p/content-routing");let Ka=class extends Error{static name="AbortError";constructor(e="The operation was aborted"){super(e),this.name="AbortError"}};class fF extends Error{static name="UnexpectedPeerError";constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}let pF=class extends Error{static name="InvalidCryptoExchangeError";constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},ue=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}};class Pp extends Error{static name="InvalidPublicKeyError";constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}class RC extends Error{static name="InvalidPrivateKeyError";constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}class R7 extends Error{static name="UnsupportedOperationError";constructor(e="Unsupported operation"){super(e),this.name="UnsupportedOperationError"}}class b3 extends Error{static name="ConnectionClosedError";constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}class PC extends Error{static name="ConnectionFailedError";constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}class Wc extends Error{static name="MuxerClosedError";constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}class DC extends Error{static name="StreamResetError";constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}class zc extends Error{static name="StreamStateError";constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}class P7 extends Error{static name="StreamBufferError";constructor(e="The stream buffer was full"){super(e),this.name="StreamBufferError"}}let dn=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}};class NC extends Error{static name="InvalidPeerIdError";constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}let Bg=class extends Error{static name="InvalidMultiaddrError";constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}},gF=class extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}},OC=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};class LC extends Error{static name="UnsupportedProtocolError";constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}class Bt extends Error{static name="InvalidMessageError";constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}let mF=class extends Error{static name="ProtocolError";constructor(e="Protocol error"){super(e),this.name="ProtocolError"}},Mg=class extends Error{static name="TimeoutError";constructor(e="Timed out"){super(e),this.name="TimeoutError"}};class Rl extends Error{static name="NotStartedError";constructor(e="Not started"){super(e),this.name="NotStartedError"}}class X1 extends Error{static name="DialError";constructor(e="Dial error"){super(e),this.name="DialError"}}class v3 extends Error{static name="ListenError";constructor(e="Listen error"){super(e),this.name="ListenError"}}class D7 extends Error{static name="LimitedConnectionError";constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}class yF extends Error{static name="TooManyInboundProtocolStreamsError";constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}class BC extends Error{static name="TooManyOutboundProtocolStreamsError";constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}class pu extends Error{static name="UnsupportedKeyTypeError";constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}class wF extends Event{data;constructor(e,t){super("message",t),this.data=e}}class $g extends Event{error;local;constructor(e,t,n){super("close",n),this.error=t,this.local=e}}class bF extends $g{constructor(e,t){super(!0,e,t)}}class vF extends $g{constructor(e,t){super(!1,e,t)}}const Dp=Symbol.for("@libp2p/peer-discovery"),zw=Symbol.for("@libp2p/peer-id");function Oa(r){return!!r?.[zw]}const Ed=Symbol.for("@libp2p/peer-routing"),Ug="keep-alive";function Hw(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function oi(...r){const e=[];for(const t of r)Hw(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function eo(...r){const e=[];for(const t of r)Hw(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const Fg=Symbol.for("@libp2p/transport");var Np;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(Np||(Np={}));class Nt extends EventTarget{#e=new Map;constructor(){super()}listenerCount(e){const t=this.#e.get(e);return t==null?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let s=this.#e.get(e);s==null&&(s=[],this.#e.set(e,s)),s.push({callback:t,once:(n!==!0&&n!==!1&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let s=this.#e.get(e);s!=null&&(s=s.filter(({callback:i})=>i!==t),this.#e.set(e,s))}dispatchEvent(e){const t=super.dispatchEvent(e);let n=this.#e.get(e.type);return n==null||(n=n.filter(({once:s})=>!s),this.#e.set(e.type,n)),t}safeDispatchEvent(e,t={}){return this.dispatchEvent(new CustomEvent(e,t))}}const yr=Symbol.for("@libp2p/service-capabilities"),ja=Symbol.for("@libp2p/service-dependencies"),EF=new Uint8Array(0);function SF(r){const e=r.match(/../g);return e!=null?new Uint8Array(e.map(t=>parseInt(t,16))):EF}function _F(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function gu(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function xF(r){return new TextEncoder().encode(r)}function AF(r){return new TextDecoder().decode(r)}function CF(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(g){if(g instanceof Uint8Array||(ArrayBuffer.isView(g)?g=new Uint8Array(g.buffer,g.byteOffset,g.byteLength):Array.isArray(g)&&(g=Uint8Array.from(g))),!(g instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(g.length===0)return"";for(var m=0,b=0,v=0,A=g.length;v!==A&&g[v]===0;)v++,m++;for(var w=(A-v)*u+1>>>0,E=new Uint8Array(w);v!==A;){for(var x=g[v],P=0,T=w-1;(x!==0||P<b)&&T!==-1;T--,P++)x+=256*E[T]>>>0,E[T]=x%a>>>0,x=x/a>>>0;if(x!==0)throw new Error("Non-zero carry");b=P,v++}for(var D=w-b;D!==w&&E[D]===0;)D++;for(var C=c.repeat(m);D<w;++D)C+=r.charAt(E[D]);return C}function d(g){if(typeof g!="string")throw new TypeError("Expected String");if(g.length===0)return new Uint8Array;var m=0;if(g[m]!==" "){for(var b=0,v=0;g[m]===c;)b++,m++;for(var A=(g.length-m)*l+1>>>0,w=new Uint8Array(A);g[m];){var E=t[g.charCodeAt(m)];if(E===255)return;for(var x=0,P=A-1;(E!==0||x<v)&&P!==-1;P--,x++)E+=a*w[P]>>>0,w[P]=E%256>>>0,E=E/256>>>0;if(E!==0)throw new Error("Non-zero carry");v=x,m++}if(g[m]!==" "){for(var T=A-v;T!==A&&w[T]===0;)T++;for(var D=new Uint8Array(b+(A-T)),C=b;T!==A;)D[C++]=w[T++];return D}}}function f(g){var m=d(g);if(m)return m;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var kF=CF,IF=kF;let TF=class{name;prefix;baseEncode;constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},RF=class{name;prefix;baseDecode;prefixCodePoint;constructor(e,t,n){this.name=e,this.prefix=t;const s=t.codePointAt(0);if(s===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return MC(this,e)}};class PF{decoders;constructor(e){this.decoders=e}or(e){return MC(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function MC(r,e){return new PF({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class DF{name;prefix;baseEncode;baseDecode;encoder;decoder;constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new TF(e,t,n),this.decoder=new RF(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function Vg({name:r,prefix:e,encode:t,decode:n}){return new DF(r,e,t,n)}function gf({name:r,prefix:e,alphabet:t}){const{encode:n,decode:s}=IF(t,r);return Vg({prefix:e,name:r,encode:n,decode:i=>gu(s(i))})}function NF(r,e,t,n){let s=r.length;for(;r[s-1]==="=";)--s;const i=new Uint8Array(s*t/8|0);let o=0,a=0,c=0;for(let l=0;l<s;++l){const u=e[r[l]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<t|u,o+=t,o>=8&&(o-=8,i[c++]=255&a>>o)}if(o>=t||(255&a<<8-o)!==0)throw new SyntaxError("Unexpected end of data");return i}function OF(r,e,t){const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o!==0&&(i+=e[s&a<<t-o]),n)for(;(i.length*t&7)!==0;)i+="=";return i}function LF(r){const e={};for(let t=0;t<r.length;++t)e[r[t]]=t;return e}function Dr({name:r,prefix:e,bitsPerChar:t,alphabet:n}){const s=LF(n);return Vg({prefix:e,name:r,encode(i){return OF(i,n,t)},decode(i){return NF(i,s,t,r)}})}const _r=Dr({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),BF=Dr({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),MF=Dr({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$F=Dr({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),UF=Dr({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),FF=Dr({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),VF=Dr({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),zF=Dr({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),HF=Dr({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),qF=Object.freeze(Object.defineProperty({__proto__:null,base32:_r,base32hex:UF,base32hexpad:VF,base32hexpadupper:zF,base32hexupper:FF,base32pad:MF,base32padupper:$F,base32upper:BF,base32z:HF},Symbol.toStringTag,{value:"Module"})),Dt=gf({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),KF=gf({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),jF=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Dt,base58flickr:KF},Symbol.toStringTag,{value:"Module"})),gn=Dr({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),qw=Dr({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mu=Dr({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),WF=Dr({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),GF=Object.freeze(Object.defineProperty({__proto__:null,base64:gn,base64pad:qw,base64url:mu,base64urlpad:WF},Symbol.toStringTag,{value:"Module"})),Pl=1e3,Dl=Pl*60,Nl=Dl*60,Wa=Nl*24,Sd=Wa*7,Ol=Wa*365.25,_d=Ol/12;function YF(r,e){if(typeof r=="string")return QF(r);if(typeof r=="number")return ZF(r,e);throw Error(`Value provided to ms() must be a string or number. value=${JSON.stringify(r)}`)}var $C=YF;function QF(r){if(typeof r!="string"||r.length===0||r.length>100)throw Error(`Value provided to ms.parse() must be a string with length between 1 and 99. value=${JSON.stringify(r)}`);let e=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec(r);if(!e?.groups)return NaN;let{value:t,unit:n="ms"}=e.groups,s=parseFloat(t),i=n.toLowerCase();switch(i){case"years":case"year":case"yrs":case"yr":case"y":return s*Ol;case"months":case"month":case"mo":return s*_d;case"weeks":case"week":case"w":return s*Sd;case"days":case"day":case"d":return s*Wa;case"hours":case"hour":case"hrs":case"hr":case"h":return s*Nl;case"minutes":case"minute":case"mins":case"min":case"m":return s*Dl;case"seconds":case"second":case"secs":case"sec":case"s":return s*Pl;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:throw Error(`Unknown unit "${i}" provided to ms.parse(). value=${JSON.stringify(r)}`)}}function XF(r){let e=Math.abs(r);return e>=Ol?`${Math.round(r/Ol)}y`:e>=_d?`${Math.round(r/_d)}mo`:e>=Sd?`${Math.round(r/Sd)}w`:e>=Wa?`${Math.round(r/Wa)}d`:e>=Nl?`${Math.round(r/Nl)}h`:e>=Dl?`${Math.round(r/Dl)}m`:e>=Pl?`${Math.round(r/Pl)}s`:`${r}ms`}function JF(r){let e=Math.abs(r);return e>=Ol?da(r,e,Ol,"year"):e>=_d?da(r,e,_d,"month"):e>=Sd?da(r,e,Sd,"week"):e>=Wa?da(r,e,Wa,"day"):e>=Nl?da(r,e,Nl,"hour"):e>=Dl?da(r,e,Dl,"minute"):e>=Pl?da(r,e,Pl,"second"):`${r} ms`}function ZF(r,e){if(typeof r!="number"||!Number.isFinite(r))throw Error("Value provided to ms.format() must be of type number.");return e?.long?JF(r):XF(r)}function da(r,e,t,n){let s=e>=t*1.5;return`${Math.round(r/t)} ${n}${s?"s":""}`}function eV(r){t.debug=t,t.default=t,t.coerce=c,t.disable=i,t.enable=s,t.enabled=o,t.humanize=$C,t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let h=0;for(let d=0;d<u.length;d++)h=(h<<5)-h+u.charCodeAt(d),h|=0;return t.colors[Math.abs(h)%t.colors.length]}t.selectColor=e;function t(u){let h,d=null,f,g;function m(...b){if(!m.enabled)return;const v=m,A=Number(new Date),w=A-(h||A);v.diff=w,v.prev=h,v.curr=A,h=A,b[0]=t.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let E=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(P,T)=>{if(P==="%%")return"%";E++;const D=t.formatters[T];if(typeof D=="function"){const C=b[E];P=D.call(v,C),b.splice(E,1),E--}return P}),t.formatArgs.call(v,b),(v.log||t.log).apply(v,b)}return m.namespace=u,m.useColors=t.useColors(),m.color=t.selectColor(u),m.extend=n,m.destroy=t.destroy,Object.defineProperty(m,"enabled",{enumerable:!0,configurable:!1,get:()=>d!==null?d:(f!==t.namespaces&&(f=t.namespaces,g=t.enabled(u)),g),set:b=>{d=b}}),typeof t.init=="function"&&t.init(m),m}function n(u,h){const d=t(this.namespace+(typeof h>"u"?":":h)+u);return d.log=this.log,d}function s(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let h;const d=(typeof u=="string"?u:"").split(/[\s,]+/),f=d.length;for(h=0;h<f;h++)d[h]&&(u=d[h].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function i(){const u=[...t.names.map(a),...t.skips.map(a).map(h=>"-"+h)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let h,d;for(h=0,d=t.skips.length;h<d;h++)if(t.skips[h].test(u))return!1;for(h=0,d=t.names.length;h<d;h++)if(t.names[h].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var tV={};const Op=cV(),rV=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function nV(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/(edge|trident)\/(\d+)/)!=null?!1:typeof document<"u"&&document.documentElement?.style?.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/firefox\/(\d+)/)!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent?.toLowerCase().match(/applewebkit\/(\d+)/)}function sV(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+$C(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(t++,s==="%c"&&(n=t))}),r.splice(n,0,e)}const iV=console.debug??console.log??(()=>{});function oV(r){try{r?Op?.setItem("debug",r):Op?.removeItem("debug")}catch{}}function aV(){let r;try{r=Op?.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=tV.DEBUG),r}function cV(){try{return localStorage}catch{}}function lV(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const rt=eV({formatArgs:sV,save:oV,load:aV,useColors:nV,setupFormatters:lV,colors:rV,storage:Op,log:iV});rt.formatters.b=r=>r==null?"undefined":Dt.baseEncode(r);rt.formatters.t=r=>r==null?"undefined":_r.baseEncode(r);rt.formatters.m=r=>r==null?"undefined":gn.baseEncode(r);rt.formatters.p=r=>r==null?"undefined":r.toString();rt.formatters.c=r=>r==null?"undefined":r.toString();rt.formatters.k=r=>r==null?"undefined":r.toString();rt.formatters.a=r=>r==null?"undefined":r.toString();rt.formatters.e=r=>{if(r==null)return"undefined";const e=N7(r.message),t=N7(r.stack);return e!=null&&t!=null?t.includes(e)?t:`${e}
${t}`:t??e??r.toString()};function uV(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function zg(){return{forComponent(r){return yn(r)}}}function yn(r){let e=uV(`${r}:trace`);return rt.enabled(`${r}:trace`)&&rt.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=rt(`${r}:trace`)),Object.assign(rt(r),{error:rt(`${r}:error`),trace:e,newScope:t=>yn(`${r}:${t}`)})}function N7(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}class Pe extends Event{type;detail;constructor(e,t){super(e),this.type=e,this.detail=t}}var Vm={exports:{}},O7;function hV(){return O7||(O7=1,(function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,h,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,h||c,d),g=t?t+l:l;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],f]:c._events[g].push(f):(c._events[g]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var d=0,f=h.length,g=new Array(f);d<f;d++)g[d]=h[d].fn;return g},a.prototype.listenerCount=function(l){var u=t?t+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,d,f,g){var m=t?t+l:l;if(!this._events[m])return!1;var b=this._events[m],v=arguments.length,A,w;if(b.fn){switch(b.once&&this.removeListener(l,b.fn,void 0,!0),v){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,u),!0;case 3:return b.fn.call(b.context,u,h),!0;case 4:return b.fn.call(b.context,u,h,d),!0;case 5:return b.fn.call(b.context,u,h,d,f),!0;case 6:return b.fn.call(b.context,u,h,d,f,g),!0}for(w=1,A=new Array(v-1);w<v;w++)A[w-1]=arguments[w];b.fn.apply(b.context,A)}else{var E=b.length,x;for(w=0;w<E;w++)switch(b[w].once&&this.removeListener(l,b[w].fn,void 0,!0),v){case 1:b[w].fn.call(b[w].context);break;case 2:b[w].fn.call(b[w].context,u);break;case 3:b[w].fn.call(b[w].context,u,h);break;case 4:b[w].fn.call(b[w].context,u,h,d);break;default:if(!A)for(x=1,A=new Array(v-1);x<v;x++)A[x-1]=arguments[x];b[w].fn.apply(b[w].context,A)}}return!0},a.prototype.on=function(l,u,h){return i(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return i(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,d){var f=t?t+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===u&&(!d||g.once)&&(!h||g.context===h)&&o(this,f);else{for(var m=0,b=[],v=g.length;m<v;m++)(g[m].fn!==u||d&&!g[m].once||h&&g[m].context!==h)&&b.push(g[m]);b.length?this._events[f]=b.length===1?b[0]:b:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a})(Vm)),Vm.exports}var dV=hV();const UC=sa(dV);let FC=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},fV=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const L7=r=>globalThis.DOMException===void 0?new fV(r):new DOMException(r),B7=r=>{const e=r.reason===void 0?L7("This operation was aborted."):r.reason;return e instanceof Error?e:L7(e)};function pV(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:f}=e;f.aborted&&h(B7(f)),a=()=>{h(B7(f))},f.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,h);return}const d=new FC;o=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(f){h(f)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?u():s instanceof Error?h(s):(d.message=s??`Promise timed out after ${t} milliseconds`,h(d))},t),(async()=>{try{u(await r)}catch(f){h(f)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},l}function gV(r,e,t){let n=0,s=r.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}let mV=class{#e=[];enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||this.#e[this.size-1].priority>=t.priority){this.#e.push(n);return}const s=gV(this.#e,n,(i,o)=>o.priority-i.priority);this.#e.splice(s,0,n)}setPriority(e,t){const n=this.#e.findIndex(i=>i.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[s]=this.#e.splice(n,1);this.enqueue(s.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}},VC=class extends UC{#e;#t;#r=0;#l;#c;#d=0;#a;#p;#s;#u;#i=0;#n;#h;#o;#g=1n;timeout;constructor(e){if(super(),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:mV,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);this.#e=e.carryoverConcurrencyCount,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#l=e.intervalCap,this.#c=e.interval,this.#s=new e.queueClass,this.#u=e.queueClass,this.concurrency=e.concurrency,this.timeout=e.timeout,this.#o=e.throwOnTimeout===!0,this.#h=e.autoStart===!1}get#f(){return this.#t||this.#r<this.#l}get#A(){return this.#i<this.#n}#m(){this.#i--,this.#b(),this.emit("next")}#C(){this.#S(),this.#E(),this.#p=void 0}get#k(){const e=Date.now();if(this.#a===void 0){const t=this.#d-e;if(t<0)this.#r=this.#e?this.#i:0;else return this.#p===void 0&&(this.#p=setTimeout(()=>{this.#C()},t)),!0}return!1}#b(){if(this.#s.size===0)return this.#a&&clearInterval(this.#a),this.#a=void 0,this.emit("empty"),this.#i===0&&this.emit("idle"),!1;if(!this.#h){const e=!this.#k;if(this.#f&&this.#A){const t=this.#s.dequeue();return t?(this.emit("active"),t(),e&&this.#E(),!0):!1}}return!1}#E(){this.#t||this.#a!==void 0||(this.#a=setInterval(()=>{this.#S()},this.#c),this.#d=Date.now()+this.#c)}#S(){this.#r===0&&this.#i===0&&this.#a&&(clearInterval(this.#a),this.#a=void 0),this.#r=this.#e?this.#i:0,this.#y()}#y(){for(;this.#b(););}get concurrency(){return this.#n}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#n=e,this.#y()}async#_(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})}setPriority(e,t){this.#s.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#g++).toString(),t={timeout:this.timeout,throwOnTimeout:this.#o,...t},new Promise((n,s)=>{this.#s.enqueue(async()=>{this.#i++;try{t.signal?.throwIfAborted(),this.#r++;let i=e({signal:t.signal});t.timeout&&(i=pV(Promise.resolve(i),{milliseconds:t.timeout})),t.signal&&(i=Promise.race([i,this.#_(t.signal)]));const o=await i;n(o),this.emit("completed",o)}catch(i){if(i instanceof FC&&!t.throwOnTimeout){n();return}s(i),this.emit("error",i)}finally{this.#m()}},t),this.emit("add"),this.#b()})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this.#h?(this.#h=!1,this.#y(),this):this}pause(){this.#h=!0}clear(){this.#s=new this.#u}async onEmpty(){this.#s.size!==0&&await this.#v("empty")}async onSizeLessThan(e){this.#s.size<e||await this.#v("next",()=>this.#s.size<e)}async onIdle(){this.#i===0&&this.#s.size===0||await this.#v("idle")}async#v(e,t){return new Promise(n=>{const s=()=>{t&&!t()||(this.off(e,s),n())};this.on(e,s)})}get size(){return this.#s.size}sizeBy(e){return this.#s.filter(e).length}get pending(){return this.#i}get isPaused(){return this.#h}};function zC(r){const e=[Ko.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const yV=gf({prefix:"9",name:"base10",alphabet:"0123456789"}),wV=Object.freeze(Object.defineProperty({__proto__:null,base10:yV},Symbol.toStringTag,{value:"Module"})),bV=Dr({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),vV=Dr({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),EV=Object.freeze(Object.defineProperty({__proto__:null,base16:bV,base16upper:vV},Symbol.toStringTag,{value:"Module"})),SV=Dr({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),_V=Object.freeze(Object.defineProperty({__proto__:null,base2:SV},Symbol.toStringTag,{value:"Module"})),HC=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),xV=HC.reduce((r,e,t)=>(r[t]=e,r),[]),AV=HC.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function CV(r){return r.reduce((e,t)=>(e+=xV[t],e),"")}function kV(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const s=AV[n];if(s==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(s)}return new Uint8Array(e)}const IV=Vg({prefix:"🚀",name:"base256emoji",encode:CV,decode:kV}),TV=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:IV},Symbol.toStringTag,{value:"Module"})),Oo=gf({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),RV=gf({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),PV=Object.freeze(Object.defineProperty({__proto__:null,base36:Oo,base36upper:RV},Symbol.toStringTag,{value:"Module"})),DV=Dr({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),NV=Object.freeze(Object.defineProperty({__proto__:null,base8:DV},Symbol.toStringTag,{value:"Module"})),OV=Vg({prefix:"\0",name:"identity",encode:r=>AF(r),decode:r=>xF(r)}),LV=Object.freeze(Object.defineProperty({__proto__:null,identity:OV},Symbol.toStringTag,{value:"Module"})),BV=new TextEncoder,MV=new TextDecoder,$V="json",Kw=512;function UV(r){return BV.encode(JSON.stringify(r))}function qC(r){return JSON.parse(MV.decode(r))}const FV=Object.freeze(Object.defineProperty({__proto__:null,code:Kw,decode:qC,encode:UV,name:$V},Symbol.toStringTag,{value:"Module"})),VV="raw",As=85;function zV(r){return gu(r)}function HV(r){return gu(r)}const KC=Object.freeze(Object.defineProperty({__proto__:null,code:As,decode:HV,encode:zV,name:VV},Symbol.toStringTag,{value:"Module"}));var qV=jC,M7=128,KV=-128,jV=Math.pow(2,31);function jC(r,e,t){e=e||[],t=t||0;for(var n=t;r>=jV;)e[t++]=r&255|M7,r/=128;for(;r&KV;)e[t++]=r&255|M7,r>>>=7;return e[t]=r|0,jC.bytes=t-n+1,e}var WV=E3,GV=128,$7=127;function E3(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw E3.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&$7)<<s:(o&$7)*Math.pow(2,s),s+=7}while(o>=GV);return E3.bytes=i-n,t}var YV=Math.pow(2,7),QV=Math.pow(2,14),XV=Math.pow(2,21),JV=Math.pow(2,28),ZV=Math.pow(2,35),ez=Math.pow(2,42),tz=Math.pow(2,49),rz=Math.pow(2,56),nz=Math.pow(2,63),sz=function(r){return r<YV?1:r<QV?2:r<XV?3:r<JV?4:r<ZV?5:r<ez?6:r<tz?7:r<rz?8:r<nz?9:10},iz={encode:qV,decode:WV,encodingLength:sz},Lp=iz;function S3(r,e=0){return[Lp.decode(r,e),Lp.decode.bytes]}function Bp(r,e,t=0){return Lp.encode(r,e,t),e}function Mp(r){return Lp.encodingLength(r)}function ia(r,e){const t=e.byteLength,n=Mp(r),s=n+Mp(t),i=new Uint8Array(s+t);return Bp(r,i,0),Bp(t,i,n),i.set(e,s),new jw(r,t,e,i)}function wr(r){const e=gu(r),[t,n]=S3(e),[s,i]=S3(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new jw(t,s,o,e)}function oz(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&_F(r.bytes,t.bytes)}}class jw{code;size;digest;bytes;constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}}const WC=0,az="identity",GC=gu;function cz(r,e){if(e?.truncate!=null&&e.truncate!==r.byteLength){if(e.truncate<0||e.truncate>r.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${r.byteLength}`);r=r.subarray(0,e.truncate)}return ia(WC,GC(r))}const Pn={code:WC,name:az,encode:GC,digest:cz},lz=20;function Hg({name:r,code:e,encode:t,minDigestLength:n,maxDigestLength:s}){return new uz(r,e,t,n,s)}class uz{name;code;encode;minDigestLength;maxDigestLength;constructor(e,t,n,s,i){this.name=e,this.code=t,this.encode=n,this.minDigestLength=s??lz,this.maxDigestLength=i}digest(e,t){if(t?.truncate!=null){if(t.truncate<this.minDigestLength)throw new Error(`Invalid truncate option, must be greater than or equal to ${this.minDigestLength}`);if(this.maxDigestLength!=null&&t.truncate>this.maxDigestLength)throw new Error(`Invalid truncate option, must be less than or equal to ${this.maxDigestLength}`)}if(e instanceof Uint8Array){const n=this.encode(e);return n instanceof Uint8Array?U7(n,this.code,t?.truncate):n.then(s=>U7(s,this.code,t?.truncate))}else throw Error("Unknown type, must be binary type")}}function U7(r,e,t){if(t!=null&&t!==r.byteLength){if(t>r.byteLength)throw new Error(`Invalid truncate option, must be less than or equal to ${r.byteLength}`);r=r.subarray(0,t)}return ia(e,r)}function YC(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const Zt=Hg({name:"sha2-256",code:18,encode:YC("SHA-256")}),F7=Hg({name:"sha2-512",code:19,encode:YC("SHA-512")});function V7(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return dz(t,_3(r),e??Dt.encoder);default:return fz(t,_3(r),e??_r.encoder)}}const z7=new WeakMap;function _3(r){const e=z7.get(r);if(e==null){const t=new Map;return z7.set(r,t),t}return e}class Ee{code;version;multihash;bytes;"/";constructor(e,t,n,s){this.code=t,this.version=e,this.multihash=n,this.bytes=s,this["/"]=s}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Fu)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==pz)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Ee.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=ia(e,t);return Ee.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Ee.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&oz(e.multihash,n.multihash)}toString(e){return V7(this,e)}toJSON(){return{"/":V7(this)}}link(){return this}[Symbol.toStringTag]="CID";[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof Ee)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:s,multihash:i,bytes:o}=t;return new Ee(n,s,i,o??H7(n,s,i.bytes))}else if(t[gz]===!0){const{version:n,multihash:s,code:i}=t,o=wr(s);return Ee.create(n,i,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Fu)throw new Error(`Version 0 CID must use dag-pb (code: ${Fu}) block encoding`);return new Ee(e,t,n,n.bytes)}case 1:{const s=H7(e,t,n.bytes);return new Ee(e,t,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return Ee.create(0,Fu,e)}static createV1(e,t){return Ee.create(1,e,t)}static decode(e){const[t,n]=Ee.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Ee.inspectBytes(e),n=t.size-t.multihashSize,s=gu(e.subarray(n,n+t.multihashSize));if(s.byteLength!==t.multihashSize)throw new Error("Incorrect length");const i=s.subarray(t.multihashSize-t.digestSize),o=new jw(t.multihashCode,t.digestSize,i,s);return[t.version===0?Ee.createV0(o):Ee.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[h,d]=S3(e.subarray(t));return t+=d,h};let s=n(),i=Fu;if(s===18?(s=0,t=0):i=n(),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:s,codec:i,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,s]=hz(e,t),i=Ee.decode(s);if(i.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return _3(i).set(n,e),i}}function hz(r,e){switch(r[0]){case"Q":{const t=e??Dt;return[Dt.prefix,t.decode(`${Dt.prefix}${r}`)]}case Dt.prefix:{const t=e??Dt;return[Dt.prefix,t.decode(r)]}case _r.prefix:{const t=e??_r;return[_r.prefix,t.decode(r)]}case Oo.prefix:{const t=e??Oo;return[Oo.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function dz(r,e,t){const{prefix:n}=t;if(n!==Dt.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const s=e.get(n);if(s==null){const i=t.encode(r).slice(1);return e.set(n,i),i}else return s}function fz(r,e,t){const{prefix:n}=t,s=e.get(n);if(s==null){const i=t.encode(r);return e.set(n,i),i}else return s}const Fu=112,pz=18;function H7(r,e,t){const n=Mp(r),s=n+Mp(e),i=new Uint8Array(s+t.byteLength);return Bp(r,i,0),Bp(e,i,n),i.set(t,s),i}const gz=Symbol.for("@ipld/js-cid/CID"),Ll={...LV,..._V,...NV,...wV,...EV,...qF,...PV,...jF,...GF,...TV};function ot(r=0){return new Uint8Array(r)}function Dn(r=0){return new Uint8Array(r)}function QC(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const q7=QC("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),zm=QC("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=Dn(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),XC={utf8:q7,"utf-8":q7,hex:Ll.base16,latin1:zm,ascii:zm,binary:zm,...Ll};function he(r,e="utf8"){const t=XC[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const JC=60;function ZC(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:Ko[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:Ko[e.type],TTL:e.TTL??e.ttl??JC,data:e.data instanceof Uint8Array?he(e.data):e.data}))}}const mz=4;function K7(r,e={}){const t=new VC({concurrency:e.queryConcurrency??mz});return async(n,s={})=>{const i=new URLSearchParams;i.set("name",n),zC(s.types).forEach(a=>{i.append("type",Ko[a])}),s.onProgress?.(new Pe("dns:query",n));const o=await t.add(async()=>{const a=await fetch(`${r}?${i}`,{headers:{accept:"application/dns-json"},signal:s?.signal});if(a.status!==200)throw new Error(`Unexpected HTTP status: ${a.status} - ${a.statusText}`);const c=ZC(await a.json());return s.onProgress?.(new Pe("dns:response",c)),c},{signal:s.signal});if(o==null)throw new Error("No DNS response received");return o}}function yz(){return[K7("https://cloudflare-dns.com/dns-query"),K7("https://dns.google/resolve")]}var Hm,j7;function wz(){return j7||(j7=1,Hm=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function s(i,o){t[i]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(i){return t[i]!==void 0||n[i]!==void 0},remove:function(i){t[i]!==void 0&&(t[i]=void 0),n[i]!==void 0&&(n[i]=void 0)},get:function(i){var o=t[i];if(o!==void 0)return o;if((o=n[i])!==void 0)return s(i,o),o},set:function(i,o){t[i]!==void 0?t[i]=o:s(i,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}}),Hm}var bz=wz();const vz=sa(bz);class Ez{lru;constructor(e){this.lru=vz(e)}get(e,t){let n=!0;const s=[];for(const i of t){const o=this.getAnswers(e,i);if(o.length===0){n=!1;break}s.push(...o)}if(n)return ZC({answers:s})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,s=this.lru.get(n);if(s!=null){const i=s.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Ko[a.type]}));return i.length===0&&this.lru.remove(n),i}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,s=this.lru.get(n)??[];s.push({expires:Date.now()+(t.TTL??JC)*1e3,value:t}),this.lru.set(n,s)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function Sz(r){return new Ez(r)}const _z=1e3;let xz=class{resolvers;cache;constructor(e){this.resolvers={},this.cache=Sz(e.cacheSize??_z),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=yz())}async query(e,t={}){const n=zC(t.types),s=t.cached!==!1?this.cache.get(e,n):void 0;if(s!=null)return t.onProgress?.(new Pe("dns:cache",s)),s;const i=`${e.split(".").pop()}.`,o=(this.resolvers[i]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const c of o){if(t.signal?.aborted===!0)break;try{const l=await c(e,{...t,types:n});for(const u of l.Answer)this.cache.add(e,u);return l}catch(l){a.push(l),t.onProgress?.(new Pe("dns:error",l))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}};var Ko;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(Ko||(Ko={}));function ek(r={}){return new xz(r)}function Az(r){return r[Symbol.asyncIterator]!=null}function jo(r){if(Az(r))return(async()=>{for await(const e of r);})();for(const e of r);}class W7 extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class G7 extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class Cz extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const rn={get(r=globalThis){const e=r.crypto;if(e?.subtle==null)throw new Cz("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}};function Qe(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function Wt(r,e){e==null&&(e=r.reduce((s,i)=>s+i.length,0));const t=Dn(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return t}const tk=Symbol.for("@achingbrain/uint8arraylist");function Y7(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const s=t+n.byteLength;if(e<s)return{buf:n,index:e-t};t=s}throw new RangeError("index is out of bounds")}function nh(r){return!!r?.[tk]}class ze{bufs;length;[tk]=!0;constructor(...e){this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(nh(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(nh(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=Y7(this.bufs,e);return t.buf[t.index]}set(e,t){const n=Y7(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(nh(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:s}=this._subList(e,t);return Wt(n,s)}subarray(e,t){const{bufs:n,length:s}=this._subList(e,t);return n.length===1?n[0]:Wt(n,s)}sublist(e,t){const{bufs:n,length:s}=this._subList(e,t),i=new ze;return i.length=s,i.bufs=[...n],i}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let s=0;for(let i=0;i<this.bufs.length;i++){const o=this.bufs[i],a=s,c=a+o.byteLength;if(s=c,e>=c)continue;const l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(o);break}const h=e-a;n.push(o.subarray(h,h+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(u){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!nh(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const s=n.byteLength;if(s===0)throw new TypeError("search must be at least 1 byte long");const i=256,o=new Int32Array(i);for(let h=0;h<i;h++)o[h]=-1;for(let h=0;h<s;h++)o[n[h]]=h;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let u;for(let h=t;h<=c;h+=u){u=0;for(let d=l;d>=0;d--){const f=this.get(h+d);if(n[d]!==f){u=Math.max(1,d-a[f]);break}}if(u===0)return h}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=Dn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const s=ot(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt16(0,t,n),this.write(s,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const s=ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setInt32(0,t,n),this.write(s,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const s=ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigInt64(0,t,n),this.write(s,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=Dn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const s=ot(2);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint16(0,t,n),this.write(s,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const s=ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setUint32(0,t,n),this.write(s,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const s=ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setBigUint64(0,t,n),this.write(s,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const s=ot(4);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat32(0,t,n),this.write(s,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const s=ot(8);new DataView(s.buffer,s.byteOffset,s.byteLength).setFloat64(0,t,n),this.write(s,e)}equals(e){if(e==null||!(e instanceof ze)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Qe(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new ze;return n.bufs=e,t==null&&(t=e.reduce((s,i)=>s+i.byteLength,0)),n.length=t,n}}function le(r,e="utf8"){const t=XC[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}const kz=parseInt("11111",2),x3=parseInt("10000000",2),Iz=parseInt("01111111",2),Q7={0:Vu,1:Vu,2:Tz,3:Dz,4:Nz,5:Pz,6:Rz,16:Vu,22:Vu,48:Vu};function yc(r,e={offset:0}){const t=r[e.offset]&kz;if(e.offset++,Q7[t]!=null)return Q7[t](r,e);throw new Error("No decoder for tag "+t)}function mf(r,e){let t=0;if((r[e.offset]&x3)===x3){const n=r[e.offset]&Iz;let s="0x";e.offset++;for(let i=0;i<n;i++,e.offset++)s+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(s,16)}else t=r[e.offset],e.offset++;return t}function Vu(r,e){mf(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=yc(r,e);if(n===null)break;t.push(n)}return t}function Tz(r,e){const t=mf(r,e),n=e.offset,s=e.offset+t,i=[];for(let o=n;o<s;o++)o===n&&r[o]===0||i.push(r[o]);return e.offset+=t,Uint8Array.from(i)}function Rz(r,e){const t=mf(r,e),n=e.offset+t,s=r[e.offset];e.offset++;let i=0,o=0;s<40?(i=0,o=s):s<80?(i=1,o=s-40):(i=2,o=s-80);let a=`${i}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let h=0;h<c.length;h++)u+=c[h]<<h*7;a+=`.${u}`,c=[]}}return a}function Pz(r,e){return e.offset++,null}function Dz(r,e){const t=mf(r,e),n=r[e.offset];e.offset++;const s=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return s}function Nz(r,e){const t=mf(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function Oz(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new ze;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function qg(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=Oz(r.byteLength);return new ze(Uint8Array.from([e.byteLength|x3]),e)}function En(r){const e=new ze,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new ze(Uint8Array.from([2]),qg(e),e)}function Ww(r){const e=Uint8Array.from([0]),t=new ze(e,r);return new ze(Uint8Array.from([3]),qg(t),t)}function Lz(r){return new ze(Uint8Array.from([4]),qg(r),r)}function Oi(r,e=48){const t=new ze;for(const n of r)t.append(n);return new ze(Uint8Array.from([e]),qg(t),t)}const Bz="1.2.840.10045.3.1.7",Mz="1.3.132.0.34",$z="1.3.132.0.35";async function Uz(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function Fz(r,e,t){const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);t?.signal?.throwIfAborted();const s=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}async function Vz(r,e,t,n){const s=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);n?.signal?.throwIfAborted();const i=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},s,e,t.subarray());return n?.signal?.throwIfAborted(),i}const zz=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),Hz=Uint8Array.from([6,5,43,129,4,0,34]),qz=Uint8Array.from([6,5,43,129,4,0,35]),rk={ext:!0,kty:"EC",crv:"P-256"},nk={ext:!0,kty:"EC",crv:"P-384"},sk={ext:!0,kty:"EC",crv:"P-521"},ll=32,ul=48,hl=66;function Kz(r){const e=yc(r);return ik(e)}function ik(r){const e=r[1],t=he(e,"base64url"),n=r[2][1][0],s=1;let i,o;if(e.byteLength===ll)return i=he(n.subarray(s,s+ll),"base64url"),o=he(n.subarray(s+ll),"base64url"),new Z1({...rk,key_ops:["sign"],d:t,x:i,y:o});if(e.byteLength===ul)return i=he(n.subarray(s,s+ul),"base64url"),o=he(n.subarray(s+ul),"base64url"),new Z1({...nk,key_ops:["sign"],d:t,x:i,y:o});if(e.byteLength===hl)return i=he(n.subarray(s,s+hl),"base64url"),o=he(n.subarray(s+hl),"base64url"),new Z1({...sk,key_ops:["sign"],d:t,x:i,y:o});throw new ue(`Private key length was wrong length, got ${e.byteLength}, expected 32, 48 or 66`)}function ok(r){const e=yc(r);return jz(e)}function jz(r){const e=r[1][1][0],t=1;let n,s;if(e.byteLength===ll*2+1)return n=he(e.subarray(t,t+ll),"base64url"),s=he(e.subarray(t+ll),"base64url"),new J1({...rk,key_ops:["verify"],x:n,y:s});if(e.byteLength===ul*2+1)return n=he(e.subarray(t,t+ul),"base64url"),s=he(e.subarray(t+ul),"base64url"),new J1({...nk,key_ops:["verify"],x:n,y:s});if(e.byteLength===hl*2+1)return n=he(e.subarray(t,t+hl),"base64url"),s=he(e.subarray(t+hl),"base64url"),new J1({...sk,key_ops:["verify"],x:n,y:s});throw new ue(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function Wz(r){return Oi([En(Uint8Array.from([1])),Lz(le(r.d??"","base64url")),Oi([ak(r.crv)],160),Oi([Ww(new ze(Uint8Array.from([4]),le(r.x??"","base64url"),le(r.y??"","base64url")))],161)]).subarray()}function Gz(r){return Oi([En(Uint8Array.from([1])),Oi([ak(r.crv)],160),Oi([Ww(new ze(Uint8Array.from([4]),le(r.x??"","base64url"),le(r.y??"","base64url")))],161)]).subarray()}function ak(r){if(r==="P-256")return zz;if(r==="P-384")return Hz;if(r==="P-521")return qz;throw new ue(`Invalid curve ${r}`)}async function Yz(r="P-256"){const e=await Uz(r);return new Z1(e.privateKey)}class J1{type="ECDSA";jwk;_raw;constructor(e){this.jwk=e}get raw(){return this._raw==null&&(this._raw=Gz(this.jwk)),this._raw}toMultihash(){return Pn.digest(Qs(this))}toCID(){return Ee.createV1(114,this.toMultihash())}toString(){return Dt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}async verify(e,t,n){return Vz(this.jwk,t,e,n)}}class Z1{type="ECDSA";jwk;publicKey;_raw;constructor(e){this.jwk=e,this.publicKey=new J1({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=Wz(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}async sign(e,t){return Fz(this.jwk,e,t)}}/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Kg(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function bs(r,e=""){if(!Number.isSafeInteger(r)||r<0){const t=e&&`"${e}" `;throw new Error(`${t}expected integer >= 0, got ${r}`)}}function st(r,e,t=""){const n=Kg(r),s=r?.length,i=e!==void 0;if(!n||i&&s!==e){const o=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function yf(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash must wrapped by utils.createHasher");bs(r.outputLen),bs(r.blockLen)}function $p(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Qz(r,e){st(r,void 0,"digestInto() output");const t=e.outputLen;if(r.length<t)throw new Error('"digestInto() output" expected to be of length >='+t)}function ai(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Vh(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Bs(r,e){return r<<32-e|r>>>e}function qm(r,e){return r<<e|r>>>32-e>>>0}const ck=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",Xz=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function wf(r){if(st(r),ck)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=Xz[r[t]];return e}const bi={_0:48,_9:57,A:65,F:70,a:97,f:102};function X7(r){if(r>=bi._0&&r<=bi._9)return r-bi._0;if(r>=bi.A&&r<=bi.F)return r-(bi.A-10);if(r>=bi.a&&r<=bi.f)return r-(bi.a-10)}function xd(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(ck)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=X7(r.charCodeAt(i)),a=X7(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}const Jz=async()=>{};async function Zz(r,e,t){let n=Date.now();for(let s=0;s<r;s++){t(s);const i=Date.now()-n;i>=0&&i<e||(await Jz(),n+=i)}}function eH(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function J7(r,e=""){return typeof r=="string"?eH(r):st(r,void 0,e)}function Ks(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];st(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}function tH(r,e){if(e!==void 0&&{}.toString.call(e)!=="[object Object]")throw new Error("options must be object or undefined");return Object.assign(r,e)}function Gw(r,e={}){const t=(s,i)=>r(i).update(s).digest(),n=r(void 0);return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=s=>r(s),Object.assign(t,e),Object.freeze(t)}function bf(r=32){const e=typeof globalThis=="object"?globalThis.crypto:null;if(typeof e?.getRandomValues!="function")throw new Error("crypto.getRandomValues must be defined");return e.getRandomValues(new Uint8Array(r))}const lk=r=>({oid:Uint8Array.from([6,9,96,134,72,1,101,3,4,2,r])});function uk(r,e,t){return r&e^~r&t}function hk(r,e,t){return r&e^r&t^e&t}class Yw{blockLen;outputLen;padOffset;isLE;buffer;view;finished=!1;length=0;pos=0;destroyed=!1;constructor(e,t,n,s){this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Vh(this.buffer)}update(e){$p(this),st(e);const{view:t,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Vh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){$p(this),Qz(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,ai(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;n.setBigUint64(s-8,BigInt(this.length*8),i),this.process(n,0);const a=Vh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen must be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||=new this.constructor,e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const ao=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Nr=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),t1=BigInt(2**32-1),Z7=BigInt(32);function rH(r,e=!1){return e?{h:Number(r&t1),l:Number(r>>Z7&t1)}:{h:Number(r>>Z7&t1)|0,l:Number(r&t1)|0}}function nH(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=rH(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const e9=(r,e,t)=>r>>>t,t9=(r,e,t)=>r<<32-t|e>>>t,Pc=(r,e,t)=>r>>>t|e<<32-t,Dc=(r,e,t)=>r<<32-t|e>>>t,r1=(r,e,t)=>r<<64-t|e>>>t-32,n1=(r,e,t)=>r>>>t-32|e<<64-t;function vi(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const sH=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),iH=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,oH=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),aH=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,cH=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),lH=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,uH=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),co=new Uint32Array(64);class hH extends Yw{constructor(e){super(64,e,8,!1)}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)co[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const d=co[h-15],f=co[h-2],g=Bs(d,7)^Bs(d,18)^d>>>3,m=Bs(f,17)^Bs(f,19)^f>>>10;co[h]=m+co[h-7]+g+co[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const d=Bs(a,6)^Bs(a,11)^Bs(a,25),f=u+d+uk(a,c,l)+uH[h]+co[h]|0,m=(Bs(n,2)^Bs(n,13)^Bs(n,22))+hk(n,s,i)|0;u=l,l=c,c=a,a=o+f|0,o=i,i=s,s=n,n=f+m|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){ai(co)}destroy(){this.set(0,0,0,0,0,0,0,0),ai(this.buffer)}}class dH extends hH{A=ao[0]|0;B=ao[1]|0;C=ao[2]|0;D=ao[3]|0;E=ao[4]|0;F=ao[5]|0;G=ao[6]|0;H=ao[7]|0;constructor(){super(32)}}const dk=nH(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),fH=dk[0],pH=dk[1],lo=new Uint32Array(80),uo=new Uint32Array(80);class gH extends Yw{constructor(e){super(128,e,16,!1)}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:f,Gl:g,Hh:m,Hl:b}=this;return[e,t,n,s,i,o,a,c,l,u,h,d,f,g,m,b]}set(e,t,n,s,i,o,a,c,l,u,h,d,f,g,m,b){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=f|0,this.Gl=g|0,this.Hh=m|0,this.Hl=b|0}process(e,t){for(let w=0;w<16;w++,t+=4)lo[w]=e.getUint32(t),uo[w]=e.getUint32(t+=4);for(let w=16;w<80;w++){const E=lo[w-15]|0,x=uo[w-15]|0,P=Pc(E,x,1)^Pc(E,x,8)^e9(E,x,7),T=Dc(E,x,1)^Dc(E,x,8)^t9(E,x,7),D=lo[w-2]|0,C=uo[w-2]|0,R=Pc(D,C,19)^r1(D,C,61)^e9(D,C,6),O=Dc(D,C,19)^n1(D,C,61)^t9(D,C,6),V=oH(T,O,uo[w-7],uo[w-16]),B=aH(V,P,R,lo[w-7],lo[w-16]);lo[w]=B|0,uo[w]=V|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:f,Fl:g,Gh:m,Gl:b,Hh:v,Hl:A}=this;for(let w=0;w<80;w++){const E=Pc(h,d,14)^Pc(h,d,18)^r1(h,d,41),x=Dc(h,d,14)^Dc(h,d,18)^n1(h,d,41),P=h&f^~h&m,T=d&g^~d&b,D=cH(A,x,T,pH[w],uo[w]),C=lH(D,v,E,P,fH[w],lo[w]),R=D|0,O=Pc(n,s,28)^r1(n,s,34)^r1(n,s,39),V=Dc(n,s,28)^n1(n,s,34)^n1(n,s,39),B=n&i^n&a^i&a,z=s&o^s&c^o&c;v=m|0,A=b|0,m=f|0,b=g|0,f=h|0,g=d|0,{h,l:d}=vi(l|0,u|0,C|0,R|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const $=sH(R,V,z);n=iH($,C,O,B),s=$|0}({h:n,l:s}=vi(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=vi(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=vi(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=vi(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=vi(this.Eh|0,this.El|0,h|0,d|0),{h:f,l:g}=vi(this.Fh|0,this.Fl|0,f|0,g|0),{h:m,l:b}=vi(this.Gh|0,this.Gl|0,m|0,b|0),{h:v,l:A}=vi(this.Hh|0,this.Hl|0,v|0,A|0),this.set(n,s,i,o,a,c,l,u,h,d,f,g,m,b,v,A)}roundClean(){ai(lo,uo)}destroy(){ai(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}class mH extends gH{Ah=Nr[0]|0;Al=Nr[1]|0;Bh=Nr[2]|0;Bl=Nr[3]|0;Ch=Nr[4]|0;Cl=Nr[5]|0;Dh=Nr[6]|0;Dl=Nr[7]|0;Eh=Nr[8]|0;El=Nr[9]|0;Fh=Nr[10]|0;Fl=Nr[11]|0;Gh=Nr[12]|0;Gl=Nr[13]|0;Hh=Nr[14]|0;Hl=Nr[15]|0;constructor(){super(64)}}const Lo=Gw(()=>new dH,lk(1)),jg=Gw(()=>new mH,lk(3));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qw=BigInt(0),A3=BigInt(1);function Ga(r,e=""){if(typeof r!="boolean"){const t=e&&`"${e}" `;throw new Error(t+"expected boolean, got type="+typeof r)}return r}function fk(r){if(typeof r=="bigint"){if(!ep(r))throw new Error("positive bigint expected, got "+r)}else bs(r);return r}function s1(r){const e=fk(r).toString(16);return e.length&1?"0"+e:e}function pk(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Qw:BigInt("0x"+r)}function Wg(r){return pk(wf(r))}function Ya(r){return pk(wf(Ad(st(r)).reverse()))}function Xw(r,e){bs(e),r=fk(r);const t=xd(r.toString(16).padStart(e*2,"0"));if(t.length!==e)throw new Error("number too large");return t}function Jw(r,e){return Xw(r,e).reverse()}function Ad(r){return Uint8Array.from(r)}const ep=r=>typeof r=="bigint"&&Qw<=r;function yH(r,e,t){return ep(r)&&ep(e)&&ep(t)&&e<=r&&r<t}function Cd(r,e,t,n){if(!yH(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function wH(r){let e;for(e=0;r>Qw;r>>=A3,e+=1);return e}const Zw=r=>(A3<<BigInt(r))-A3;function bH(r,e,t){if(bs(r,"hashLen"),bs(e,"qByteLen"),typeof t!="function")throw new Error("hmacFn must be a function");const n=b=>new Uint8Array(b),s=Uint8Array.of(),i=Uint8Array.of(0),o=Uint8Array.of(1),a=1e3;let c=n(r),l=n(r),u=0;const h=()=>{c.fill(1),l.fill(0),u=0},d=(...b)=>t(l,Ks(c,...b)),f=(b=s)=>{l=d(i,b),c=d(),b.length!==0&&(l=d(o,b),c=d())},g=()=>{if(u++>=a)throw new Error("drbg: tried max amount of iterations");let b=0;const v=[];for(;b<e;){c=d();const A=c.slice();v.push(A),b+=c.length}return Ks(...v)};return(b,v)=>{h(),f(b);let A;for(;!(A=v(g()));)f();return h(),A}}function yu(r,e={},t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(i,o,a){const c=r[i];if(a&&c===void 0)return;const l=typeof c;if(l!==o||c===null)throw new Error(`param "${i}" is invalid: expected ${o}, got ${l}`)}const s=(i,o)=>Object.entries(i).forEach(([a,c])=>n(a,c,o));s(e,!1),s(t,!0)}function Up(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const fn=BigInt(0),kr=BigInt(1),Ea=BigInt(2),gk=BigInt(3),mk=BigInt(4),yk=BigInt(5),vH=BigInt(7),wk=BigInt(8),EH=BigInt(9),bk=BigInt(16);function Qt(r,e){const t=r%e;return t>=fn?t:e+t}function Kt(r,e,t){let n=r;for(;e-- >fn;)n*=n,n%=t;return n}function r9(r,e){if(r===fn)throw new Error("invert: expected non-zero number");if(e<=fn)throw new Error("invert: expected positive modulus, got "+e);let t=Qt(r,e),n=e,s=fn,i=kr;for(;t!==fn;){const a=n/t,c=n%t,l=s-i*a;n=t,t=c,s=i,i=l}if(n!==kr)throw new Error("invert: does not exist");return Qt(s,e)}function e5(r,e,t){if(!r.eql(r.sqr(e),t))throw new Error("Cannot find square root")}function vk(r,e){const t=(r.ORDER+kr)/mk,n=r.pow(e,t);return e5(r,n,e),n}function SH(r,e){const t=(r.ORDER-yk)/wk,n=r.mul(e,Ea),s=r.pow(n,t),i=r.mul(e,s),o=r.mul(r.mul(i,Ea),s),a=r.mul(i,r.sub(o,r.ONE));return e5(r,a,e),a}function _H(r){const e=Gg(r),t=Ek(r),n=t(e,e.neg(e.ONE)),s=t(e,n),i=t(e,e.neg(n)),o=(r+vH)/bk;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,s),d=a.mul(l,i),f=a.eql(a.sqr(u),c),g=a.eql(a.sqr(h),c);l=a.cmov(l,u,f),u=a.cmov(d,h,g);const m=a.eql(a.sqr(u),c),b=a.cmov(l,u,m);return e5(a,b,c),b}}function Ek(r){if(r<gk)throw new Error("sqrt is not defined for small field");let e=r-kr,t=0;for(;e%Ea===fn;)e/=Ea,t++;let n=Ea;const s=Gg(r);for(;n9(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return vk;let i=s.pow(n,e);const o=(e+kr)/Ea;return function(c,l){if(c.is0(l))return l;if(n9(c,l)!==1)throw new Error("Cannot find square root");let u=t,h=c.mul(c.ONE,i),d=c.pow(l,e),f=c.pow(l,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let g=1,m=c.sqr(d);for(;!c.eql(m,c.ONE);)if(g++,m=c.sqr(m),g===u)throw new Error("Cannot find square root");const b=kr<<BigInt(u-g-1),v=c.pow(h,b);u=g,h=c.sqr(v),d=c.mul(d,h),f=c.mul(f,v)}return f}}function xH(r){return r%mk===gk?vk:r%wk===yk?SH:r%bk===EH?_H(r):Ek(r)}const AH=(r,e)=>(Qt(r,e)&kr)===kr,CH=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function kH(r){const e={ORDER:"bigint",BYTES:"number",BITS:"number"},t=CH.reduce((n,s)=>(n[s]="function",n),e);return yu(r,t),r}function IH(r,e,t){if(t<fn)throw new Error("invalid exponent, negatives unsupported");if(t===fn)return r.ONE;if(t===kr)return e;let n=r.ONE,s=e;for(;t>fn;)t&kr&&(n=r.mul(n,s)),s=r.sqr(s),t>>=kr;return n}function Sk(r,e,t=!1){const n=new Array(e.length).fill(t?r.ZERO:void 0),s=e.reduce((o,a,c)=>r.is0(a)?o:(n[c]=o,r.mul(o,a)),r.ONE),i=r.inv(s);return e.reduceRight((o,a,c)=>r.is0(a)?o:(n[c]=r.mul(o,n[c]),r.mul(o,a)),i),n}function n9(r,e){const t=(r.ORDER-kr)/Ea,n=r.pow(e,t),s=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),o=r.eql(n,r.neg(r.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function TH(r,e){e!==void 0&&bs(e);const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}class RH{ORDER;BITS;BYTES;isLE;ZERO=fn;ONE=kr;_lengths;_sqrt;_mod;constructor(e,t={}){if(e<=fn)throw new Error("invalid field: expected ORDER > 0, got "+e);let n;this.isLE=!1,t!=null&&typeof t=="object"&&(typeof t.BITS=="number"&&(n=t.BITS),typeof t.sqrt=="function"&&(this.sqrt=t.sqrt),typeof t.isLE=="boolean"&&(this.isLE=t.isLE),t.allowedLengths&&(this._lengths=t.allowedLengths?.slice()),typeof t.modFromBytes=="boolean"&&(this._mod=t.modFromBytes));const{nBitLength:s,nByteLength:i}=TH(e,n);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");this.ORDER=e,this.BITS=s,this.BYTES=i,this._sqrt=void 0,Object.preventExtensions(this)}create(e){return Qt(e,this.ORDER)}isValid(e){if(typeof e!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof e);return fn<=e&&e<this.ORDER}is0(e){return e===fn}isValidNot0(e){return!this.is0(e)&&this.isValid(e)}isOdd(e){return(e&kr)===kr}neg(e){return Qt(-e,this.ORDER)}eql(e,t){return e===t}sqr(e){return Qt(e*e,this.ORDER)}add(e,t){return Qt(e+t,this.ORDER)}sub(e,t){return Qt(e-t,this.ORDER)}mul(e,t){return Qt(e*t,this.ORDER)}pow(e,t){return IH(this,e,t)}div(e,t){return Qt(e*r9(t,this.ORDER),this.ORDER)}sqrN(e){return e*e}addN(e,t){return e+t}subN(e,t){return e-t}mulN(e,t){return e*t}inv(e){return r9(e,this.ORDER)}sqrt(e){return this._sqrt||(this._sqrt=xH(this.ORDER)),this._sqrt(this,e)}toBytes(e){return this.isLE?Jw(e,this.BYTES):Xw(e,this.BYTES)}fromBytes(e,t=!1){st(e);const{_lengths:n,BYTES:s,isLE:i,ORDER:o,_mod:a}=this;if(n){if(!n.includes(e.length)||e.length>s)throw new Error("Field.fromBytes: expected "+n+" bytes, got "+e.length);const l=new Uint8Array(s);l.set(e,i?0:l.length-e.length),e=l}if(e.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+e.length);let c=i?Ya(e):Wg(e);if(a&&(c=Qt(c,o)),!t&&!this.isValid(c))throw new Error("invalid field element: outside of range 0..ORDER");return c}invertBatch(e){return Sk(this,e)}cmov(e,t,n){return n?t:e}}function Gg(r,e={}){return new RH(r,e)}function _k(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function xk(r){const e=_k(r);return e+Math.ceil(e/2)}function PH(r,e,t=!1){st(r);const n=r.length,s=_k(e),i=xk(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=t?Ya(r):Wg(r),a=Qt(o,e-kr)+kr;return t?Jw(a,s):Xw(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Bl=BigInt(0),Sa=BigInt(1);function Fp(r,e){const t=e.negate();return r?t:e}function zh(r,e){const t=Sk(r.Fp,e.map(n=>n.Z));return e.map((n,s)=>r.fromAffine(n.toAffine(t[s])))}function Ak(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Km(r,e){Ak(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),s=2**r,i=Zw(r),o=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function s9(r,e,t){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(r&s),c=r>>o;a>n&&(a-=i,c+=Sa);const l=e*n,u=l+Math.abs(a)-1,h=a===0,d=a<0,f=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:f,offsetF:l}}const jm=new WeakMap,Ck=new WeakMap;function Wm(r){return Ck.get(r)||1}function i9(r){if(r!==Bl)throw new Error("invalid wNAF")}class kk{BASE;ZERO;Fn;bits;constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let s=e;for(;t>Bl;)t&Sa&&(n=n.add(s)),s=s.double(),t>>=Sa;return n}precomputeWindow(e,t){const{windows:n,windowSize:s}=Km(t,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<s;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Km(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:d,offsetF:f}=s9(n,a,o);n=c,u?i=i.add(Fp(d,t[f])):s=s.add(Fp(h,t[l]))}return i9(n),{p:s,f:i}}wNAFUnsafe(e,t,n,s=this.ZERO){const i=Km(e,this.bits);for(let o=0;o<i.windows&&n!==Bl;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=s9(n,o,i);if(n=a,!l){const h=t[c];s=s.add(u?h.negate():h)}}return i9(n),s}getPrecomputes(e,t,n){let s=jm.get(t);return s||(s=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(s=n(s)),jm.set(t,s))),s}cached(e,t,n){const s=Wm(e);return this.wNAF(s,this.getPrecomputes(s,e,n),t)}unsafe(e,t,n,s){const i=Wm(e);return i===1?this._unsafeLadder(e,t,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,s)}createCache(e,t){Ak(t,this.bits),Ck.set(e,t),jm.delete(e)}hasCache(e){return Wm(e)!==1}}function DH(r,e,t,n){let s=e,i=r.ZERO,o=r.ZERO;for(;t>Bl||n>Bl;)t&Sa&&(i=i.add(s)),n&Sa&&(o=o.add(s)),s=s.double(),t>>=Sa,n>>=Sa;return{p1:i,p2:o}}function o9(r,e,t){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return kH(e),e}else return Gg(r,{isLE:t})}function Ik(r,e,t={},n){if(n===void 0&&(n=r==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const c of["p","n","h"]){const l=e[c];if(!(typeof l=="bigint"&&l>Bl))throw new Error(`CURVE.${c} must be positive bigint`)}const s=o9(e.p,t.Fp,n),i=o9(e.n,t.Fn,n),a=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(const c of a)if(!s.isValid(e[c]))throw new Error(`CURVE.${c} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}function t5(r,e){return function(n){const s=r(n);return{secretKey:s,publicKey:e(s)}}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ho=BigInt(0),ur=BigInt(1),Gm=BigInt(2),NH=BigInt(8);function OH(r,e,t,n){const s=r.sqr(t),i=r.sqr(n),o=r.add(r.mul(e.a,s),i),a=r.add(r.ONE,r.mul(e.d,r.mul(s,i)));return r.eql(o,a)}function LH(r,e={}){const t=Ik("edwards",r,e,e.FpFnLE),{Fp:n,Fn:s}=t;let i=t.CURVE;const{h:o}=i;yu(e,{},{uvRatio:"function"});const a=Gm<<BigInt(s.BYTES*8)-ur,c=b=>n.create(b),l=e.uvRatio||((b,v)=>{try{return{isValid:!0,value:n.sqrt(n.div(b,v))}}catch{return{isValid:!1,value:ho}}});if(!OH(n,i,i.Gx,i.Gy))throw new Error("bad curve params: generator point");function u(b,v,A=!1){const w=A?ur:ho;return Cd("coordinate "+b,v,w,a),v}function h(b){if(!(b instanceof g))throw new Error("EdwardsPoint expected")}const d=Up((b,v)=>{const{X:A,Y:w,Z:E}=b,x=b.is0();v==null&&(v=x?NH:n.inv(E));const P=c(A*v),T=c(w*v),D=n.mul(E,v);if(x)return{x:ho,y:ur};if(D!==ur)throw new Error("invZ was invalid");return{x:P,y:T}}),f=Up(b=>{const{a:v,d:A}=i;if(b.is0())throw new Error("bad point: ZERO");const{X:w,Y:E,Z:x,T:P}=b,T=c(w*w),D=c(E*E),C=c(x*x),R=c(C*C),O=c(T*v),V=c(C*c(O+D)),B=c(R+c(A*c(T*D)));if(V!==B)throw new Error("bad point: equation left != right (1)");const z=c(w*E),$=c(x*P);if(z!==$)throw new Error("bad point: equation left != right (2)");return!0});class g{static BASE=new g(i.Gx,i.Gy,ur,c(i.Gx*i.Gy));static ZERO=new g(ho,ur,ur,ho);static Fp=n;static Fn=s;X;Y;Z;T;constructor(v,A,w,E){this.X=u("x",v),this.Y=u("y",A),this.Z=u("z",w,!0),this.T=u("t",E),Object.freeze(this)}static CURVE(){return i}static fromAffine(v){if(v instanceof g)throw new Error("extended point not allowed");const{x:A,y:w}=v||{};return u("x",A),u("y",w),new g(A,w,ur,c(A*w))}static fromBytes(v,A=!1){const w=n.BYTES,{a:E,d:x}=i;v=Ad(st(v,w,"point")),Ga(A,"zip215");const P=Ad(v),T=v[w-1];P[w-1]=T&-129;const D=Ya(P),C=A?a:n.ORDER;Cd("point.y",D,ho,C);const R=c(D*D),O=c(R-ur),V=c(x*R-E);let{isValid:B,value:z}=l(O,V);if(!B)throw new Error("bad point: invalid y coordinate");const $=(z&ur)===ur,K=(T&128)!==0;if(!A&&z===ho&&K)throw new Error("bad point: x=0 and x_0=1");return K!==$&&(z=c(-z)),g.fromAffine({x:z,y:D})}static fromHex(v,A=!1){return g.fromBytes(xd(v),A)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,A=!0){return m.createCache(this,v),A||this.multiply(Gm),this}assertValidity(){f(this)}equals(v){h(v);const{X:A,Y:w,Z:E}=this,{X:x,Y:P,Z:T}=v,D=c(A*T),C=c(x*E),R=c(w*T),O=c(P*E);return D===C&&R===O}is0(){return this.equals(g.ZERO)}negate(){return new g(c(-this.X),this.Y,this.Z,c(-this.T))}double(){const{a:v}=i,{X:A,Y:w,Z:E}=this,x=c(A*A),P=c(w*w),T=c(Gm*c(E*E)),D=c(v*x),C=A+w,R=c(c(C*C)-x-P),O=D+P,V=O-T,B=D-P,z=c(R*V),$=c(O*B),K=c(R*B),X=c(V*O);return new g(z,$,X,K)}add(v){h(v);const{a:A,d:w}=i,{X:E,Y:x,Z:P,T}=this,{X:D,Y:C,Z:R,T:O}=v,V=c(E*D),B=c(x*C),z=c(T*w*O),$=c(P*R),K=c((E+x)*(D+C)-V-B),X=$-z,te=$+z,W=c(B-A*V),ie=c(K*X),ce=c(te*W),de=c(K*W),oe=c(X*te);return new g(ie,ce,oe,de)}subtract(v){return this.add(v.negate())}multiply(v){if(!s.isValidNot0(v))throw new Error("invalid scalar: expected 1 <= sc < curve.n");const{p:A,f:w}=m.cached(this,v,E=>zh(g,E));return zh(g,[A,w])[0]}multiplyUnsafe(v,A=g.ZERO){if(!s.isValid(v))throw new Error("invalid scalar: expected 0 <= sc < curve.n");return v===ho?g.ZERO:this.is0()||v===ur?this:m.unsafe(this,v,w=>zh(g,w),A)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}isTorsionFree(){return m.unsafe(this,i.n).is0()}toAffine(v){return d(this,v)}clearCofactor(){return o===ur?this:this.multiplyUnsafe(o)}toBytes(){const{x:v,y:A}=this.toAffine(),w=n.toBytes(A);return w[w.length-1]|=v&ur?128:0,w}toHex(){return wf(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const m=new kk(g,s.BITS);return g.BASE.precompute(8),g}function BH(r,e,t={}){if(typeof e!="function")throw new Error('"hash" function param is required');yu(t,{},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:n}=t,{BASE:s,Fp:i,Fn:o}=r,a=t.randomBytes||bf,c=t.adjustScalarBytes||(D=>D),l=t.domain||((D,C,R)=>{if(Ga(R,"phflag"),C.length||R)throw new Error("Contexts/pre-hash are not supported");return D});function u(D){return o.create(Ya(D))}function h(D){const C=w.secretKey;st(D,w.secretKey,"secretKey");const R=st(e(D),2*C,"hashedSecretKey"),O=c(R.slice(0,C)),V=R.slice(C,2*C),B=u(O);return{head:O,prefix:V,scalar:B}}function d(D){const{head:C,prefix:R,scalar:O}=h(D),V=s.multiply(O),B=V.toBytes();return{head:C,prefix:R,scalar:O,point:V,pointBytes:B}}function f(D){return d(D).pointBytes}function g(D=Uint8Array.of(),...C){const R=Ks(...C);return u(e(l(R,st(D,void 0,"context"),!!n)))}function m(D,C,R={}){D=st(D,void 0,"message"),n&&(D=n(D));const{prefix:O,scalar:V,pointBytes:B}=d(C),z=g(R.context,O,D),$=s.multiply(z).toBytes(),K=g(R.context,$,B,D),X=o.create(z+K*V);if(!o.isValid(X))throw new Error("sign failed: invalid s");const te=Ks($,o.toBytes(X));return st(te,w.signature,"result")}const b={zip215:!0};function v(D,C,R,O=b){const{context:V,zip215:B}=O,z=w.signature;D=st(D,z,"signature"),C=st(C,void 0,"message"),R=st(R,w.publicKey,"publicKey"),B!==void 0&&Ga(B,"zip215"),n&&(C=n(C));const $=z/2,K=D.subarray(0,$),X=Ya(D.subarray($,z));let te,W,ie;try{te=r.fromBytes(R,B),W=r.fromBytes(K,B),ie=s.multiplyUnsafe(X)}catch{return!1}if(!B&&te.isSmallOrder())return!1;const ce=g(V,W.toBytes(),te.toBytes(),C);return W.add(te.multiplyUnsafe(ce)).subtract(ie).clearCofactor().is0()}const A=i.BYTES,w={secretKey:A,publicKey:A,signature:2*A,seed:A};function E(D=a(w.seed)){return st(D,w.seed,"seed")}function x(D){return Kg(D)&&D.length===o.BYTES}function P(D,C){try{return!!r.fromBytes(D,C)}catch{return!1}}const T={getExtendedPublicKey:d,randomSecretKey:E,isValidSecretKey:x,isValidPublicKey:P,toMontgomery(D){const{y:C}=r.fromBytes(D),R=w.publicKey,O=R===32;if(!O&&R!==57)throw new Error("only defined for 25519 and 448");const V=O?i.div(ur+C,ur-C):i.div(C-ur,C+ur);return i.toBytes(V)},toMontgomerySecret(D){const C=w.secretKey;st(D,C);const R=e(D.subarray(0,C));return c(R).subarray(0,C)}};return Object.freeze({keygen:t5(E,f),getPublicKey:f,sign:m,verify:v,utils:T,Point:r,lengths:w})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const zu=BigInt(0),Nc=BigInt(1),i1=BigInt(2);function MH(r){return yu(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function $H(r){const e=MH(r),{P:t,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||bf,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),f=a?i1**BigInt(254):i1**BigInt(447),g=a?BigInt(8)*i1**BigInt(251)-Nc:BigInt(4)*i1**BigInt(445)-Nc,m=f+g+Nc,b=z=>Qt(z,t),v=A(h);function A(z){return Jw(b(z),u)}function w(z){const $=Ad(st(z,u,"uCoordinate"));return a&&($[31]&=127),b(Ya($))}function E(z){return Ya(s(Ad(st(z,u,"scalar"))))}function x(z,$){const K=R(w($),E(z));if(K===zu)throw new Error("invalid private or public key received");return A(K)}function P(z){return x(z,v)}const T=P,D=x;function C(z,$,K){const X=b(z*($-K));return $=b($-X),K=b(K+X),{x_2:$,x_3:K}}function R(z,$){Cd("u",z,zu,t),Cd("scalar",$,f,m);const K=$,X=z;let te=Nc,W=zu,ie=z,ce=Nc,de=zu;for(let Se=BigInt(l-1);Se>=zu;Se--){const Le=K>>Se&Nc;de^=Le,{x_2:te,x_3:ie}=C(de,te,ie),{x_2:W,x_3:ce}=C(de,W,ce),de=Le;const xe=te+W,ee=b(xe*xe),pe=te-W,se=b(pe*pe),ye=ee-se,He=ie+ce,M=ie-ce,F=b(M*xe),G=b(He*pe),L=F+G,U=F-G;ie=b(L*L),ce=b(X*b(U*U)),te=b(ee*se),W=b(ye*(ee+b(d*ye)))}({x_2:te,x_3:ie}=C(de,te,ie)),{x_2:W,x_3:ce}=C(de,W,ce);const oe=i(W);return b(te*oe)}const O={secretKey:u,publicKey:u,seed:u},V=(z=c(u))=>(st(z,O.seed,"seed"),z),B={randomSecretKey:V};return Object.freeze({keygen:t5(V,T),getSharedSecret:D,getPublicKey:T,scalarMult:x,scalarMultBase:P,utils:B,GuBytes:v.slice(),lengths:O})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const UH=BigInt(1),a9=BigInt(2),FH=BigInt(3),VH=BigInt(5),zH=BigInt(8),Yg=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),HH={p:Yg,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:zH,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function Tk(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=Yg,a=r*r%i*r%i,c=Kt(a,a9,i)*a%i,l=Kt(c,UH,i)*r%i,u=Kt(l,VH,i)*l%i,h=Kt(u,e,i)*u%i,d=Kt(h,t,i)*h%i,f=Kt(d,n,i)*d%i,g=Kt(f,s,i)*f%i,m=Kt(g,s,i)*f%i,b=Kt(m,e,i)*u%i;return{pow_p_5_8:Kt(b,a9,i)*r%i,b2:a}}function Rk(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const c9=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function qH(r,e){const t=Yg,n=Qt(e*e*e,t),s=Qt(n*n*e,t),i=Tk(r*s).pow_p_5_8;let o=Qt(r*n*i,t);const a=Qt(e*o*o,t),c=o,l=Qt(o*c9,t),u=a===r,h=a===Qt(-r,t),d=a===Qt(-r*c9,t);return u&&(o=c),(h||d)&&(o=l),AH(o,t)&&(o=Qt(-o,t)),{isValid:u||h,value:o}}const KH=LH(HH,{uvRatio:qH});function jH(r){return BH(KH,jg,Object.assign({adjustScalarBytes:Rk},r))}const Vp=jH({}),o1=(()=>{const r=Yg;return $H({P:r,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:n}=Tk(e);return Qt(Kt(t,FH,r)*n,r)},adjustScalarBytes:Rk})})(),zp=32,Hs=64,C3=32;let dl;const Pk=(async()=>{try{return await rn.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function WH(){const r=Vp.utils.randomSecretKey(),e=Vp.getPublicKey(r);return{privateKey:eq(r,e),publicKey:e}}async function GH(r,e){let t;r.length===Hs?t=r.subarray(0,32):t=r;const n={crv:"Ed25519",kty:"OKP",x:he(r.subarray(32),"base64url"),d:he(t,"base64url"),ext:!0,key_ops:["sign"]},s=await rn.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),i=await rn.get().subtle.sign({name:"Ed25519"},s,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(i,0,i.byteLength)}function YH(r,e){const t=r.subarray(0,C3);return Vp.sign(e instanceof Uint8Array?e:e.subarray(),t)}async function QH(r,e){return dl==null&&(dl=await Pk),dl?GH(r,e):YH(r,e)}async function XH(r,e,t){if(r.buffer instanceof ArrayBuffer){const n=await rn.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return await rn.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function JH(r,e,t){return Vp.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}async function ZH(r,e,t){return dl==null&&(dl=await Pk),dl?XH(r,e,t):JH(r,e,t)}function eq(r,e){const t=new Uint8Array(Hs);for(let n=0;n<C3;n++)t[n]=r[n],t[C3+n]=e[n];return t}function Qg(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class Dk{type="Ed25519";raw;constructor(e){this.raw=kd(e,zp)}toMultihash(){return Pn.digest(Qs(this))}toCID(){return Ee.createV1(114,this.toMultihash())}toString(){return Dt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}verify(e,t,n){n?.signal?.throwIfAborted();const s=ZH(this.raw,t,e);return Qg(s)?s.then(i=>(n?.signal?.throwIfAborted(),i)):s}}class k3{type="Ed25519";raw;publicKey;constructor(e,t){this.raw=kd(e,Hs),this.publicKey=new Dk(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}sign(e,t){t?.signal?.throwIfAborted();const n=QH(this.raw,e);return Qg(n)?n.then(s=>(t?.signal?.throwIfAborted(),s)):(t?.signal?.throwIfAborted(),n)}}function Nk(r){if(r.length>Hs){r=kd(r,Hs+zp);const n=r.subarray(0,Hs),s=r.subarray(Hs,r.length);return new k3(n,s)}r=kd(r,Hs);const e=r.subarray(0,Hs),t=r.subarray(zp);return new k3(e,t)}function Ok(r){return r=kd(r,zp),new Dk(r)}async function tq(){const{privateKey:r,publicKey:e}=WH();return new k3(r,e)}function kd(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ue(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const rq=Math.pow(2,7),nq=Math.pow(2,14),sq=Math.pow(2,21),r5=Math.pow(2,28),n5=Math.pow(2,35),s5=Math.pow(2,42),i5=Math.pow(2,49),Et=128,Mr=127;function ht(r){if(r<rq)return 1;if(r<nq)return 2;if(r<sq)return 3;if(r<r5)return 4;if(r<n5)return 5;if(r<s5)return 6;if(r<i5)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Wo(r,e,t=0){switch(ht(r)){case 8:e[t++]=r&255|Et,r/=128;case 7:e[t++]=r&255|Et,r/=128;case 6:e[t++]=r&255|Et,r/=128;case 5:e[t++]=r&255|Et,r/=128;case 4:e[t++]=r&255|Et,r>>>=7;case 3:e[t++]=r&255|Et,r>>>=7;case 2:e[t++]=r&255|Et,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function iq(r,e,t=0){switch(ht(r)){case 8:e.set(t++,r&255|Et),r/=128;case 7:e.set(t++,r&255|Et),r/=128;case 6:e.set(t++,r&255|Et),r/=128;case 5:e.set(t++,r&255|Et),r/=128;case 4:e.set(t++,r&255|Et),r>>>=7;case 3:e.set(t++,r&255|Et),r>>>=7;case 2:e.set(t++,r&255|Et),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function Lk(r,e){let t=r[e],n=0;if(n+=t&Mr,t<Et||(t=r[e+1],n+=(t&Mr)<<7,t<Et)||(t=r[e+2],n+=(t&Mr)<<14,t<Et)||(t=r[e+3],n+=(t&Mr)<<21,t<Et)||(t=r[e+4],n+=(t&Mr)*r5,t<Et)||(t=r[e+5],n+=(t&Mr)*n5,t<Et)||(t=r[e+6],n+=(t&Mr)*s5,t<Et)||(t=r[e+7],n+=(t&Mr)*i5,t<Et))return n;throw new RangeError("Could not decode varint")}function oq(r,e){let t=r.get(e),n=0;if(n+=t&Mr,t<Et||(t=r.get(e+1),n+=(t&Mr)<<7,t<Et)||(t=r.get(e+2),n+=(t&Mr)<<14,t<Et)||(t=r.get(e+3),n+=(t&Mr)<<21,t<Et)||(t=r.get(e+4),n+=(t&Mr)*r5,t<Et)||(t=r.get(e+5),n+=(t&Mr)*n5,t<Et)||(t=r.get(e+6),n+=(t&Mr)*s5,t<Et)||(t=r.get(e+7),n+=(t&Mr)*i5,t<Et))return n;throw new RangeError("Could not decode varint")}function Ys(r,e,t=0){return e==null&&(e=Dn(ht(r))),e instanceof Uint8Array?Wo(r,e,t):iq(r,e,t)}function Ts(r,e=0){return r instanceof Uint8Array?Lk(r,e):oq(r,e)}const o5=new Float32Array([-0]),Co=new Uint8Array(o5.buffer);function aq(r,e,t){o5[0]=r,e[t]=Co[0],e[t+1]=Co[1],e[t+2]=Co[2],e[t+3]=Co[3]}function cq(r,e){return Co[0]=r[e],Co[1]=r[e+1],Co[2]=r[e+2],Co[3]=r[e+3],o5[0]}const a5=new Float64Array([-0]),$r=new Uint8Array(a5.buffer);function lq(r,e,t){a5[0]=r,e[t]=$r[0],e[t+1]=$r[1],e[t+2]=$r[2],e[t+3]=$r[3],e[t+4]=$r[4],e[t+5]=$r[5],e[t+6]=$r[6],e[t+7]=$r[7]}function uq(r,e){return $r[0]=r[e],$r[1]=r[e+1],$r[2]=r[e+2],$r[3]=r[e+3],$r[4]=r[e+4],$r[5]=r[e+5],$r[6]=r[e+6],$r[7]=r[e+7],a5[0]}const hq=BigInt(Number.MAX_SAFE_INTEGER),dq=BigInt(Number.MIN_SAFE_INTEGER);class Fr{lo;hi;constructor(e,t){this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return La;if(e<hq&&e>dq)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,s=e-(n<<32n);return t&&(n=~n|0n,s=~s|0n,++s>l9&&(s=0n,++n>l9&&(n=0n))),new Fr(Number(s),Number(n))}static fromNumber(e){if(e===0)return La;const t=e<0;t&&(e=-e);let n=e>>>0,s=(e-n)/4294967296>>>0;return t&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new Fr(n,s)}static from(e){return typeof e=="number"?Fr.fromNumber(e):typeof e=="bigint"?Fr.fromBigInt(e):typeof e=="string"?Fr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new Fr(e.low>>>0,e.high>>>0):La}}const La=new Fr(0,0);La.toBigInt=function(){return 0n};La.zzEncode=La.zzDecode=function(){return this};La.length=function(){return 1};const l9=4294967296n;function fq(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function pq(r,e,t){if(t-e<1)return"";let s;const i=[];let o=0,a;for(;e<t;)a=r[e++],a<128?i[o++]=a:a>191&&a<224?i[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,i[o++]=55296+(a>>10),i[o++]=56320+(a&1023)):i[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((s??(s=[])).push(String.fromCharCode.apply(String,i)),o=0);return s!=null?(o>0&&s.push(String.fromCharCode.apply(String,i.slice(0,o))),s.join("")):String.fromCharCode.apply(String,i.slice(0,o))}function Bk(r,e,t){const n=t;let s,i;for(let o=0;o<r.length;++o)s=r.charCodeAt(o),s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&((i=r.charCodeAt(o+1))&64512)===56320?(s=65536+((s&1023)<<10)+(i&1023),++o,e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128);return t-n}function is(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function a1(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class gq{buf;pos;len;_slice=Uint8Array.prototype.subarray;constructor(e){this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,is(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw is(this,4);return a1(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw is(this,4);return a1(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw is(this,4);const e=cq(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw is(this,4);const e=uq(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw is(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return pq(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw is(this,e);this.pos+=e}else do if(this.pos>=this.len)throw is(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new Fr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw is(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw is(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw is(this,8);const e=a1(this.buf,this.pos+=4),t=a1(this.buf,this.pos+=4);return new Fr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=Lk(this.buf,this.pos);return this.pos+=ht(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function mq(r){return new gq(r instanceof Uint8Array?r:r.subarray())}function Ze(r,e,t){const n=mq(r);return e.decode(n,void 0,t)}function yq(r){let n,s=8192;return function(o){if(o<1||o>4096)return Dn(o);s+o>8192&&(n=Dn(8192),s=0);const a=n.subarray(s,s+=o);return(s&7)!==0&&(s=(s|7)+1),a}}class sh{fn;len;next;val;constructor(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}}function Ym(){}class wq{head;tail;len;next;constructor(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const bq=yq();function vq(r){return globalThis.Buffer!=null?Dn(r):bq(r)}class I3{len;head;tail;states;constructor(){this.len=0,this.head=new sh(Ym,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new sh(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new Sq((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(c1,10,Fr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=Fr.fromBigInt(e);return this._push(c1,t.length(),t)}uint64Number(e){return this._push(Wo,ht(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=Fr.fromBigInt(e).zzEncode();return this._push(c1,t.length(),t)}sint64Number(e){const t=Fr.fromNumber(e).zzEncode();return this._push(c1,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(Qm,1,e?1:0)}fixed32(e){return this._push(Hu,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=Fr.fromBigInt(e);return this._push(Hu,4,t.lo)._push(Hu,4,t.hi)}fixed64Number(e){const t=Fr.fromNumber(e);return this._push(Hu,4,t.lo)._push(Hu,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(aq,4,e)}double(e){return this._push(lq,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(Qm,1,0):this.uint32(t)._push(_q,t,e)}string(e){const t=fq(e);return t!==0?this.uint32(t)._push(Bk,t,e):this._push(Qm,1,0)}fork(){return this.states=new wq(this),this.head=this.tail=new sh(Ym,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sh(Ym,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=vq(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function Qm(r,e,t){e[t]=r&255}function Eq(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class Sq extends sh{next;constructor(e,t){super(Eq,e,t),this.next=void 0}}function c1(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Hu(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function _q(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(I3.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(xq,e,r),this},I3.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(Aq,e,r),this});function xq(r,e,t){e.set(r,t)}function Aq(r,e,t){r.length<40?Bk(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(le(r),t)}function Cq(){return new I3}function et(r,e){const t=Cq();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Hp;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Hp||(Hp={}));function Mk(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function nn(r){function e(s){if(r[s.toString()]==null)throw new Error("Invalid enum value");return r[s]}const t=function(i,o){const a=e(i);o.int32(a)},n=function(i){const o=i.int32();return e(o)};return Mk("enum",Hp.VARINT,t,n)}function tt(r,e){return Mk("message",Hp.LENGTH_DELIMITED,r,e)}class Ir extends Error{code="ERR_MAX_LENGTH";name="MaxLengthError"}class u9 extends Error{code="ERR_MAX_SIZE";name="MaxSizeError"}var Ht;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ht||(Ht={}));var T3;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(T3||(T3={}));(function(r){r.codec=()=>nn(T3)})(Ht||(Ht={}));var Go;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ht.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=Ht.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Go||(Go={}));var qp;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ht.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.Type=Ht.codec().decode(t);break}case 2:{i.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(qp||(qp={}));function Qa(r){if(isNaN(r)||r<=0)throw new ue("random bytes length must be a Number bigger than 0");return bf(r)}let c5=class{type="RSA";jwk;_raw;_multihash;constructor(e,t){this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=u5(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return Ee.createV1(114,this._multihash)}toString(){return Dt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}verify(e,t,n){return Fq(this.jwk,t,e,n)}},$k=class{type="RSA";jwk;_raw;publicKey;constructor(e,t){this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=Rq(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}sign(e,t){return Uq(this.jwk,e,t)}};const Uk=8192,l5=18,kq=1062,Iq=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function Tq(r){return{n:he(r[1],"base64url"),e:he(r[2],"base64url"),d:he(r[3],"base64url"),p:he(r[4],"base64url"),q:he(r[5],"base64url"),dp:he(r[6],"base64url"),dq:he(r[7],"base64url"),qi:he(r[8],"base64url"),kty:"RSA"}}function Rq(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ue("JWK was missing components");return Oi([En(Uint8Array.from([0])),En(le(r.n,"base64url")),En(le(r.e,"base64url")),En(le(r.d,"base64url")),En(le(r.p,"base64url")),En(le(r.q,"base64url")),En(le(r.dp,"base64url")),En(le(r.dq,"base64url")),En(le(r.qi,"base64url"))]).subarray()}function Pq(r){const e=yc(r[1],{offset:0});return{kty:"RSA",n:he(e[0],"base64url"),e:he(e[1],"base64url")}}function u5(r){if(r.n==null||r.e==null)throw new ue("JWK was missing components");return Oi([Iq,Ww(Oi([En(le(r.n,"base64url")),En(le(r.e,"base64url"))]))]).subarray()}function Dq(r){const e=yc(r);return Fk(e)}function Fk(r){const e=Tq(r);return Lq(e)}function Nq(r,e){if(r.byteLength>=kq)throw new Pp("Key size is too large");const t=yc(r,{offset:0});return Oq(t,r,e)}function Oq(r,e,t){const n=Pq(r);if(t==null){const s=Lo(Go.encode({Type:Ht.RSA,Data:e}));t=ia(l5,s)}return new c5(n,t)}function Lq(r){if(zq(r)>Uk)throw new ue("Key size is too large");const e=Mq(r),t=Lo(Go.encode({Type:Ht.RSA,Data:u5(e.publicKey)})),n=ia(l5,t);return new $k(e.privateKey,new c5(e.publicKey,n))}async function Bq(r){if(r>Uk)throw new ue("Key size is too large");const e=await $q(r),t=Lo(Go.encode({Type:Ht.RSA,Data:u5(e.publicKey)})),n=ia(l5,t);return new $k(e.privateKey,new c5(e.publicKey,n))}function Mq(r){if(r==null)throw new ue("Missing key parameter");return{privateKey:r,publicKey:{kty:r.kty,n:r.n,e:r.e}}}async function $q(r,e){const t=await rn.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await Vq(t);return{privateKey:n[0],publicKey:n[1]}}async function Uq(r,e,t){const n=await rn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);t?.signal?.throwIfAborted();const s=await rn.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return t?.signal?.throwIfAborted(),new Uint8Array(s,0,s.byteLength)}async function Fq(r,e,t,n){const s=await rn.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);n?.signal?.throwIfAborted();const i=await rn.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},s,e,t instanceof Uint8Array?t:t.subarray());return n?.signal?.throwIfAborted(),i}async function Vq(r,e){if(r.privateKey==null||r.publicKey==null)throw new ue("Private and public key are required");return await Promise.all([rn.get().subtle.exportKey("jwk",r.privateKey),rn.get().subtle.exportKey("jwk",r.publicKey)])}function zq(r){if(r.kty!=="RSA")throw new ue("invalid key type");if(r.n==null)throw new ue("invalid key modulus");return le(r.n,"base64url").length*8}class Vk{oHash;iHash;blockLen;outputLen;finished=!1;destroyed=!1;constructor(e,t){if(yf(e),st(t,void 0,"key"),this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const n=this.blockLen,s=new Uint8Array(n);s.set(t.length>n?e.create().update(t).digest():t);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=e.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),ai(s)}update(e){return $p(this),this.iHash.update(e),this}digestInto(e){$p(this),st(e,this.outputLen,"output"),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||=Object.create(Object.getPrototypeOf(this),{});const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const vf=(r,e,t)=>new Vk(r,e).update(t).digest();vf.create=(r,e)=>new Vk(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const h9=(r,e)=>(r+(r>=0?e:-e)/zk)/e;function Hq(r,e,t){const[[n,s],[i,o]]=e,a=h9(o*r,t),c=h9(-s*r,t);let l=r-a*n-c*i,u=-a*s-c*o;const h=l<Ti,d=u<Ti;h&&(l=-l),d&&(u=-u);const f=Zw(Math.ceil(wH(t)/2))+fl;if(l<Ti||l>=f||u<Ti||u>=f)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:h,k1:l,k2neg:d,k2:u}}function R3(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function Xm(r,e){const t={};for(let n of Object.keys(e))t[n]=r[n]===void 0?e[n]:r[n];return Ga(t.lowS,"lowS"),Ga(t.prehash,"prehash"),t.format!==void 0&&R3(t.format),t}class qq extends Error{constructor(e=""){super(e)}}const vo={Err:qq,_tlv:{encode:(r,e)=>{const{Err:t}=vo;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,s=s1(n);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=n>127?s1(s.length/2|128):"";return s1(r)+i+s+e},decode(r,e){const{Err:t}=vo;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=vo;if(r<Ti)throw new e("integer: negative integers are not allowed");let t=s1(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=vo;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Wg(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=vo,s=st(r,void 0,"signature"),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=vo,n=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),i=n+s;return e.encode(48,i)}},Ti=BigInt(0),fl=BigInt(1),zk=BigInt(2),l1=BigInt(3),Kq=BigInt(4);function jq(r,e={}){const t=Ik("weierstrass",r,e),{Fp:n,Fn:s}=t;let i=t.CURVE;const{h:o,n:a}=i;yu(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=qk(n,s);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(V,B,z){const{x:$,y:K}=B.toAffine(),X=n.toBytes($);if(Ga(z,"isCompressed"),z){u();const te=!n.isOdd(K);return Ks(Hk(te),X)}else return Ks(Uint8Array.of(4),X,n.toBytes(K))}function d(V){st(V,void 0,"Point");const{publicKey:B,publicKeyUncompressed:z}=l,$=V.length,K=V[0],X=V.subarray(1);if($===B&&(K===2||K===3)){const te=n.fromBytes(X);if(!n.isValid(te))throw new Error("bad point: is not on curve, wrong x");const W=m(te);let ie;try{ie=n.sqrt(W)}catch(oe){const Se=oe instanceof Error?": "+oe.message:"";throw new Error("bad point: is not on curve, sqrt error"+Se)}u();const ce=n.isOdd(ie);return(K&1)===1!==ce&&(ie=n.neg(ie)),{x:te,y:ie}}else if($===z&&K===4){const te=n.BYTES,W=n.fromBytes(X.subarray(0,te)),ie=n.fromBytes(X.subarray(te,te*2));if(!b(W,ie))throw new Error("bad point: is not on curve");return{x:W,y:ie}}else throw new Error(`bad point: got length ${$}, expected compressed=${B} or uncompressed=${z}`)}const f=e.toBytes||h,g=e.fromBytes||d;function m(V){const B=n.sqr(V),z=n.mul(B,V);return n.add(n.add(z,n.mul(V,i.a)),i.b)}function b(V,B){const z=n.sqr(B),$=m(V);return n.eql(z,$)}if(!b(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const v=n.mul(n.pow(i.a,l1),Kq),A=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(v,A)))throw new Error("bad curve params: a or b");function w(V,B,z=!1){if(!n.isValid(B)||z&&n.is0(B))throw new Error(`bad point coordinate ${V}`);return B}function E(V){if(!(V instanceof C))throw new Error("Weierstrass Point expected")}function x(V){if(!c||!c.basises)throw new Error("no endo");return Hq(V,c.basises,s.ORDER)}const P=Up((V,B)=>{const{X:z,Y:$,Z:K}=V;if(n.eql(K,n.ONE))return{x:z,y:$};const X=V.is0();B==null&&(B=X?n.ONE:n.inv(K));const te=n.mul(z,B),W=n.mul($,B),ie=n.mul(K,B);if(X)return{x:n.ZERO,y:n.ZERO};if(!n.eql(ie,n.ONE))throw new Error("invZ was invalid");return{x:te,y:W}}),T=Up(V=>{if(V.is0()){if(e.allowInfinityPoint&&!n.is0(V.Y))return;throw new Error("bad point: ZERO")}const{x:B,y:z}=V.toAffine();if(!n.isValid(B)||!n.isValid(z))throw new Error("bad point: x or y not field elements");if(!b(B,z))throw new Error("bad point: equation left != right");if(!V.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function D(V,B,z,$,K){return z=new C(n.mul(z.X,V),z.Y,z.Z),B=Fp($,B),z=Fp(K,z),B.add(z)}class C{static BASE=new C(i.Gx,i.Gy,n.ONE);static ZERO=new C(n.ZERO,n.ONE,n.ZERO);static Fp=n;static Fn=s;X;Y;Z;constructor(B,z,$){this.X=w("x",B),this.Y=w("y",z,!0),this.Z=w("z",$),Object.freeze(this)}static CURVE(){return i}static fromAffine(B){const{x:z,y:$}=B||{};if(!B||!n.isValid(z)||!n.isValid($))throw new Error("invalid affine point");if(B instanceof C)throw new Error("projective point not allowed");return n.is0(z)&&n.is0($)?C.ZERO:new C(z,$,n.ONE)}static fromBytes(B){const z=C.fromAffine(g(st(B,void 0,"point")));return z.assertValidity(),z}static fromHex(B){return C.fromBytes(xd(B))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(B=8,z=!0){return O.createCache(this,B),z||this.multiply(l1),this}assertValidity(){T(this)}hasEvenY(){const{y:B}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(B)}equals(B){E(B);const{X:z,Y:$,Z:K}=this,{X,Y:te,Z:W}=B,ie=n.eql(n.mul(z,W),n.mul(X,K)),ce=n.eql(n.mul($,W),n.mul(te,K));return ie&&ce}negate(){return new C(this.X,n.neg(this.Y),this.Z)}double(){const{a:B,b:z}=i,$=n.mul(z,l1),{X:K,Y:X,Z:te}=this;let W=n.ZERO,ie=n.ZERO,ce=n.ZERO,de=n.mul(K,K),oe=n.mul(X,X),Se=n.mul(te,te),Le=n.mul(K,X);return Le=n.add(Le,Le),ce=n.mul(K,te),ce=n.add(ce,ce),W=n.mul(B,ce),ie=n.mul($,Se),ie=n.add(W,ie),W=n.sub(oe,ie),ie=n.add(oe,ie),ie=n.mul(W,ie),W=n.mul(Le,W),ce=n.mul($,ce),Se=n.mul(B,Se),Le=n.sub(de,Se),Le=n.mul(B,Le),Le=n.add(Le,ce),ce=n.add(de,de),de=n.add(ce,de),de=n.add(de,Se),de=n.mul(de,Le),ie=n.add(ie,de),Se=n.mul(X,te),Se=n.add(Se,Se),de=n.mul(Se,Le),W=n.sub(W,de),ce=n.mul(Se,oe),ce=n.add(ce,ce),ce=n.add(ce,ce),new C(W,ie,ce)}add(B){E(B);const{X:z,Y:$,Z:K}=this,{X,Y:te,Z:W}=B;let ie=n.ZERO,ce=n.ZERO,de=n.ZERO;const oe=i.a,Se=n.mul(i.b,l1);let Le=n.mul(z,X),xe=n.mul($,te),ee=n.mul(K,W),pe=n.add(z,$),se=n.add(X,te);pe=n.mul(pe,se),se=n.add(Le,xe),pe=n.sub(pe,se),se=n.add(z,K);let ye=n.add(X,W);return se=n.mul(se,ye),ye=n.add(Le,ee),se=n.sub(se,ye),ye=n.add($,K),ie=n.add(te,W),ye=n.mul(ye,ie),ie=n.add(xe,ee),ye=n.sub(ye,ie),de=n.mul(oe,se),ie=n.mul(Se,ee),de=n.add(ie,de),ie=n.sub(xe,de),de=n.add(xe,de),ce=n.mul(ie,de),xe=n.add(Le,Le),xe=n.add(xe,Le),ee=n.mul(oe,ee),se=n.mul(Se,se),xe=n.add(xe,ee),ee=n.sub(Le,ee),ee=n.mul(oe,ee),se=n.add(se,ee),Le=n.mul(xe,se),ce=n.add(ce,Le),Le=n.mul(ye,se),ie=n.mul(pe,ie),ie=n.sub(ie,Le),Le=n.mul(pe,xe),de=n.mul(ye,de),de=n.add(de,Le),new C(ie,ce,de)}subtract(B){return this.add(B.negate())}is0(){return this.equals(C.ZERO)}multiply(B){const{endo:z}=e;if(!s.isValidNot0(B))throw new Error("invalid scalar: out of range");let $,K;const X=te=>O.cached(this,te,W=>zh(C,W));if(z){const{k1neg:te,k1:W,k2neg:ie,k2:ce}=x(B),{p:de,f:oe}=X(W),{p:Se,f:Le}=X(ce);K=oe.add(Le),$=D(z.beta,de,Se,te,ie)}else{const{p:te,f:W}=X(B);$=te,K=W}return zh(C,[$,K])[0]}multiplyUnsafe(B){const{endo:z}=e,$=this;if(!s.isValid(B))throw new Error("invalid scalar: out of range");if(B===Ti||$.is0())return C.ZERO;if(B===fl)return $;if(O.hasCache(this))return this.multiply(B);if(z){const{k1neg:K,k1:X,k2neg:te,k2:W}=x(B),{p1:ie,p2:ce}=DH(C,$,X,W);return D(z.beta,ie,ce,K,te)}else return O.unsafe($,B)}toAffine(B){return P(this,B)}isTorsionFree(){const{isTorsionFree:B}=e;return o===fl?!0:B?B(C,this):O.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:B}=e;return o===fl?this:B?B(C,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(B=!0){return Ga(B,"isCompressed"),this.assertValidity(),f(C,this,B)}toHex(B=!0){return wf(this.toBytes(B))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}const R=s.BITS,O=new kk(C,e.endo?Math.ceil(R/2):R);return C.BASE.precompute(8),C}function Hk(r){return Uint8Array.of(r?2:3)}function qk(r,e){return{secretKey:e.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function Wq(r,e={}){const{Fn:t}=r,n=e.randomBytes||bf,s=Object.assign(qk(r.Fp,t),{seed:xk(t.ORDER)});function i(f){try{const g=t.fromBytes(f);return t.isValidNot0(g)}catch{return!1}}function o(f,g){const{publicKey:m,publicKeyUncompressed:b}=s;try{const v=f.length;return g===!0&&v!==m||g===!1&&v!==b?!1:!!r.fromBytes(f)}catch{return!1}}function a(f=n(s.seed)){return PH(st(f,s.seed,"seed"),t.ORDER)}function c(f,g=!0){return r.BASE.multiply(t.fromBytes(f)).toBytes(g)}function l(f){const{secretKey:g,publicKey:m,publicKeyUncompressed:b}=s;if(!Kg(f)||"_lengths"in t&&t._lengths||g===m)return;const v=st(f,void 0,"key").length;return v===m||v===b}function u(f,g,m=!0){if(l(f)===!0)throw new Error("first arg must be private key");if(l(g)===!1)throw new Error("second arg must be public key");const b=t.fromBytes(f);return r.fromBytes(g).multiply(b).toBytes(m)}const h={isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a},d=t5(a,c);return Object.freeze({getPublicKey:c,getSharedSecret:u,keygen:d,Point:r,utils:h,lengths:s})}function Gq(r,e,t={}){yf(e),yu(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"}),t=Object.assign({},t);const n=t.randomBytes||bf,s=t.hmac||((z,$)=>vf(e,z,$)),{Fp:i,Fn:o}=r,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:f}=Wq(r,t),g={prehash:!0,lowS:typeof t.lowS=="boolean"?t.lowS:!0,format:"compact",extraEntropy:!1},m=a*zk<i.ORDER;function b(z){const $=a>>fl;return z>$}function v(z,$){if(!o.isValidNot0($))throw new Error(`invalid signature ${z}: out of range 1..Point.Fn.ORDER`);return $}function A(){if(m)throw new Error('"recovered" sig type is not supported for cofactor >2 curves')}function w(z,$){R3($);const K=f.signature,X=$==="compact"?K:$==="recovered"?K+1:void 0;return st(z,X)}class E{r;s;recovery;constructor($,K,X){if(this.r=v("r",$),this.s=v("s",K),X!=null){if(A(),![0,1,2,3].includes(X))throw new Error("invalid recovery id");this.recovery=X}Object.freeze(this)}static fromBytes($,K=g.format){w($,K);let X;if(K==="der"){const{r:ce,s:de}=vo.toSig(st($));return new E(ce,de)}K==="recovered"&&(X=$[0],K="compact",$=$.subarray(1));const te=f.signature/2,W=$.subarray(0,te),ie=$.subarray(te,te*2);return new E(o.fromBytes(W),o.fromBytes(ie),X)}static fromHex($,K){return this.fromBytes(xd($),K)}assertRecovery(){const{recovery:$}=this;if($==null)throw new Error("invalid recovery id: must be present");return $}addRecoveryBit($){return new E(this.r,this.s,$)}recoverPublicKey($){const{r:K,s:X}=this,te=this.assertRecovery(),W=te===2||te===3?K+a:K;if(!i.isValid(W))throw new Error("invalid recovery id: sig.r+curve.n != R.x");const ie=i.toBytes(W),ce=r.fromBytes(Ks(Hk((te&1)===0),ie)),de=o.inv(W),oe=P(st($,void 0,"msgHash")),Se=o.create(-oe*de),Le=o.create(X*de),xe=r.BASE.multiplyUnsafe(Se).add(ce.multiplyUnsafe(Le));if(xe.is0())throw new Error("invalid recovery: point at infinify");return xe.assertValidity(),xe}hasHighS(){return b(this.s)}toBytes($=g.format){if(R3($),$==="der")return xd(vo.hexFromSig(this));const{r:K,s:X}=this,te=o.toBytes(K),W=o.toBytes(X);return $==="recovered"?(A(),Ks(Uint8Array.of(this.assertRecovery()),te,W)):Ks(te,W)}toHex($){return wf(this.toBytes($))}}const x=t.bits2int||function($){if($.length>8192)throw new Error("input is too large");const K=Wg($),X=$.length*8-c;return X>0?K>>BigInt(X):K},P=t.bits2int_modN||function($){return o.create(x($))},T=Zw(c);function D(z){return Cd("num < 2^"+c,z,Ti,T),o.toBytes(z)}function C(z,$){return st(z,void 0,"message"),$?st(e(z),void 0,"prehashed message"):z}function R(z,$,K){const{lowS:X,prehash:te,extraEntropy:W}=Xm(K,g);z=C(z,te);const ie=P(z),ce=o.fromBytes($);if(!o.isValidNot0(ce))throw new Error("invalid private key");const de=[D(ce),D(ie)];if(W!=null&&W!==!1){const xe=W===!0?n(f.secretKey):W;de.push(st(xe,void 0,"extraEntropy"))}const oe=Ks(...de),Se=ie;function Le(xe){const ee=x(xe);if(!o.isValidNot0(ee))return;const pe=o.inv(ee),se=r.BASE.multiply(ee).toAffine(),ye=o.create(se.x);if(ye===Ti)return;const He=o.create(pe*o.create(Se+ye*ce));if(He===Ti)return;let M=(se.x===ye?0:2)|Number(se.y&fl),F=He;return X&&b(He)&&(F=o.neg(He),M^=1),new E(ye,F,m?void 0:M)}return{seed:oe,k2sig:Le}}function O(z,$,K={}){const{seed:X,k2sig:te}=R(z,$,K);return bH(e.outputLen,o.BYTES,s)(X,te).toBytes(K.format)}function V(z,$,K,X={}){const{lowS:te,prehash:W,format:ie}=Xm(X,g);if(K=st(K,void 0,"publicKey"),$=C($,W),!Kg(z)){const ce=z instanceof E?", use sig.toBytes()":"";throw new Error("verify expects Uint8Array signature"+ce)}w(z,ie);try{const ce=E.fromBytes(z,ie),de=r.fromBytes(K);if(te&&ce.hasHighS())return!1;const{r:oe,s:Se}=ce,Le=P($),xe=o.inv(Se),ee=o.create(Le*xe),pe=o.create(oe*xe),se=r.BASE.multiplyUnsafe(ee).add(de.multiplyUnsafe(pe));return se.is0()?!1:o.create(se.x)===oe}catch{return!1}}function B(z,$,K={}){const{prehash:X}=Xm(K,g);return $=C($,X),E.fromBytes(z,"recovered").recoverPublicKey($).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:f,Point:r,sign:O,verify:V,recoverPublicKey:B,Signature:E,hash:e})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const h5={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")},Yq={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),basises:[[BigInt("0x3086d221a7d46bcde86c90e49284eb15"),-BigInt("0xe4437ed6010e88286f547fa90abfe4c3")],[BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),BigInt("0x3086d221a7d46bcde86c90e49284eb15")]]},d9=BigInt(2);function Qq(r){const e=h5.p,t=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,h=Kt(u,t,e)*u%e,d=Kt(h,t,e)*u%e,f=Kt(d,d9,e)*l%e,g=Kt(f,s,e)*f%e,m=Kt(g,i,e)*g%e,b=Kt(m,a,e)*m%e,v=Kt(b,c,e)*b%e,A=Kt(v,a,e)*m%e,w=Kt(A,t,e)*u%e,E=Kt(w,o,e)*g%e,x=Kt(E,n,e)*l%e,P=Kt(x,d9,e);if(!P3.eql(P3.sqr(P),r))throw new Error("Cannot find square root");return P}const P3=Gg(h5.p,{sqrt:Qq}),Xq=jq(h5,{Fp:P3,endo:Yq}),Hi=Gq(Xq,Lo),Jq=32;function Zq(r,e,t){const n=Zt.digest(e instanceof Uint8Array?e:e.subarray());if(Qg(n))return n.then(({digest:s})=>(t?.signal?.throwIfAborted(),Hi.sign(s,r,{prehash:!1,format:"der"}))).catch(s=>{throw s.name==="AbortError"?s:new W7(String(s))});try{return Hi.sign(n.digest,r,{prehash:!1,format:"der"})}catch(s){throw new W7(String(s))}}function eK(r,e,t,n){const s=Zt.digest(t instanceof Uint8Array?t:t.subarray());if(Qg(s))return s.then(({digest:i})=>(n?.signal?.throwIfAborted(),Hi.verify(e,i,r,{prehash:!1,format:"der"}))).catch(i=>{throw i.name==="AbortError"?i:new G7(String(i))});try{return n?.signal?.throwIfAborted(),Hi.verify(e,s.digest,r,{prehash:!1,format:"der"})}catch(i){throw new G7(String(i))}}class Kk{type="secp256k1";raw;_key;constructor(e){this._key=sK(e),this.raw=rK(this._key)}toMultihash(){return Pn.digest(Qs(this))}toCID(){return Ee.createV1(114,this.toMultihash())}toString(){return Dt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}verify(e,t,n){return eK(this._key,t,e,n)}}class jk{type="secp256k1";raw;publicKey;constructor(e,t){this.raw=nK(e),this.publicKey=new Kk(t??iK(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:Qe(this.raw,e.raw)}sign(e,t){return Zq(this.raw,e,t)}}function Wk(r){return new jk(r)}function Gk(r){return new Kk(r)}async function tK(){const r=oK();return new jk(r)}function rK(r){return Hi.Point.fromBytes(r).toBytes()}function nK(r){try{return Hi.getPublicKey(r,!0),r}catch(e){throw new RC(String(e))}}function sK(r){try{return Hi.Point.fromBytes(r),r}catch(e){throw new Pp(String(e))}}function iK(r){try{return Hi.getPublicKey(r,!0)}catch(e){throw new RC(String(e))}}function oK(){return Hi.utils.randomSecretKey()}async function d5(r,e){if(r==="Ed25519")return tq();if(r==="secp256k1")return tK();if(r==="RSA")return Bq(lK(e));if(r==="ECDSA")return Yz(uK(e));throw new pu}function Cs(r,e){const{Type:t,Data:n}=Go.decode(r),s=n??new Uint8Array;switch(t){case Ht.RSA:return Nq(s,e);case Ht.Ed25519:return Ok(s);case Ht.secp256k1:return Gk(s);case Ht.ECDSA:return ok(s);default:throw new pu}}function Xg(r){const{Type:e,Data:t}=Go.decode(r.digest),n=t??new Uint8Array;switch(e){case Ht.Ed25519:return Ok(n);case Ht.secp256k1:return Gk(n);case Ht.ECDSA:return ok(n);default:throw new pu}}function Qs(r){return Go.encode({Type:Ht[r.type],Data:r.raw})}function aK(r){const e=qp.decode(r),t=e.Data??new Uint8Array;switch(e.Type){case Ht.RSA:return Dq(t);case Ht.Ed25519:return Nk(t);case Ht.secp256k1:return Wk(t);case Ht.ECDSA:return Kz(t);default:throw new pu}}function cK(r){if(r.byteLength===Hs)return Nk(r);if(r.byteLength===Jq)return Wk(r);const e=yc(r),t=e[2]?.[0];if(t===Bz||t===Mz||t===$z)return ik(e);if(e.length>8)return Fk(e);throw new ue("Could not extract private key from raw bytes")}function Ef(r){return qp.encode({Type:Ht[r.type],Data:r.raw})}function lK(r){return r==null?2048:parseInt(r,10)}function uK(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new ue("Unsupported curve, should be P-256, P-384 or P-521")}async function Yk(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new ue("Only RSA and ECDSA keys are supported")}const qu=Uint32Array.from([1732584193,4023233417,2562383102,271733878,3285377520]),fo=new Uint32Array(80);class hK extends Yw{A=qu[0]|0;B=qu[1]|0;C=qu[2]|0;D=qu[3]|0;E=qu[4]|0;constructor(){super(64,20,8,!1)}get(){const{A:e,B:t,C:n,D:s,E:i}=this;return[e,t,n,s,i]}set(e,t,n,s,i){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0}process(e,t){for(let c=0;c<16;c++,t+=4)fo[c]=e.getUint32(t,!1);for(let c=16;c<80;c++)fo[c]=qm(fo[c-3]^fo[c-8]^fo[c-14]^fo[c-16],1);let{A:n,B:s,C:i,D:o,E:a}=this;for(let c=0;c<80;c++){let l,u;c<20?(l=uk(s,i,o),u=1518500249):c<40?(l=s^i^o,u=1859775393):c<60?(l=hk(s,i,o),u=2400959708):(l=s^i^o,u=3395469782);const h=qm(n,5)+l+a+u+fo[c]|0;a=o,o=i,i=qm(s,30),s=n,n=h}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,this.set(n,s,i,o,a)}roundClean(){ai(fo)}destroy(){this.set(0,0,0,0,0),ai(this.buffer)}}const dK=Gw(()=>new hK);function Qk(r,e,t,n){yf(r);const s=tH({dkLen:32,asyncTick:10},n),{c:i,dkLen:o,asyncTick:a}=s;if(bs(i,"c"),bs(o,"dkLen"),bs(a,"asyncTick"),i<1)throw new Error("iterations (c) must be >= 1");const c=J7(e,"password"),l=J7(t,"salt"),u=new Uint8Array(o),h=vf.create(r,c),d=h._cloneInto().update(l);return{c:i,dkLen:o,asyncTick:a,DK:u,PRF:h,PRFSalt:d}}function Xk(r,e,t,n,s){return r.destroy(),e.destroy(),n&&n.destroy(),ai(s),t}function fK(r,e,t,n){const{c:s,dkLen:i,DK:o,PRF:a,PRFSalt:c}=Qk(r,e,t,n);let l;const u=new Uint8Array(4),h=Vh(u),d=new Uint8Array(a.outputLen);for(let f=1,g=0;g<i;f++,g+=a.outputLen){const m=o.subarray(g,g+a.outputLen);h.setInt32(0,f,!1),(l=c._cloneInto(l)).update(u).digestInto(d),m.set(d.subarray(0,m.length));for(let b=1;b<s;b++){a._cloneInto(l).update(d).digestInto(d);for(let v=0;v<m.length;v++)m[v]^=d[v]}}return Xk(a,c,o,l,d)}async function Jk(r,e,t,n){const{c:s,dkLen:i,asyncTick:o,DK:a,PRF:c,PRFSalt:l}=Qk(r,e,t,n);let u;const h=new Uint8Array(4),d=Vh(h),f=new Uint8Array(c.outputLen);for(let g=1,m=0;m<i;g++,m+=c.outputLen){const b=a.subarray(m,m+c.outputLen);d.setInt32(0,g,!1),(u=l._cloneInto(u)).update(h).digestInto(f),b.set(f.subarray(0,b.length)),await Zz(s-1,o,()=>{c._cloneInto(u).update(f).digestInto(f);for(let v=0;v<b.length;v++)b[v]^=f[v]})}return Xk(c,l,a,u,f)}const f9={sha1:dK,"sha2-256":Lo,"sha2-512":jg};function p9(r,e,t,n,s){if(s!=="sha1"&&s!=="sha2-256"&&s!=="sha2-512"){const a=Object.keys(f9).join(" / ");throw new ue(`Hash '${s}' is unknown or not supported. Must be ${a}`)}const i=f9[s],o=fK(i,r,e,{c:t,dkLen:n});return gn.encode(o).substring(1)}const f5={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},Zk={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},eI=new globalThis.TextEncoder;function pK(r,e){const t=f5[e];let n=Zk[e];for(let s=0;s<r.length;s++)n^=BigInt(r[s]),n=BigInt.asUintN(e,n*t);return n}function gK(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=f5[e];let s=Zk[e],i=r;for(;i.length>0;){const o=eI.encodeInto(i,t);i=i.slice(o.read);for(let a=0;a<o.written;a++)s^=BigInt(t[a]),s=BigInt.asUintN(e,s*n)}return s}function mK(r,{size:e=32,utf8Buffer:t}={}){if(!f5[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return gK(r,e,t);r=eI.encode(r)}return pK(r,e)}const p5={hash:r=>Number(mK(r,{size:32})),hashV:(r,e)=>yK(p5.hash(r,e))};function yK(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),le(e,"base16")}const tI=64;class _a{fp;h;seed;constructor(e,t,n,s=2){if(s>tI)throw new TypeError("Invalid Fingerprint Size");const i=t.hashV(e,n),o=ot(s);for(let a=0;a<o.length;a++)o[a]=i[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return e?.fp instanceof Uint8Array?Qe(this.fp,e.fp):!1}}function Kp(r,e){return Math.floor(Math.random()*(e-r))+r}let u1=class{contents;constructor(e){this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof _a))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof _a))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof _a))throw new TypeError("Invalid Fingerprint");const t=Kp(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof _a))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}};const wK=500;class g9{bucketSize;filterSize;fingerprintSize;buckets;count;hash;seed;constructor(e){this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??p5,this.seed=e.seed??Kp(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=le(e));const t=new _a(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new u1(this.bucketSize)),this.buckets[s]==null&&(this.buckets[s]=new u1(this.bucketSize)),this.buckets[n].add(t)||this.buckets[s].add(t))return this.count++,!0;const i=[n,s];let o=i[Kp(0,i.length-1)];this.buckets[o]==null&&(this.buckets[o]=new u1(this.bucketSize));for(let a=0;a<wK;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new u1(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){typeof e=="string"&&(e=le(e));const t=new _a(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=this.buckets[n]?.has(t)??!1;if(s)return s;const i=(n^t.hash())%this.filterSize;return this.buckets[i]?.has(t)??!1}remove(e){typeof e=="string"&&(e=le(e));const t=new _a(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,s=this.buckets[n]?.remove(t)??!1;if(s)return this.count--,s;const i=(n^t.hash())%this.filterSize,o=this.buckets[i]?.remove(t)??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const bK={1:.5,2:.84,4:.95,8:.98};function vK(r=.001){return r>.002?2:r>1e-5?4:8}function EK(r,e=.001){const t=vK(e),n=bK[t],s=Math.round(r/n),i=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),tI);return{filterSize:s,bucketSize:t,fingerprintSize:i}}class rI{filterSize;bucketSize;fingerprintSize;scale;filterSeries;hash;seed;constructor(e){this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??p5,this.seed=e.seed??Kp(0,Math.pow(2,10)),this.filterSeries=[new g9({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=le(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new g9({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=le(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=le(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function Yo(r,e=.001,t){return new rI({...EK(r,e)})}function ct(r){const e=r.getComponents(),t={};let n=0;if(e[n]?.name==="ip6zone"&&(t.zone=`${e[n].value}`,n++),e[n].name==="ip4"||e[n].name==="ip6"||e[n].name==="dns"||e[n].name==="dns4"||e[n].name==="dns6"?(t.type=e[n].name,t.host=e[n].value,n++):e[n].name==="dnsaddr"&&(t.type=e[n].name,t.host=`_dnsaddr.${e[n].value}`,n++),(e[n]?.name==="tcp"||e[n]?.name==="udp")&&(t.protocol=e[n].name==="tcp"?"tcp":"udp",t.port=parseInt(`${e[n].value}`),n++),e[n]?.name==="ipcidr"&&(t.type==="ip4"?t.cidr=parseInt(`${e[n].value}`):t.type==="ip6"&&(t.cidr=`${e[n].value}`),n++),t.type==null||t.host==null)throw new ue(`Multiaddr ${r} was not an IPv4, IPv6, DNS, DNS4, DNS6 or DNSADDR address`);return e[n]?.name==="tls"&&e[n+1]?.name==="sni"&&(t.sni=e[n+1].value,n+=2),t}class SK{index=0;input="";new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,s){return this.readAtomically(()=>{let i=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*s)-1;for(;;){const u=this.readAtomically(()=>{const h=this.readChar();if(h===void 0)return;const d=Number.parseInt(h,e);if(!Number.isNaN(d))return d});if(u===void 0)break;if(i*=e,i+=u,i>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:i})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const s=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[s]=o[0],t[s+1]=o[1],t[s+2]=o[2],t[s+3]=o[3],[s+4,!0]}const i=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(i===void 0)return[s,!1];t[s]=i>>8,t[s+1]=i&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,s]=e(t);if(n===16)return t;if(s||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const i=new Uint8Array(14),o=16-(n+2),[a]=e(i.subarray(0,o));return t.set(i.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const nI=45,_K=15,Ml=new SK;function sI(r){if(!(r.length>_K))return Ml.new(r).parseWith(()=>Ml.readIPv4Addr())}function iI(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>nI))return Ml.new(r).parseWith(()=>Ml.readIPv6Addr())}function D3(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>nI)return;const t=Ml.new(r).parseWith(()=>Ml.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function xK(r,e,t){let n=0;for(const s of r)if(!(n<e)){if(n>t)break;if(s!==255)return!1;n++}return!0}function AK(r,e,t,n){let s=0;for(const i of r)if(!(s<t)){if(s>n)break;if(i!==e[s])return!1;s++}return!0}function CK(r){switch(r.length){case Id:return r.join(".");case Td:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function kK(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;(n&128)!=0;)e++,n=n<<1;if((n&128)!=0)return-1;for(let s=t+1;s<r.length;s++)if(r[s]!=0)return-1;break}return e}function IK(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const Id=4,Td=16,TK=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function oI(r,e){e.length===Td&&r.length===Id&&xK(e,0,11)&&(e=e.slice(12)),e.length===Id&&r.length===Td&&AK(r,TK,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=r[s]&e[s];return n}function RK(r,e){if(typeof e=="string"&&(e=D3(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function PK(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=Id,s=sI(e);if(s==null&&(n=Td,s=iI(e),s==null))throw new Error("Failed to parse given CIDR: "+r);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=aI(i,8*n);return{network:oI(s,o),mask:o}}function aI(r,e){if(e!==8*Id&&e!==8*Td)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let s=0;s<t;s++){if(r>=8){n[s]=255,r-=8;continue}n[s]=255-(255>>r),r=0}return n}class cI{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=PK(e));else{const n=D3(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n.length*8){const i=D3(t);if(i==null)throw new Error("Failed to parse mask");this.mask=i}else this.mask=aI(s,8*n.length);this.network=oI(n,this.mask)}}contains(e){return RK({network:this.network,mask:this.mask},e)}toString(){const e=kK(this.mask),t=e!==-1?String(e):IK(this.mask);return CK(this.network)+"/"+t}}function DK(r,e){return new cI(r).contains(e)}function lI(r){try{const e=ct(r);switch(e.type){case"ip6":return DK("2000::/3",e.host);default:return!1}}catch{return!1}}function NK(r){try{const e=ct(r);switch(e.type){case"ip4":return e.host.startsWith("169.254.");case"ip6":return e.host.toLowerCase().startsWith("fe80");default:return!1}}catch{return!1}}function OK(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function N3(r){try{const e=ct(r);switch(e.type){case"ip4":case"ip6":return OK(e.host);default:return!1}}catch{return!1}}function vs(r){try{return ct(r),!0}catch{return!1}}function ci(r){return!!sI(r)}function Jg(r){return!!iI(r)}var Oc={},m9;function LK(){return m9||(m9=1,(function(){var r,e,t,n,s,i,o,a;a=function(c){var l,u,h,d;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,h=(c&65280)>>>8,d=c&255,[l,u,h,d].join(".")},o=function(c){var l,u,h,d,f,g;for(l=[],h=d=0;d<=3&&c.length!==0;h=++d){if(h>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}g=e(c),f=g[0],u=g[1],c=c.substring(u),l.push(f)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),i=t("a"),s=t("A"),e=function(c){var l,u,h,d,f;for(d=0,l=10,u="9",h=0,c.length>1&&c[h]==="0"&&(c[h+1]==="x"||c[h+1]==="X"?(h+=2,l=16):"0"<=c[h+1]&&c[h+1]<="9"&&(h++,l=8,u="7")),f=h;h<c.length;){if("0"<=c[h]&&c[h]<=u)d=d*l+(t(c[h])-n)>>>0;else if(l===16)if("a"<=c[h]&&c[h]<="f")d=d*l+(10+t(c[h])-i)>>>0;else if("A"<=c[h]&&c[h]<="F")d=d*l+(10+t(c[h])-s)>>>0;else break;else break;if(d>4294967295)throw new Error("too large");h++}if(h===f)throw new Error("empty octet");return[d,h]},r=(function(){function c(l,u){var h,d,f;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(f=l.split("/",2),l=f[0],u=f[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(h=d=32;d>=0;h=--d)if(this.maskLong===4294967295<<32-h>>>0){this.bitmask=h;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,h,d;for(d=o(this.first),h=o(this.last),u=0;d<=h;)l(a(d),d,u),u++,d++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c})(),Oc.ip2long=o,Oc.long2ip=a,Oc.Netmask=r}).call(Oc)),Oc}var BK=LK();const MK=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],$K=MK.map(r=>new BK.Netmask(r));function g5(r){for(const e of $K)if(e.contains(r))return!0;return!1}function UK(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function FK(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),s=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return g5(s)}function VK(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function zK(r){const e=r.split(":"),t=e[e.length-1];return g5(t)}function HK(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function m5(r){if(ci(r))return g5(r);if(UK(r))return FK(r);if(VK(r))return zK(r);if(Jg(r))return HK(r)}function Zn(r){try{const e=ct(r);switch(e.type){case"ip4":case"ip6":return m5(e.host)??!1;default:return e.host==="localhost"}}catch{return!1}}function Lt(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}class y9{buffer;mask;top;btm;next;constructor(e){if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class Jm{size;hwm;head;tail;constructor(e={}){this.hwm=e.splitLimit??16,this.head=new y9(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return e?.byteLength!=null?e.byteLength:1}push(e){if(e?.value!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new y9(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return e?.value!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let qK=class extends Error{type;code;constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}};function to(r={}){return KK(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function KK(r,e){e=e??{};let t=e.onEnd,n=new Jm,s,i,o,a=Lt();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((b,v)=>{i=A=>{i=null,n.push(A);try{b(r(n))}catch(w){v(w)}return s}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=Lt()})}},l=b=>i!=null?i(b):(n.push(b),s),u=b=>(n=new Jm,i!=null?i({error:b}):(n.push({error:b}),s)),h=b=>{if(o)return s;if(e?.objectMode!==!0&&b?.byteLength==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:b})},d=b=>o?s:(o=!0,b!=null?u(b):l({done:!0})),f=()=>(n=new Jm,d(),{done:!0}),g=b=>(d(b),{done:!0});if(s={[Symbol.asyncIterator](){return this},next:c,return:f,throw:g,push:h,end:d,get readableLength(){return n.size},onEmpty:async b=>{const v=b?.signal;if(v?.throwIfAborted(),n.isEmpty())return;let A,w;v!=null&&(A=new Promise((E,x)=>{w=()=>{x(new qK)},v.addEventListener("abort",w)}));try{await Promise.race([a.promise,A])}finally{w!=null&&v!=null&&v?.removeEventListener("abort",w)}}},t==null)return s;const m=s;return s={[Symbol.asyncIterator](){return this},next(){return m.next()},throw(b){return m.throw(b),t!=null&&(t(b),t=void 0),{done:!0}},return(){return m.return(),t!=null&&(t(),t=void 0),{done:!0}},push:h,end(b){return m.end(b),t!=null&&(t(b),t=void 0),s},get readableLength(){return m.readableLength},onEmpty:b=>m.onEmpty(b)},s}let jK=class extends Error{constructor(e){super(e),this.name="TimeoutError"}},WK=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const w9=r=>globalThis.DOMException===void 0?new WK(r):new DOMException(r),b9=r=>{const e=r.reason===void 0?w9("This operation was aborted."):r.reason;return e instanceof Error?e:w9(e)};function GK(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,h)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:f}=e;f.aborted&&h(b9(f)),a=()=>{h(b9(f))},f.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,h);return}const d=new jK;o=i.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(f){h(f)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?u():s instanceof Error?h(s):(d.message=s??`Promise timed out after ${t} milliseconds`,h(d))},t),(async()=>{try{u(await r)}catch(f){h(f)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},l}const YK=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function QK(r,e,t){let n;const s=new Promise((i,o)=>{if(t={rejectionEvents:["error"],multiArgs:!1,rejectionMultiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");t.signal?.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:u}=YK(r),h=async(...f)=>{const g=t.multiArgs?f:f[0];if(t.filter)try{if(!await t.filter(g))return}catch(m){n(),o(m);return}c.push(g),t.count===c.length&&(n(),i(c))},d=(...f)=>{n(),o(t.rejectionMultiArgs?f:f[0])};n=()=>{for(const f of a)u(f,h);for(const f of t.rejectionEvents)a.includes(f)||u(f,d)};for(const f of a)l(f,h);for(const f of t.rejectionEvents)a.includes(f)||l(f,d);t.signal&&t.signal.addEventListener("abort",()=>{d(t.signal.reason)},{once:!0}),t.resolveImmediately&&i(c)});if(s.cancel=n,typeof t.timeout=="number"){const i=GK(s,{milliseconds:t.timeout});return i.cancel=()=>{n(),i.clear()},i}return s}function sr(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=QK(r,e,t),s=n.then(i=>i[0]);return s.cancel=n.cancel,s}function Rd(r,e){let t;const n=function(){const s=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(s,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}class XK extends Error{remainingPoints;msBeforeNext;consumedPoints;isFirstInDuration;constructor(e="Rate limit exceeded",t){super(e),this.name="RateLimitError",this.remainingPoints=t.remainingPoints,this.msBeforeNext=t.msBeforeNext,this.consumedPoints=t.consumedPoints,this.isFirstInDuration=t.isFirstInDuration}}let JK=class extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}},jp=class extends Error{static name="UnexpectedEOFError";name="UnexpectedEOFError"};class ZK extends Error{static name="MaxEarlyStreamsError";name="MaxEarlyStreamsError"}class ej extends Error{static name="StreamClosedError";name="StreamClosedError"}function tj(r){return r.reason}async function es(r,e,t){if(e==null)return r;const n=tj;if(e.aborted)return r.catch(()=>{}),Promise.reject(n(e));let s;try{return await Promise.race([r,new Promise((i,o)=>{s=()=>{o(n(e))},e.addEventListener("abort",s)})])}finally{s!=null&&e.removeEventListener("abort",s)}}let rj=class{deferred;signal;constructor(e){this.signal=e,this.deferred=Lt(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new Ka)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}};function nj(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let sj=class{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=nj(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new Ka),this.cleanup())}async join(e={}){const t=new rj(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await es(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}},Qo=class extends Nt{concurrency;maxSize;queue;pending;sort;paused;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.paused=!1,e.metricName!=null&&e.metrics?.registerMetricGroup(e.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})}),this.sort=e.sort,this.queue=[],this.emitEmpty=Rd(this.emitEmpty.bind(this),1),this.emitIdle=Rd(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}pause(){this.paused=!0}resume(){this.paused&&(this.paused=!1,this.tryToStartAnother())}tryToStartAnother(){if(this.paused)return!1;if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new JK;const n=new sj(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.tryToStartAnother(),n.join(t).then(s=>(this.safeDispatchEvent("completed",{detail:s}),this.safeDispatchEvent("success",{detail:{job:n,result:s}}),s)).catch(s=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:n,error:s}}),s})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new Ka)}),this.clear()}async onEmpty(e){this.size!==0&&await sr(this,"empty",e)}async onSizeLessThan(e,t){this.size<e||await sr(this,"next",{...t,filter:()=>this.size<e})}async onIdle(e){this.pending===0&&this.size===0||await sr(this,"idle",e)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=to({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},s=c=>{c.detail!=null&&t.push(c.detail)},i=c=>{n(c.detail.error)},o=()=>{n()},a=()=>{n(new Ka("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("failure",i),this.addEventListener("idle",o),e?.signal?.addEventListener("abort",a);try{yield*t}finally{this.removeEventListener("completed",s),this.removeEventListener("failure",i),this.removeEventListener("idle",o),e?.signal?.removeEventListener("abort",a),n()}}};const ij=Math.pow(2,20)*4;class y5 extends Nt{status;timeline;inactivityTimeout;maxReadBufferLength;maxWriteBufferLength;log;direction;maxMessageSize;readStatus;writeStatus;remoteReadStatus;remoteWriteStatus;writableNeedsDrain;readBuffer;writeBuffer;sendingData;onDrainPromise;constructor(e){super(),this.status="open",this.log=e.log,this.direction=e.direction??"outbound",this.inactivityTimeout=e.inactivityTimeout??12e4,this.maxReadBufferLength=e.maxReadBufferLength??ij,this.maxWriteBufferLength=e.maxWriteBufferLength,this.maxMessageSize=e.maxMessageSize,this.readBuffer=new ze,this.writeBuffer=new ze,this.readStatus="readable",this.remoteReadStatus="readable",this.writeStatus="writable",this.remoteWriteStatus="writable",this.sendingData=!1,this.writableNeedsDrain=!1,this.timeline={open:Date.now()},this.processSendQueue=this.processSendQueue.bind(this);const t=()=>{this.writableNeedsDrain&&(this.log.trace("drain event received, continue sending data"),this.writableNeedsDrain=!1,this.processSendQueue()),this.onDrainPromise?.resolve()};this.addEventListener("drain",t);const n=s=>{this.onDrainPromise?.reject(s.error??new ej)};this.addEventListener("close",n)}get readBufferLength(){return this.readBuffer.byteLength}get writeBufferLength(){return this.writeBuffer.byteLength}async onDrain(e){return this.writableNeedsDrain!==!0?Promise.resolve():(this.onDrainPromise==null&&(this.onDrainPromise=Promise.withResolvers()),es(this.onDrainPromise.promise,e?.signal))}async*[Symbol.asyncIterator](){if(this.readStatus!=="readable"&&this.readStatus!=="paused")return;const e=to(),t=i=>{e.push(i.data)};this.addEventListener("message",t);const n=i=>{e.end(i.error)};this.addEventListener("close",n);const s=()=>{e.end()};this.addEventListener("remoteCloseWrite",s);try{yield*e}finally{this.removeEventListener("message",t),this.removeEventListener("close",n),this.removeEventListener("remoteCloseWrite",s)}}isReadable(){return this.status==="open"}send(e){if(this.writeStatus==="closed"||this.writeStatus==="closing")throw new zc(`Cannot write to a stream that is ${this.writeStatus}`);return this.log.trace("append %d bytes to write buffer",e.byteLength),this.writeBuffer.append(e),this.processSendQueue()}abort(e){if(!(this.status==="aborted"||this.status==="reset"||this.status==="closed")){this.log.error("abort with error - %e",e),this.status="aborted",this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle")),this.writeStatus="closed",this.remoteWriteStatus="closed",this.readStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now();try{this.sendReset(e)}catch(t){this.log("failed to send reset to remote - %e",t)}this.dispatchEvent(new bF(e))}}pause(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new zc("Cannot pause a stream that is closing/closed");this.readStatus!=="paused"&&(this.readStatus="paused",this.sendPause())}resume(){if(this.readStatus==="closed"||this.readStatus==="closing")throw new zc("Cannot resume a stream that is closing/closed");this.readStatus!=="readable"&&(this.readStatus="readable",this.dispatchReadBuffer(),this.sendResume())}push(e){if(this.readStatus==="closed"||this.readStatus==="closing")throw new zc(`Cannot push data onto a stream that is ${this.readStatus}`);if(e.byteLength!==0){if(this.readBuffer.append(e),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}unshift(e){if(this.readStatus==="closed"||this.readStatus==="closing")throw new zc(`Cannot push data onto a stream that is ${this.readStatus}`);if(e.byteLength!==0){if(this.readBuffer.prepend(e),this.readStatus==="paused"||this.listenerCount("message")===0){this.checkReadBufferLength();return}setTimeout(()=>{this.dispatchReadBuffer()},0)}}onData(e){if(e.byteLength!==0){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("ignoring data - read status %s",this.readStatus);return}this.readBuffer.append(e),this.dispatchReadBuffer()}}addEventListener(...e){super.addEventListener.apply(this,e),e[0]==="message"&&this.readBuffer.byteLength>0&&queueMicrotask(()=>{this.dispatchReadBuffer()})}onRemoteReset(){this.log("remote reset"),this.status="reset",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.timeline.close=Date.now(),this.readBuffer.byteLength===0&&(this.readStatus="closed");const e=new DC;this.dispatchEvent(new vF(e))}onTransportClosed(e){this.log("transport closed"),this.readStatus==="readable"&&this.readBuffer.byteLength===0&&(this.log("close readable end after transport closed and read buffer is empty"),this.readStatus="closed"),this.remoteReadStatus!=="closed"&&(this.remoteReadStatus="closed"),this.remoteWriteStatus!=="closed"&&(this.remoteWriteStatus="closed"),this.writeStatus!=="closed"&&(this.writeStatus="closed"),e!=null?this.abort(e):(this.status==="open"||this.status==="closing")&&(this.timeline.close=Date.now(),this.status="closed",this.writeStatus="closed",this.remoteWriteStatus="closed",this.remoteReadStatus="closed",this.dispatchEvent(new $g))}onRemoteCloseWrite(){this.remoteWriteStatus!=="closed"&&(this.log.trace("on remote close write"),this.remoteWriteStatus="closed",this.safeDispatchEvent("remoteCloseWrite"),this.writeStatus==="closed"&&this.onTransportClosed())}onRemoteCloseRead(){this.log.trace("on remote close read"),this.remoteReadStatus="closed",this.writeBuffer.byteLength>0&&(this.writeBuffer.consume(this.writeBuffer.byteLength),this.safeDispatchEvent("idle"))}processSendQueue(){if(this.writableNeedsDrain)return this.log.trace("not processing send queue as drain is required"),this.checkWriteBufferLength(),!1;if(this.writeBuffer.byteLength===0)return this.log.trace("not processing send queue as no bytes to send"),!0;if(this.sendingData)return this.log.trace("not processing send queue as already sending data"),!0;this.sendingData=!0,this.log.trace("processing send queue with %d queued bytes",this.writeBuffer.byteLength);try{let e=!0;const t=this.writeBuffer.byteLength;let n=0;for(;this.writeBuffer.byteLength>0;){const s=Math.min(this.maxMessageSize??this.writeBuffer.byteLength,this.writeBuffer.byteLength);if(s===0){e=!1;break}const i=this.writeBuffer.sublist(0,s),o=new ze(i);this.writeBuffer.consume(i.byteLength);const a=this.sendData(i);if(e=a.canSendMore,n+=a.sentBytes,a.sentBytes!==o.byteLength&&(o.consume(a.sentBytes),this.writeBuffer.prepend(o)),!e)break}return e||(this.log.trace("sent %d/%d bytes, pausing sending because underlying stream is full, %d bytes left in the write buffer",n,t,this.writeBuffer.byteLength),this.writableNeedsDrain=!0,this.checkWriteBufferLength()),this.writeBuffer.byteLength===0&&this.safeDispatchEvent("idle"),e}finally{this.sendingData=!1}}dispatchReadBuffer(){try{if(this.listenerCount("message")===0){this.log.trace("not dispatching pause buffer as there are no listeners for the message event");return}if(this.readBuffer.byteLength===0){this.log.trace("not dispatching pause buffer as there is no data to dispatch");return}if(this.readStatus==="paused"){this.log.trace("not dispatching pause buffer we are paused");return}if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("dropping %d bytes because the readable end is %s",this.readBuffer.byteLength,this.readStatus),this.readBuffer.consume(this.readBuffer.byteLength);return}const e=this.readBuffer.sublist();this.readBuffer.consume(e.byteLength),this.dispatchEvent(new wF(e))}finally{this.readBuffer.byteLength===0&&this.remoteWriteStatus==="closed"&&(this.log("close readable end after dispatching read buffer and remote writable end is closed"),this.readStatus="closed"),this.checkReadBufferLength()}}checkReadBufferLength(){this.readBuffer.byteLength>this.maxReadBufferLength&&this.abort(new P7(`Read buffer length of ${this.readBuffer.byteLength} exceeded limit of ${this.maxReadBufferLength}, read status is ${this.readStatus}`))}checkWriteBufferLength(){this.maxWriteBufferLength!=null&&this.writeBuffer.byteLength>this.maxWriteBufferLength&&this.abort(new P7(`Write buffer length of ${this.writeBuffer.byteLength} exceeded limit of ${this.maxWriteBufferLength}, write status is ${this.writeStatus}`))}onMuxerNeedsDrain(){this.writableNeedsDrain=!0}onMuxerDrain(){this.safeDispatchEvent("drain")}}class w5 extends y5{remoteAddr;metricPrefix;metrics;constructor(e){super(e),this.metricPrefix=e.metricPrefix??"",this.metrics=e.metrics,this.remoteAddr=e.remoteAddr,this.addEventListener("close",t=>{this.metrics?.increment({[`${this.metricPrefix}end`]:!0}),t.error!=null?t.local?this.metrics?.increment({[`${this.metricPrefix}abort`]:!0}):this.metrics?.increment({[`${this.metricPrefix}reset`]:!0}):t.local?this.metrics?.increment({[`${this.metricPrefix}_local_close`]:!0}):this.metrics?.increment({[`${this.metricPrefix}_remote_close`]:!0})})}async close(e){this.status==="open"&&(this.status="closing",this.writeStatus="closing",this.remoteWriteStatus="closing",this.remoteReadStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await sr(this,"idle",{...e,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await sr(this,"drain",{...e,rejectionEvents:["close"]})),await this.sendClose(e),this.onTransportClosed())}}function oj(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class b5 extends Nt{streams;protocol;status;log;maConn;streamOptions;earlyStreams;maxEarlyStreams;metrics;constructor(e,t){super(),this.maConn=e,this.protocol=t.protocol,this.streams=[],this.earlyStreams=[],this.status="open",this.log=e.log.newScope(t.name),this.streamOptions=t.streamOptions,this.maxEarlyStreams=t.maxEarlyStreams??10,this.metrics=t.metrics;const n=o=>{try{this.onData(o.data)}catch(a){this.abort(a),this.maConn.abort(a)}};this.maConn.addEventListener("message",n);const s=()=>{this.log("underlying stream drained, signal %d streams to continue writing",this.streams.length),this.streams.forEach(o=>{o.onMuxerDrain()})};this.maConn.addEventListener("drain",s);const i=()=>{this.log("underlying stream closed with status %s and %d streams",this.status,this.streams.length),this.onTransportClosed()};this.maConn.addEventListener("close",i)}send(e){const t=this.maConn.send(e);return t===!1&&(this.log("underlying stream saturated, signal %d streams to pause writing",this.streams.length),this.streams.forEach(n=>{n.onMuxerNeedsDrain()})),t}async close(e){this.status==="closed"||this.status==="closing"||(this.status="closing",await es(Promise.all([...this.streams].map(async t=>{await t.close(e)})),e?.signal),this.status="closed")}abort(e){this.status!=="closed"&&(this.status="closing",[...this.streams].forEach(t=>{t.abort(e)}),this.status="closed")}onTransportClosed(e){this.status="closing";try{[...this.streams].forEach(t=>{t.onTransportClosed(e)})}catch(t){this.abort(t)}this.status="closed"}async createStream(e){if(this.status!=="open")throw new Wc;let t=this.onCreateStream({...this.streamOptions,...e});return oj(t)&&(t=await t),this.streams.push(t),this.cleanUpStream(t),t}onRemoteStream(e){if(this.streams.push(e),this.cleanUpStream(e),this.listenerCount("stream")===0){this.earlyStreams.push(e),this.earlyStreams.length>this.maxEarlyStreams&&this.abort(new ZK(`Too many early streams were opened - ${this.earlyStreams.length}/${this.maxEarlyStreams}`));return}this.safeDispatchEvent("stream",{detail:e})}cleanUpStream(e){const t=n=>{const s=this.streams.findIndex(i=>i===e);s!==-1&&this.streams.splice(s,1),n.error!=null?n.local?this.metrics?.increment({[`${e.direction}_stream_reset`]:!0}):this.metrics?.increment({[`${e.direction}_stream_abort`]:!0}):this.metrics?.increment({[`${e.direction}_stream_end`]:!0})};e.addEventListener("close",t),this.metrics?.increment({[`${e.direction}_stream`]:!0})}addEventListener(...e){super.addEventListener.apply(this,e),e[0]==="stream"&&this.earlyStreams.length>0&&queueMicrotask(()=>{this.earlyStreams.forEach(t=>{this.safeDispatchEvent("stream",{detail:t})}),this.earlyStreams=[]})}}class v5 extends y5{id;protocol;constructor(e){super(e),this.id=e.id,this.protocol=e.protocol??""}async close(e){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.writeStatus="closing",(this.sendingData||this.writeBuffer.byteLength>0)&&(this.log("waiting for write queue to become idle before closing writable end of stream, %d unsent bytes",this.writeBuffer.byteLength),await sr(this,"idle",{...e,rejectionEvents:["close"]})),this.writableNeedsDrain&&(this.log("waiting for write queue to drain before closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData),await sr(this,"drain",{...e,rejectionEvents:["close"]}),this.log("write queue drained, closing writable end of stream, %d unsent bytes, sending %s",this.writeBuffer.byteLength,this.sendingData)),await this.sendCloseWrite(e),this.writeStatus="closed",this.log("closed writable end gracefully"),this.remoteWriteStatus==="closed"&&this.onTransportClosed())}async closeRead(e){this.readStatus==="closing"||this.readStatus==="closed"||(this.readBuffer.byteLength>0&&this.readBuffer.consume(this.readBuffer.byteLength),this.readStatus="closing",await this.sendCloseRead(e),this.readStatus="closed",this.log("closed readable end gracefully"))}}function xt(r){const e=new globalThis.AbortController;function t(){e.abort();for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}for(const i of r){if(i?.aborted===!0){t();break}i?.addEventListener!=null&&i.addEventListener("abort",t)}function n(){for(const i of r)i?.removeEventListener!=null&&i.removeEventListener("abort",t)}const s=e.signal;return s.clear=n,s}class Zm{movingAverage;variance;deviation;forecast;timeSpan;previousTime;constructor(e){this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),s=e-this.movingAverage,i=n*s;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+s*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*s}else this.movingAverage=e;this.previousTime=t}}const aj=1.2,cj=2,lj=5e3,uj=6e4,hj=5e3;class Pd{success;failure;next;metric;timeoutMultiplier;failureMultiplier;minTimeout;maxTimeout;constructor(e={}){const t=e.interval??hj;this.success=new Zm(t),this.failure=new Zm(t),this.next=new Zm(t),this.failureMultiplier=e.failureMultiplier??cj,this.timeoutMultiplier=e.timeoutMultiplier??aj,this.minTimeout=e.minTimeout??lj,this.maxTimeout=e.maxTimeout??uj,e.metricName!=null&&(this.metric=e.metrics?.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);const n=AbortSignal.timeout(t),s=xt([e.signal,n]);return s.start=Date.now(),s.timeout=t,s}cleanUp(e){const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),this.metric?.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),this.metric?.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}let Wn=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},Dd=class extends Error{static name="ValidationError";name="ValidationError"},dj=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},fj=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};const Wp=4,Ba=6,uI=273,pj=33,Xa=41,E5=42,S5=43,_5=53,x5=54,A5=55,C5=56,gj=132,mj=301,yj=302,hI=400,qe=421,wj=444,bj=445,vj=446,Ej=447,Ma=448,Gp=449,Sj=454,dI=460,fI=461,pI=465,$l=466,pl=480,_j=481,O3=443,k5=477,gI=478,xj=479,Aj=277,Cj=275,kj=276,mI=280,Hh=281,wu=290,yI=777;function v9(r){return e=>he(e,r)}function E9(r){return e=>le(e,r)}function ih(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function Gc(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function Ij(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=le(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Gc(n);return Wt([t,s],t.length+s.length)}function Tj(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=_r.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Gc(n);return Wt([t,s],t.length+s.length)}function S9(r){const e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=he(e,"base32"),s=ih(t);return`${n}:${s}`}const wI=function(r){r=r.toString().trim();const e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{const s=parseInt(t,10);if(isNaN(s)||s<0||s>255)throw new Wn("Invalid byte value in IP address");e[n]=s}),e},Rj=function(r){let e=0;r=r.toString().trim();const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=ci(t[n]);let o;i&&(o=wI(t[n]),t[n]=he(o.subarray(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,he(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");const i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new Wn("Invalid byte value in IP address");s[e++]=i>>8&255,s[e++]=i&255}return s},Pj=function(r){if(r.byteLength!==4)throw new Wn("IPv4 address was incorrect length");const e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},Dj=function(r){if(r.byteLength!==16)throw new Wn("IPv6 address was incorrect length");const e=[];for(let n=0;n<r.byteLength;n+=2){const s=r[n],i=r[n+1],o=`${s.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new Wn(`Invalid IPv6 address "${t}"`)}};function Nj(r){try{const e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Wn(`Invalid IPv6 address "${r}"`)}}const ey=Object.values(Ll).map(r=>r.decoder),Oj=(function(){let r=ey[0].or(ey[1]);return ey.slice(2).forEach(e=>r=r.or(e)),r})();function Lj(r){return Oj.decode(r)}function Bj(r){return e=>r.encoder.encode(e)}function Mj(r){if(parseInt(r).toString()!==r)throw new Dd("Value must be an integer")}function $j(r){if(r<0)throw new Dd("Value must be a positive integer, or zero")}function Uj(r){return e=>{if(e>r)throw new Dd(`Value must be smaller than or equal to ${r}`)}}function Fj(...r){return e=>{for(const t of r)t(e)}}const h1=Fj(Mj,$j,Uj(65535)),Or=-1;let Vj=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new fj(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}};const bu=new Vj,zj=[{code:Wp,name:"ip4",size:32,valueToBytes:wI,bytesToValue:Pj,validate:r=>{if(!ci(r))throw new Dd(`Invalid IPv4 address "${r}"`)}},{code:Ba,name:"tcp",size:16,valueToBytes:Gc,bytesToValue:ih,validate:h1},{code:uI,name:"udp",size:16,valueToBytes:Gc,bytesToValue:ih,validate:h1},{code:pj,name:"dccp",size:16,valueToBytes:Gc,bytesToValue:ih,validate:h1},{code:Xa,name:"ip6",size:128,valueToBytes:Rj,bytesToValue:Dj,stringToValue:Nj,validate:r=>{if(!Jg(r))throw new Dd(`Invalid IPv6 address "${r}"`)}},{code:E5,name:"ip6zone",size:Or},{code:S5,name:"ipcidr",size:8,bytesToValue:v9("base10"),valueToBytes:E9("base10")},{code:_5,name:"dns",size:Or},{code:x5,name:"dns4",size:Or},{code:A5,name:"dns6",size:Or},{code:C5,name:"dnsaddr",size:Or},{code:gj,name:"sctp",size:16,valueToBytes:Gc,bytesToValue:ih,validate:h1},{code:mj,name:"udt"},{code:yj,name:"utp"},{code:hI,name:"unix",size:Or,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:qe,name:"p2p",aliases:["ipfs"],size:Or,bytesToValue:v9("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?E9("base58btc")(r):Ee.parse(r).multihash.bytes},{code:wj,name:"onion",size:96,bytesToValue:S9,valueToBytes:Ij},{code:bj,name:"onion3",size:296,bytesToValue:S9,valueToBytes:Tj},{code:vj,name:"garlic64",size:Or},{code:Ej,name:"garlic32",size:Or},{code:Ma,name:"tls"},{code:Gp,name:"sni",size:Or},{code:Sj,name:"noise"},{code:dI,name:"quic"},{code:fI,name:"quic-v1"},{code:pI,name:"webtransport"},{code:$l,name:"certhash",size:Or,bytesToValue:Bj(mu),valueToBytes:Lj},{code:pl,name:"http"},{code:_j,name:"http-path",size:Or,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:O3,name:"https"},{code:k5,name:"ws"},{code:gI,name:"wss"},{code:xj,name:"p2p-websocket-star"},{code:Aj,name:"p2p-stardust"},{code:Cj,name:"p2p-webrtc-star"},{code:kj,name:"p2p-webrtc-direct"},{code:mI,name:"webrtc-direct"},{code:Hh,name:"webrtc"},{code:wu,name:"p2p-circuit"},{code:yI,name:"memory",size:Or}];zj.forEach(r=>{bu.addProtocol(r)});function Hj(r){const e=[];let t=0;for(;t<r.length;){const n=Ts(r,t),s=bu.getProtocol(n),i=ht(n),o=Wj(s,r,t+i);let a=0;o>0&&s.size===Or&&(a=ht(o));const c=i+a+o,l={code:n,name:s.name,bytes:r.subarray(t,t+c)};if(o>0){const u=t+i+a,h=r.subarray(u,u+o);l.value=s.bytesToValue?.(h)??he(h)}e.push(l),t+=c}return e}function qj(r){let e=0;const t=[];for(const n of r){if(n.bytes==null){const s=bu.getProtocol(n.code),i=ht(n.code);let o,a=0,c=0;n.value!=null&&(o=s.valueToBytes?.(n.value)??le(n.value),a=o.byteLength,s.size===Or&&(c=ht(a)));const l=new Uint8Array(i+c+a);let u=0;Wo(n.code,l,u),u+=i,o!=null&&(s.size===Or&&(Wo(a,l,u),u+=c),l.set(o,u)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return Wt(t,e)}function Kj(r){if(r.charAt(0)!=="/")throw new Wn('String multiaddr must start with "/"');const e=[];let t="protocol",n="",s="";for(let i=1;i<r.length;i++){const o=r.charAt(i);o!=="/"&&(t==="protocol"?s+=r.charAt(i):n+=r.charAt(i));const a=i===r.length-1;if(o==="/"||a){const c=bu.getProtocol(s);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",s="",t="protocol";continue}else if(a)throw new Wn(`Component ${s} was missing value`);t="value"}else if(t==="value"){const l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new Wn(`Component ${s} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",s="",t="protocol"}}}if(s!==""&&n!=="")throw new Wn("Incomplete multiaddr");return e}function jj(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;const t=bu.getProtocol(e.code);if(t==null)throw new Wn(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function Wj(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:Ts(e,t)}const Gj=Symbol.for("nodejs.util.inspect.custom"),bI=Symbol.for("@multiformats/multiaddr");function Yj(r){if(r==null&&(r="/"),Zg(r))return r.getComponents();if(r instanceof Uint8Array)return Hj(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),Kj(r);if(Array.isArray(r))return r;throw new Wn("Must be a string, Uint8Array, Component[], or another Multiaddr")}let Qj=class oh{[bI]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=Yj(e),t.validate!==!1&&Xj(this)}get bytes(){return this.#r==null&&(this.#r=qj(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=jj(this.#e)),this.#t}toJSON(){return this.toString()}getComponents(){return[...this.#e.map(e=>({...e}))]}encapsulate(e){const t=new oh(e);return new oh([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new dj(`Address ${this.toString()} does not contain subaddress: ${t}`);return new oh(n.slice(0,s),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new oh(this.#e.slice(0,t),{validate:!1})}equals(e){return Qe(this.bytes,e.bytes)}[Gj](){return`Multiaddr(${this.toString()})`}};function Xj(r){r.getComponents().forEach(e=>{const t=bu.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}function Zg(r){return!!r?.[bI]}function Ye(r){return new Qj(r)}let _9=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function Jj(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new _9(t?.errorMessage,t?.errorCode,t?.errorName));let n;const s=new _9(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((i,o)=>{n=()=>{o(s)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}class Zj{readNext;haveNext;ended;nextResult;error;constructor(){this.ended=!1,this.readNext=Lt(),this.haveNext=Lt()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=Lt(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=Lt(),await Jj(this.readNext.promise,t?.signal,t)}}function e2(){return new Zj}function eW(r){return r[Symbol.asyncIterator]!=null}async function tW(r,e,t){try{await Promise.all(r.map(async n=>{for await(const s of n)await e.push(s,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(n){await e.end(n,{signal:t}).catch(()=>{})}}async function*rW(r){const e=new AbortController,t=e2();tW(r,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*nW(r){for(const e of r)yield*e}function Bo(...r){const e=[];for(const t of r)eW(t)||e.push(t);return e.length===r.length?nW(e):rW(r)}function wc(r,...e){if(r==null)throw new Error("Empty pipeline");if(ty(r)){const n=r;r=()=>n.source}else if(EI(r)||vI(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&ty(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)ty(t[n])&&(t[n]=iW(t[n]));return sW(...t)}const sW=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},vI=r=>r?.[Symbol.asyncIterator]!=null,EI=r=>r?.[Symbol.iterator]!=null,ty=r=>r==null?!1:r.sink!=null&&r.source!=null,iW=r=>e=>{const t=r.sink(e);if(t?.then!=null){const n=to({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let s;const i=r.source;if(vI(i))s=async function*(){yield*i,n.end()};else if(EI(i))s=function*(){yield*i,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Bo(n,s())}return r.source},oW=4194304;class x9 extends Error{static name="UnwrappedError";name="UnwrappedError"}let SI=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"},aW=class extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"},cW=class extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"};function lW(r){return typeof r?.closeRead=="function"}function uW(r){return typeof r?.close=="function"}function ry(r){return lW(r)?r.remoteWriteStatus!=="writable"&&r.readBufferLength===0:uW(r)?r.status!=="open":!1}function hW(r){return r?.addEventListener!=null&&r?.removeEventListener!=null&&r?.send!=null&&r?.push!=null&&r?.log!=null}function _I(r,e){const t=e?.maxBufferSize??oW,n=new ze;let s,i=!1;if(!hW(r))throw new ue("Argument should be a Stream or a Multiaddr");const o=u=>{if(n.append(u.data),n.byteLength>t){const h=n.byteLength;n.consume(n.byteLength),s?.reject(new Error(`Read buffer overflow - ${h} > ${t}`))}s?.resolve()};r.addEventListener("message",o);const a=u=>{u.error!=null?s?.reject(u.error):s?.resolve()};r.addEventListener("close",a);const c=()=>{s?.resolve()};r.addEventListener("remoteCloseWrite",c);const l={readBuffer:n,async read(u){if(i===!0)throw new x9("Stream was unwrapped");if(ry(r)){if(u?.bytes==null)return null;if(n.byteLength<u.bytes)throw r.log.error("closed after reading %d/%d bytes",n.byteLength,u.bytes),new jp(`Unexpected EOF - stream closed after reading ${n.byteLength}/${u.bytes} bytes`)}const h=u?.bytes??1;for(s=Promise.withResolvers();;){if(n.byteLength>=h){s.resolve();break}if(await es(s.promise,u?.signal),ry(r)){if(n.byteLength===0&&u?.bytes==null)return null;break}s=Promise.withResolvers()}const d=u?.bytes??n.byteLength;if(n.byteLength<d){if(ry(r))throw r.log.error("closed while reading %d/%d bytes",n.byteLength,d),new jp(`Unexpected EOF - stream closed while reading ${n.byteLength}/${d} bytes`);return l.read(u)}const f=n.sublist(0,d);return n.consume(d),f},async write(u,h){if(i===!0)throw new x9("Stream was unwrapped");r.send(u)||await sr(r,"drain",{signal:h?.signal,rejectionEvents:["close"]})},unwrap(){return i||(i=!0,r.removeEventListener("message",o),r.removeEventListener("close",a),r.removeEventListener("remoteCloseWrite",c),n.byteLength>0&&(r.log("stream unwrapped with %d unread bytes",n.byteLength),r.push(n))),r}};return l}function Nd(r,e={}){const t=_I(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=ht(e.maxDataLength));const n=e?.lengthDecoder??Ts,s=e?.lengthEncoder??Ys;return{async read(o){let a=-1;const c=new ze;for(;;){const u=await t.read({...o,bytes:1});if(u==null)break;c.append(u);try{a=n(c)}catch(h){if(h instanceof RangeError)continue;throw h}if(a<0)throw new SI("Invalid message length");if(e?.maxLengthLength!=null&&c.byteLength>e.maxLengthLength)throw new cW(`Message length length too long - ${c.byteLength} > ${e.maxLengthLength}`);if(a>-1)break}if(e?.maxDataLength!=null&&a>e.maxDataLength)throw new aW(`Message length too long - ${a} > ${e.maxDataLength}`);const l=await t.read({...o,bytes:a});if(l==null)throw r.log.error("tried to read %d bytes but the stream closed",a),new jp(`Unexpected EOF - tried to read ${a} bytes but the stream closed`);if(l.byteLength!==a)throw r.log.error("read %d/%d bytes before the stream closed",l.byteLength,a),new jp(`Unexpected EOF - read ${l.byteLength}/${a} bytes before the stream closed`);return l},async write(o,a){await t.write(new ze(s(o.byteLength),o),a)},async writeV(o,a){const c=new ze(...o.flatMap(l=>[s(l.byteLength),l]));await t.write(c,a)},unwrap(){return t.unwrap()}}}function Wr(r,e){const t=Nd(r,e),n={read:async(s,i)=>{const o=await t.read(i);return s.decode(o)},write:async(s,i,o)=>{await t.write(i.encode(s),o)},writeV:async(s,i,o)=>{await t.writeV(s.map(a=>i.encode(a)),o)},pb:s=>({read:async i=>n.read(s,i),write:async(i,o)=>n.write(i,s,o),writeV:async(i,o)=>n.writeV(i,s,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}const dW=1024*1024*4,fW=1024*1024*4;class pW{buffer;maxBufferSize;lengthDecoder;maxDataLength;encodingLength;constructor(e={}){this.buffer=new ze,this.maxBufferSize=e.maxBufferSize??dW,this.maxDataLength=e.maxDataLength??fW,this.lengthDecoder=e.lengthDecoder??Ts,this.encodingLength=e.encodingLength??ht}*decode(e){if(this.buffer.append(e),this.buffer.byteLength>this.maxBufferSize)throw new ue(`Buffer length limit exceeded - ${this.buffer.byteLength}/${this.maxBufferSize}`);for(;;){let t;try{t=this.lengthDecoder(this.buffer)}catch(i){if(i instanceof RangeError)break;throw i}if(t<0||t>this.maxDataLength)throw new SI("Invalid message length");const n=this.encodingLength(t),s=n+t;if(this.buffer.byteLength>=s){const i=this.buffer.sublist(n,s);this.buffer.consume(s),i.byteLength>0&&(yield i)}else break}}}const gW=["string","number","bigint","symbol"],mW=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function yW(r){if(r===null)return"null";if(r===void 0)return"undefined";if(r===!0||r===!1)return"boolean";const e=typeof r;if(gW.includes(e))return e;if(e==="function")return"Function";if(Array.isArray(r))return"Array";if(wW(r))return"Buffer";const t=bW(r);return t||"Object"}function wW(r){return r&&r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer.call(null,r)}function bW(r){const e=Object.prototype.toString.call(r).slice(8,-1);if(mW.includes(e))return e}class J{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}J.uint=new J(0,"uint",!0);J.negint=new J(1,"negint",!0);J.bytes=new J(2,"bytes",!0);J.string=new J(3,"string",!0);J.array=new J(4,"array",!1);J.map=new J(5,"map",!1);J.tag=new J(6,"tag",!1);J.float=new J(7,"float",!0);J.false=new J(7,"false",!0);J.true=new J(7,"true",!0);J.null=new J(7,"null",!0);J.undefined=new J(7,"undefined",!0);J.break=new J(7,"break",!0);class we{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const vu=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&typeof globalThis.Buffer.isBuffer=="function",vW=new TextDecoder,EW=new TextEncoder;function Yp(r){return vu&&globalThis.Buffer.isBuffer(r)}function I5(r){return r instanceof Uint8Array?Yp(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r:Uint8Array.from(r)}const SW=vu?(r,e,t)=>t-e>64?globalThis.Buffer.from(r.subarray(e,t)).toString("utf8"):C9(r,e,t):(r,e,t)=>t-e>64?vW.decode(r.subarray(e,t)):C9(r,e,t),xI=vu?r=>r.length>64?globalThis.Buffer.from(r):A9(r):r=>r.length>64?EW.encode(r):A9(r),Ei=r=>Uint8Array.from(r),T5=vu?(r,e,t)=>Yp(r)?new Uint8Array(r.subarray(e,t)):r.slice(e,t):(r,e,t)=>r.slice(e,t),_W=vu?(r,e)=>(r=r.map(t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t)),I5(globalThis.Buffer.concat(r,e))):(r,e)=>{const t=new Uint8Array(e);let n=0;for(let s of r)n+s.length>t.length&&(s=s.subarray(0,t.length-n)),t.set(s,n),n+=s.length;return t},xW=vu?r=>globalThis.Buffer.allocUnsafe(r):r=>new Uint8Array(r);function AW(r,e){if(Yp(r)&&Yp(e))return r.compare(e);for(let t=0;t<r.length;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}function A9(r){const e=[];let t=0;for(let n=0;n<r.length;n++){let s=r.charCodeAt(n);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=s&63|128):(s&64512)===55296&&n+1<r.length&&(r.charCodeAt(n+1)&64512)===56320?(s=65536+((s&1023)<<10)+(r.charCodeAt(++n)&1023),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=s&63|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=s&63|128)}return e}function C9(r,e,t){const n=[];for(;e<t;){const s=r[e];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(e+o<=t){let a,c,l,u;switch(o){case 1:s<128&&(i=s);break;case 2:a=r[e+1],(a&192)===128&&(u=(s&31)<<6|a&63,u>127&&(i=u));break;case 3:a=r[e+1],c=r[e+2],(a&192)===128&&(c&192)===128&&(u=(s&15)<<12|(a&63)<<6|c&63,u>2047&&(u<55296||u>57343)&&(i=u));break;case 4:a=r[e+1],c=r[e+2],l=r[e+3],(a&192)===128&&(c&192)===128&&(l&192)===128&&(u=(s&15)<<18|(a&63)<<12|(c&63)<<6|l&63,u>65535&&u<1114112&&(i=u))}}i===null?(i=65533,o=1):i>65535&&(i-=65536,n.push(i>>>10&1023|55296),i=56320|i&1023),n.push(i),e+=o}return AI(n)}const k9=4096;function AI(r){const e=r.length;if(e<=k9)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=k9));return t}const CW=256;class CI{constructor(e=CW){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),this._initReuseChunk!==null&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];if(this.cursor+e.length<=this.maxCursor+1){const s=t.length-(this.maxCursor-this.cursor)-1;t.set(e,s)}else{if(t){const s=t.length-(this.maxCursor-this.cursor)-1;s<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,s),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=xW(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,this._initReuseChunk===null&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(this.chunks.length===1){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=T5(n,0,this.cursor)}else t=_W(this.chunks,this.cursor);return e&&this.reset(),t}}const Ve="CBOR decode error:",$a="CBOR encode error:";function Eu(r,e,t){if(r.length-e<t)throw new Error(`${Ve} not enough data for type`)}const xr=[24,256,65536,4294967296,BigInt("18446744073709551616")];function bc(r,e,t){Eu(r,e,1);const n=r[e];if(t.strict===!0&&n<xr[0])throw new Error(`${Ve} integer encoded in more bytes than necessary (strict decode)`);return n}function vc(r,e,t){Eu(r,e,2);const n=r[e]<<8|r[e+1];if(t.strict===!0&&n<xr[1])throw new Error(`${Ve} integer encoded in more bytes than necessary (strict decode)`);return n}function Ec(r,e,t){Eu(r,e,4);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3];if(t.strict===!0&&n<xr[2])throw new Error(`${Ve} integer encoded in more bytes than necessary (strict decode)`);return n}function Sc(r,e,t){Eu(r,e,8);const n=r[e]*16777216+(r[e+1]<<16)+(r[e+2]<<8)+r[e+3],s=r[e+4]*16777216+(r[e+5]<<16)+(r[e+6]<<8)+r[e+7],i=(BigInt(n)<<BigInt(32))+BigInt(s);if(t.strict===!0&&i<xr[3])throw new Error(`${Ve} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(t.allowBigInt===!0)return i;throw new Error(`${Ve} integers outside of the safe integer range are not supported`)}function kW(r,e,t,n){return new we(J.uint,bc(r,e+1,n),2)}function IW(r,e,t,n){return new we(J.uint,vc(r,e+1,n),3)}function TW(r,e,t,n){return new we(J.uint,Ec(r,e+1,n),5)}function RW(r,e,t,n){return new we(J.uint,Sc(r,e+1,n),9)}function _c(r,e){return rs(r,0,e.value)}function rs(r,e,t){if(t<xr[0]){const n=Number(t);r.push([e|n])}else if(t<xr[1]){const n=Number(t);r.push([e|24,n])}else if(t<xr[2]){const n=Number(t);r.push([e|25,n>>>8,n&255])}else if(t<xr[3]){const n=Number(t);r.push([e|26,n>>>24&255,n>>>16&255,n>>>8&255,n&255])}else{const n=BigInt(t);if(n<xr[4]){const s=[e|27,0,0,0,0,0,0,0];let i=Number(n&BigInt(4294967295)),o=Number(n>>BigInt(32)&BigInt(4294967295));s[8]=i&255,i=i>>8,s[7]=i&255,i=i>>8,s[6]=i&255,i=i>>8,s[5]=i&255,s[4]=o&255,o=o>>8,s[3]=o&255,o=o>>8,s[2]=o&255,o=o>>8,s[1]=o&255,r.push(s)}else throw new Error(`${Ve} encountered BigInt larger than allowable range`)}}_c.encodedSize=function(e){return rs.encodedSize(e.value)};rs.encodedSize=function(e){return e<xr[0]?1:e<xr[1]?2:e<xr[2]?3:e<xr[3]?5:9};_c.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};function PW(r,e,t,n){return new we(J.negint,-1-bc(r,e+1,n),2)}function DW(r,e,t,n){return new we(J.negint,-1-vc(r,e+1,n),3)}function NW(r,e,t,n){return new we(J.negint,-1-Ec(r,e+1,n),5)}const R5=BigInt(-1),kI=BigInt(1);function OW(r,e,t,n){const s=Sc(r,e+1,n);if(typeof s!="bigint"){const i=-1-s;if(i>=Number.MIN_SAFE_INTEGER)return new we(J.negint,i,9)}if(n.allowBigInt!==!0)throw new Error(`${Ve} integers outside of the safe integer range are not supported`);return new we(J.negint,R5-BigInt(s),9)}function P5(r,e){const t=e.value,n=typeof t=="bigint"?t*R5-kI:t*-1-1;rs(r,e.type.majorEncoded,n)}P5.encodedSize=function(e){const t=e.value,n=typeof t=="bigint"?t*R5-kI:t*-1-1;return n<xr[0]?1:n<xr[1]?2:n<xr[2]?3:n<xr[3]?5:9};P5.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0};function Sf(r,e,t,n){Eu(r,e,t+n);const s=T5(r,e+t,e+t+n);return new we(J.bytes,s,t+n)}function LW(r,e,t,n){return Sf(r,e,1,t)}function BW(r,e,t,n){return Sf(r,e,2,bc(r,e+1,n))}function MW(r,e,t,n){return Sf(r,e,3,vc(r,e+1,n))}function $W(r,e,t,n){return Sf(r,e,5,Ec(r,e+1,n))}function UW(r,e,t,n){const s=Sc(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Ve} 64-bit integer bytes lengths not supported`);return Sf(r,e,9,s)}function Qp(r){return r.encodedBytes===void 0&&(r.encodedBytes=r.type===J.string?xI(r.value):r.value),r.encodedBytes}function t2(r,e){const t=Qp(e);rs(r,e.type.majorEncoded,t.length),r.push(t)}t2.encodedSize=function(e){const t=Qp(e);return rs.encodedSize(t.length)+t.length};t2.compareTokens=function(e,t){return FW(Qp(e),Qp(t))};function FW(r,e){return r.length<e.length?-1:r.length>e.length?1:AW(r,e)}function _f(r,e,t,n,s){const i=t+n;Eu(r,e,i);const o=new we(J.string,SW(r,e+t,e+i),i);return s.retainStringBytes===!0&&(o.byteValue=T5(r,e+t,e+i)),o}function VW(r,e,t,n){return _f(r,e,1,t,n)}function zW(r,e,t,n){return _f(r,e,2,bc(r,e+1,n),n)}function HW(r,e,t,n){return _f(r,e,3,vc(r,e+1,n),n)}function qW(r,e,t,n){return _f(r,e,5,Ec(r,e+1,n),n)}function KW(r,e,t,n){const s=Sc(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Ve} 64-bit integer string lengths not supported`);return _f(r,e,9,s,n)}const jW=t2;function Su(r,e,t,n){return new we(J.array,n,t)}function WW(r,e,t,n){return Su(r,e,1,t)}function GW(r,e,t,n){return Su(r,e,2,bc(r,e+1,n))}function YW(r,e,t,n){return Su(r,e,3,vc(r,e+1,n))}function QW(r,e,t,n){return Su(r,e,5,Ec(r,e+1,n))}function XW(r,e,t,n){const s=Sc(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Ve} 64-bit integer array lengths not supported`);return Su(r,e,9,s)}function JW(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ve} indefinite length items not allowed`);return Su(r,e,1,1/0)}function D5(r,e){rs(r,J.array.majorEncoded,e.value)}D5.compareTokens=_c.compareTokens;D5.encodedSize=function(e){return rs.encodedSize(e.value)};function _u(r,e,t,n){return new we(J.map,n,t)}function ZW(r,e,t,n){return _u(r,e,1,t)}function eG(r,e,t,n){return _u(r,e,2,bc(r,e+1,n))}function tG(r,e,t,n){return _u(r,e,3,vc(r,e+1,n))}function rG(r,e,t,n){return _u(r,e,5,Ec(r,e+1,n))}function nG(r,e,t,n){const s=Sc(r,e+1,n);if(typeof s=="bigint")throw new Error(`${Ve} 64-bit integer map lengths not supported`);return _u(r,e,9,s)}function sG(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ve} indefinite length items not allowed`);return _u(r,e,1,1/0)}function N5(r,e){rs(r,J.map.majorEncoded,e.value)}N5.compareTokens=_c.compareTokens;N5.encodedSize=function(e){return rs.encodedSize(e.value)};function iG(r,e,t,n){return new we(J.tag,t,1)}function oG(r,e,t,n){return new we(J.tag,bc(r,e+1,n),2)}function aG(r,e,t,n){return new we(J.tag,vc(r,e+1,n),3)}function cG(r,e,t,n){return new we(J.tag,Ec(r,e+1,n),5)}function lG(r,e,t,n){return new we(J.tag,Sc(r,e+1,n),9)}function O5(r,e){rs(r,J.tag.majorEncoded,e.value)}O5.compareTokens=_c.compareTokens;O5.encodedSize=function(e){return rs.encodedSize(e.value)};const uG=20,hG=21,dG=22,fG=23;function pG(r,e,t,n){if(n.allowUndefined===!1)throw new Error(`${Ve} undefined values are not supported`);return n.coerceUndefinedToNull===!0?new we(J.null,null,1):new we(J.undefined,void 0,1)}function gG(r,e,t,n){if(n.allowIndefinite===!1)throw new Error(`${Ve} indefinite length items not allowed`);return new we(J.break,void 0,1)}function L5(r,e,t){if(t){if(t.allowNaN===!1&&Number.isNaN(r))throw new Error(`${Ve} NaN values are not supported`);if(t.allowInfinity===!1&&(r===1/0||r===-1/0))throw new Error(`${Ve} Infinity values are not supported`)}return new we(J.float,r,e)}function mG(r,e,t,n){return L5(M5(r,e+1),3,n)}function yG(r,e,t,n){return L5($5(r,e+1),5,n)}function wG(r,e,t,n){return L5(PI(r,e+1),9,n)}function B5(r,e,t){const n=e.value;if(n===!1)r.push([J.float.majorEncoded|uG]);else if(n===!0)r.push([J.float.majorEncoded|hG]);else if(n===null)r.push([J.float.majorEncoded|dG]);else if(n===void 0)r.push([J.float.majorEncoded|fG]);else{let s,i=!1;(!t||t.float64!==!0)&&(TI(n),s=M5(us,1),n===s||Number.isNaN(n)?(us[0]=249,r.push(us.slice(0,3)),i=!0):(RI(n),s=$5(us,1),n===s&&(us[0]=250,r.push(us.slice(0,5)),i=!0))),i||(bG(n),s=PI(us,1),us[0]=251,r.push(us.slice(0,9)))}}B5.encodedSize=function(e,t){const n=e.value;if(n===!1||n===!0||n===null||n===void 0)return 1;if(!t||t.float64!==!0){TI(n);let s=M5(us,1);if(n===s||Number.isNaN(n))return 3;if(RI(n),s=$5(us,1),n===s)return 5}return 9};const II=new ArrayBuffer(9),Fn=new DataView(II,1),us=new Uint8Array(II,0);function TI(r){if(r===1/0)Fn.setUint16(0,31744,!1);else if(r===-1/0)Fn.setUint16(0,64512,!1);else if(Number.isNaN(r))Fn.setUint16(0,32256,!1);else{Fn.setFloat32(0,r);const e=Fn.getUint32(0),t=(e&2139095040)>>23,n=e&8388607;if(t===255)Fn.setUint16(0,31744,!1);else if(t===0)Fn.setUint16(0,(r&2147483648)>>16|n>>13,!1);else{const s=t-127;s<-24?Fn.setUint16(0,0):s<-14?Fn.setUint16(0,(e&2147483648)>>16|1<<24+s,!1):Fn.setUint16(0,(e&2147483648)>>16|s+15<<10|n>>13,!1)}}}function M5(r,e){if(r.length-e<2)throw new Error(`${Ve} not enough data for float16`);const t=(r[e]<<8)+r[e+1];if(t===31744)return 1/0;if(t===64512)return-1/0;if(t===32256)return NaN;const n=t>>10&31,s=t&1023;let i;return n===0?i=s*2**-24:n!==31?i=(s+1024)*2**(n-25):i=s===0?1/0:NaN,t&32768?-i:i}function RI(r){Fn.setFloat32(0,r,!1)}function $5(r,e){if(r.length-e<4)throw new Error(`${Ve} not enough data for float32`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,4).getFloat32(0,!1)}function bG(r){Fn.setFloat64(0,r,!1)}function PI(r,e){if(r.length-e<8)throw new Error(`${Ve} not enough data for float64`);const t=(r.byteOffset||0)+e;return new DataView(r.buffer,t,8).getFloat64(0,!1)}B5.compareTokens=_c.compareTokens;function mt(r,e,t){throw new Error(`${Ve} encountered invalid minor (${t}) for major ${r[e]>>>5}`)}function r2(r){return()=>{throw new Error(`${Ve} ${r}`)}}const _e=[];for(let r=0;r<=23;r++)_e[r]=mt;_e[24]=kW;_e[25]=IW;_e[26]=TW;_e[27]=RW;_e[28]=mt;_e[29]=mt;_e[30]=mt;_e[31]=mt;for(let r=32;r<=55;r++)_e[r]=mt;_e[56]=PW;_e[57]=DW;_e[58]=NW;_e[59]=OW;_e[60]=mt;_e[61]=mt;_e[62]=mt;_e[63]=mt;for(let r=64;r<=87;r++)_e[r]=LW;_e[88]=BW;_e[89]=MW;_e[90]=$W;_e[91]=UW;_e[92]=mt;_e[93]=mt;_e[94]=mt;_e[95]=r2("indefinite length bytes/strings are not supported");for(let r=96;r<=119;r++)_e[r]=VW;_e[120]=zW;_e[121]=HW;_e[122]=qW;_e[123]=KW;_e[124]=mt;_e[125]=mt;_e[126]=mt;_e[127]=r2("indefinite length bytes/strings are not supported");for(let r=128;r<=151;r++)_e[r]=WW;_e[152]=GW;_e[153]=YW;_e[154]=QW;_e[155]=XW;_e[156]=mt;_e[157]=mt;_e[158]=mt;_e[159]=JW;for(let r=160;r<=183;r++)_e[r]=ZW;_e[184]=eG;_e[185]=tG;_e[186]=rG;_e[187]=nG;_e[188]=mt;_e[189]=mt;_e[190]=mt;_e[191]=sG;for(let r=192;r<=215;r++)_e[r]=iG;_e[216]=oG;_e[217]=aG;_e[218]=cG;_e[219]=lG;_e[220]=mt;_e[221]=mt;_e[222]=mt;_e[223]=mt;for(let r=224;r<=243;r++)_e[r]=r2("simple values are not supported");_e[244]=mt;_e[245]=mt;_e[246]=mt;_e[247]=pG;_e[248]=r2("simple values are not supported");_e[249]=mG;_e[250]=yG;_e[251]=wG;_e[252]=mt;_e[253]=mt;_e[254]=mt;_e[255]=gG;const di=[];for(let r=0;r<24;r++)di[r]=new we(J.uint,r,1);for(let r=-1;r>=-24;r--)di[31-r]=new we(J.negint,r,1);di[64]=new we(J.bytes,new Uint8Array(0),1);di[96]=new we(J.string,"",1);di[128]=new we(J.array,0,1);di[160]=new we(J.map,0,1);di[244]=new we(J.false,!1,1);di[245]=new we(J.true,!0,1);di[246]=new we(J.null,null,1);function vG(r){switch(r.type){case J.false:return Ei([244]);case J.true:return Ei([245]);case J.null:return Ei([246]);case J.bytes:return r.value.length?void 0:Ei([64]);case J.string:return r.value===""?Ei([96]):void 0;case J.array:return r.value===0?Ei([128]):void 0;case J.map:return r.value===0?Ei([160]):void 0;case J.uint:return r.value<24?Ei([Number(r.value)]):void 0;case J.negint:if(r.value>=-24)return Ei([31-Number(r.value)])}}const EG={float64:!1,mapSorter:xG,quickEncodeToken:vG};function SG(){const r=[];return r[J.uint.major]=_c,r[J.negint.major]=P5,r[J.bytes.major]=t2,r[J.string.major]=jW,r[J.array.major]=D5,r[J.map.major]=N5,r[J.tag.major]=O5,r[J.float.major]=B5,r}const DI=SG(),ny=new CI;class Xp{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do if(t.obj===e)return!0;while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${$a} object contains circular references`);return new Xp(t,e)}}const po={null:new we(J.null,null),undefined:new we(J.undefined,void 0),true:new we(J.true,!0),false:new we(J.false,!1),emptyArray:new we(J.array,0),emptyMap:new we(J.map,0)},Xo={number(r,e,t,n){return!Number.isInteger(r)||!Number.isSafeInteger(r)?new we(J.float,r):r>=0?new we(J.uint,r):new we(J.negint,r)},bigint(r,e,t,n){return r>=BigInt(0)?new we(J.uint,r):new we(J.negint,r)},Uint8Array(r,e,t,n){return new we(J.bytes,r)},string(r,e,t,n){return new we(J.string,r)},boolean(r,e,t,n){return r?po.true:po.false},null(r,e,t,n){return po.null},undefined(r,e,t,n){return po.undefined},ArrayBuffer(r,e,t,n){return new we(J.bytes,new Uint8Array(r))},DataView(r,e,t,n){return new we(J.bytes,new Uint8Array(r.buffer,r.byteOffset,r.byteLength))},Array(r,e,t,n){if(!r.length)return t.addBreakTokens===!0?[po.emptyArray,new we(J.break)]:po.emptyArray;n=Xp.createCheck(n,r);const s=[];let i=0;for(const o of r)s[i++]=tp(o,t,n);return t.addBreakTokens?[new we(J.array,r.length),s,new we(J.break)]:[new we(J.array,r.length),s]},Object(r,e,t,n){const s=e!=="Object",i=s?r.keys():Object.keys(r),o=s?r.size:i.length;if(!o)return t.addBreakTokens===!0?[po.emptyMap,new we(J.break)]:po.emptyMap;n=Xp.createCheck(n,r);const a=[];let c=0;for(const l of i)a[c++]=[tp(l,t,n),tp(s?r.get(l):r[l],t,n)];return _G(a,t),t.addBreakTokens?[new we(J.map,o),a,new we(J.break)]:[new we(J.map,o),a]}};Xo.Map=Xo.Object;Xo.Buffer=Xo.Uint8Array;for(const r of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Xo[`${r}Array`]=Xo.DataView;function tp(r,e={},t){const n=yW(r),s=e&&e.typeEncoders&&e.typeEncoders[n]||Xo[n];if(typeof s=="function"){const o=s(r,n,e,t);if(o!=null)return o}const i=Xo[n];if(!i)throw new Error(`${$a} unsupported type: ${n}`);return i(r,n,e,t)}function _G(r,e){e.mapSorter&&r.sort(e.mapSorter)}function xG(r,e){const t=Array.isArray(r[0])?r[0][0]:r[0],n=Array.isArray(e[0])?e[0][0]:e[0];if(t.type!==n.type)return t.type.compare(n.type);const s=t.type.major,i=DI[s].compareTokens(t,n);return i===0&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function NI(r,e,t,n){if(Array.isArray(e))for(const s of e)NI(r,s,t,n);else t[e.type.major](r,e,n)}function OI(r,e,t){const n=tp(r,t);if(!Array.isArray(n)&&t.quickEncodeToken){const s=t.quickEncodeToken(n);if(s)return s;const i=e[n.type.major];if(i.encodedSize){const o=i.encodedSize(n,t),a=new CI(o);if(i(a,n,t),a.chunks.length!==1)throw new Error(`Unexpected error: pre-calculated length for ${n} was wrong`);return I5(a.chunks[0])}}return ny.reset(),NI(ny,n,e,t),ny.toBytes(!0)}function rp(r,e){return e=Object.assign({},EG,e),OI(r,DI,e)}const AG={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class CG{constructor(e,t={}){this._pos=0,this.data=e,this.options=t}pos(){return this._pos}done(){return this._pos>=this.data.length}next(){const e=this.data[this._pos];let t=di[e];if(t===void 0){const n=_e[e];if(!n)throw new Error(`${Ve} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const s=e&31;t=n(this.data,this._pos,s,this.options)}return this._pos+=t.encodedLength,t}}const Od=Symbol.for("DONE"),n2=Symbol.for("BREAK");function kG(r,e,t){const n=[];for(let s=0;s<r.value;s++){const i=Ld(e,t);if(i===n2){if(r.value===1/0)break;throw new Error(`${Ve} got unexpected break to lengthed array`)}if(i===Od)throw new Error(`${Ve} found array but not enough entries (got ${s}, expected ${r.value})`);n[s]=i}return n}function IG(r,e,t){const n=t.useMaps===!0,s=n?void 0:{},i=n?new Map:void 0;for(let o=0;o<r.value;o++){const a=Ld(e,t);if(a===n2){if(r.value===1/0)break;throw new Error(`${Ve} got unexpected break to lengthed map`)}if(a===Od)throw new Error(`${Ve} found map but not enough entries (got ${o} [no key], expected ${r.value})`);if(n!==!0&&typeof a!="string")throw new Error(`${Ve} non-string keys not supported (got ${typeof a})`);if(t.rejectDuplicateMapKeys===!0&&(n&&i.has(a)||!n&&a in s))throw new Error(`${Ve} found repeat map key "${a}"`);const c=Ld(e,t);if(c===Od)throw new Error(`${Ve} found map but not enough entries (got ${o} [no value], expected ${r.value})`);n?i.set(a,c):s[a]=c}return n?i:s}function Ld(r,e){if(r.done())return Od;const t=r.next();if(t.type===J.break)return n2;if(t.type.terminal)return t.value;if(t.type===J.array)return kG(t,r,e);if(t.type===J.map)return IG(t,r,e);if(t.type===J.tag){if(e.tags&&typeof e.tags[t.value]=="function"){const n=Ld(r,e);return e.tags[t.value](n)}throw new Error(`${Ve} tag not supported (${t.value})`)}throw new Error("unsupported")}function TG(r,e){if(!(r instanceof Uint8Array))throw new Error(`${Ve} data to decode must be a Uint8Array`);e=Object.assign({},AG,e);const t=e.tokenizer||new CG(r,e),n=Ld(t,e);if(n===Od)throw new Error(`${Ve} did not find any content to decode`);if(n===n2)throw new Error(`${Ve} got unexpected break`);return[n,r.subarray(t.pos())]}function xo(r,e){const[t,n]=TG(r,e);if(n.length>0)throw new Error(`${Ve} too many terminals, data makes no sense`);return t}const RG=8,U5=1024*1024*4;let PG=class extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MSG_LENGTH"};class LI extends Error{name="InvalidDataLengthError";code="ERR_MSG_DATA_TOO_LONG"}class DG extends Error{name="InvalidDataLengthLengthError";code="ERR_MSG_LENGTH_TOO_LONG"}let I9=class extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"};function BI(r){return r[Symbol.asyncIterator]!=null}function MI(r,e){if(r.byteLength>e)throw new LI("Message length too long")}const s2=r=>{const e=ht(r),t=Dn(e);return Ys(r,t),s2.bytes=e,t};s2.bytes=0;function Bd(r,e){e=e??{};const t=e.lengthEncoder??s2,n=e?.maxDataLength??U5;function*s(i){MI(i,n);const o=t(i.byteLength);o instanceof Uint8Array?yield o:yield*o,i instanceof Uint8Array?yield i:yield*i}return BI(r)?(async function*(){for await(const i of r)yield*s(i)})():(function*(){for(const i of r)yield*s(i)})()}Bd.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??s2,n=e?.maxDataLength??U5;return MI(r,n),new ze(t(r.byteLength),r)};var wa;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(wa||(wa={}));const F5=r=>{const e=Ts(r);return F5.bytes=ht(e),e};F5.bytes=0;function Jp(r,e){const t=new ze;let n=wa.LENGTH,s=-1;const i=e?.lengthDecoder??F5,o=e?.maxLengthLength??RG,a=e?.maxDataLength??U5;function*c(){for(;t.byteLength>0;){if(n===wa.LENGTH)try{if(s=i(t),s<0)throw new PG("Invalid message length");if(s>a)throw new LI("Message length too long");const l=i.bytes;t.consume(l),e?.onLength!=null&&e.onLength(s),n=wa.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new DG("Message length length too long");break}throw l}if(n===wa.DATA){if(t.byteLength<s)break;const l=t.sublist(0,s);t.consume(s),e?.onData!=null&&e.onData(l),yield l,n=wa.LENGTH}}}return BI(r)?(async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new I9("Unexpected end of input")})():(function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new I9("Unexpected end of input")})()}Jp.fromReader=(r,e)=>{let t=1;const n=(async function*(){for(;;)try{const{done:i,value:o}=await r.next(t);if(i===!0)return;o!=null&&(yield o)}catch(i){if(i.code==="ERR_UNDER_READ")return{done:!0,value:null};throw i}finally{t=1}})();return Jp(n,{...e??{},onLength:i=>{t=i}})};const T9=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},NG=new WeakMap;function OG({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:s}={})=>{if(s?.aborted)return Promise.reject(T9());let i,o,a;const c=r??clearTimeout,l=()=>{c(i),a(T9())},u=()=>{s&&s.removeEventListener("abort",l)},h=new Promise((d,f)=>{o=()=>{u(),d(n)},a=f,i=(e??setTimeout)(o,t)});return s&&s.addEventListener("abort",l,{once:!0}),NG.set(h,()=>{c(i),i=null,o()}),h}}const LG=OG();class Jo extends Qo{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}let BG=class extends Qo{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}};class $I{memoryStorage;points;duration;blockDuration;keyPrefix;constructor(e={}){this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new MG}consume(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(s,t,i);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(s,o.consumedPoints,this.blockDuration)),new XK("Rate limit exceeded",o);return o}penalty(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(s,t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const s=this.getKey(e),i=this._getKeySecDuration(n),o=this.memoryStorage.incrby(s,-t,i);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,s=this.points+1;return this.memoryStorage.set(this.getKey(e),s,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:s,isFirstInDuration:!1}}set(e,t,n=0){const s=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return e?.customDuration!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class MG{storage;constructor(){this.storage=new Map}incrby(e,t,n){const s=this.storage.get(e);if(s!=null){const i=s.expiresAt!=null?s.expiresAt.getTime()-new Date().getTime():-1;return s.expiresAt==null||i>0?(s.value+=t,{remainingPoints:0,msBeforeNext:i,consumedPoints:s.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const s=n*1e3,i=this.storage.get(e);i!=null&&clearTimeout(i.timeoutId);const o={value:t,expiresAt:s>0?new Date(Date.now()+s):void 0};return this.storage.set(e,o),s>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},s),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:s===0?-1:s,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function V5(r,e,t){let n,s,i=!1;function o(){const l={signal:s.signal};if(t?.timeout!=null){const u=xt([s.signal,AbortSignal.timeout(t.timeout)]);l.signal=u}i=!0,Promise.resolve().then(async()=>{await r(l)}).catch(()=>{}).finally(()=>{i=!1,!s.signal.aborted&&(n=setTimeout(o,e))})}const a=Rd(o,t?.debounce??100);let c=!1;return{setInterval:l=>{e!==l&&(e=l,n!=null&&(clearTimeout(n),n=setTimeout(o,e)))},setTimeout:l=>{t??={},t.timeout=l},run:()=>{i||(clearTimeout(n),a())},start:()=>{c||(c=!0,s=new AbortController,s.signal,t?.runImmediately===!0?queueMicrotask(()=>{o()}):n=setTimeout(o,e))},stop:()=>{clearTimeout(n),s?.abort(),c=!1}}}class $G extends Map{metric;constructor(e){super();const{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function ks(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new $G({name:e,metrics:t}):n=new Map,n}const _i="/",UI=new TextEncoder().encode(_i),d1=UI[0];class Pt{_buf;constructor(e,t){if(typeof e=="string")this._buf=le(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==d1)throw new Error("Invalid key")}toString(e="utf8"){return he(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Pt(e.join(_i))}static random(){return new Pt(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Pt(e):typeof e.uint8Array=="function"?new Pt(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=UI),this._buf[0]!==d1){const e=new Uint8Array(this._buf.byteLength+1);e.fill(d1,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===d1;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let s=0;s<t.length;s++){if(n.length<s+1)return!1;const i=t[s],o=n[s];if(i<o)return!0;if(i>o)return!1}return t.length<n.length}reverse(){return Pt.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(_i).slice(1)}type(){return UG(this.baseNamespace())}name(){return FG(this.baseNamespace())}instance(e){return new Pt(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(_i)||(e+=_i),e+=this.type(),new Pt(e)}parent(){const e=this.list();return e.length===1?new Pt(_i):new Pt(e.slice(0,-1).join(_i))}child(e){return this.toString()===_i?e:e.toString()===_i?this:new Pt(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Pt.withNamespaces([...this.namespaces(),...VG(e.map(t=>t.namespaces()))])}}function UG(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function FG(r){const e=r.split(":");return e[e.length-1]}function VG(r){return[].concat(...r)}function zG(r){return r[Symbol.asyncIterator]!=null}function Gr(r){if(zG(r))return(async()=>{let n=new Uint8Array(0);for await(const s of r)n=Wt([n,s],n.length+s.length);return n})();const e=[];let t=0;for(const n of r)e.push(n),t+=n.byteLength;return Wt(e,t)}function f1({enumerable:r=!0,configurable:e=!1}={}){return{enumerable:r,configurable:e,writable:!1}}function*HG(r,e){if(e!=null&&typeof e=="object")if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t],i=Ee.asCID(n);i!=null?yield[s.join("/"),i]:typeof n=="object"&&(yield*L3(n,s))}else{const t=Ee.asCID(e);t!=null?yield[r.join("/"),t]:yield*L3(e,r)}}function*L3(r,e){if(r==null||r instanceof Uint8Array)return;const t=Ee.asCID(r);t!=null&&(yield[e.join("/"),t]);for(const[n,s]of Object.entries(r)){const i=[...e,n];yield*HG(i,s)}}function*qG(r,e){if(Array.isArray(e))for(const[t,n]of e.entries()){const s=[...r,t];yield s.join("/"),typeof n=="object"&&Ee.asCID(n)==null&&(yield*B3(n,s))}else yield*B3(e,r)}function*B3(r,e){if(!(r==null||typeof r!="object"))for(const[t,n]of Object.entries(r)){const s=[...e,t];yield s.join("/"),n!=null&&!(n instanceof Uint8Array)&&typeof n=="object"&&Ee.asCID(n)==null&&(yield*qG(s,n))}}function KG(r,e){let t=r;for(const[n,s]of e.entries()){if(t=t[s],t==null)throw new Error(`Object has no property at ${e.slice(0,n+1).map(o=>`[${JSON.stringify(o)}]`).join("")}`);const i=Ee.asCID(t);if(i!=null)return{value:i,remaining:e.slice(n+1).join("/")}}return{value:t}}let jG=class{cid;bytes;value;asBlock;constructor({cid:e,bytes:t,value:n}){if(e==null||t==null||typeof n>"u")throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:f1(),bytes:f1(),value:f1(),asBlock:f1()})}links(){return L3(this.value,[])}tree(){return B3(this.value,[])}get(e="/"){return KG(this.value,e.split("/").filter(Boolean))}};function WG({bytes:r,cid:e,value:t,codec:n}){const s=t!==void 0?t:n?.decode(r);if(s===void 0)throw new Error('Missing required argument, must either provide "value" or "codec"');return new jG({cid:e,bytes:r,value:s})}class GG extends Error{static name="AlreadyPinnedError";name="AlreadyPinnedError"}class R9 extends Error{static name="BlockPinnedError";name="BlockPinnedError"}class YG extends Error{static name="InvalidDatastoreVersion";name="InvalidDatastoreVersion"}const FI="/pin/",P9="/pinned-block/",M3=Oo,D9=1;function p1(r){return r.version===0&&(r=r.toV1()),new Pt(`${FI}${r.toString(M3)}`)}class QG{datastore;blockstore;getCodec;constructor(e,t,n){this.datastore=e,this.blockstore=t,this.getCodec=n}async*add(e,t={}){const n=p1(e);if(await this.datastore.has(n))throw new GG("Already pinned");const s=Math.round(t.depth??1/0);if(s<0)throw new ue("Depth must be greater than or equal to 0");const i=new Qo({concurrency:D9});for await(const a of this.#e(e,i,{...t,depth:s}))await this.#t(a,c=>c.pinnedBy.find(l=>Qe(l,e.bytes))!=null?!1:(c.pinCount++,c.pinnedBy.push(e.bytes),!0),t),yield a;const o={depth:s,metadata:t.metadata??{}};await this.datastore.put(n,rp(o),t)}async*#e(e,t,n){if(n.depth===-1)return;const s=await this.getCodec(e.code),i=await Gr(this.blockstore.get(e,n)),o=WG({bytes:i,cid:e,codec:s});yield e;for(const[,a]of o.links())yield*await t.add(async()=>this.#e(a,t,{...n,depth:n.depth-1}))}async#t(e,t,n){const s=new Pt(`${P9}${M3.encode(e.multihash.bytes)}`);let i={pinCount:0,pinnedBy:[]};try{i=xo(await this.datastore.get(s,n))}catch(a){if(a.name!=="NotFoundError")throw a}if(t(i)){if(i.pinCount===0&&await this.datastore.has(s)){await this.datastore.delete(s);return}await this.datastore.put(s,rp(i),n),n.onProgress?.(new Pe("helia:pin:add",e))}}async*rm(e,t={}){const n=p1(e),s=await this.datastore.get(n,t),i=xo(s);await this.datastore.delete(n,t);const o=new Qo({concurrency:D9});for await(const a of this.#e(e,o,{...t,depth:i.depth}))await this.#t(a,c=>(c.pinCount--,c.pinnedBy=c.pinnedBy.filter(l=>Qe(l,e.bytes)),!0),{...t,depth:i.depth}),yield a}async*ls(e={}){for await(const{key:t,value:n}of this.datastore.query({prefix:FI+(e.cid!=null?`${e.cid.toString(Oo)}`:"")},e)){const s=Ee.parse(t.toString().substring(5),Oo),i=xo(n);yield{cid:s,...i}}}async isPinned(e,t={}){const n=new Pt(`${P9}${M3.encode(e.multihash.bytes)}`);return this.datastore.has(n,t)}async get(e,t){const n=p1(e),s=await this.datastore.get(n,t);return xo(s)}async setMetadata(e,t,n){const s=p1(e),i=await this.datastore.get(s,n),o=xo(i);o.metadata=t??{},await this.datastore.put(s,rp(o),n)}}const XG=1,JG=5;class ZG extends Error{static name="InsufficientProvidersError";constructor(e="Insufficient providers found"){super(e),this.name="InsufficientProvidersError"}}class g1 extends Error{static name="NoRoutersAvailableError";constructor(e="No routers available"){super(e),this.name="NoRoutersAvailableError"}}class eY extends Error{static name="UnknownHashAlgorithmError";constructor(e="Unknown hash algorithm"){super(e),this.name="UnknownHashAlgorithmError"}}class tY extends Error{static name="UnknownCodecError";constructor(e="Unknown codec"){super(e),this.name="UnknownCodecError"}}const rY=5;class nY{log;routers;providerLookupConcurrency;constructor(e,t){this.log=e.logger.forComponent("helia:routing"),this.routers=t.routers??[],this.providerLookupConcurrency=t.providerLookupConcurrency??rY,this.findProviders=e.metrics?.traceFunction("helia.routing.findProviders",this.findProviders.bind(this),{optionsIndex:1})??this.findProviders,this.provide=e.metrics?.traceFunction("helia.routing.provide",this.provide.bind(this),{optionsIndex:1})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("helia.routing.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1})??this.cancelReprovide,this.put=e.metrics?.traceFunction("helia.routing.put",this.put.bind(this),{optionsIndex:2})??this.put,this.get=e.metrics?.traceFunction("helia.routing.get",this.get.bind(this),{optionsIndex:1})??this.get,this.findPeer=e.metrics?.traceFunction("helia.routing.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("helia.routing.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async start(){await oi(...this.routers)}async stop(){await eo(...this.routers)}async*findProviders(e,t={}){if(this.routers.length===0)throw new g1("No content routers available");const n=new Jo({concurrency:this.providerLookupConcurrency});for await(const s of Bo(n.toGenerator(),...fa(this.routers,"findProviders").map(i=>i.findProviders(e,t))))if(s!=null){if(s.multiaddrs.length===0){if(n.find(s.id)!=null)continue;n.add(async()=>{try{const i=await this.findPeer(s.id,t);return i.multiaddrs.length===0?null:i}catch(i){return this.log.error("could not load multiaddrs for peer %p",s.id,i),null}},{peerId:s.id,signal:t.signal}).catch(i=>{this.log.error("could not load multiaddrs for peer %p",s.id,i)})}yield s}}async provide(e,t={}){if(this.routers.length===0)throw new g1("No content routers available");await Promise.all(fa(this.routers,"provide").map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){await Promise.all(fa(this.routers,"cancelReprovide").map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){await Promise.all(fa(this.routers,"put").map(async s=>{await s.put(e,t,n)}))}async get(e,t){return Promise.any(fa(this.routers,"get").map(async n=>n.get(e,t)))}async findPeer(e,t){if(this.routers.length===0)throw new g1("No peer routers available");const n=this,s=Bo(...fa(this.routers,"findPeer").map(i=>(async function*(){try{yield await i.findPeer(e,t)}catch(o){n.log.error(o)}})()));for await(const i of s)if(i!=null)return i;throw new dn("Could not find peer in routing")}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new g1("No peer routers available");for await(const n of Bo(...fa(this.routers,"getClosestPeers").map(s=>s.getClosestPeers(e,t))))n!=null&&(yield n)}}function fa(r,e){return r.filter(t=>t[e]!=null)}let Ul=class extends Error{static name="AbortError";name="AbortError";constructor(e="The operation was aborted",...t){super(e,...t)}};async function ko(r,e,t,n){const s=new Ul(n?.errorMessage);n?.errorCode!=null&&(s.code=n.errorCode);const i=n?.errorEvent??"error";return t?.aborted===!0?Promise.reject(s):new Promise((o,a)=>{function c(){iy(t,"abort",h),iy(r,e,l),iy(r,i,u)}const l=d=>{try{if(n?.filter?.(d)===!1)return}catch(f){c(),a(f);return}c(),o(d)},u=d=>{if(c(),d instanceof Error){a(d);return}a(d.detail??n?.error??new Error(`The "${n?.errorEvent}" event was emitted but the event had no '.detail' field. Pass an 'error' option to race-event to change this message.`))},h=()=>{c(),a(s)};sy(t,"abort",h),sy(r,e,l),sy(r,i,u)})}function sy(r,e,t){r!=null&&(VI(r)?r.addEventListener(e,t):r.addListener(e,t))}function iy(r,e,t){r!=null&&(VI(r)?r.removeEventListener(e,t):r.removeListener(e,t))}function VI(r){return typeof r.addEventListener=="function"&&typeof r.removeEventListener=="function"}class sY extends Error{static name="QueueFullError";constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}let N9=class extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}};async function iY(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new N9(t?.errorMessage,t?.errorCode,t?.errorName));let n;const s=new N9(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((i,o)=>{n=()=>{o(s)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}class oY{deferred;signal;constructor(e){this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),this.signal?.addEventListener("abort",this.onAbort)}onAbort(){this.deferred.reject(this.signal?.reason??new Ul)}cleanup(){this.signal?.removeEventListener("abort",this.onAbort)}}function aY(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class cY{id;fn;options;recipients;status;timeline;controller;constructor(e,t){this.id=aY(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>t&&n.signal?.aborted===!0,!0)&&(this.controller.abort(new Ul),this.cleanup())}async join(e={}){const t=new oY(e.signal);return this.recipients.push(t),e.signal?.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await iY(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{e.cleanup(),e.signal?.removeEventListener("abort",this.onAbort)})}}function O9(r,e){let t;const n=function(){const s=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(s,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}class L9 extends Nt{concurrency;maxSize;queue;pending;sort;autoStart;constructor(e={}){super(),this.concurrency=e.concurrency??Number.POSITIVE_INFINITY,this.maxSize=e.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=e.autoStart??!0,this.sort=e.sort,this.queue=[],this.emitEmpty=O9(this.emitEmpty.bind(this),1),this.emitIdle=O9(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let e;for(const t of this.queue)if(t.status==="queued"){e=t;break}return e==null?!1:(this.safeDispatchEvent("active"),this.pending++,e.run().finally(()=>{for(let t=0;t<this.queue.length;t++)if(this.queue[t]===e){this.queue.splice(t,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(e){this.queue.push(e),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(e,t){if(t?.signal?.throwIfAborted(),this.size===this.maxSize)throw new sY;const n=new cY(e,t);return this.enqueue(n),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),n.join(t).then(s=>(this.safeDispatchEvent("success",{detail:{job:n,result:s}}),s)).catch(s=>{if(n.status==="queued"){for(let i=0;i<this.queue.length;i++)if(this.queue[i]===n){this.queue.splice(i,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:n,error:s}}),s})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(e=>{e.abort(new Ul)}),this.clear()}async onEmpty(e){this.size!==0&&await ko(this,"empty",e?.signal)}async onSizeLessThan(e,t){this.size<e||await ko(this,"next",t?.signal,{filter:()=>this.size<e})}async onIdle(e){this.pending===0&&this.size===0||await ko(this,"idle",e?.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(e){e?.signal?.throwIfAborted();const t=to({objectMode:!0}),n=c=>{c!=null?this.abort():this.clear(),t.end(c)},s=c=>{c.detail!=null&&t.push(c.detail.result)},i=c=>{n(c.detail.error)},o=()=>{n()},a=()=>{n(new Ul("Queue aborted"))};this.addEventListener("success",s),this.addEventListener("failure",i),this.addEventListener("idle",o),e?.signal?.addEventListener("abort",a);try{yield*t}finally{this.removeEventListener("success",s),this.removeEventListener("failure",i),this.removeEventListener("idle",o),e?.signal?.removeEventListener("abort",a),n()}}}const zI="lock:worker:request-read",HI="lock:worker:abort-read-request",qI="lock:worker:release-read",KI="lock:master:grant-read",jI="lock:master:error-read",WI="lock:worker:request-write",GI="lock:worker:abort-write-request",YI="lock:worker:release-write",QI="lock:master:grant-write",XI="lock:master:error-write",JI="lock:worker:finalize",ZI="mortice",lY={singleProcess:!1},B9=(r,e,t,n,s,i,o,a,c)=>l=>{if(l.data==null)return;const u={type:l.data.type,name:l.data.name,identifier:l.data.identifier};u.type===s&&r.safeDispatchEvent(t,{detail:{name:u.name,identifier:u.identifier,handler:async()=>{e.postMessage({type:c,name:u.name,identifier:u.identifier}),await new Promise(h=>{const d=f=>{if(f?.data==null)return;const g={type:f.data.type,name:f.data.name,identifier:f.data.identifier};g.type===a&&g.identifier===u.identifier&&(e.removeEventListener("message",d),h())};e.addEventListener("message",d)})},onError:h=>{e.postMessage({type:o,name:u.name,identifier:u.identifier,error:{message:h.message,name:h.name,stack:h.stack}})}}}),u.type===i&&r.safeDispatchEvent(n,{detail:{name:u.name,identifier:u.identifier}}),u.type===JI&&r.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})},uY=(r=10)=>Math.random().toString().substring(2,r+2);class hY{name;channel;constructor(e){this.name=e,this.channel=new BroadcastChannel(ZI)}readLock(e){return this.sendRequest(zI,HI,KI,jI,qI,e)}writeLock(e){return this.sendRequest(WI,GI,QI,XI,YI,e)}finalize(){this.channel.postMessage({type:JI,name:this.name}),this.channel.close()}async sendRequest(e,t,n,s,i,o){o?.signal?.throwIfAborted();const a=uY();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((c,l)=>{const u=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};o?.signal?.addEventListener("abort",u,{once:!0});const h=d=>{if(d.data?.identifier===a&&(d.data?.type===n&&(this.channel.removeEventListener("message",h),o?.signal?.removeEventListener("abort",u),c(()=>{this.channel.postMessage({type:i,identifier:a,name:this.name})})),d.data.type===s)){this.channel.removeEventListener("message",h),o?.signal?.removeEventListener("abort",u);const f=new Error;d.data.error!=null&&(f.message=d.data.error.message,f.name=d.data.error.name,f.stack=d.data.error.stack),l(f)}};this.channel.addEventListener("message",h)})}}const dY=r=>{if(r=Object.assign({},lY,r),!!globalThis.document||r.singleProcess){const t=new BroadcastChannel(ZI),n=new Nt;return t.addEventListener("message",B9(n,t,"requestReadLock","abortReadLockRequest",zI,HI,jI,qI,KI)),t.addEventListener("message",B9(n,t,"requestWriteLock","abortWriteLockRequest",WI,GI,XI,YI,QI)),n}return new hY(r.name)},xa=new Map;let Ku;function eT(r){return typeof r?.readLock=="function"&&typeof r?.writeLock=="function"}function fY(r){if(Ku==null&&(Ku=dY(r),!eT(Ku))){const e=Ku;e.addEventListener("requestReadLock",t=>{const n=t.detail.name,s=t.detail.identifier,i=xa.get(n);if(i==null)return;const o=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==s||o.abort()};e.addEventListener("abortReadLockRequest",a),i.readLock({signal:o.signal}).then(async c=>{await t.detail.handler().finally(()=>{c()})}).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{const n=t.detail.name,s=t.detail.identifier,i=xa.get(n);if(i==null)return;const o=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==s||o.abort()};e.addEventListener("abortWriteLockRequest",a),i.writeLock({signal:o.signal}).then(async c=>{await t.detail.handler().finally(()=>{c()})}).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{const n=t.detail.name,s=xa.get(n);s?.finalize()})}return Ku}async function oy(r,e){let t,n;const s=new Promise((o,a)=>{t=o,n=a}),i=()=>{n(new Ul)};return e?.signal?.addEventListener("abort",i,{once:!0}),r.add(async()=>{await new Promise(o=>{t(()=>{e?.signal?.removeEventListener("abort",i),o()})})},{signal:e?.signal}).catch(o=>{n(o)}),s}const pY=(r,e)=>{let t=xa.get(r);if(t!=null)return t;const n=fY(e);if(eT(n))return t=n,xa.set(r,t),t;const s=new L9({concurrency:1});let i;return t={async readLock(o){if(i!=null)return oy(i,o);i=new L9({concurrency:e.concurrency,autoStart:!1});const a=i,c=oy(i,o);return s.add(async()=>{a.start(),await a.onIdle().then(()=>{i===a&&(i=null)})}),c},async writeLock(o){return i=null,oy(s,o)},finalize:()=>{xa.delete(r)},queue:s},xa.set(r,t),e.autoFinalize===!0&&s.addEventListener("idle",()=>{t.finalize()},{once:!0}),t},gY={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function tT(r){const e=Object.assign({},gY,r);return pY(e.name,e)}class mY{lock;child;pins;started;constructor(e,t,n={}){this.child=e,this.pins=t,this.lock=tT({singleProcess:n.holdGcLock}),this.started=!1}isStarted(){return this.started}async start(){await oi(this.child),this.started=!0}async stop(){await eo(this.child),this.started=!1}unwrap(){return this.child}async put(e,t,n={}){n?.signal?.throwIfAborted();const s=await this.lock.readLock();try{return await this.child.put(e,t,n)}finally{s()}}async*putMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.putMany(e,t)}finally{n()}}async*get(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.get(e,t)}finally{n()}}async*getMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{yield*this.child.getMany(e,t)}finally{n()}}async delete(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.writeLock();try{if(await this.pins.isPinned(e))throw new R9("Block was pinned - please unpin and try again");await this.child.delete(e,t)}finally{n()}}async*deleteMany(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.writeLock();try{const s=this;yield*this.child.deleteMany((async function*(){for await(const i of e){if(await s.pins.isPinned(i))throw new R9("Block was pinned - please unpin and try again");yield i}})(),t)}finally{n()}}async has(e,t={}){t?.signal?.throwIfAborted();const n=await this.lock.readLock();try{return await this.child.has(e,t)}finally{n()}}async*getAll(e={}){e?.signal?.throwIfAborted();const t=await this.lock.readLock();try{yield*this.child.getAll(e)}finally{t()}}createSession(e,t){return t?.signal?.throwIfAborted(),this.child.createSession(e,t)}}const ay=new Pt("/version"),M9=1;async function yY(r){if(!await r.has(ay)){await r.put(ay,le(`${M9}`));return}const e=await r.get(ay),t=he(e);if(parseInt(t,10)!==M9)throw new YG("Invalid datastore version, a datastore migration may be required")}const rT=42;function nT(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function wY(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=Ee.asCID(r);if(!e)return null;const t=new Uint8Array(e.bytes.byteLength+1);return t.set(e.bytes,1),[new we(J.tag,rT),new we(J.bytes,t)]}function bY(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function vY(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}function EY(r){for(const e of r.keys())if(typeof e!="string"||e.length===0)throw new Error("Non-string Map keys are not supported by the IPLD Data Model and cannot be encoded");return null}const $3={float64:!0,typeEncoders:{Map:EY,Object:wY,undefined:bY,number:vY}},SY={...$3,typeEncoders:{...$3.typeEncoders}};function _Y(r){if(r[0]!==0)throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Ee.decode(r.subarray(1))}const Zp={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};Zp.tags[rT]=_Y;const xY={...Zp,tags:Zp.tags.slice()},AY="dag-cbor",z5=113,CY=r=>rp(r,$3),sT=r=>xo(nT(r),Zp),kY=Object.freeze(Object.defineProperty({__proto__:null,code:z5,decode:sT,decodeOptions:xY,encode:CY,encodeOptions:SY,name:AY,toByteView:nT},Symbol.toStringTag,{value:"Module"}));class IY extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===J.array&&(t.elements++,t.elements!==1&&e.push([44])),t.type===J.map&&(t.elements++,t.elements!==1&&(t.elements%2===1?e.push([44]):e.push([58]))))}[J.uint.major](e,t){this.prefix(e);const n=String(t.value),s=[];for(let i=0;i<n.length;i++)s[i]=n.charCodeAt(i);e.push(s)}[J.negint.major](e,t){this[J.uint.major](e,t)}[J.bytes.major](e,t){throw new Error(`${$a} unsupported type: Uint8Array`)}[J.string.major](e,t){this.prefix(e);const n=xI(JSON.stringify(t.value));e.push(n.length>32?I5(n):n)}[J.array.major](e,t){this.prefix(e),this.inRecursive.push({type:J.array,elements:0}),e.push([91])}[J.map.major](e,t){this.prefix(e),this.inRecursive.push({type:J.map,elements:0}),e.push([123])}[J.tag.major](e,t){}[J.float.major](e,t){if(t.type.name==="break"){const o=this.inRecursive.pop();if(o){if(o.type===J.array)e.push([93]);else if(o.type===J.map)e.push([125]);else throw new Error("Unexpected recursive type; this should not happen!");return}throw new Error("Unexpected break; this should not happen!")}if(t.value===void 0)throw new Error(`${$a} unsupported type: undefined`);if(this.prefix(e),t.type.name==="true"){e.push([116,114,117,101]);return}else if(t.type.name==="false"){e.push([102,97,108,115,101]);return}else if(t.type.name==="null"){e.push([110,117,108,108]);return}const n=String(t.value),s=[];let i=!1;for(let o=0;o<n.length;o++)s[o]=n.charCodeAt(o),!i&&(s[o]===46||s[o]===101||s[o]===69)&&(i=!0);i||(s.push(46),s.push(48)),e.push(s)}}function TY(r,e){if(Array.isArray(r[0])||Array.isArray(e[0]))throw new Error(`${$a} complex map keys are not supported`);const t=r[0],n=e[0];if(t.type!==J.string||n.type!==J.string)throw new Error(`${$a} non-string map keys are not supported`);if(t<n)return-1;if(t>n)return 1;throw new Error(`${$a} unexpected duplicate map keys, this is not supported`)}const RY={addBreakTokens:!0,mapSorter:TY};function PY(r,e){return e=Object.assign({},RY,e),OI(r,new IY,e)}class iT{constructor(e,t={}){this._pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}pos(){return this._pos}done(){return this._pos>=this.data.length}ch(){return this.data[this._pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();for(;e===32||e===9||e===13||e===10;)e=this.data[++this._pos]}expect(e){if(this.data.length-this._pos<e.length)throw new Error(`${Ve} unexpected end of input at position ${this._pos}`);for(let t=0;t<e.length;t++)if(this.data[this._pos++]!==e[t])throw new Error(`${Ve} unexpected token at position ${this._pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this._pos;let t=!1,n=!1;const s=a=>{for(;!this.done();){const c=this.ch();if(a.includes(c))this._pos++;else break}};if(this.ch()===45&&(t=!0,this._pos++),this.ch()===48)if(this._pos++,this.ch()===46)this._pos++,n=!0;else return new we(J.uint,0,this._pos-e);if(s([48,49,50,51,52,53,54,55,56,57]),t&&this._pos===e+1)throw new Error(`${Ve} unexpected token at position ${this._pos}`);if(!this.done()&&this.ch()===46){if(n)throw new Error(`${Ve} unexpected token at position ${this._pos}`);n=!0,this._pos++,s([48,49,50,51,52,53,54,55,56,57])}!this.done()&&(this.ch()===101||this.ch()===69)&&(n=!0,this._pos++,!this.done()&&(this.ch()===43||this.ch()===45)&&this._pos++,s([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(e,this._pos)),o=parseFloat(i);return n?new we(J.float,o,this._pos-e):this.options.allowBigInt!==!0||Number.isSafeInteger(o)?new we(o>=0?J.uint:J.negint,o,this._pos-e):new we(o>=0?J.uint:J.negint,BigInt(i),this._pos-e)}parseString(){if(this.ch()!==34)throw new Error(`${Ve} unexpected character at position ${this._pos}; this shouldn't happen`);this._pos++;for(let i=this._pos,o=0;i<this.data.length&&o<65536;i++,o++){const a=this.data[i];if(a===92||a<32||a>=128)break;if(a===34){const c=String.fromCharCode.apply(null,this.data.subarray(this._pos,i));return this._pos=i+1,new we(J.string,c,o)}}const e=this._pos,t=[],n=()=>{if(this._pos+4>=this.data.length)throw new Error(`${Ve} unexpected end of unicode escape sequence at position ${this._pos}`);let i=0;for(let o=0;o<4;o++){let a=this.ch();if(a>=48&&a<=57)a-=48;else if(a>=97&&a<=102)a=a-97+10;else if(a>=65&&a<=70)a=a-65+10;else throw new Error(`${Ve} unexpected unicode escape character at position ${this._pos}`);i=i*16+a,this._pos++}return i},s=()=>{const i=this.ch();let o=null,a=i>239?4:i>223?3:i>191?2:1;if(this._pos+a>this.data.length)throw new Error(`${Ve} unexpected unicode sequence at position ${this._pos}`);let c,l,u,h;switch(a){case 1:i<128&&(o=i);break;case 2:c=this.data[this._pos+1],(c&192)===128&&(h=(i&31)<<6|c&63,h>127&&(o=h));break;case 3:c=this.data[this._pos+1],l=this.data[this._pos+2],(c&192)===128&&(l&192)===128&&(h=(i&15)<<12|(c&63)<<6|l&63,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:c=this.data[this._pos+1],l=this.data[this._pos+2],u=this.data[this._pos+3],(c&192)===128&&(l&192)===128&&(u&192)===128&&(h=(i&15)<<18|(c&63)<<12|(l&63)<<6|u&63,h>65535&&h<1114112&&(o=h))}o===null?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|o&1023),t.push(o),this._pos+=a};for(;!this.done();){const i=this.ch();let o;switch(i){case 92:if(this._pos++,this.done())throw new Error(`${Ve} unexpected string termination at position ${this._pos}`);switch(o=this.ch(),this._pos++,o){case 34:case 39:case 92:case 47:t.push(o);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${Ve} unexpected string escape character at position ${this._pos}`)}break;case 34:return this._pos++,new we(J.string,AI(t),this._pos-e);default:if(i<32)throw new Error(`${Ve} invalid control character at position ${this._pos}`);i<128?(t.push(i),this._pos++):s()}}throw new Error(`${Ve} unexpected end of string at position ${this._pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this._pos++,new we(J.map,1/0,1);case 91:return this.modeStack.push("array-start"),this._pos++,new we(J.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new we(J.null,null,4);case 102:return this.expect([102,97,108,115,101]),new we(J.false,!1,5);case 116:return this.expect([116,114,117,101]),new we(J.true,!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Ve} unexpected character at position ${this._pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":{if(this.modeStack.pop(),this.ch()===93)return this._pos++,this.skipWhitespace(),new we(J.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ve} unexpected character at position ${this._pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue()}case"array-start":return this.modeStack.pop(),this.ch()===93?(this._pos++,this.skipWhitespace(),new we(J.break,void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(this.ch()===125)return this.modeStack.pop(),this._pos++,this.skipWhitespace(),new we(J.break,void 0,1);if(this.ch()!==44)throw new Error(`${Ve} unexpected character at position ${this._pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this._pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),this.ch()===125)return this._pos++,this.skipWhitespace(),new we(J.break,void 0,1);const e=this.parseString();if(this.skipWhitespace(),this.ch()!==58)throw new Error(`${Ve} unexpected character at position ${this._pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this._pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Ve} unexpected parse state at position ${this._pos}; this shouldn't happen`)}}}function DY(r,e){return e=Object.assign({tokenizer:new iT(r,e)},e),xo(r,e)}function NY(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}function OY(r){if(r.asCID!==r&&r["/"]!==r.bytes)return null;const e=Ee.asCID(r);if(!e)return null;const t=e.toString();return[new we(J.map,1/0,1),new we(J.string,"/",1),new we(J.string,t,t.length),new we(J.break,void 0,1)]}function e0(r){const e=gn.encode(r).slice(1);return[new we(J.map,1/0,1),new we(J.string,"/",1),new we(J.map,1/0,1),new we(J.string,"bytes",5),new we(J.string,e,e.length),new we(J.break,void 0,1),new we(J.break,void 0,1)]}function os(r){return e0(new Uint8Array(r.buffer,r.byteOffset,r.byteLength))}function LY(r){return e0(new Uint8Array(r))}function BY(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function MY(r){if(Number.isNaN(r))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(r===1/0||r===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const $Y={typeEncoders:{Object:OY,Buffer:e0,Uint8Array:e0,Int8Array:os,Uint16Array:os,Int16Array:os,Uint32Array:os,Int32Array:os,Float32Array:os,Float64Array:os,Uint8ClampedArray:os,BigInt64Array:os,BigUint64Array:os,DataView:os,ArrayBuffer:LY,undefined:BY,number:MY}};class UY extends iT{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return this.tokenBuffer.length===0&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===J.map){const t=this._next();if(t.type===J.string&&t.value==="/"){const n=this._next();if(n.type===J.string){if(this._next().type!==J.break)throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(n),new we(J.tag,42,0)}if(n.type===J.map){const s=this._next();if(s.type===J.string&&s.value==="bytes"){const i=this._next();if(i.type===J.string){for(let a=0;a<2;a++)if(this._next().type!==J.break)throw new Error("Invalid encoded Bytes form");const o=gn.decode(`m${i.value}`);return new we(J.bytes,o,i.value.length)}this.tokenBuffer.push(i)}this.tokenBuffer.push(s)}this.tokenBuffer.push(n)}this.tokenBuffer.push(t)}return e}}const U3={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,rejectDuplicateMapKeys:!0,tags:[]};U3.tags[42]=Ee.parse;const FY="dag-json",H5=297,oT=r=>PY(r,$Y),q5=r=>{const e=NY(r),t=Object.assign(U3,{tokenizer:new UY(e,U3)});return DY(e,t)},$9=r=>VY.decode(oT(r)),VY=new TextDecoder,zY=r=>q5(HY.encode(r)),HY=new TextEncoder,qY=Object.freeze(Object.defineProperty({__proto__:null,code:H5,decode:q5,encode:oT,format:$9,name:FY,parse:zY,stringify:$9},Symbol.toStringTag,{value:"Module"})),KY=new TextDecoder;function K5(r,e){let t=0;for(let n=0;;n+=7){if(n>=64)throw new Error("protobuf: varint overflow");if(e>=r.length)throw new Error("protobuf: unexpected end of data");const s=r[e++];if(t+=n<28?(s&127)<<n:(s&127)*2**n,s<128)break}return[t,e]}function t0(r,e){let t;[t,e]=K5(r,e);const n=e+t;if(t<0||n<0)throw new Error("protobuf: invalid length");if(n>r.length)throw new Error("protobuf: unexpected end of data");return[r.subarray(e,n),n]}function aT(r,e){let t;return[t,e]=K5(r,e),[t&7,t>>3,e]}function jY(r){const e={},t=r.length;let n=0;for(;n<t;){let s,i;if([s,i,n]=aT(r,n),i===1){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Hash`);if(e.Name!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,n]=t0(r,n)}else if(i===2){if(e.Name!==void 0)throw new Error("protobuf: (PBLink) duplicate Name section");if(s!==2)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Name`);if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let o;[o,n]=t0(r,n),e.Name=KY.decode(o)}else if(i===3){if(e.Tsize!==void 0)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(s!==0)throw new Error(`protobuf: (PBLink) wrong wireType (${s}) for Tsize`);[e.Tsize,n]=K5(r,n)}else throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`)}if(n>t)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function WY(r){const e=r.length;let t=0,n,s=!1,i;for(;t<e;){let a,c;if([a,c,t]=aT(r,t),a!==2)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${a}`);if(c===1){if(i)throw new Error("protobuf: (PBNode) duplicate Data section");[i,t]=t0(r,t),n&&(s=!0)}else if(c===2){if(s)throw new Error("protobuf: (PBNode) duplicate Links section");n||(n=[]);let l;[l,t]=t0(r,t),n.push(jY(l))}else throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${c}`)}if(t>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return i&&(o.Data=i),o.Links=n||[],o}const cT=new TextEncoder,U9=2**32,GY=2**31;function YY(r,e){let t=e.length;if(typeof r.Tsize=="number"){if(r.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(r.Tsize))throw new Error("Tsize too large for encoding");t=qh(e,t,r.Tsize)-1,e[t]=24}if(typeof r.Name=="string"){const n=cT.encode(r.Name);t-=n.length,e.set(n,t),t=qh(e,t,n.length)-1,e[t]=18}return r.Hash&&(t-=r.Hash.length,e.set(r.Hash,t),t=qh(e,t,r.Hash.length)-1,e[t]=10),e.length-t}function QY(r){const e=JY(r),t=new Uint8Array(e);let n=e;if(r.Data&&(n-=r.Data.length,t.set(r.Data,n),n=qh(t,n,r.Data.length)-1,t[n]=10),r.Links)for(let s=r.Links.length-1;s>=0;s--){const i=YY(r.Links[s],t.subarray(0,n));n-=i,n=qh(t,n,i)-1,t[n]=18}return t}function XY(r){let e=0;if(r.Hash){const t=r.Hash.length;e+=1+t+gl(t)}if(typeof r.Name=="string"){const t=cT.encode(r.Name).length;e+=1+t+gl(t)}return typeof r.Tsize=="number"&&(e+=1+gl(r.Tsize)),e}function JY(r){let e=0;if(r.Data){const t=r.Data.length;e+=1+t+gl(t)}if(r.Links)for(const t of r.Links){const n=XY(t);e+=1+n+gl(n)}return e}function qh(r,e,t){e-=gl(t);const n=e;for(;t>=GY;)r[e++]=t&127|128,t/=128;for(;t>=128;)r[e++]=t&127|128,t>>>=7;return r[e]=t,n}function gl(r){return r%2===0&&r++,Math.floor((ZY(r)+6)/7)}function ZY(r){let e=0;return r>=U9&&(r=Math.floor(r/U9),e=32),r>=65536&&(r>>>=16,e+=16),r>=256&&(r>>>=8,e+=8),e+eQ[r]}const eQ=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],tQ=["Data","Links"],rQ=["Hash","Name","Tsize"],F3=new TextEncoder;function lT(r,e){if(r===e)return 0;const t=r.Name?F3.encode(r.Name):[],n=e.Name?F3.encode(e.Name):[];let s=t.length,i=n.length;for(let o=0,a=Math.min(s,i);o<a;++o)if(t[o]!==n[o]){s=t[o],i=n[o];break}return s<i?-1:i<s?1:0}function F9(r,e){return!Object.keys(r).some(t=>!e.includes(t))}function uT(r){if(typeof r.asCID=="object"){const t=Ee.asCID(r);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if(typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Hash){let t=Ee.asCID(r.Hash);try{t||(typeof r.Hash=="string"?t=Ee.parse(r.Hash):r.Hash instanceof Uint8Array&&(t=Ee.decode(r.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}t&&(e.Hash=t)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return typeof r.Name=="string"&&(e.Name=r.Name),typeof r.Tsize=="number"&&(e.Tsize=r.Tsize),e}function Nn(r){if((r instanceof Uint8Array||typeof r=="string")&&(r={Data:r}),typeof r!="object"||Array.isArray(r))throw new TypeError("Invalid DAG-PB form");const e={};if(r.Data!==void 0)if(typeof r.Data=="string")e.Data=F3.encode(r.Data);else if(r.Data instanceof Uint8Array)e.Data=r.Data;else throw new TypeError("Invalid DAG-PB form");if(r.Links!==void 0)if(Array.isArray(r.Links))e.Links=r.Links.map(uT),e.Links.sort(lT);else throw new TypeError("Invalid DAG-PB form");else e.Links=[];return e}function hT(r){if(!r||typeof r!="object"||Array.isArray(r)||r instanceof Uint8Array||r["/"]&&r["/"]===r.bytes)throw new TypeError("Invalid DAG-PB form");if(!F9(r,tQ))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(r.Data!==void 0&&!(r.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be bytes)");if(!Array.isArray(r.Links))throw new TypeError("Invalid DAG-PB form (Links must be a list)");for(let e=0;e<r.Links.length;e++){const t=r.Links[e];if(!t||typeof t!="object"||Array.isArray(t)||t instanceof Uint8Array||t["/"]&&t["/"]===t.bytes)throw new TypeError("Invalid DAG-PB form (bad link)");if(!F9(t,rQ))throw new TypeError("Invalid DAG-PB form (extraneous properties on link)");if(t.Hash===void 0)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(t.Hash==null||!t.Hash["/"]||t.Hash["/"]!==t.Hash.bytes)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(t.Name!==void 0&&typeof t.Name!="string")throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(t.Tsize!==void 0){if(typeof t.Tsize!="number"||t.Tsize%1!==0)throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t.Tsize<0)throw new TypeError("Invalid DAG-PB form (link Tsize cannot be negative)")}if(e>0&&lT(t,r.Links[e-1])===-1)throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function nQ(r,e=[]){return Nn({Data:r,Links:e})}function sQ(r,e,t){return uT({Hash:t,Name:r,Tsize:e})}function iQ(r){return r instanceof ArrayBuffer?new Uint8Array(r,0,r.byteLength):r}const oQ="dag-pb",fi=112;function er(r){hT(r);const e={};return r.Links&&(e.Links=r.Links.map(t=>{const n={};return t.Hash&&(n.Hash=t.Hash.bytes),t.Name!==void 0&&(n.Name=t.Name),t.Tsize!==void 0&&(n.Tsize=t.Tsize),n})),r.Data&&(e.Data=r.Data),QY(e)}function Rs(r){const e=iQ(r),t=WY(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map(s=>{const i={};try{i.Hash=Ee.decode(s.Hash)}catch{}if(!i.Hash)throw new Error("Invalid Hash field found in link, expected CID");return s.Name!==void 0&&(i.Name=s.Name),s.Tsize!==void 0&&(i.Tsize=s.Tsize),i})),n}const xf=Object.freeze(Object.defineProperty({__proto__:null,code:fi,createLink:sQ,createNode:nQ,decode:Rs,encode:er,name:oQ,prepare:Nn,validate:hT},Symbol.toStringTag,{value:"Module"}));function j5(r){return r?.then!=null}function aQ(r=[],e){const t={[fi]:xf,[As]:KC,[z5]:kY,[H5]:qY,[Kw]:FV};return r.forEach(n=>{t[n.code]=n}),async n=>{let s=t[n];if(s==null&&e!=null){const i=e(n);j5(i)?s=await i:s=i,t[s.code]=s}if(s!=null)return s;throw new tY(`Could not load codec for ${n}`)}}function cQ(r=[],e){const t={[Zt.code]:Zt,[F7.code]:F7,[Pn.code]:Pn};return r.forEach(n=>{t[n.code]=n}),async n=>{let s=t[n];if(s==null&&e!=null){const i=e(n);j5(i)?s=await i:s=i,t[s.code]=s}if(s!=null)return s;throw new eY(`No hasher configured for multihash code 0x${n.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`)}}let W5=class V3 extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=V3.name;code=V3.code;constructor(e="Not Found"){super(e)}};class dT{has(e,t){return Promise.reject(new Error(".has is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}async*putMany(e,t){for await(const{cid:n,bytes:s}of e)await this.put(n,s,t),yield n}get(e,t){throw new Error(".get is not implemented")}async*getMany(e,t){for await(const n of e)yield{cid:n,bytes:this.get(n,t)}}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*deleteMany(e,t){for await(const n of e)await this.delete(n,t),yield n}async*getAll(e){throw new Error(".getAll is not implemented")}}const m1=0;class y1 extends Error{static name="IdentityHashDigestTooLongError";name="IdentityHashDigestTooLongError"}class lQ extends dT{child;maxDigestLength;constructor(e,t){super(),this.child=e,this.maxDigestLength=t?.maxDigestLength}put(e,t,n){if(e.multihash.code===m1){if(this.maxDigestLength!=null&&e.multihash.digest.byteLength>this.maxDigestLength)throw new y1(`Identity digest too long - ${e.multihash.digest.byteLength} > this.maxDigestLength`);return n?.signal?.throwIfAborted(),e}return this.child==null?(n?.signal?.throwIfAborted(),e):this.child.put(e,t,n)}*get(e,t){if(e.multihash.code===m1){if(this.maxDigestLength!=null&&e.multihash.digest.byteLength>this.maxDigestLength)throw new y1(`Identity digest too long - ${e.multihash.digest.byteLength} > this.maxDigestLength`);t?.signal?.throwIfAborted(),yield e.multihash.digest;return}if(this.child==null)throw t?.signal?.throwIfAborted(),new W5;yield*this.child.get(e,t)}has(e,t){if(e.multihash.code===m1){if(this.maxDigestLength!=null&&e.multihash.digest.byteLength>this.maxDigestLength)throw new y1(`Identity digest too long - ${e.multihash.digest.byteLength} > this.maxDigestLength`);return t?.signal?.throwIfAborted(),!0}return this.child==null?(t?.signal?.throwIfAborted(),!1):this.child.has(e,t)}delete(e,t){if(e.code===m1){if(this.maxDigestLength!=null&&e.multihash.digest.byteLength>this.maxDigestLength)throw new y1(`Identity digest too long - ${e.multihash.digest.byteLength} > this.maxDigestLength`);t?.signal?.throwIfAborted();return}if(this.child!=null)return this.child.delete(e,t)}*getAll(e){this.child!=null&&(yield*this.child.getAll(e)),e?.signal?.throwIfAborted()}}function G5(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:s=>{n.push(s)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function uQ(r){return r[Symbol.asyncIterator]!=null}function Eo(r,e){let t=0;if(uQ(r))return(async function*(){for await(const c of r)await e(c,t++)&&(yield c)})();const n=G5(r),{value:s,done:i}=n.next();if(i===!0)return(function*(){})();const o=e(s,t++);if(typeof o.then=="function")return(async function*(){await o&&(yield s);for(const c of n)await e(c,t++)&&(yield c)})();const a=e;return(function*(){o===!0&&(yield s);for(const c of n)a(c,t++)&&(yield c)})()}function hQ(r){return r[Symbol.asyncIterator]!=null}function V9(r){return r?.then!=null}function z9(r,e){let t=0;if(hQ(r))return(async function*(){for await(const c of r){const l=e(c,t++);V9(l)&&await l,yield c}})();const n=G5(r),{value:s,done:i}=n.next();if(i===!0)return(function*(){})();if(typeof e(s,t++)?.then=="function")return(async function*(){yield s;for(const c of n){const l=e(c,t++);V9(l)&&await l,yield c}})();const a=e;return(function*(){yield s;for(const c of n)a(c,t++),yield c})()}const dQ=128;class fT{child;getHasher;log;logger;components;constructor(e,t={}){this.log=e.logger.forComponent("helia:networked-storage"),this.logger=e.logger,this.components=e,this.child=new lQ(e.blockstore,{maxDigestLength:t.maxIdentityHashDigestLength??dQ}),this.getHasher=e.getHasher}async put(e,t,n={}){return await this.child.has(e,n)?(n.onProgress?.(new Pe("blocks:put:duplicate",e)),e):(n.onProgress?.(new Pe("blocks:put:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async s=>s.announce?.(e,n))),n.onProgress?.(new Pe("blocks:put:blockstore:put",e)),this.child.put(e,t,n))}async*putMany(e,t={}){const n=Eo(e,async({cid:i})=>{const o=await this.child.has(i,t);return o&&t.onProgress?.(new Pe("blocks:put-many:duplicate",i)),!o}),s=z9(n,async({cid:i})=>{t.onProgress?.(new Pe("blocks:put-many:providers:notify",i)),await Promise.all(this.components.blockBrokers.map(async o=>o.announce?.(i,t)))});t.onProgress?.(new Pe("blocks:put-many:blockstore:put-many")),yield*this.child.putMany(s,t)}async*get(e,t={}){if(t.offline!==!0&&!await this.child.has(e,t)){const n=await this.getHasher(e.multihash.code);t.onProgress?.(new Pe("blocks:get:providers:get",e));const s=await H9(e,this.components.blockBrokers,n,{...t,log:this.log});t.onProgress?.(new Pe("blocks:get:blockstore:put",e)),await this.child.put(e,s,t),t.onProgress?.(new Pe("blocks:get:providers:notify",e)),await Promise.all(this.components.blockBrokers.map(async i=>i.announce?.(e,t))),yield s;return}t.onProgress?.(new Pe("blocks:get:blockstore:get",e)),yield*this.child.get(e,t)}async*getMany(e,t={}){t.onProgress?.(new Pe("blocks:get-many:blockstore:get-many")),yield*this.child.getMany(z9(e,async n=>{if(t.offline!==!0&&!await this.child.has(n,t)){const s=await this.getHasher(n.multihash.code);t.onProgress?.(new Pe("blocks:get-many:providers:get",n));const i=await H9(n,this.components.blockBrokers,s,{...t,log:this.log});t.onProgress?.(new Pe("blocks:get-many:blockstore:put",n)),await this.child.put(n,i,t),t.onProgress?.(new Pe("blocks:get-many:providers:notify",n)),await Promise.all(this.components.blockBrokers.map(async o=>o.announce?.(n,t)))}}))}async delete(e,t={}){t.onProgress?.(new Pe("blocks:delete:blockstore:delete",e)),await this.child.delete(e,t)}async*deleteMany(e,t={}){t.onProgress?.(new Pe("blocks:delete-many:blockstore:delete-many")),yield*this.child.deleteMany((async function*(){for await(const n of e)yield n})(),t)}async has(e,t={}){return this.child.has(e,t)}async*getAll(e={}){e.onProgress?.(new Pe("blocks:get-all:blockstore:get-many")),yield*this.child.getAll(e)}}class fQ extends fT{started;constructor(e,t={}){super(e,t),this.started=!1}isStarted(){return this.started}async start(){await oi(this.child,...this.components.blockBrokers),this.started=!0}async stop(){await eo(this.child,...this.components.blockBrokers),this.started=!1}unwrap(){return this.child}createSession(e,t){const n=this.components.blockBrokers.map(s=>s.createSession==null?s:s.createSession(t));return new pQ({blockstore:this.child,blockBrokers:n,getHasher:this.getHasher,logger:this.logger},{root:e})}}class pQ extends fT{closeController;constructor(e,t){super(e),this.closeController=new AbortController,this.closeController.signal,this.log=e.logger.forComponent(`helia:session-storage:${t.root}`)}close(){this.closeController.abort()}async put(e,t,n={}){const s=xt([this.closeController.signal,n.signal]);try{return await super.put(e,t,{...n,signal:s})}finally{s.clear()}}async*putMany(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{yield*super.putMany(e,{...t,signal:n})}finally{n.clear()}}async*get(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{yield*super.get(e,{...t,signal:n})}finally{n.clear()}}async*getMany(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{yield*super.getMany(e,{...t,signal:n})}finally{n.clear()}}async delete(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{await super.delete(e,{...t,signal:n})}finally{n.clear()}}async*deleteMany(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{yield*super.deleteMany(e,{...t,signal:n})}finally{n.clear()}}async has(e,t={}){const n=xt([this.closeController.signal,t.signal]);try{return await super.has(e,{...t,signal:n})}finally{n.clear()}}async*getAll(e={}){const t=xt([this.closeController.signal,e.signal]);try{yield*super.getAll({...e,signal:t})}finally{t.clear()}}}function gQ(r){return typeof r.retrieve=="function"}const mQ=(r,e)=>{if(e==null)throw new ue(`No hasher configured for multihash code 0x${r.multihash.code.toString(16)}, please configure one. You can look up which hash this is at https://github.com/multiformats/multicodec/blob/master/table.csv`);return async t=>{let n;const s=e.digest(t);if(j5(s)?n=await s:n=s,!Qe(n.digest,r.multihash.digest))throw new OC("Hash of downloaded block did not match multihash from passed CID")}};async function H9(r,e,t,n){const s=mQ(r,t),i=new AbortController,o=xt([i.signal,n.signal]);i.signal;const a=[];for(const c of e)gQ(c)&&a.push(c);try{return await Promise.any(a.map(async c=>{try{let l=!1;const u=await c.retrieve(r,{...n,signal:o,validateFn:async h=>{await s(h),l=!0}});return l||await s(u),u}catch(l){throw n.log.error("could not retrieve verified block for %c",r,l),l}}))}finally{i.abort(),o.clear()}}class pT extends Nt{initialPeerSearchComplete;requests;name;log;logger;minProviders;maxProviders;providers;evictionFilter;initialProviders;constructor(e,t){super(),this.name=t.name,this.logger=e.logger,this.log=e.logger.forComponent(this.name),this.requests=new Map,this.minProviders=t.minProviders??XG,this.maxProviders=t.maxProviders??JG,this.providers=[],this.evictionFilter=Yo(this.maxProviders),this.initialProviders=t.providers??[]}async retrieve(e,t={}){const n=gn.encode(e.multihash.bytes),s=this.requests.get(n);if(s!=null)return this.log("join existing request for %c",e),s;const i=Lt();if(this.requests.set(n,i.promise),this.providers.length===0){let u=!1;this.initialPeerSearchComplete==null&&(u=!0,this.log=this.logger.forComponent(`${this.name}:${e}`),this.initialPeerSearchComplete=this.findProviders(e,this.minProviders,t)),await this.initialPeerSearchComplete,u&&this.log("found initial session peers for %c",e)}let o=!1;const a=new Qo({concurrency:this.maxProviders});a.addEventListener("failure",u=>{this.log.error("error querying provider %o, evicting from session",u.detail.job.options.provider,u.detail.error),this.evict(u.detail.job.options.provider)}),a.addEventListener("success",u=>{o=!0,i.resolve(u.detail.result)}),a.addEventListener("idle",()=>{if(o){this.log.trace("session idle, found block");return}if(t.signal?.aborted===!0){this.log.trace("session idle, signal aborted");return}Promise.resolve().then(async()=>{this.log("no session peers had block for for %c, finding new providers",e);for(let u=0;u<this.minProviders&&this.providers.length!==0;u++){const h=this.providers[Math.floor(Math.random()*this.providers.length)];this.evict(h)}await this.findProviders(e,this.minProviders,t),this.log("found new providers re-retrieving %c",e),this.requests.delete(n),i.resolve(await this.retrieve(e,t))}).catch(u=>{this.log.error("could not find new providers for %c",e,u),i.reject(u)})});const c=u=>{a.add(async()=>this.queryProvider(e,u.detail,t),{provider:u.detail}).catch(h=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,h)})};this.addEventListener("provider",c),Promise.all([...this.providers].map(async u=>a.add(async()=>this.queryProvider(e,u,t),{provider:u}))).catch(u=>{t.signal?.aborted!==!0&&this.log.error("error retrieving session block for %c",e,u)});const l=()=>{i.reject(new Ka(t.signal?.reason??"Session aborted")),a.abort()};t.signal?.addEventListener("abort",l);try{return await i.promise}finally{this.removeEventListener("provider",c),t.signal?.removeEventListener("abort",l),a.clear(),this.requests.delete(n)}}evict(e){this.evictionFilter.add(this.toEvictionKey(e));const t=this.providers.findIndex(n=>this.equals(n,e));t!==-1&&this.providers.splice(t,1)}isEvicted(e){return this.evictionFilter.has(this.toEvictionKey(e))}hasProvider(e){return!!(this.providers.find(t=>this.equals(t,e))!=null||this.isEvicted(e))}async findProviders(e,t,n){const s=Lt();let i=0;return Promise.resolve().then(async()=>{if(this.log("finding %d-%d new provider(s) for %c",t,this.maxProviders,e),this.initialProviders.length>0)for(;i<t&&this.initialProviders.length>0;){const o=this.initialProviders.pop();if(o==null)break;const a=await this.convertToProvider(o,n);if(n.signal?.aborted===!0)break;if(a!=null&&!this.hasProvider(a)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(a),this.safeDispatchEvent("provider",{detail:a}),i++,i===t&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(i<this.maxProviders)for await(const o of this.findNewProviders(e,n)){if(i===this.maxProviders||n.signal?.aborted===!0)break;if(!this.hasProvider(o)&&(this.log("found %d/%d new providers",i,this.maxProviders),this.providers.push(o),this.safeDispatchEvent("provider",{detail:o}),i++,i===t&&(this.log("session is ready"),s.resolve()),this.providers.length===this.maxProviders)){this.log("found max session peers",i);break}}if(this.log("found %d/%d new session peers",i,this.maxProviders),i<t)throw new ZG(`Found ${i} of ${t} ${this.name} providers for ${e}`)}).catch(o=>{this.log.error("error searching routing for potential session peers for %c",e,o.errors??o),s.reject(o)}),s.promise}}class yQ{libp2p;blockstore;datastore;events;pins;logger;routing;getCodec;getHasher;dns;metrics;log;constructor(e){this.logger=e.logger??zg(),this.log=this.logger.forComponent("helia"),this.getHasher=cQ(e.hashers,e.loadHasher),this.getCodec=aQ(e.codecs,e.loadCodec),this.dns=e.dns??ek(),this.metrics=e.metrics,this.libp2p=e.libp2p,this.events=new Nt;const t={blockstore:e.blockstore,datastore:e.datastore,logger:this.logger,libp2p:this.libp2p,blockBrokers:[],getHasher:this.getHasher,getCodec:this.getCodec,dns:this.dns,metrics:this.metrics,...e.components??{}};this.routing=t.routing=new nY(t,{routers:(e.routers??[]).flatMap(s=>{const i=[s];return s[vd]!=null&&i.push(s[vd]),s[Ed]!=null&&i.push(s[Ed]),i}),providerLookupConcurrency:e.providerLookupConcurrency});const n=new fQ(t,e);this.pins=new QG(e.datastore,n,this.getCodec),this.blockstore=new mY(n,this.pins,{holdGcLock:e.holdGcLock??!0}),this.datastore=e.datastore,t.blockBrokers=e.blockBrokers.map(s=>s(t))}async start(){await yY(this.datastore),await oi(this.blockstore,this.datastore,this.routing,this.libp2p),this.events.dispatchEvent(new CustomEvent("start",{detail:this}))}async stop(){await eo(this.blockstore,this.datastore,this.routing,this.libp2p),this.events.dispatchEvent(new CustomEvent("stop",{detail:this}))}async gc(e={}){const t=await this.blockstore.lock.writeLock();try{const n=this,s=this.blockstore.unwrap();this.log("gc start"),await jo(s.deleteMany((async function*(){for await(const{cid:i}of s.getAll())try{if(await n.pins.isPinned(i,e))continue;yield i,e.onProgress?.(new Pe("helia:gc:deleted",i))}catch(o){n.log.error("Error during gc",o),e.onProgress?.(new Pe("helia:gc:error",o))}})()))}finally{t()}this.log("gc finished")}}function wQ(r){return r[Symbol.asyncIterator]!=null}function oa(r,e){let t=0;if(wQ(r))return(async function*(){for await(const c of r)yield e(c,t++)})();const n=G5(r),{value:s,done:i}=n.next();if(i===!0)return(function*(){})();const o=e(s,t++);if(typeof o.then=="function")return(async function*(){yield await o;for(const c of n)yield e(c,t++)})();const a=e;return(function*(){yield o;for(const c of n)yield a(c,t++)})()}function bQ(r){return r[Symbol.asyncIterator]!=null}function r0(r,e){return bQ(r)?(async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}})():(function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}})()}const w1="/ipfs/bitswap/1.2.0",vQ=1024,EQ=1024,SQ=1024,_Q=5e3,xQ=10,AQ=50,CQ=!1,kQ=3,gT=1024*1024*4,IQ=gT;var fr;(function(r){r.WantBlock="WantBlock",r.WantHave="WantHave"})(fr||(fr={}));var z3;(function(r){r[r.WantBlock=0]="WantBlock",r[r.WantHave=1]="WantHave"})(z3||(z3={}));(function(r){r.codec=()=>nn(z3)})(fr||(fr={}));var Md;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.priority!=null&&t.priority!==0&&(n.uint32(16),n.int32(t.priority)),t.cancel!=null&&(n.uint32(24),n.bool(t.cancel)),t.wantType!=null&&(n.uint32(32),fr.codec().encode(t.wantType,n)),t.sendDontHave!=null&&(n.uint32(40),n.bool(t.sendDontHave)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={cid:ot(0),priority:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.priority=t.int32();break}case 3:{i.cancel=t.bool();break}case 4:{i.wantType=fr.codec().decode(t);break}case 5:{i.sendDontHave=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Md||(Md={}));var n0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.entries!=null)for(const i of t.entries)n.uint32(10),Md.codec().encode(i,n);t.full!=null&&(n.uint32(16),n.bool(t.full)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={entries:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{if(s.limits?.entries!=null&&i.entries.length===s.limits.entries)throw new Ir('Decode error - map field "entries" had too many elements');i.entries.push(Md.codec().decode(t,t.uint32(),{limits:s.limits?.entries$}));break}case 2:{i.full=t.bool();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(n0||(n0={}));var $d;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.prefix!=null&&t.prefix.byteLength>0&&(n.uint32(10),n.bytes(t.prefix)),t.data!=null&&t.data.byteLength>0&&(n.uint32(18),n.bytes(t.data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={prefix:ot(0),data:ot(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.prefix=t.bytes();break}case 2:{i.data=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})($d||($d={}));var Xs;(function(r){r.HaveBlock="HaveBlock",r.DoNotHaveBlock="DoNotHaveBlock"})(Xs||(Xs={}));var s0;(function(r){r[r.HaveBlock=0]="HaveBlock",r[r.DoNotHaveBlock=1]="DoNotHaveBlock"})(s0||(s0={}));(function(r){r.codec=()=>nn(s0)})(Xs||(Xs={}));var Ud;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.cid!=null&&t.cid.byteLength>0&&(n.uint32(10),n.bytes(t.cid)),t.type!=null&&s0[t.type]!==0&&(n.uint32(16),Xs.codec().encode(t.type,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={cid:ot(0),type:Xs.HaveBlock},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.cid=t.bytes();break}case 2:{i.type=Xs.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Ud||(Ud={}));var Fd;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.wantlist!=null&&(n.uint32(10),n0.codec().encode(t.wantlist,n)),t.blocks!=null)for(const i of t.blocks)n.uint32(26),$d.codec().encode(i,n);if(t.blockPresences!=null)for(const i of t.blockPresences)n.uint32(34),Ud.codec().encode(i,n);t.pendingBytes!=null&&t.pendingBytes!==0&&(n.uint32(40),n.int32(t.pendingBytes)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={blocks:[],blockPresences:[],pendingBytes:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.wantlist=n0.codec().decode(t,t.uint32(),{limits:s.limits?.wantlist});break}case 3:{if(s.limits?.blocks!=null&&i.blocks.length===s.limits.blocks)throw new Ir('Decode error - map field "blocks" had too many elements');i.blocks.push($d.codec().decode(t,t.uint32(),{limits:s.limits?.blocks$}));break}case 4:{if(s.limits?.blockPresences!=null&&i.blockPresences.length===s.limits.blockPresences)throw new Ir('Decode error - map field "blockPresences" had too many elements');i.blockPresences.push(Ud.codec().decode(t,t.uint32(),{limits:s.limits?.blockPresences$}));break}case 5:{i.pendingBytes=t.int32();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Fd||(Fd={}));function TQ(r,e){for(const[t,n]of e.wantlist.entries()){const s=r.wantlist.get(t);s!=null&&(s.priority>n.priority&&(n.priority=s.priority),n.cancel=n.cancel??s.cancel,n.wantType=n.wantType??s.wantType,n.sendDontHave=n.sendDontHave??s.sendDontHave),r.wantlist.set(t,n)}for(const[t,n]of e.blockPresences.entries())r.blockPresences.set(t,n);for(const[t,n]of e.blocks.entries())r.blocks.set(t,n);return e.full&&!r.full&&(r.full=!0),r}class RQ extends Error{static name="BlockTooLargeError";constructor(e="Block too large"){super(e),this.name="BlockTooLargeError"}}const PQ=4193648,DQ=PQ+16;function*NQ(r,e){const t=[...r.wantlist.values()],n=[...r.blockPresences.values()],s=[...r.blocks.values()];let i=0,o=0,a=0,c=!1;for(;;){const l={wantlist:{full:r.full??!1,entries:[]},blockPresences:[],blocks:[],pendingBytes:0};let u=Fd.encode(l).byteLength,{added:h,hasMore:d,newSize:f}=cy(s,l.blocks,a,e,u,OQ);a+=h,u=f;const g=d;({added:h,hasMore:d,newSize:f}=cy(n,l.blockPresences,o,e,u,LQ)),o+=h,u=f;const m=d;if({added:h,hasMore:d,newSize:f}=cy(t,l.wantlist.entries,i,e,u,BQ),i+=h,u=f,c=!g&&!m&&!d,c||(l.wantlist.full=!1),yield Fd.encode(l),c)break}}function cy(r,e,t,n,s,i){let o=0,a=!1;for(let c=t;c<r.length;c++){const l=r[c],u=i(l);if(u>DQ)throw new RQ("Cannot send block as after encoding it is over the max message size");const h=s+u;if(h>n){a=!0;break}e.push(l),o++,s=h}return{hasMore:a,added:o,newSize:s}}function OQ(r){return Y5(3,$d.encode(r))}function LQ(r){return Y5(4,Ud.encode(r))}function BQ(r){return Y5(1,Md.encode(r))}function Y5(r,e){const t=ht(r),n=ht(e.byteLength);return t+n+e.byteLength}let MQ=class extends Nt{log;libp2p;routing;protocols;running;maxInboundStreams;maxOutboundStreams;messageReceiveTimeout;registrarIds;metrics;sendQueue;runOnLimitedConnections;maxOutgoingMessageSize;maxIncomingMessageSize;constructor(e,t={}){super(),this.log=e.logger.forComponent("helia:bitswap:network"),this.libp2p=e.libp2p,this.routing=e.routing,this.protocols=t.protocols??[w1],this.registrarIds=[],this.running=!1,this._onStream=this._onStream.bind(this),this.maxInboundStreams=t.maxInboundStreams??EQ,this.maxOutboundStreams=t.maxOutboundStreams??SQ,this.messageReceiveTimeout=t.messageReceiveTimeout??_Q,this.runOnLimitedConnections=t.runOnLimitedConnections??CQ,this.maxIncomingMessageSize=t.maxIncomingMessageSize??gT,this.maxOutgoingMessageSize=t.maxOutgoingMessageSize??t.maxIncomingMessageSize??IQ,this.metrics={blocksSent:e.metrics?.registerCounter("helia_bitswap_sent_blocks_total"),dataSent:e.metrics?.registerCounter("helia_bitswap_sent_data_bytes_total")},this.sendQueue=new Jo({concurrency:t.messageSendConcurrency??AQ,metrics:e.metrics,metricName:"helia_bitswap_message_send_queue"})}async start(){if(this.running)return;this.running=!0,await this.libp2p.handle(this.protocols,this._onStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnections});const e={onConnect:t=>{this.safeDispatchEvent("peer:connected",{detail:t})},onDisconnect:t=>{this.safeDispatchEvent("peer:disconnected",{detail:t})}};this.registrarIds=[];for(const t of this.protocols)this.registrarIds.push(await this.libp2p.register(t,e));this.libp2p.getConnections().forEach(t=>{this.safeDispatchEvent("peer:connected",{detail:t.remotePeer})})}async stop(){if(this.running=!1,await this.libp2p.unhandle(this.protocols),this.registrarIds!=null){for(const e of this.registrarIds)this.libp2p.unregister(e);this.registrarIds=[]}}_onStream(e,t){this.running&&Promise.resolve().then(async()=>{this.log("incoming new bitswap %s stream from %p",e.protocol,t.remotePeer);const n=()=>{e.status==="open"?e.abort(new Mg(`Incoming Bitswap stream timed out after ${this.messageReceiveTimeout}ms`)):this.log("stream aborted with status %s",e.status)};let s=AbortSignal.timeout(this.messageReceiveTimeout);s.addEventListener("abort",n),await e.close({signal:s});const i=to();e.addEventListener("message",o=>{i.push(o.data)}),e.addEventListener("remoteCloseWrite",()=>{i.end()}),e.addEventListener("close",o=>{o.error!=null&&i.end(o.error)});for await(const o of Jp(i,{maxDataLength:this.maxIncomingMessageSize}))try{const a=Fd.decode(o);this.log("incoming new bitswap %s message from %p on stream",e.protocol,t.remotePeer,e.id),this.safeDispatchEvent("bitswap:message",{detail:{peer:t.remotePeer,message:a}}),s.removeEventListener("abort",n),s=AbortSignal.timeout(this.messageReceiveTimeout),s.addEventListener("abort",n)}catch(a){this.log.error("error reading incoming bitswap message from %p on stream",t.remotePeer,e.id,a),e.abort(a);break}}).catch(n=>{this.log.error("error handling incoming stream from %p",t.remotePeer,n),e.abort(n)})}async*findProviders(e,t){t?.onProgress?.(new Pe("bitswap:network:find-providers",e));for await(const n of this.routing.findProviders(e,t))await this.libp2p.isDialable(n.multiaddrs,{runOnLimitedConnection:this.runOnLimitedConnections})&&(yield n)}async findAndConnect(e,t){t?.providers!=null&&await Promise.all(t.providers.map(async n=>this.connectTo(n).catch(s=>{this.log.error("could not connect to supplied provider - %e",s)}))),await jo(oa(r0(this.findProviders(e,t),t?.maxProviders??kQ),async n=>this.connectTo(n.id,t))).catch(n=>{this.log.error(n)})}async sendMessage(e,t,n){if(!this.running)throw new Error("network isn't running");const s=this.sendQueue.queue.find(i=>e.equals(i.options.peerId)&&i.status==="queued");if(s!=null){s.options.message=TQ(s.options.message,t),await s.join({signal:n?.signal});return}await this.sendQueue.add(async i=>{const o=i?.message;if(o==null)throw new ue("No message to send");this.log("sendMessage to %p",e),i?.onProgress?.(new Pe("bitswap:network:send-wantlist",e));const a=await this.libp2p.dialProtocol(e,w1,i);await a.closeRead();try{for(const c of NQ(o,this.maxOutgoingMessageSize))a.send(Bd.single(c))||await a.onDrain(i);await a.close(i)}catch(c){i?.onProgress?.(new Pe("bitswap:network:send-wantlist:error",{peer:e,error:c})),this.log.error("error sending message to %p",e,c),a.abort(c)}this._updateSentStats(o.blocks)},{peerId:e,signal:n?.signal,message:t})}async connectTo(e,t){if(!this.running)throw new Rl("Network isn't running");t?.onProgress?.(new Pe("bitswap:network:dial",e));const[n]=await Promise.all([this.libp2p.dial(e,t),ko(this.libp2p,"peer:identify",t?.signal,{filter:s=>{if(!s.detail.peerId.equals(e))return!1;if(s.detail.protocols.includes(w1))return!0;throw new LC(`${e} did not support ${w1}`)}})]);return n}_updateSentStats(e){let t=0;for(const n of e.values())t+=n.data.byteLength;this.metrics.dataSent?.increment(t),this.metrics.blocksSent?.increment(e.size)}};const mT=Symbol.for("nodejs.util.inspect.custom"),$Q=114;let Q5=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[zw]=!0;toString(){return this.string==null&&(this.string=Dt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Ee.createV1($Q,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Qe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Qe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[mT](){return`PeerId(${this.toString()})`}},yT=class extends Q5{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},wT=class extends Q5{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}},bT=class extends Q5{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}};const UQ=2336;let vT=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=Pn.digest(le(this.url))}[mT](){return`PeerId(${this.url})`}[zw]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Ee.createV1(UQ,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=he(e)),e.toString()===this.toString())}};const FQ=114,q9=2336;function On(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=wr(Dt.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return xu(Ee.parse(r));throw new ue('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return Ps(t)}function Fl(r){if(r.type==="Ed25519")return new wT({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new bT({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new yT({multihash:r.toCID().multihash,publicKey:r});throw new pu}function VQ(r){return Fl(r.publicKey)}function Ps(r){if(HQ(r))return new yT({multihash:r});if(zQ(r))try{const e=Xg(r);if(e.type==="Ed25519")return new wT({multihash:r,publicKey:e});if(e.type==="secp256k1")return new bT({multihash:r,publicKey:e})}catch{const t=he(r.digest);return new vT(new URL(t))}throw new OC("Supplied PeerID Multihash is invalid")}function xu(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==FQ&&r.code!==q9)throw new gF("Supplied PeerID CID is invalid");if(r.code===q9){const e=he(r.multihash.digest);return new vT(new URL(e))}return Ps(r.multihash)}function zQ(r){return r.code===Pn.code}function HQ(r){return r.code===Zt.code}function Kh(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),s=n.value;return n.done===!0||s==null?{done:!0,value:void 0}:{done:!1,value:e(s)}}};return t}function ly(r){const e=wr(Dt.decode(`z${r}`));return Ps(e)}class xc{map;constructor(e){if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return Kh(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){return this.map.get(e.toString())?.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return Kh(this.map.values(),e=>e.key)}values(){return Kh(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Js{set;constructor(e){if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return Kh(this.set.entries(),e=>{const t=ly(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=ly(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return Kh(this.set.values(),e=>ly(e))}intersection(e){const t=new Js;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new Js;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new Js;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}function qQ(){return new Js}class KQ{filter;constructor(e,t){this.filter=Yo(e,t)}has(e){return this.filter.has(e.toMultihash().bytes)}add(e){this.filter.add(e.toMultihash().bytes)}remove(e){this.filter.remove?.(e.toMultihash().bytes)}}function jQ(r,e=.001){return new KQ(r,e)}class WQ extends xc{metric;constructor(e){super();const{name:t,metrics:n}=e;this.metric=n.registerMetric(t),this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function i2(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new WQ({name:e,metrics:t}):n=new xc,n}class ah{full;pendingBytes;wantlist;blocks;blockPresences;constructor(e=!1,t=0){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}addWantlistEntry(e,t){const n=gn.encode(e.multihash.bytes);this.wantlist.set(n,t)}addBlockPresence(e,t){const n=gn.encode(e.multihash.bytes);this.blockPresences.set(n,t)}addBlock(e,t){const n=gn.encode(e.multihash.bytes);this.blocks.set(n,t)}}function GQ(r){let e=new Uint8Array(r.reduce((n,s)=>n+ht(s),0)),t=0;for(const n of r)e=Ys(n,e,t),t+=ht(n);return e}function K9(r){return GQ([r.version,r.code,r.multihash.code,r.multihash.digest.byteLength])}class YQ{peerId;blockstore;network;wants;exchangeCount;bytesSent;bytesReceived;lastExchange;maxSizeReplaceHasWithBlock;log;constructor(e,t){this.peerId=e.peerId,this.blockstore=e.blockstore,this.network=e.network,this.wants=new Map,this.log=e.logger.forComponent(`helia:bitswap:ledger:${e.peerId}`),this.exchangeCount=0,this.bytesSent=0,this.bytesReceived=0,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock??vQ}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.bytesReceived+=e}debtRatio(){return this.bytesSent/(this.bytesReceived+1)}async sendBlocksToPeer(e){const t=new ah,n=new Set;for(const[s,i]of this.wants.entries())try{const o=await Gr(this.blockstore.get(i.cid,e));i.wantType===fr.WantHave?o.byteLength<this.maxSizeReplaceHasWithBlock?(this.log("sending have and block for %c",i.cid),n.add(s),t.addBlock(i.cid,{data:o,prefix:K9(i.cid)})):(this.log("sending have for %c",i.cid),t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:Xs.HaveBlock})):(this.log("sending block for %c",i.cid),n.add(s),t.addBlock(i.cid,{data:o,prefix:K9(i.cid)}))}catch(o){if(o.name!=="NotFoundError")throw o;if(this.log("do not have block for %c",i.cid),!i.sendDontHave||i.sentDoNotHave===!0)continue;i.sentDoNotHave=!0,t.addBlockPresence(i.cid,{cid:i.cid.bytes,type:Xs.DoNotHaveBlock})}if(t.blocks.size>0||t.blockPresences.size>0){this.log("sending message"),await this.network.sendMessage(this.peerId,t,e),this.log("sent message"),this.sentBytes([...t.blocks.values()].reduce((s,i)=>s+i.data.byteLength,0));for(const s of n)this.wants.delete(s)}}}class QQ{blockstore;network;ledgerMap;maxSizeReplaceHasWithBlock;log;logger;constructor(e,t={}){this.blockstore=e.blockstore,this.network=e.network,this.maxSizeReplaceHasWithBlock=t.maxSizeReplaceHasWithBlock,this.log=e.logger.forComponent("helia:bitswap:peer-want-lists"),this.logger=e.logger,this.ledgerMap=i2({name:"helia_bitswap_ledger_map",metrics:e.metrics}),this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,s)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}ledgerForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return{peer:t.peerId,value:t.debtRatio(),sent:t.bytesSent,received:t.bytesReceived,exchanged:t.exchangeCount}}wantListForPeer(e){const t=this.ledgerMap.get(e);if(t!=null)return[...t.wants.values()]}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.peerId)}async receiveMessage(e,t){let n=this.ledgerMap.get(e);if(n==null&&(n=new YQ({peerId:e,blockstore:this.blockstore,network:this.network,logger:this.logger},{maxSizeReplaceHasWithBlock:this.maxSizeReplaceHasWithBlock}),this.ledgerMap.set(e,n)),n.receivedBytes(t.blocks?.reduce((s,i)=>s+i.data.byteLength,0)??0),t.wantlist!=null){t.wantlist.full===!0&&n.wants.clear();for(const s of t.wantlist.entries){const i=Ee.decode(s.cid),o=he(i.multihash.bytes,"base64");s.cancel===!0?(this.log("peer %p cancelled want of block for %c",e,i),n.wants.delete(o)):(s.wantType===fr.WantHave?this.log("peer %p wanted block presence for %c",e,i):this.log("peer %p wanted block for %c",e,i),n.wants.set(o,{cid:i,priority:s.priority,wantType:s.wantType??fr.WantBlock,sendDontHave:s.sendDontHave??!1}))}}this.log("send blocks to peer"),await n.sendBlocksToPeer()}async receivedBlock(e,t){const n=he(e.multihash.bytes,"base64"),s=[];for(const i of this.ledgerMap.values())i.wants.has(n)&&s.push(i);await Promise.all(s.map(async i=>i.sendBlocksToPeer(t)))}peerDisconnected(e){this.ledgerMap.delete(e)}}class XQ extends pT{wantList;network;libp2p;constructor(e,t){super(e,{...t,name:"helia:bitswap:session"}),this.wantList=e.wantList,this.network=e.network,this.libp2p=e.libp2p}async queryProvider(e,t,n){this.log("sending WANT-BLOCK for %c to %p",e,t);const s=await this.wantList.wantSessionBlock(e,t,n);if(this.log("%p %s %c",t,s.has?"has":"does not have",e),s.has&&s.block!=null)return s.block;throw new Error("Provider did not have block")}async*findNewProviders(e,t={}){for await(const n of this.network.findProviders(e,t))yield n.id}toEvictionKey(e){return e.toMultihash().bytes}equals(e,t){return e.equals(t)}async convertToProvider(e,t){return Oa(e)?e:(await this.libp2p.dial(e,t)).remotePeer}}function JQ(r,e){return new XQ(r,e)}class ZQ{blocksReceived;duplicateBlocksReceived;dataReceived;duplicateDataReceived;constructor(e){this.blocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_received_blocks"),this.duplicateBlocksReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_received_blocks"),this.dataReceived=e.metrics?.registerMetricGroup("helia_bitswap_data_received_bytes"),this.duplicateDataReceived=e.metrics?.registerMetricGroup("helia_bitswap_duplicate_data_received_bytes")}updateBlocksReceived(e=1,t){const n={global:e};t!=null&&(n[t.toString()]=e),this.blocksReceived?.increment(n)}updateDuplicateBlocksReceived(e=1,t){const n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateBlocksReceived?.increment(n)}updateDataReceived(e,t){const n={global:e};t!=null&&(n[t.toString()]=e),this.dataReceived?.increment(n)}updateDuplicateDataReceived(e,t){const n={global:e};t!=null&&(n[t.toString()]=e),this.duplicateDataReceived?.increment(n)}}function eX(r){if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];for(;r.length>0;){const t=Ts(r);e.push(t),r=r.slice(ht(t))}return e}class tX extends Nt{peers;wants;network;log;sendMessagesDelay;sendMessagesTimeout;hashLoader;sendingMessages;constructor(e,t={}){super(),this.peers=i2({name:"helia_bitswap_peers",metrics:e.metrics}),this.wants=ks({name:"helia_bitswap_wantlist",metrics:e.metrics}),this.network=e.network,this.sendMessagesDelay=t.sendMessagesDelay??xQ,this.log=e.logger.forComponent("helia:bitswap:wantlist"),this.hashLoader=t.hashLoader,this.network.addEventListener("bitswap:message",n=>{this.receiveMessage(n.detail.peer,n.detail.message).catch(s=>{this.log.error("error receiving bitswap message from %p",n.detail.peer,s)})}),this.network.addEventListener("peer:connected",n=>{this.peerConnected(n.detail).catch(s=>{this.log.error("error processing newly connected bitswap peer %p",n.detail,s)})}),this.network.addEventListener("peer:disconnected",n=>{this.peerDisconnected(n.detail)})}async addEntry(e,t){const n=he(e.multihash.bytes,"base64");let s=this.wants.get(n);s==null&&(s={cid:e,priority:t.priority??1,wantType:t.wantType??fr.WantBlock,cancel:!1,sendDontHave:!0},this.wants.set(n,s)),s.wantType===fr.WantHave&&t.wantType===fr.WantBlock&&(s.wantType=fr.WantBlock),await this.sendMessagesDebounced();try{return t.wantType===fr.WantBlock?(await ko(this,"block",t?.signal,{filter:a=>Qe(e.multihash.digest,a.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail:(await ko(this,"presence",t?.signal,{filter:o=>Qe(e.multihash.digest,o.detail.cid.multihash.digest),errorMessage:"Want was aborted"})).detail}finally{t.signal?.aborted===!0&&(this.log("want for %c was aborted, cancelling want",e),s.cancel=!0,await this.sendMessagesDebounced())}}async sendMessagesDebounced(){await this.sendingMessages?.promise,clearTimeout(this.sendMessagesTimeout),this.sendMessagesTimeout=setTimeout(()=>{this.sendMessages().catch(e=>{this.log("error sending messages to peers",e)})},this.sendMessagesDelay)}async sendMessages(){this.sendingMessages=Lt(),await Promise.all([...this.peers.entries()].map(async([e,t])=>{const n=new Set,s=new ah;for(const[i,o]of this.wants.entries())t.has(i)||o.cancel||(n.add(i),s.addWantlistEntry(o.cid,{cid:o.cid.bytes,priority:o.priority,wantType:o.wantType,cancel:o.cancel,sendDontHave:o.sendDontHave}));if(s.wantlist.size!==0)try{await this.network.sendMessage(e,s);for(const i of n)t.add(i)}catch(i){this.log.error("error sending full wantlist to new peer",i)}})).catch(e=>{this.log.error("error sending messages",e)});for(const[e,t]of this.wants)if(t.cancel){this.wants.delete(e);for(const n of this.peers.values())n.delete(e)}this.sendingMessages.resolve()}has(e){const t=he(e.multihash.bytes,"base64");return this.wants.has(t)}async wantSessionPresence(e,t,n={}){const s=new ah;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:fr.WantHave,priority:1}),await this.network.sendMessage(t,s),(await ko(this,"presence",n.signal,{filter:o=>t.equals(o.detail.sender)&&Qe(e.multihash.digest,o.detail.cid.multihash.digest)})).detail}async wantBlock(e,t={}){return this.addEntry(e,{...t,wantType:fr.WantBlock})}async wantSessionBlock(e,t,n={}){const s=new ah;return s.addWantlistEntry(e,{cid:e.bytes,sendDontHave:!0,wantType:fr.WantBlock,priority:1}),await this.network.sendMessage(t,s),(await ko(this,"presence",n.signal,{filter:o=>t.equals(o.detail.sender)&&Qe(e.multihash.digest,o.detail.cid.multihash.digest)})).detail}async receivedBlock(e,t){const n=he(e.multihash.bytes,"base64"),s=this.wants.get(n);s!=null&&(s.cancel=!0,await this.sendMessagesDebounced())}async receiveMessage(e,t){this.log("received message from %p with %d blocks",e,t.blocks.length);let n=!1;for(const s of t.blocks){if(s.prefix==null||s.data==null)continue;const i=eX(s.prefix),o=i[0],a=i[1],c=i[2],l=c===Zt.code?Zt:await this.hashLoader?.getHasher(c);if(l==null){this.log.error("unknown hash algorithm",c);continue}let u=l.digest(s.data);u.then!=null&&(u=await u);const h=Ee.create(o===0?0:1,a,u);this.log("received block from %p for %c",e,h),this.safeDispatchEvent("block",{detail:{sender:e,cid:h,block:s.data}}),this.safeDispatchEvent("presence",{detail:{sender:e,cid:h,has:!0,block:s.data}});const d=he(h.multihash.bytes,"base64"),f=this.wants.get(d);f!=null&&(f.cancel=!0,n=!0)}for(const{cid:s,type:i}of t.blockPresences){const o=Ee.decode(s);this.log("received %s from %p for %c",i,e,o),this.safeDispatchEvent("presence",{detail:{sender:e,cid:o,has:i===Xs.HaveBlock}})}n&&await this.sendMessagesDebounced()}async peerConnected(e){const t=new Set,n=new ah(!0);for(const[s,i]of this.wants.entries())i.cancel||(t.add(s),n.addWantlistEntry(i.cid,{cid:i.cid.bytes,priority:1,wantType:fr.WantBlock,cancel:!1,sendDontHave:!1}));if(n.wantlist.size===0){this.peers.set(e,t);return}try{await this.network.sendMessage(e,n),this.peers.set(e,t)}catch(s){this.log.error("error sending full wantlist to new peer %p",e,s)}}peerDisconnected(e){this.peers.delete(e)}start(){}stop(){this.peers.clear(),clearTimeout(this.sendMessagesTimeout)}}class rX{log;logger;stats;network;blockstore;peerWantLists;wantList;libp2p;constructor(e,t={}){this.logger=e.logger,this.log=e.logger.forComponent("helia:bitswap"),this.blockstore=e.blockstore,this.libp2p=e.libp2p,this.stats=new ZQ(e),this.network=new MQ(e,t),this.peerWantLists=new QQ({...e,network:this.network},t),this.wantList=new tX({...e,network:this.network},t)}createSession(e={}){return JQ({wantList:this.wantList,network:this.network,logger:this.logger,libp2p:this.libp2p},e)}async want(e,t={}){const n=new AbortController,s=xt([n.signal,t.signal]);n.signal,this.network.findAndConnect(e,{...t,signal:s}).catch(i=>{n.signal.aborted||this.log.error("error during finding and connect for cid %c",e,i)});try{const i=await this.wantList.wantBlock(e,{...t,signal:s});return t.onProgress?.(new Pe("bitswap:want-block:received",{cid:e,sender:i.sender})),i.block}finally{n.abort(),s.clear()}}async notify(e,t={}){await Promise.all([this.peerWantLists.receivedBlock(e,t),this.wantList.receivedBlock(e,t)])}getWantlist(){return[...this.wantList.wants.values()].filter(e=>!e.cancel).map(e=>({cid:e.cid,priority:e.priority,wantType:e.wantType}))}getPeerWantlist(e){return this.peerWantLists.wantListForPeer(e)}async start(){this.wantList.start(),await this.network.start()}async stop(){this.wantList.stop(),await this.network.stop()}}const nX=(r,e={})=>new rX(r,e);class sX{bitswap;started;constructor(e,t={}){const{getHasher:n}=e;this.bitswap=nX(e,{hashLoader:{getHasher:async s=>n(s)},...t}),this.started=!1}isStarted(){return this.started}async start(){await this.bitswap.start(),this.started=!0}async stop(){await this.bitswap.stop(),this.started=!1}async announce(e,t){await this.bitswap.notify(e,t)}async retrieve(e,t={}){return this.bitswap.want(e,t)}createSession(e){const t=this.bitswap.createSession(e);return{announce:async(n,s)=>{await this.bitswap.notify(n,s)},retrieve:async(n,s)=>t.retrieve(n,s)}}}function iX(r={}){return e=>new sX(e,r)}const oX=[Ba,_5,C5,x5,A5];function j9(r){return ET("sni",r)?.value}function W9(r){const e=ET("tcp",r)?.value;return e==null?"":`:${e}`}function ET(r,e){return e.find(t=>t.name===r)}function G9(r){return r.some(({code:e})=>e===Ma)}function as(r,e){const t=ST[r.name];if(t==null)throw new Error(`Can't interpret protocol ${r.name}`);const n=t(r,e);return r.code===Xa?`[${n}]`:n}const ST={ip4:(r,e)=>r.value,ip6:(r,e)=>e.length===0?r.value:`[${r.value}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${as(t,e)}:${r.value}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${as(t,e)}:${r.value}`},dnsaddr:(r,e)=>r.value,dns4:(r,e)=>r.value,dns6:(r,e)=>r.value,dns:(r,e)=>r.value,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${as(t,e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${as(t,e)}`},http:(r,e)=>{const t=G9(e),n=j9(e),s=W9(e);if(t&&n!=null)return`https://${n}${s}`;const i=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=as(o,e);return a=a?.replace("tcp://",""),`${i}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=as(t,e),s=decodeURIComponent(r.value??"");return`${n}${s}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return as(t,e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return as(t,e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=as(t,e);return n=n?.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=G9(e),n=j9(e),s=W9(e);if(t&&n!=null)return`wss://${n}${s}`;const i=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=as(o,e);return a=a?.replace("tcp://",""),`${i}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=as(t,e);return n=n?.replace("tcp://",""),`wss://${n}`}};function X5(r,e){const n=Ye(r).getComponents(),s=n.pop();if(s==null)throw new Error("Unexpected end of multiaddr");const i=ST[s.name];if(i==null)throw new Error(`No interpreter found for ${s.name}`);let o=i(s,n)??"";return oX.includes(s.code)&&(o=o.replace(/^.*:\/\//,""),s.value==="443"?o=`https://${o}`:o=`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString(),o.endsWith("/")&&(o=o.substring(0,o.length-1))),o}const It=r=>({match:e=>{const t=e[0];return t==null||t.code!==r||t.value!=null?!1:e.slice(1)}}),Ke=(r,e)=>({match:t=>{const n=t[0];return n?.code!==r||n.value==null||e!=null&&n.value!==e?!1:t.slice(1)}}),aX=r=>({match:e=>r.match(e)===!1?e:!1}),lt=r=>({match:e=>{const t=r.match(e);return t===!1?e:t}}),sn=(...r)=>({match:e=>{let t;for(const n of r){const s=n.match(e);s!==!1&&(t==null||s.length<t.length)&&(t=s)}return t??!1}}),St=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e}});function Tt(...r){function e(s){if(s==null)return!1;let i=s.getComponents();for(const o of r){const a=o.match(i);if(a===!1)return!1;i=a}return i}function t(s){return e(s)!==!1}function n(s){const i=e(s);return i===!1?!1:i.length===0}return{matchers:r,matches:t,exactMatch:n}}const cX=Ke(qe),lX=Tt(cX),o2=Ke(x5),a2=Ke(A5),c2=Ke(C5),J5=Ke(_5);Tt(o2,lt(Ke(qe)));Tt(a2,lt(Ke(qe)));Tt(c2,lt(Ke(qe)));const _T=Tt(sn(J5,c2,o2,a2),lt(Ke(qe))),xT=St(Ke(Wp),lt(Ke(S5))),AT=St(lt(Ke(E5)),Ke(Xa),lt(Ke(S5))),Z5=sn(xT,AT),Ja=sn(Z5,J5,o2,a2,c2),uX=Tt(sn(Z5,St(sn(J5,c2,o2,a2),lt(Ke(qe))))),Y9=Tt(xT),Q9=Tt(AT),hX=Tt(Z5),e8=St(Ja,Ke(Ba)),Af=St(Ja,Ke(uI)),i0=Tt(St(e8,lt(Ke(qe))));Tt(Af);const t8=St(Af,It(dI),lt(Ke(qe))),l2=St(Af,It(fI),lt(Ke(qe))),dX=sn(t8,l2);Tt(t8);const fX=Tt(l2),H3=sn(Ja,e8,Af,t8,l2),CT=sn(St(H3,It(k5),lt(Ke(qe)))),Vd=Tt(CT),kT=sn(St(H3,It(gI),lt(Ke(qe))),St(H3,It(Ma),lt(Ke(Gp)),It(k5),lt(Ke(qe)))),o0=Tt(kT),IT=St(Af,It(mI),lt(Ke($l)),lt(Ke($l)),lt(Ke(qe))),q3=Tt(IT),TT=St(l2,It(pI),lt(Ke($l)),lt(Ke($l)),lt(Ke(qe))),X9=Tt(TT),a0=sn(CT,kT,St(e8,lt(Ke(qe))),St(dX,lt(Ke(qe))),St(Ja,lt(Ke(qe))),IT,TT,Ke(qe)),r8=Tt(a0),pX=St(lt(a0),It(wu),aX(It(Hh)),lt(Ke(qe))),li=Tt(pX),gX=sn(St(a0,It(wu),It(Hh),lt(Ke(qe))),St(a0,It(Hh),lt(Ke(qe))),St(It(Hh),lt(Ke(qe)))),K3=Tt(gX),mX=sn(St(Ja,Ke(Ba),It(pl),lt(Ke(qe))),St(Ja,It(pl),lt(Ke(qe)))),yX=Tt(mX),wX=St(Ja,sn(St(Ke(Ba,"443"),It(pl)),St(Ke(Ba),It(O3)),St(Ke(Ba),It(Ma),It(pl)),St(It(Ma),It(pl)),It(Ma),It(O3)),lt(Ke(qe))),bX=Tt(wX),vX=sn(St(Ke(yI),lt(Ke(qe))));Tt(vX);const EX=sn(St(Ke(hI),lt(Ke(qe))));Tt(EX);function RT(r,e,t){return r.filter(n=>{if(bX.matches(n)||e&&yX.matches(n))return t||_T.matches(n)?!0:Zn(n)===!1;if(!e&&t){const{host:s}=ct(n);if(s==="127.0.0.1"||s==="localhost"||s.endsWith(".localhost"))return!0}return!1})}async function*PT(r,e,t,n,s,i={}){for await(const o of e.findProviders(r,i)){const a=RT(o.multiaddrs,n,s);if(a.length===0)continue;const c=X5(a[0]);yield new DT(c,{logger:t,transformRequestInit:i.transformRequestInit})}}async function SX(r,e,t){const{signal:n,log:s}=t??{},i=r.headers.get("content-length");if(i!=null){const c=parseInt(i,10);if(c>e)throw s?.error("content-length header (%d) is greater than the limit (%d)",c,e),r.body!=null&&await r.body.cancel().catch(l=>{s?.error("error cancelling response body after content-length check - %e",l)}),new Error(`Content-Length header (${c}) is greater than the limit (${e}).`)}const o=r.body?.getReader();if(o==null)throw new Error("Response body is not readable");const a=new ze;try{for(;;){if(n?.aborted===!0)throw new Error("Response body read was aborted.");const{done:c,value:l}=await o.read();if(c)break;if(a.append(l),a.byteLength>e)throw new Error(`Response body is greater than the limit (${e}), received ${a.byteLength} bytes.`)}}finally{o.cancel().catch(c=>{s?.error("error cancelling reader - %e",c)}).finally(()=>{o.releaseLock()})}return a.subarray()}class DT{url;#e=0;#t=0;#r=0;#l=0;#c=new Map;log;transformRequestInit;constructor(e,{logger:t,transformRequestInit:n}){this.url=e instanceof URL?e:new URL(e),this.transformRequestInit=n,this.log=t.forComponent(`helia:trustless-gateway-block-broker:${this.url.hostname}`)}#d(e){const t=e.multihash.bytes;return gn.encode(t)}async getRawBlock(e,{signal:t,maxSize:n=CX}={}){const s=new URL(this.url.toString());if(s.pathname=`/ipfs/${e.toString()}`,s.search="?format=raw",t?.aborted===!0)throw new Error(`Signal to fetch raw block for CID ${e} from gateway ${this.url} was aborted prior to fetch`);const i=this.#d(e),o=new AbortController,a=()=>{o.abort()};t?.addEventListener("abort",a);try{let c=this.#c.get(i);if(c==null){this.#e++;const l={signal:o.signal,headers:{Accept:"application/vnd.ipld.raw"},cache:"force-cache"},u=this.transformRequestInit!=null?await this.transformRequestInit(l):l;c=fetch(s.toString(),u).then(async h=>{if(this.log("GET %s %d",s,h.status),!h.ok)throw this.#t++,new Error(`unable to fetch raw block for CID ${e} from gateway ${this.url}`);const d=await SX(h,n,{signal:o.signal,log:this.log});return this.#l++,d}),this.#c.set(i,c)}return await c}catch{throw t?.aborted===!0?new Error(`fetching raw block for CID ${e} from gateway ${this.url} was aborted`):(this.#t++,new Error(`unable to fetch raw block for CID ${e}`))}finally{t?.removeEventListener("abort",a),this.#c.delete(i)}}reliability(){return this.#e===0?1:this.#r>0?-1/0:this.#l/(this.#e+this.#t*3)}incrementInvalidBlocks(){this.#r++}getStats(){return{attempts:this.#e,errors:this.#t,invalidBlocks:this.#r,successes:this.#l,pendingResponses:this.#c.size}}}class _X extends pT{routing;allowInsecure;allowLocal;transformRequestInit;constructor(e,t){super(e,{...t,name:"helia:trustless-gateway:session"}),this.routing=e.routing,this.allowInsecure=t.allowInsecure??NT,this.allowLocal=t.allowLocal??OT,this.transformRequestInit=t.transformRequestInit}async queryProvider(e,t,n){this.log("fetching BLOCK for %c from %s",e,t.url);const s=await t.getRawBlock(e,n);return this.log.trace("got block for %c from %s",e,t.url),await n.validateFn?.(s),s}async*findNewProviders(e,t={}){yield*PT(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})}toEvictionKey(e){return e.url.toString()}equals(e,t){return e.url.toString()===t.url.toString()}async convertToProvider(e,t){if(Oa(e))return;const n=RT(Array.isArray(e)?e:[e],this.allowInsecure,this.allowLocal);if(n.length===0)return;const s=X5(n[0]);return new DT(s,{logger:this.logger,transformRequestInit:this.transformRequestInit})}}function xX(r,e){return new _X(r,e)}class AX{allowInsecure;allowLocal;transformRequestInit;routing;log;logger;constructor(e,t={}){this.log=e.logger.forComponent("helia:trustless-gateway-block-broker"),this.logger=e.logger,this.routing=e.routing,this.allowInsecure=t.allowInsecure??NT,this.allowLocal=t.allowLocal??OT,this.transformRequestInit=t.transformRequestInit}async retrieve(e,t={}){const n=[];for await(const s of PT(e,this.routing,this.logger,this.allowInsecure,this.allowLocal,{...t,transformRequestInit:this.transformRequestInit})){this.log("getting block for %c from %s",e,s.url);try{const i=await s.getRawBlock(e,t);this.log.trace("got block for %c from %s",e,s.url);try{await t.validateFn?.(i)}catch(o){this.log.error("failed to validate block for %c from %s",e,s.url,o);continue}return i}catch(i){if(this.log.error("failed to get block for %c from %s",e,s.url,i),i instanceof Error?n.push(i):n.push(new Error(`Unable to fetch raw block for CID ${e} from gateway ${s.url}`)),t.signal?.aborted===!0){this.log.trace("request aborted while fetching raw block for CID %c from gateway %s",e,s.url);break}}}throw n.length>0?new AggregateError(n,`Unable to fetch raw block for CID ${e} from any gateway`):new Error(`Unable to fetch raw block for CID ${e} from any gateway`)}createSession(e={}){return xX({logger:this.logger,routing:this.routing},{...e,allowLocal:this.allowLocal,allowInsecure:this.allowInsecure,transformRequestInit:this.transformRequestInit})}}const NT=!1,OT=!1,CX=2097152;function kX(r={}){return e=>new AX(e,r)}const IX=Symbol.for("@libp2p/content-routing"),LT=Symbol.for("@libp2p/peer-id"),TX=Symbol.for("@libp2p/peer-routing");let RX=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},ml=class extends Error{static name="NotFoundError";constructor(e="Not found"){super(e),this.name="NotFoundError"}},PX=class extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}},DX=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};rt.formatters.b=r=>r==null?"undefined":Dt.baseEncode(r);rt.formatters.t=r=>r==null?"undefined":_r.baseEncode(r);rt.formatters.m=r=>r==null?"undefined":gn.baseEncode(r);rt.formatters.p=r=>r==null?"undefined":r.toString();rt.formatters.c=r=>r==null?"undefined":r.toString();rt.formatters.k=r=>r==null?"undefined":r.toString();rt.formatters.a=r=>r==null?"undefined":r.toString();rt.formatters.e=r=>r==null?"undefined":J9(r.stack)??J9(r.message)??r.toString();function NX(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function BT(r){let e=NX(`${r}:trace`);return rt.enabled(`${r}:trace`)&&rt.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=rt(`${r}:trace`)),Object.assign(rt(r),{error:rt(`${r}:error`),trace:e,newScope:t=>BT(`${r}:${t}`)})}function J9(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}const MT=Symbol.for("nodejs.util.inspect.custom"),OX=114;let n8=class{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[LT]=!0;toString(){return this.string==null&&(this.string=Dt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Ee.createV1(OX,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Qe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Qe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[MT](){return`PeerId(${this.toString()})`}},LX=class extends n8{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}},BX=class extends n8{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}},MX=class extends n8{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}};const $X=2336;let $T=class{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=Pn.digest(le(this.url))}[MT](){return`PeerId(${this.url})`}[LT]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Ee.createV1($X,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=he(e)),e.toString()===this.toString())}};const UX=114,Z9=2336;function FX(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=wr(Dt.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return VX(Ee.parse(r));throw new RX('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return UT(t)}function UT(r){if(HX(r))return new LX({multihash:r});if(zX(r))try{const e=Xg(r);if(e.type==="Ed25519")return new BX({multihash:r,publicKey:e});if(e.type==="secp256k1")return new MX({multihash:r,publicKey:e})}catch{const t=he(r.digest);return new $T(new URL(t))}throw new DX("Supplied PeerID Multihash is invalid")}function VX(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==UX&&r.code!==Z9)throw new PX("Supplied PeerID CID is invalid");if(r.code===Z9){const e=he(r.multihash.digest);return new $T(new URL(e))}return UT(r.multihash)}function zX(r){return r.code===Pn.code}function HX(r){return r.code===Zt.code}let Gn=class extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"},zd=class extends Error{static name="ValidationError";name="ValidationError"},qX=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"},KX=class extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"};const j3=4,W3=6,G3=273,jX=33,np=41,FT=42,WX=43,VT=53,zT=54,s8=55,HT=56,GX=132,YX=301,QX=302,XX=400,qT=421,JX=444,ZX=445,eJ=446,tJ=447,rJ=448,nJ=449,sJ=454,iJ=460,oJ=461,aJ=465,cJ=466,lJ=480,uJ=481,hJ=443,dJ=477,fJ=478,pJ=479,gJ=277,mJ=275,yJ=276,wJ=280,bJ=281,KT=290,vJ=777;function ev(r){return e=>he(e,r)}function tv(r){return e=>le(e,r)}function ch(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function Yc(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function EJ(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=le(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Yc(n);return Wt([t,s],t.length+s.length)}function SJ(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=_r.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Yc(n);return Wt([t,s],t.length+s.length)}function rv(r){const e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=he(e,"base32"),s=ch(t);return`${n}:${s}`}const jT=function(r){r=r.toString().trim();const e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{const s=parseInt(t,10);if(isNaN(s)||s<0||s>255)throw new Gn("Invalid byte value in IP address");e[n]=s}),e},_J=function(r){let e=0;r=r.toString().trim();const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=ci(t[n]);let o;i&&(o=jT(t[n]),t[n]=he(o.subarray(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,he(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");const i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new Gn("Invalid byte value in IP address");s[e++]=i>>8&255,s[e++]=i&255}return s},xJ=function(r){if(r.byteLength!==4)throw new Gn("IPv4 address was incorrect length");const e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},AJ=function(r){if(r.byteLength!==16)throw new Gn("IPv6 address was incorrect length");const e=[];for(let n=0;n<r.byteLength;n+=2){const s=r[n],i=r[n+1],o=`${s.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new Gn(`Invalid IPv6 address "${t}"`)}};function CJ(r){try{const e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Gn(`Invalid IPv6 address "${r}"`)}}const uy=Object.values(Ll).map(r=>r.decoder),kJ=(function(){let r=uy[0].or(uy[1]);return uy.slice(2).forEach(e=>r=r.or(e)),r})();function IJ(r){return kJ.decode(r)}function TJ(r){return e=>r.encoder.encode(e)}function RJ(r){if(parseInt(r).toString()!==r)throw new zd("Value must be an integer")}function PJ(r){if(r<0)throw new zd("Value must be a positive integer, or zero")}function DJ(r){return e=>{if(e>r)throw new zd(`Value must be smaller than or equal to ${r}`)}}function NJ(...r){return e=>{for(const t of r)t(e)}}const b1=NJ(RJ,PJ,DJ(65535)),Lr=-1;let OJ=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new KX(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}};const Li=new OJ,LJ=[{code:j3,name:"ip4",size:32,valueToBytes:jT,bytesToValue:xJ,validate:r=>{if(!ci(r))throw new zd(`Invalid IPv4 address "${r}"`)}},{code:W3,name:"tcp",size:16,valueToBytes:Yc,bytesToValue:ch,validate:b1},{code:G3,name:"udp",size:16,valueToBytes:Yc,bytesToValue:ch,validate:b1},{code:jX,name:"dccp",size:16,valueToBytes:Yc,bytesToValue:ch,validate:b1},{code:np,name:"ip6",size:128,valueToBytes:_J,bytesToValue:AJ,stringToValue:CJ,validate:r=>{if(!Jg(r))throw new zd(`Invalid IPv6 address "${r}"`)}},{code:FT,name:"ip6zone",size:Lr},{code:WX,name:"ipcidr",size:8,bytesToValue:ev("base10"),valueToBytes:tv("base10")},{code:VT,name:"dns",size:Lr,resolvable:!0},{code:zT,name:"dns4",size:Lr,resolvable:!0},{code:s8,name:"dns6",size:Lr,resolvable:!0},{code:HT,name:"dnsaddr",size:Lr,resolvable:!0},{code:GX,name:"sctp",size:16,valueToBytes:Yc,bytesToValue:ch,validate:b1},{code:YX,name:"udt"},{code:QX,name:"utp"},{code:XX,name:"unix",size:Lr,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:qT,name:"p2p",aliases:["ipfs"],size:Lr,bytesToValue:ev("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?tv("base58btc")(r):Ee.parse(r).multihash.bytes},{code:JX,name:"onion",size:96,bytesToValue:rv,valueToBytes:EJ},{code:ZX,name:"onion3",size:296,bytesToValue:rv,valueToBytes:SJ},{code:eJ,name:"garlic64",size:Lr},{code:tJ,name:"garlic32",size:Lr},{code:rJ,name:"tls"},{code:nJ,name:"sni",size:Lr},{code:sJ,name:"noise"},{code:iJ,name:"quic"},{code:oJ,name:"quic-v1"},{code:aJ,name:"webtransport"},{code:cJ,name:"certhash",size:Lr,bytesToValue:TJ(mu),valueToBytes:IJ},{code:lJ,name:"http"},{code:uJ,name:"http-path",size:Lr,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:hJ,name:"https"},{code:dJ,name:"ws"},{code:fJ,name:"wss"},{code:pJ,name:"p2p-websocket-star"},{code:gJ,name:"p2p-stardust"},{code:mJ,name:"p2p-webrtc-star"},{code:yJ,name:"p2p-webrtc-direct"},{code:wJ,name:"webrtc-direct"},{code:bJ,name:"webrtc"},{code:KT,name:"p2p-circuit"},{code:vJ,name:"memory",size:Lr}];LJ.forEach(r=>{Li.addProtocol(r)});function BJ(r){const e=[];let t=0;for(;t<r.length;){const n=Ts(r,t),s=Li.getProtocol(n),i=ht(n),o=FJ(s,r,t+i);let a=0;o>0&&s.size===Lr&&(a=ht(o));const c=i+a+o,l={code:n,name:s.name,bytes:r.subarray(t,t+c)};if(o>0){const u=t+i+a,h=r.subarray(u,u+o);l.value=s.bytesToValue?.(h)??he(h)}e.push(l),t+=c}return e}function MJ(r){let e=0;const t=[];for(const n of r){if(n.bytes==null){const s=Li.getProtocol(n.code),i=ht(n.code);let o,a=0,c=0;n.value!=null&&(o=s.valueToBytes?.(n.value)??le(n.value),a=o.byteLength,s.size===Lr&&(c=ht(a)));const l=new Uint8Array(i+c+a);let u=0;Wo(n.code,l,u),u+=i,o!=null&&(s.size===Lr&&(Wo(a,l,u),u+=c),l.set(o,u)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return Wt(t,e)}function $J(r){if(r.charAt(0)!=="/")throw new Gn('String multiaddr must start with "/"');const e=[];let t="protocol",n="",s="";for(let i=1;i<r.length;i++){const o=r.charAt(i);o!=="/"&&(t==="protocol"?s+=r.charAt(i):n+=r.charAt(i));const a=i===r.length-1;if(o==="/"||a){const c=Li.getProtocol(s);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",s="",t="protocol";continue}else if(a)throw new Gn(`Component ${s} was missing value`);t="value"}else if(t==="value"){const l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new Gn(`Component ${s} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",s="",t="protocol"}}}if(s!==""&&n!=="")throw new Gn("Incomplete multiaddr");return e}function UJ(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;const t=Li.getProtocol(e.code);if(t==null)throw new Gn(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function FJ(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:Ts(e,t)}const VJ=Symbol.for("nodejs.util.inspect.custom"),WT=Symbol.for("@multiformats/multiaddr"),zJ=[VT,zT,s8,HT];let HJ=class extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}};function qJ(r){if(r==null&&(r="/"),GJ(r))return r.getComponents();if(r instanceof Uint8Array)return BJ(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),$J(r);if(Array.isArray(r))return r;throw new Gn("Must be a string, Uint8Array, Component[], or another Multiaddr")}let KJ=class lh{[WT]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=qJ(e),t.validate!==!1&&jJ(this)}get bytes(){return this.#r==null&&(this.#r=MJ(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=UJ(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";for(const{code:a,name:c,value:l}of this.#e)a===FT&&(i=`%${l??""}`),zJ.includes(a)&&(t="tcp",s=443,n=`${l??""}${i}`,e=a===s8?6:4),(a===W3||a===G3)&&(t=c==="tcp"?"tcp":"udp",s=parseInt(l??"")),(a===j3||a===np)&&(t="tcp",n=`${l??""}${i}`,e=a===np?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:e,value:t})=>{const n=Li.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#e.map(({code:e})=>e)}protoNames(){return this.#e.map(({name:e})=>e)}tuples(){return this.#e.map(({code:e,value:t})=>{if(t==null)return[e];const n=Li.getProtocol(e),s=[e];return t!=null&&s.push(n.valueToBytes?.(t)??le(t)),s})}stringTuples(){return this.#e.map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){const t=new lh(e);return new lh([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new qX(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new lh(n.slice(0,s),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new lh(this.#e.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#e.forEach(({code:n,value:s})=>{n===qT&&e.push([n,s]),n===KT&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?he(Dt.decode(`z${n}`),"base58btc"):he(Ee.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const e of this.#e)if(Li.getProtocol(e.code).path)return e.value??null;return null}equals(e){return Qe(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=WJ.get(t.name);if(n==null)throw new HJ(`no available resolver for ${t.name}`);return(await n(this,e)).map(i=>GT(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==j3&&this.#e[0].code!==np||this.#e[1].code!==W3&&this.#e[1].code!==G3)}[VJ](){return`Multiaddr(${this.toString()})`}};function jJ(r){r.getComponents().forEach(e=>{const t=Li.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}const WJ=new Map;function GJ(r){return!!r?.[WT]}function GT(r){return new KJ(r)}async function*nv(r,e={}){const t=r.getReader();try{for(;;){const n=await t.read();if(n.done)return;yield n.value}}finally{e.preventCancel!==!0&&await t.cancel(),t.releaseLock()}}rt.formatters.b=r=>r==null?"undefined":Dt.baseEncode(r);rt.formatters.t=r=>r==null?"undefined":_r.baseEncode(r);rt.formatters.m=r=>r==null?"undefined":gn.baseEncode(r);rt.formatters.p=r=>r==null?"undefined":r.toString();rt.formatters.c=r=>r==null?"undefined":r.toString();rt.formatters.k=r=>r==null?"undefined":r.toString();rt.formatters.a=r=>r==null?"undefined":r.toString();rt.formatters.e=r=>r==null?"undefined":sv(r.stack)??sv(r.message)??r.toString();function YJ(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function i8(r){let e=YJ(`${r}:trace`);return rt.enabled(`${r}:trace`)&&rt.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=rt(`${r}:trace`)),Object.assign(rt(r),{error:rt(`${r}:error`),trace:e,newScope:t=>i8(`${r}:${t}`)})}function sv(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}var hy={exports:{}},iv;function QJ(){return iv||(iv=1,(function(r){(function(){r.exports=b;var e=86400,t=3200,n=146097*t/400,s=e*n,i=1e3*s,o=864e13,a=4294967296,c=1e6,l="000000000",u=Math.trunc||function(C){var R=C-C%1;return R==0&&(C<0||C===0&&1/C!=1/0)?-0:R},h=b.prototype,d=(b.fromDate=function(C){return new b(+C)},b.fromInt64BE=x(0,1,2,3,0,4),b.fromInt64LE=x(3,2,1,0,4,0),b.fromString=function(V){var R,O=new b,V=(V+="").replace(/^\s*[+\-]?\d+/,function(z){var z=+z,$=1970+(z-1970)%400;return O.year=z-$,$}).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,function(B,z,$){return z<0&&($*=-1),R=6e4*(60*+z+ +$),""}).replace(/\.\d+$/,function(B){return O.nano=+(B+l).substr(1,9),""}).split(/\D+/);if(1<V.length?V[1]--:V[1]=0,O.time=R=Date.UTC.apply(Date,V)-(R||0),isNaN(R))throw new TypeError("Invalid Date");return v(O)},b.fromTimeT=function(C){return w(C,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(C){return this.nano+=+C||0,this},h.getNano=function(){var C=v(this);return(C.time%1e3*c+ +C.nano+1e9)%1e9},h.getTimeT=function(){var R=v(this),C=Math.floor(R.time/1e3),R=R.year;return R&&(C+=R*n*e/t),C},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return A(v(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(C){var R=this,O=R.toDate(),V={H:function(){return T(O.getUTCHours())},L:function(){return D(O.getUTCMilliseconds(),3)},M:function(){return T(O.getUTCMinutes())},N:function(){return D(R.getNano(),9)},S:function(){return T(O.getUTCSeconds())},Y:function(){var B=R.getYear();return 999999<B?"+"+B:9999<B?"+"+D(B,6):0<=B?D(B,4):-999999<=B?"-"+D(-B,6):B},a:function(){return g[O.getUTCDay()]},b:function(){return f[O.getUTCMonth()]},d:function(){return T(O.getUTCDate())},e:function(){return(function(B){return(9<B?"":" ")+(0|B)})(O.getUTCDate())},m:function(){return T(O.getUTCMonth()+1)}};return(function B(z){return z.replace(/%./g,function($){var X=$[1],K=m[X],X=V[X];return K?B(K):X?X():$})})(C||d)},h.writeInt64BE=E(0,1,2,3,0,4),h.writeInt64LE=E(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],g=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],m={"%":"%",F:"%Y-%m-%d",n:`
`,R:"%H:%M",T:"%H:%M:%S",t:"	",X:"%T",Z:"GMT",z:"+0000"};return b;function b(C,R,O){var V=this;if(!(V instanceof b))return new b(C,R,O);V.time=+C||0,V.nano=+R||0,V.year=+O||0,v(V)}function v(C){var R,O,V,B=C.year,z=C.time,$=C.nano,K=(($<0||c<=$)&&($-=(O=Math.floor($/c))*c,z+=O,O=1),B%t);return(z<-o||o<z||K)&&((R=u(z/i))&&(B+=R*t,z-=R*i),(V=A(z)).setUTCFullYear(K+V.getUTCFullYear()),V=(z=+V)+(R=u((B-=K)/t))*i,R&&-o<=V&&V<=o&&(B-=R*t,z=V),O=1),O&&(C.year=B,C.time=z,C.nano=$),C}function A(C){var R=new Date(0);return R.setTime(C),R}function w(B,V){B=+B||0;var O=u((V=(V|0)*a)/s)+u(B/s),V=V%s+B%s,B=u(V/s);return B&&(O+=B,V-=B*s),new b(1e3*V,0,O*t)}function E(C,R,O,V,B,z){return function(K,X){var W=v(this);K=K||new Array(8),P(K,X|=0);var ie=Math.floor(W.time/1e3),W=W.year*(n*e/t),te=u(W/a)+u(ie/a),W=W%a+ie%a,ie=Math.floor(W/a);return ie&&(te+=ie,W-=ie*a),$(K,X+B,te),$(K,X+z,W),K};function $(K,X,te){K[X+C]=te>>24&255,K[X+R]=te>>16&255,K[X+O]=te>>8&255,K[X+V]=255&te}}function x(C,R,O,V,B,z){return function(K,X){P(K,X|=0);var te=$(K,X+B);return w($(K,X+z),te)};function $(K,X){return 16777216*K[X+C]+(K[X+R]<<16|K[X+O]<<8|K[X+V])}}function P(C,R){if(C=C&&C.length,C==null)throw new TypeError("Invalid Buffer");if(C<R+8)throw new RangeError("Out of range")}function T(C){return(9<C?"":"0")+(0|C)}function D(C,R){return(l+(0|C)).substr(-R)}})()})(hy)),hy.exports}var XJ=QJ();const Y3=sa(XJ);class ba extends Error{static name="SignatureVerificationError";constructor(e="Record signature verification failed"){super(e),this.name="SignatureVerificationError"}}class JJ extends Error{static name="RecordExpiredError";constructor(e="Record has expired"){super(e),this.name="RecordExpiredError"}}class YT extends Error{static name="UnsupportedValidityError";constructor(e="The validity type is unsupported"){super(e),this.name="UnsupportedValidityError"}}class ZJ extends Error{static name="RecordTooLargeError";constructor(e="The record is too large"){super(e),this.name="RecordTooLargeError"}}class eZ extends Error{static name="InvalidValueError";constructor(e="Value must be a valid content path starting with /"){super(e),this.name="InvalidValueError"}}class tZ extends Error{static name="InvalidRecordDataError";constructor(e="Invalid record data"){super(e),this.name="InvalidRecordDataError"}}class ov extends Error{static name="InvalidEmbeddedPublicKeyError";constructor(e="Invalid embedded public key"){super(e),this.name="InvalidEmbeddedPublicKeyError"}}var Es;(function(r){(function(n){n.EOL="EOL"})(r.ValidityType||(r.ValidityType={}));let e;(function(n){n[n.EOL=0]="EOL"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.ValidityType||(r.ValidityType={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.value!=null&&(s.uint32(10),s.bytes(n.value)),n.signatureV1!=null&&(s.uint32(18),s.bytes(n.signatureV1)),n.validityType!=null&&(s.uint32(24),r.ValidityType.codec().encode(n.validityType,s)),n.validity!=null&&(s.uint32(34),s.bytes(n.validity)),n.sequence!=null&&(s.uint32(40),s.uint64(n.sequence)),n.ttl!=null&&(s.uint32(48),s.uint64(n.ttl)),n.pubKey!=null&&(s.uint32(58),s.bytes(n.pubKey)),n.signatureV2!=null&&(s.uint32(66),s.bytes(n.signatureV2)),n.data!=null&&(s.uint32(74),s.bytes(n.data)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.value=n.bytes();break}case 2:{o.signatureV1=n.bytes();break}case 3:{o.validityType=r.ValidityType.codec().decode(n);break}case 4:{o.validity=n.bytes();break}case 5:{o.sequence=n.uint64();break}case 6:{o.ttl=n.uint64();break}case 7:{o.pubKey=n.bytes();break}case 8:{o.signatureV2=n.bytes();break}case 9:{o.data=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(Es||(Es={}));let rZ=class extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}};const nZ=i8("ipns:utils"),QT=le("/ipns/"),sZ=0,iZ=18;function oZ(r){let e;if(r.pubKey!=null)try{e=Cs(r.pubKey)}catch(t){throw nZ.error(t),t}if(e!=null)return e}function aZ(r){const e=le("ipns-signature:");return Wt([e,r])}function XT(r){return"signatureV1"in r?Es.encode({value:le(r.value),signatureV1:r.signatureV1,validityType:r.validityType,validity:le(r.validity),sequence:r.sequence,ttl:r.ttl,pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data}):Es.encode({pubKey:r.pubKey,signatureV2:r.signatureV2,data:r.data})}function Cf(r){const e=Es.decode(r);if(e.sequence!=null&&(e.sequence=BigInt(e.sequence)),e.ttl!=null&&(e.ttl=BigInt(e.ttl)),e.signatureV2==null||e.data==null)throw new ba("Missing data or signatureV2");const t=ZT(e.data),n=cZ(t.Value),s=he(t.Validity);if(e.value!=null&&e.signatureV1!=null)return lZ(e),{value:n,validityType:Es.ValidityType.EOL,validity:s,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV1:e.signatureV1,signatureV2:e.signatureV2,data:e.data};if(e.signatureV2!=null)return{value:n,validityType:Es.ValidityType.EOL,validity:s,sequence:t.Sequence,ttl:t.TTL,pubKey:e.pubKey,signatureV2:e.signatureV2,data:e.data};throw new Error("invalid record: does not include signatureV1 or signatureV2")}function JT(r){return Wt([QT,r.bytes])}function Q3(r){const e=wr(r.slice(QT.length));if(!X3(e,sZ)&&!X3(e,iZ))throw new rZ("Multihash in IPNS key was not identity or sha2-256");return e}function ZT(r){const e=xo(r);if(e.ValidityType===0)e.ValidityType=Es.ValidityType.EOL;else throw new YT("The validity type is unsupported");return Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e}function cZ(r){const e=he(r).trim();if(e.startsWith("/"))return e;try{return`/ipfs/${Ee.decode(r).toV1().toString()}`}catch{}try{return`/ipfs/${Ee.parse(e).toV1().toString()}`}catch{}throw new eZ("Value must be a valid content path starting with /")}function lZ(r){if(r.data==null)throw new tZ("Record data is missing");const e=ZT(r.data);if(!Qe(e.Value,r.value??new Uint8Array(0)))throw new ba('Field "value" did not match between protobuf and CBOR');if(!Qe(e.Validity,r.validity??new Uint8Array(0)))throw new ba('Field "validity" did not match between protobuf and CBOR');if(e.ValidityType!==r.validityType)throw new ba('Field "validityType" did not match between protobuf and CBOR');if(e.Sequence!==r.sequence)throw new ba('Field "sequence" did not match between protobuf and CBOR');if(e.TTL!==r.ttl)throw new ba('Field "ttl" did not match between protobuf and CBOR')}function X3(r,e){return r.code===e}const v1=i8("ipns:validator"),uZ=1024*10;async function hZ(r,e){const t=Cf(e);let n;try{const s=aZ(t.data);n=await r.verify(s,t.signatureV2)}catch{n=!1}if(!n)throw v1.error("record signature verification failed"),new ba("Record signature verification failed");if(t.validityType===Es.ValidityType.EOL){if(Y3.fromString(t.validity).toDate().getTime()<Date.now())throw v1.error("record has expired"),new JJ("record has expired")}else if(t.validityType!=null)throw v1.error("the validity type is unsupported"),new YT("The validity type is unsupported");v1("ipns record for %s is valid",t.value)}async function eR(r,e){if(e.byteLength>uZ)throw new ZJ("The record is too large");const t=Q3(r);let n;X3(t,0)&&(n=Xg(t));const s=Cf(e),i=oZ(s)??n;if(i==null)throw new ov("Could not extract public key from IPNS record or routing key");const o=JT(i.toMultihash());if(!Qe(o,r))throw new ov("Embedded public key did not match routing key");await hZ(i,e)}class dZ extends Error{name="InvalidMessageLengthError";code="ERR_INVALID_MESSAGE_LENGTH"}async function*av(r,e={}){const t=/\r?\n/,n=new TextDecoder("utf8");let s="";for await(let i of r){if(typeof i=="string"&&(i=new TextEncoder().encode(i)),nh(i)&&(i=i.subarray()),s+=n.decode(i,{stream:!0}),s.length>(e?.maxMessageLength??s.length))throw new dZ("Incoming message too long");const o=s.split(t);s=o.pop()??"";for(let a=0;a<o.length;a++)yield JSON.parse(o[a])}s+=n.decode(),s!==""&&(yield JSON.parse(s))}class dy extends Error{static name="InvalidRequestError";constructor(e="Invalid request"){super(e),this.name="InvalidRequestError"}}class go extends Error{static name="BadResponseError";constructor(e="Bad response"){super(e),this.name="BadResponseError"}}function fZ(r){return r[Symbol.asyncIterator]!=null}function o8(r){if(fZ(r))return(async()=>{for await(const e of r)return e})();for(const e of r)return e}const cv=le("/ipns/");function lv(r){return Qe(r.subarray(0,cv.byteLength),cv)}class pZ{client;constructor(e){this.client=e}async*findProviders(e,t={}){yield*oa(this.client.getProviders(e,t),n=>({id:n.ID,multiaddrs:n.Addrs??[]}))}async provide(){}async cancelReprovide(){}async put(e,t,n){if(!lv(e))return;const s=Q3(e),i=Ee.createV1(114,s),o=Cf(t);await this.client.putIPNS(i,o,n)}async get(e,t){if(!lv(e))throw new ml("Not found");const n=Q3(e),s=Ee.createV1(114,n);try{const i=await this.client.getIPNS(s,t);return XT(i)}catch(i){throw i.name==="BadResponseError"?new ml("Not found"):i}}}class gZ{client;constructor(e){this.client=e}async findPeer(e,t={}){const n=await o8(this.client.getPeers(e,t));if(n!=null)return{id:n.ID,multiaddrs:n.Addrs??[]};throw new ml("Not found")}async*getClosestPeers(e,t={}){}}const br=BT("delegated-routing-v1-http-api-client"),E1={concurrentRequests:4,timeout:3e4,cacheTTL:300*1e3,cacheName:"delegated-routing-v1-cache"};class mZ{started;httpQueue;shutDownController;clientUrl;timeout;contentRouting;peerRouting;filterAddrs;filterProtocols;inFlightRequests;cacheName;cache;cacheTTL;constructor(e,t={}){this.started=!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.httpQueue=new VC({concurrency:t.concurrentRequests??E1.concurrentRequests}),this.inFlightRequests=new Map,this.clientUrl=e instanceof URL?e:new URL(e),this.timeout=t.timeout??E1.timeout,this.filterAddrs=t.filterAddrs,this.filterProtocols=t.filterProtocols,this.contentRouting=new pZ(this),this.peerRouting=new gZ(this),this.cacheName=t.cacheName??E1.cacheName,this.cacheTTL=t.cacheTTL??E1.cacheTTL}get[IX](){return this.contentRouting}get[TX](){return this.peerRouting}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cacheTTL>0&&(this.cache=await globalThis.caches?.open(this.cacheName),this.cache!=null&&br("cache enabled with ttl %d",this.cacheTTL)))}async stop(){this.httpQueue.clear(),this.shutDownController.abort(),await globalThis.caches?.delete(this.cacheName),this.started=!1}async*getProviders(e,t={}){br("getProviders starts: %c",e);const n=AbortSignal.timeout(this.timeout),s=xt([this.shutDownController.signal,n,t.signal]),i=Lt(),o=Lt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;const a=new URL(`${this.clientUrl}routing/v1/providers/${e.toString()}`);this.#t(a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:s},l=await this.#r(a.toString(),c);if(l==null)throw new go("No response received");if(!l.ok)throw l.status===404?new ml("No matching records found"):l.status===422?new dy("Request does not conform to schema or semantic constraints"):new go(`Unexpected status code: ${l.status}`);if(l.body==null)throw new go("Routing response had no body");const u=l.headers.get("Content-Type");if(u==null)throw new go("No Content-Type header received");if(u?.startsWith("application/json")){const h=await l.json();for(const d of h.Providers){const f=this.#e(d);f!=null&&(yield f)}}else if(u.includes("application/x-ndjson"))for await(const h of av(nv(l.body))){const d=this.#e(h);d!=null&&(yield d)}else throw new go(`Unsupported Content-Type: ${u}`)}finally{s.clear(),o.resolve(),br("getProviders finished: %c",e)}}async*getPeers(e,t={}){br("getPeers starts: %c",e);const n=AbortSignal.timeout(this.timeout),s=xt([this.shutDownController.signal,n,t.signal]),i=Lt(),o=Lt();this.httpQueue.add(async()=>(i.resolve(),o.promise));try{await i.promise;const a=new URL(`${this.clientUrl}routing/v1/peers/${e.toCID().toString()}`);this.#t(a,t.filterAddrs,t.filterProtocols);const c={headers:{Accept:"application/x-ndjson"},signal:s},l=await this.#r(a.toString(),c);if(l.status===404)throw new ml("No matching records found");if(l.status===422)throw new dy("Request does not conform to schema or semantic constraints");if(l.body==null)throw new go("Routing response had no body");if(l.headers.get("Content-Type")==="application/json"){const h=await l.json();for(const d of h.Peers){const f=this.#e(d);f!=null&&(yield f)}}else for await(const h of av(nv(l.body))){const d=this.#e(h);d!=null&&(yield d)}}catch(a){br.error("getPeers errored:",a)}finally{s.clear(),o.resolve(),br("getPeers finished: %c",e)}}async getIPNS(e,t={}){br("getIPNS starts: %s",e);const n=AbortSignal.timeout(this.timeout),s=xt([this.shutDownController.signal,n,t.signal]),i=Lt(),o=Lt();this.httpQueue.add(async()=>(i.resolve(),o.promise));const a=`${this.clientUrl}routing/v1/ipns/${e}`;try{await i.promise;const c={headers:{Accept:"application/vnd.ipfs.ipns-record"},signal:s},l=await this.#r(a,c);if(br("getIPNS GET %s %d",a,l.status),l.status===404)throw new ml("No matching records found");if(l.status===422)throw new dy("Request does not conform to schema or semantic constraints");if(l.body==null)throw new go("GET ipns response had no body");const u=await l.arrayBuffer(),h=new Uint8Array(u,0,u.byteLength);return t.validate!==!1&&await eR(JT(e.multihash),h),Cf(h)}catch(c){throw br.error("getIPNS GET %s error:",a,c),c}finally{s.clear(),o.resolve(),br("getIPNS finished: %s",e)}}async putIPNS(e,t,n={}){br("putIPNS starts: %c",e);const s=AbortSignal.timeout(this.timeout),i=xt([this.shutDownController.signal,s,n.signal]),o=Lt(),a=Lt();this.httpQueue.add(async()=>(o.resolve(),a.promise));const c=`${this.clientUrl}routing/v1/ipns/${e}`;try{await o.promise;const l=XT(t),u={method:"PUT",headers:{"Content-Type":"application/vnd.ipfs.ipns-record"},body:l,signal:i},h=await this.#r(c,u);if(br("putIPNS PUT %s %d",c,h.status),h.status!==200)throw new go("PUT ipns response had status other than 200")}catch(l){throw br.error("putIPNS PUT %s error:",c,l.stack),l}finally{i.clear(),a.resolve(),br("putIPNS finished: %c",e)}}#e(e){try{const t=[],n=e.Addrs?.map(GT)??[];return e.Protocols!=null&&t.push(...e.Protocols),e.Protocol!=null&&(t.push(e.Protocol),delete e.Protocol),{...e,Schema:"peer",ID:FX(e.ID),Addrs:n,Protocols:t}}catch(t){br.error("could not conform record to peer schema",t)}}#t(e,t,n){if(t!=null||this.filterAddrs!=null){const s=t?.join(",")??this.filterAddrs?.join(",")??"";s!==""&&e.searchParams.set("filter-addrs",s)}if(n!=null||this.filterProtocols!=null){const s=n?.join(",")??this.filterProtocols?.join(",")??"";s!==""&&e.searchParams.set("filter-protocols",s)}}async#r(e,t){const n=t.method??"GET",s=`${n}-${e}`;if(n==="GET"){const c=await this.cache?.match(e);if(c!=null){if(parseInt(c.headers.get("x-cache-expires")??"0",10)>Date.now())return br("returning cached response for %s",s),c;await this.cache?.delete(e)}}const i=this.inFlightRequests.get(s);if(i!=null){const c=await i;return br("deduplicating outgoing request for %s",s),c.clone()}const o=fetch(e,t).then(async c=>{if(this.cache!=null&&c.ok&&n==="GET"){const l=Date.now()+this.cacheTTL,u=new Headers(c.headers);u.set("x-cache-expires",l.toString());const h=new Response(c.clone().body,{status:c.status,statusText:c.statusText,headers:u});await this.cache.put(e,h)}return c}).finally(()=>{this.inFlightRequests.delete(s)});return this.inFlightRequests.set(s,o),await o}}function yZ(r,e={}){return new mZ(new URL(r),e)}function wZ(){return{filterProtocols:["unknown","transport-bitswap","transport-ipfs-gateway-http"],filterAddrs:["https","webtransport","webrtc","webrtc-direct","wss","tls"]}}const uv="[a-fA-F\\d:]",Io=r=>r&&r.includeBoundaries?`(?:(?<=\\s|^)(?=${uv})|(?<=${uv})(?=\\s|$))`:"",fs="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",tr="[a-fA-F\\d]{1,4}",u2=`
(?:
(?:${tr}:){7}(?:${tr}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8
(?:${tr}:){6}(?:${fs}|:${tr}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4
(?:${tr}:){5}(?::${fs}|(?::${tr}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4
(?:${tr}:){4}(?:(?::${tr}){0,1}:${fs}|(?::${tr}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4
(?:${tr}:){3}(?:(?::${tr}){0,2}:${fs}|(?::${tr}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4
(?:${tr}:){2}(?:(?::${tr}){0,3}:${fs}|(?::${tr}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4
(?:${tr}:){1}(?:(?::${tr}){0,4}:${fs}|(?::${tr}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4
(?::(?:(?::${tr}){0,5}:${fs}|(?::${tr}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4
)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),bZ=new RegExp(`(?:^${fs}$)|(?:^${u2}$)`),vZ=new RegExp(`^${fs}$`),EZ=new RegExp(`^${u2}$`),h2=r=>r&&r.exact?bZ:new RegExp(`(?:${Io(r)}${fs}${Io(r)})|(?:${Io(r)}${u2}${Io(r)})`,"g");h2.v4=r=>r&&r.exact?vZ:new RegExp(`${Io(r)}${fs}${Io(r)}`,"g");h2.v6=r=>r&&r.exact?EZ:new RegExp(`${Io(r)}${u2}${Io(r)}`,"g");function SZ(r){const e=(...t)=>r(...t);return Object.defineProperty(e,"name",{value:`functionTimeout(${r.name||"<anonymous>"})`,configurable:!0}),e}const{toString:_Z}=Object.prototype;function xZ(r){return _Z.call(r)==="[object RegExp]"}const hv={global:"g",ignoreCase:"i",multiline:"m",dotAll:"s",sticky:"y",unicode:"u"};function AZ(r,e={}){if(!xZ(r))throw new TypeError("Expected a RegExp instance");const t=Object.keys(hv).map(s=>(typeof e[s]=="boolean"?e[s]:r[s])?hv[s]:"").join(""),n=new RegExp(e.source||r.source,t);return n.lastIndex=typeof e.lastIndex=="number"?e.lastIndex:r.lastIndex,n}function tR(r,e,{timeout:t}={}){try{return SZ(()=>AZ(r).test(e),{timeout:t})()}catch(n){throw n}}const CZ=15,kZ=45,rR={timeout:400};function c0(r){return r.length>kZ?!1:tR(h2.v6({exact:!0}),r,rR)}function nR(r){return r.length>CZ?!1:tR(h2.v4({exact:!0}),r,rR)}const dv={http:"80",https:"443",ws:"80",wss:"443"},IZ=["http","https","ws","wss"];function TZ(r,e){e=e??{};const t=e.defaultDnsType??"dns",{scheme:n,hostname:s,port:i,path:o}=RZ(r),a=[PZ(s,t),DZ(i,n),NZ(n)];o!=null&&a.push(OZ(o));const c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return Ye(c)}function RZ(r){const[e]=r.split(":");IZ.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:s,pathname:i,search:o}=new URL(r);if(s==null||s===""){const c=LZ(e);c!=null&&(s=c),c==null&&t==="http:"&&(s="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:s,path:a}}function PZ(r,e){if(!(r==null||r==="")){if(nR(r))return["ip4",r];if(c0(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(c0(t))return["ip6",t]}return[e,r]}}function DZ(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function NZ(r){if(r.match(/^tcp$|^udp$/)==null)return r==="https"?["/tls/http"]:r==="wss"?["/tls/ws"]:[r]}function OZ(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function LZ(r){if(!(r==null||r===""||dv[r]==null))return dv[r]}const BZ=["https://trustless-gateway.link","https://4everland.io"],MZ=2336;function $Z(r){return r=r.toString(),{id:xu(Ee.createV1(MZ,Pn.digest(le(r)))),multiaddrs:[TZ(r)]}}class UZ{gateways;shuffle;constructor(e={}){this.gateways=(e.gateways??BZ).map(t=>$Z(t)),this.shuffle=e.shuffle??!0}async*findProviders(e,t){yield*(this.shuffle?this.gateways.toSorted(()=>Math.random()>.5?1:-1):this.gateways).map(n=>({...n,protocols:["transport-ipfs-gateway-http"]}))}}function FZ(r={}){return new UZ(r)}class VZ{libp2p;constructor(e){this.libp2p=e}async provide(e,t){await this.libp2p.contentRouting.provide(e,t)}async cancelReprovide(e,t){await this.libp2p.contentRouting.cancelReprovide(e,t)}async*findProviders(e,t){yield*this.libp2p.contentRouting.findProviders(e,t)}async put(e,t,n){await this.libp2p.contentRouting.put(e,t,n)}async get(e,t){return this.libp2p.contentRouting.get(e,t)}async findPeer(e,t){return this.libp2p.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t){yield*this.libp2p.peerRouting.getClosestPeers(e,t)}}function zZ(r){return new VZ(r)}function HZ(r){return r[Symbol.asyncIterator]!=null}function Vl(r){if(HZ(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}function qZ(r){return typeof r?.then=="function"}class KZ extends dT{data;constructor(){super(),this.data=new Map}put(e,t,n){n?.signal?.throwIfAborted();let s;if(t instanceof Uint8Array)s=[t];else{const i=Vl(t);if(qZ(i))return i.then(o=>this._put(e,o,n));s=i}return this._put(e,s,n)}_put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(_r.encode(e.multihash.bytes),t),e}*get(e,t){t?.signal?.throwIfAborted();const n=this.data.get(_r.encode(e.multihash.bytes));if(n==null)throw new W5;yield*n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(_r.encode(e.multihash.bytes))}async delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(_r.encode(e.multihash.bytes))}*getAll(e){e?.signal?.throwIfAborted();for(const[t,n]of this.data.entries())yield{cid:Ee.createV1(As,wr(_r.decode(t))),bytes:(async function*(){yield*n})()},e?.signal?.throwIfAborted()}}yn("blockstore:core:tiered");const jZ="SHARDING";function WZ(r){return r[Symbol.asyncIterator]!=null}function fv(r,e){return WZ(r)?(async function*(){yield*(await Vl(r)).sort(e)})():(function*(){yield*Vl(r).sort(e)})()}class GZ{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:s}of e)await this.put(n,s,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,s){e.push({key:n,value:s})},delete(n){t.push(n)},commit:async n=>{await jo(this.putMany(e,n)),e=[],await jo(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const s=e.prefix;n=Eo(n,i=>i.key.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Eo(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>fv(s,i),n)),e.offset!=null){let s=0;const i=e.offset;n=Eo(n,()=>s++>=i)}return e.limit!=null&&(n=r0(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const s=e.prefix;n=Eo(n,i=>i.toString().startsWith(s))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>Eo(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>fv(s,i),n)),e.offset!=null){const s=e.offset;let i=0;n=Eo(n,()=>i++>=s)}return e.limit!=null&&(n=r0(n,e.limit)),n}}class sR extends GZ{data;constructor(){super(),this.data=new Map}put(e,t,n){return n?.signal?.throwIfAborted(),this.data.set(e.toString(),t),e}get(e,t){t?.signal?.throwIfAborted();const n=this.data.get(e.toString());if(n==null)throw new W5;return n}has(e,t){return t?.signal?.throwIfAborted(),this.data.has(e.toString())}delete(e,t){t?.signal?.throwIfAborted(),this.data.delete(e.toString())}*_all(e,t){t?.signal?.throwIfAborted();for(const[n,s]of this.data.entries())yield{key:new Pt(n),value:s},t?.signal?.throwIfAborted()}*_allKeys(e,t){t?.signal?.throwIfAborted();for(const n of this.data.keys())yield new Pt(n),t?.signal?.throwIfAborted()}}new Pt(jZ);yn("datastore:core:tiered");var YZ={};async function QZ(r){if(r.connectionProtector===null&&YZ?.LIBP2P_FORCE_PNET!=null)throw new ue("Private network is enforced, but no protector was provided");return r}var l0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={publicKey:ot(0),payloadType:ot(0),payload:ot(0),signature:ot(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=t.bytes();break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(l0||(l0={}));class XZ extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}class Zs{static createFromProtobuf=e=>{const t=l0.decode(e),n=Cs(t.publicKey);return new Zs({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})};static seal=async(e,t,n)=>{if(t==null)throw new Error("Missing private key");const s=e.domain,i=e.codec,o=e.marshal(),a=pv(s,i,o),c=await t.sign(a.subarray(),n);return new Zs({publicKey:t.publicKey,payloadType:i,payload:o,signature:c})};static openAndCertify=async(e,t,n)=>{const s=Zs.createFromProtobuf(e);if(!await s.validate(t,n))throw new XZ("Envelope signature is not valid for the given domain");return s};publicKey;payloadType;payload;signature;marshaled;constructor(e){const{publicKey:t,payloadType:n,payload:s,signature:i}=e;this.publicKey=t,this.payloadType=n,this.payload=s,this.signature=i}marshal(){return this.marshaled==null&&(this.marshaled=l0.encode({publicKey:Qs(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return e==null?!1:Qe(this.marshal(),e.marshal())}async validate(e,t){const n=pv(e,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,t)}}const pv=(r,e,t)=>{const n=le(r),s=Ys(n.byteLength),i=Ys(e.length),o=Ys(t.length);return new ze(s,n,i,e,o,t)},JZ="libp2p-peer-record",ZZ=Uint8Array.from([3,1]);var u0;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=tt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.multiaddr!=null&&s.multiaddr.byteLength>0&&(i.uint32(10),i.bytes(s.multiaddr)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={multiaddr:ot(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.multiaddr=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>et(s,t.codec()),t.decode=(s,i)=>Ze(s,t.codec(),i)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const i of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={peerId:ot(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.peerId=t.bytes();break}case 2:{i.seq=t.uint64();break}case 3:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new Ir('Decode error - map field "addresses" had too many elements');i.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:s.limits?.addresses$}));break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(u0||(u0={}));function eee(r,e){const t=(n,s)=>n.toString().localeCompare(s.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,s)=>e[s].equals(n)))}class In{static createFromProtobuf=e=>{const t=u0.decode(e),n=Ps(wr(t.peerId)),s=(t.addresses??[]).map(o=>Ye(o.multiaddr)),i=t.seq;return new In({peerId:n,multiaddrs:s,seqNumber:i})};static DOMAIN=JZ;static CODEC=ZZ;peerId;multiaddrs;seqNumber;domain=In.DOMAIN;codec=In.CODEC;marshaled;constructor(e){const{peerId:t,multiaddrs:n,seqNumber:s}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=s??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=u0.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof In)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!eee(this.multiaddrs,e.multiaddrs))}}const tee=36e5,ree=216e5;var Aa;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=tt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&s.value.byteLength>0&&(i.uint32(18),i.bytes(s.value)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={key:"",value:ot(0)},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.key=s.string();break}case 2:{a.value=s.bytes();break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>et(s,t.codec()),t.decode=(s,i)=>Ze(s,t.codec(),i)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),(function(t){let n;t.codec=()=>(n==null&&(n=tt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.key!=null&&s.key!==""&&(i.uint32(10),i.string(s.key)),s.value!=null&&(i.uint32(18),d0.codec().encode(s.value,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={key:""},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.key=s.string();break}case 2:{a.value=d0.codec().decode(s,s.uint32(),{limits:o.limits?.value});break}default:{s.skipType(l&7);break}}}return a})),n),t.encode=s=>et(s,t.codec()),t.decode=(s,i)=>Ze(s,t.codec(),i)})(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const i of t.addresses)n.uint32(10),h0.codec().encode(i,n);if(t.protocols!=null)for(const i of t.protocols)n.uint32(18),n.string(i);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[i,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:i,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[i,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:i,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{if(s.limits?.addresses!=null&&i.addresses.length===s.limits.addresses)throw new Ir('Decode error - map field "addresses" had too many elements');i.addresses.push(h0.codec().decode(t,t.uint32(),{limits:s.limits?.addresses$}));break}case 2:{if(s.limits?.protocols!=null&&i.protocols.length===s.limits.protocols)throw new Ir('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 4:{i.publicKey=t.bytes();break}case 5:{i.peerRecordEnvelope=t.bytes();break}case 6:{if(s.limits?.metadata!=null&&i.metadata.size===s.limits.metadata)throw new u9('Decode error - map field "metadata" had too many elements');const c=r.Peer$metadataEntry.codec().decode(t,t.uint32());i.metadata.set(c.key,c.value);break}case 7:{if(s.limits?.tags!=null&&i.tags.size===s.limits.tags)throw new u9('Decode error - map field "tags" had too many elements');const c=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:s.limits?.tags$value}});i.tags.set(c.key,c.value);break}case 8:{i.updated=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Aa||(Aa={}));var h0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={multiaddr:ot(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.multiaddr=t.bytes();break}case 2:{i.isCertified=t.bool();break}case 3:{i.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(h0||(h0={}));var d0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.value=t.uint32();break}case 2:{i.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(d0||(d0={}));function nee(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;r.type==="RSA"&&(t=r.toMultihash());const n=Cs(e.publicKey,t);return Fl(n)}function see(r,e,t){const n=Aa.decode(e);return uh(r,n,t)}function uh(r,e,t){const n=new Map,s=BigInt(Date.now());for(const[i,o]of e.tags.entries())o.expiry!=null&&o.expiry<s||n.set(i,o);return{...e,id:nee(r,e),addresses:e.addresses.filter(({observed:i})=>i!=null&&i>Date.now()-t).map(({multiaddr:i,isCertified:o})=>({multiaddr:Ye(i),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function iee(r,e){return oee(r.addresses,e.addresses)&&aee(r.protocols,e.protocols)&&cee(r.publicKey,e.publicKey)&&lee(r.peerRecordEnvelope,e.peerRecordEnvelope)&&uee(r.metadata,e.metadata)&&hee(r.tags,e.tags)}function oee(r,e){return oR(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!Qe(t.multiaddr,n.multiaddr)))}function aee(r,e){return oR(r,e,(t,n)=>t===n)}function cee(r,e){return iR(r,e)}function lee(r,e){return iR(r,e)}function uee(r,e){return aR(r,e,(t,n)=>Qe(t,n))}function hee(r,e){return aR(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function iR(r,e){return r==null&&e==null?!0:r!=null&&e!=null?Qe(r,e):!1}function oR(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function aR(r,e,t){if(r.size!==e.size)return!1;for(const[n,s]of r.entries()){const i=e.get(n);if(i==null||!t(s,i))return!1}return!0}const cR="/peers/";function S1(r){if(!Oa(r)||r.type==null)throw new ue("Invalid PeerId");const e=r.toCID().toString();return new Pt(`${cR}${e}`)}async function dee(r,e,t,n,s){const i=new Map;for(const o of t){if(o==null)continue;if(o.multiaddr instanceof Uint8Array&&(o.multiaddr=Ye(o.multiaddr)),!Zg(o.multiaddr))throw new ue("Multiaddr was invalid");if(!await e(r,o.multiaddr,s))continue;const a=o.isCertified??!1,c=o.multiaddr.toString(),l=i.get(c);l!=null?o.isCertified=l.isCertified||a:i.set(c,{multiaddr:o.multiaddr,isCertified:a})}return[...i.values()].sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({isCertified:o,multiaddr:a})=>{const c=a.getComponents().find(l=>l.code===qe)?.value;return r.equals(c)&&(a=a.decapsulate(Ye(`/p2p/${r}`))),{isCertified:o,multiaddr:a.bytes}})}async function fy(r,e,t,n){if(e==null)throw new ue("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new ue("publicKey bytes do not match peer id publicKey bytes");const s=n.existingPeer?.peer;if(s!=null&&!r.equals(s.id))throw new ue("peer id did not match existing peer id");let i=s?.addresses??[],o=new Set(s?.protocols??[]),a=s?.metadata??new Map,c=s?.tags??new Map,l=s?.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(i=[],e.multiaddrs!=null&&i.push(...e.multiaddrs.map(d=>({isCertified:!1,multiaddr:d}))),e.addresses!=null&&i.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const d=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=_1(d,{validate:gv})}if(e.tags!=null){const d=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=_1(d,{validate:mv,map:yv})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&i.push(...e.multiaddrs.map(d=>({isCertified:!1,multiaddr:d}))),e.addresses!=null&&i.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const d=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[f,g]of d)g==null?a.delete(f):a.set(f,g);a=_1([...a.entries()],{validate:gv})}if(e.tags!=null){const d=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),f=new Map(c);for(const[g,m]of d)m==null?f.delete(g):f.set(g,m);c=_1([...f.entries()],{validate:mv,map:yv})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;s?.id.publicKey!=null?u=Qs(s.id.publicKey):e.publicKey!=null?u=Qs(e.publicKey):r.publicKey!=null&&(u=Qs(r.publicKey));const h={addresses:await dee(r,n.addressFilter??(async()=>!0),i,n.existingPeer?.peerPB.addresses,n),protocols:[...o.values()].sort((d,f)=>d.localeCompare(f)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return h.addresses.forEach(d=>{d.observed=n.existingPeer?.peerPB.addresses?.find(f=>Qe(f.multiaddr,f.multiaddr))?.observed??Date.now()}),r.type!=="RSA"&&delete h.publicKey,h}function _1(r,e){const t=new Map;for(const[n,s]of r)s!=null&&e.validate(n,s);for(const[n,s]of r.sort(([i],[o])=>i.localeCompare(o)))s!=null&&t.set(n,e.map?.(n,s)??s);return t}function gv(r,e){if(typeof r!="string")throw new ue("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new ue("Metadata value must be a Uint8Array")}function mv(r,e){if(typeof r!="string")throw new ue("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new ue("Tag value must be an integer");if(e.value<0||e.value>100)throw new ue("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new ue("Tag ttl must be an integer");if(e.ttl<0)throw new ue("Tag ttl must be between greater than 0")}}function yv(r,e){let t;e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl)));const n={value:e.value??0};return t!=null&&(n.expiry=t),n}function lR(r){const e=r.toString().split("/")[2],t=Ee.parse(e,_r);return xu(t)}function py(r,e,t){const n=lR(r);return see(n,e,t)}function fee(r,e){return{prefix:cR,filters:(r.filters??[]).map(t=>({key:n,value:s})=>t(py(n,s,e))),orders:(r.orders??[]).map(t=>(n,s)=>t(py(n.key,n.value,e),py(s.key,s.value,e)))}}class pee{peerId;datastore;locks;addressFilter;log;maxAddressAge;maxPeerAge;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=i2({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??tee,this.maxPeerAge=t.maxPeerAge??ree}getLock(e){let t=this.locks.get(e);return t==null&&(t={refs:0,lock:tT({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,t.refs===0&&(t.lock.finalize(),this.locks.delete(e))}async getReadLock(e,t){const n=this.getLock(e);try{const s=await n.lock.readLock(t);return()=>{s(),this.maybeRemoveLock(e,n)}}catch(s){throw this.maybeRemoveLock(e,n),s}}async getWriteLock(e,t){const n=this.getLock(e);try{const s=await n.lock.writeLock(t);return()=>{s(),this.maybeRemoveLock(e,n)}}catch(s){throw this.maybeRemoveLock(e,n),s}}async has(e,t){try{return await this.load(e,t),!0}catch(n){if(n.name!=="NotFoundError")throw n}return!1}async delete(e,t){this.peerId.equals(e)||await this.datastore.delete(S1(e),t)}async load(e,t){const n=S1(e),s=await this.datastore.get(n,t),i=Aa.decode(s);if(this.#r(e,i))throw await this.datastore.delete(n,t),new dn;return uh(e,i,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t,n){const s=await this.#e(e,n),i=await fy(e,t,"patch",{...n,addressFilter:this.addressFilter});return this.#t(e,i,s)}async patch(e,t,n){const s=await this.#e(e,n),i=await fy(e,t,"patch",{...n,addressFilter:this.addressFilter,existingPeer:s});return this.#t(e,i,s)}async merge(e,t,n){const s=await this.#e(e,n),i=await fy(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:s});return this.#t(e,i,s)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(fee(e??{},this.maxAddressAge),e)){const s=lR(t);if(s.equals(this.peerId))continue;const i=Aa.decode(n);if(this.#r(s,i)){await this.datastore.delete(t,e);continue}yield uh(s,i,this.peerId.equals(s)?1/0:this.maxAddressAge)}}async#e(e,t){try{const n=S1(e),s=await this.datastore.get(n,t),i=Aa.decode(s);if(this.#r(e,i))throw await this.datastore.delete(n,t),new dn;return{peerPB:i,peer:uh(e,i,this.maxAddressAge)}}catch(n){n.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",n)}}async#t(e,t,n,s){t.updated=Date.now();const i=Aa.encode(t);return await this.datastore.put(S1(e),i,s),{peer:uh(e,t,this.maxAddressAge),previous:n?.peer,updated:n==null||!iee(t,n.peerPB)}}#r(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,s=Date.now()-this.maxAddressAge,i=t.addresses.filter(o=>o.observed!=null&&o.observed>s);return n&&i.length===0}}class gee{store;events;peerId;log;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new pee(e,t)}[Symbol.toStringTag]="@libp2p/peer-store";async forEach(e,t){for await(const n of this.store.all(t))e(n)}async all(e){return Vl(this.store.all(e))}async delete(e,t){const n=await this.store.getReadLock(e,t);try{await this.store.delete(e,t)}finally{n()}}async has(e,t){const n=await this.store.getReadLock(e,t);try{return await this.store.has(e,t)}finally{this.log.trace("has release read lock"),n?.()}}async get(e,t){const n=await this.store.getReadLock(e,t);try{return await this.store.load(e,t)}finally{n?.()}}async getInfo(e,t){const n=await this.get(e,t);return{id:n.id,multiaddrs:n.addresses.map(({multiaddr:s})=>s)}}async save(e,t,n){const s=await this.store.getWriteLock(e,n);try{const i=await this.store.save(e,t,n);return this.#e(e,i),i.peer}finally{s?.()}}async patch(e,t,n){const s=await this.store.getWriteLock(e,n);try{const i=await this.store.patch(e,t,n);return this.#e(e,i),i.peer}finally{s?.()}}async merge(e,t,n){const s=await this.store.getWriteLock(e,n);try{const i=await this.store.merge(e,t,n);return this.#e(e,i),i.peer}finally{s?.()}}async consumePeerRecord(e,t,n){const s=Oa(t)?t:Oa(t?.expectedPeer)?t.expectedPeer:void 0,i=Oa(t)||t===void 0?n:t,o=await Zs.openAndCertify(e,In.DOMAIN,i),a=xu(o.publicKey.toCID());if(s?.equals(a)===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",s,a),!1;const c=In.createFromProtobuf(o.payload);let l;try{l=await this.get(a,i)}catch(u){if(u.name!=="NotFoundError")throw u}if(l?.peerRecordEnvelope!=null){const u=Zs.createFromProtobuf(l.peerRecordEnvelope),h=In.createFromProtobuf(u.payload);if(h.seqNumber>=c.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",h.seqNumber,c.seqNumber),!1}return await this.patch(c.peerId,{peerRecordEnvelope:e,addresses:c.multiaddrs.map(u=>({isCertified:!0,multiaddr:u}))},i),!0}#e(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))}}function mee(r,e={}){return new gee(r,e)}const wv=864e13;class yee{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=ks({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){const t=ct(e);let n=t.host;(t.type==="ip4"||t.type==="ip6")&&t.sni!=null&&(n=t.sni);for(const s of this.mappings.values())if(s.domain===n)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const s=m5(n)===!0;this.mappings.set(n,{domain:e,verified:s,expires:s?wv-Date.now():0,lastVerified:s?wv-Date.now():void 0})})}remove(e){const t=ct(e);if(t.type!=="ip4"&&t.type!=="ip6")return!1;let n=!1;for(const[s,i]of this.mappings.entries())i.domain===t.sni&&(this.log("removing %s to %s DNS mapping %e",s,i.domain),this.mappings.delete(s),n=n||i.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr;if(!vs(s))continue;const i=ct(s);for(const[o,a]of this.mappings.entries()){if(i.host!==o)continue;const c=this.maybeAddSNIComponent(s,a.domain);c!=null&&(e.splice(n,1),n--,t.push({multiaddr:c,verified:a.verified,type:"dns-mapping",expires:a.expires,lastVerified:a.lastVerified}))}}return t}maybeAddSNIComponent(e,t){const n=e.getComponents();for(let s=0;s<n.length;s++)if(n[s].code===Ma&&n[s+1]?.code!==Gp)return n.splice(s+1,0,{name:"sni",code:Gp,value:t}),Ye(n)}confirm(e,t){const n=ct(e);let s=n.host;(n.type==="ip4"||n.type==="ip6")&&n.sni!=null&&(s=n.sni);let i=!1;for(const[o,a]of this.mappings.entries())a.domain===s&&(this.log("marking %s to %s DNS mapping as verified",o,a.domain),i=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return i}unconfirm(e,t){const n=ct(e);if(n.type!=="ip4"&&n.type!=="ip6")return!1;const s=n.sni??n.host;let i=!1;for(const[o,a]of this.mappings.entries())a.domain===s&&(this.log("removing verification of %s to %s DNS mapping",o,a.domain),i=i||a.verified,a.verified=!1,a.expires=Date.now()+t);return i}}class wee{log;mappings;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=ks({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){const t=ct(e);if(t.type!=="ip4"&&t.type!=="ip6")return!1;for(const n of this.mappings.values())for(const s of n)if(s.externalIp===t.host)return!0;return!1}add(e,t,n,s=t,i="tcp"){const o=`${e}-${t}-${i}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:s,externalFamily:ci(n)?4:6,protocol:i,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=ct(e);if(t.type!=="ip4"&&t.type!=="ip6")return!1;let n=!1;for(const[s,i]of this.mappings.entries()){for(let o=0;o<i.length;o++){const a=i[o];a.externalIp===t.host&&a.externalPort===t.port&&a.protocol===t.protocol&&(this.log("removing %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,t.host,t.port,t.protocol),n=n||a.verified,i.splice(o,1),o--)}i.length===0&&this.mappings.delete(s)}return n}getAll(e){const t=[];for(const{multiaddr:n}of e){if(!vs(n))continue;const s=ct(n);if(s.type!=="ip4"&&s.type!=="ip6")continue;let i;if(s.protocol==="tcp"?i=`${s.host}-${s.port}-tcp`:s.protocol==="udp"&&(i=`${s.host}-${s.port}-udp`),i==null)continue;const o=this.mappings.get(i);if(o!=null)for(const a of o)t.push({multiaddr:this.maybeOverrideIp(n,a.externalIp,a.externalFamily,a.protocol,a.externalPort),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}maybeOverrideIp(e,t,n,s,i){const o=e.getComponents(),a=o.findIndex(l=>l.code===Wp||l.code===Xa),c=o.findIndex(l=>l.name===s);return a>-1&&c>-1?(o[a].value=t,o[a].code=n===4?Wp:Xa,o[c].value=`${i}`,Ye(o)):e}confirm(e,t){if(!vs(e))return!1;const n=ct(e);let s=!1;for(const i of this.mappings.values())for(const o of i)o.externalIp===n.host&&(this.log("marking %s to %s IP mapping as verified",o.internalIp,o.externalIp),s=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return s}unconfirm(e,t){if(!vs(e))return!1;const n=ct(e);let s=!1;for(const i of this.mappings.values())for(let o=0;o<i.length;o++){const a=i[o];a.externalIp===n.host&&a.externalPort===n.port&&a.protocol===n.protocol&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",a.externalIp,a.externalPort,n.host,n.port,n.protocol),s=s||a.verified,a.verified=!1,a.expires=Date.now()+t)}return s}}const bee={maxObservedAddresses:10};class vee{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=ks({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??bee.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Zn(e)||NK(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Ye(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){const t=this.addresses.get(e.toString())?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),s=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,s),i}}const Eee={maxObservedAddresses:10};class See{log;addresses;maxObservedAddresses;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=ks({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??Eee.maxObservedAddresses}get(e,t){if(Zn(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let s=this.addresses.get(n);return s==null&&(s={verified:!vs(e),expires:0},this.addresses.set(n,s)),{multiaddr:e,verified:s.verified,type:"transport",expires:s.expires,lastVerified:s.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){const t=this.toKey(e),n=this.addresses.get(t)?.verified??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),s=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},i=s.verified;return s.verified=!0,s.expires=Date.now()+t,s.lastVerified=Date.now(),this.addresses.set(n,s),i}unconfirm(e,t){const n=this.toKey(e),s=this.addresses.get(n)??{verified:!1,expires:0},i=s.verified;return s.verified=!1,s.expires=Date.now()+t,this.addresses.set(n,s),i}toKey(e){if(!vs(e))return e.toString();const t=ct(e);return`${t.host}-${t.port}-${t.protocol}`}}const bv=6e4,vv={addressVerificationTTL:bv*10,addressVerificationRetry:bv*5},_ee=r=>r;function gy(r,e){const t=r.getComponents().findLast(n=>n.code===qe)?.value;return t!=null&&On(t).equals(e)&&(r=r.decapsulate(Ye(`/p2p/${e.toString()}`))),r}class xee{log;components;listen;announce;appendAnnounce;announceFilter;observed;dnsMappings;ipMappings;transportAddresses;observedAddressFilter;addressVerificationTTL;addressVerificationRetry;constructor(e,t={}){const{listen:n=[],announce:s=[],appendAnnounce:i=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(s.map(o=>o.toString())),this.appendAnnounce=new Set(i.map(o=>o.toString())),this.observed=new vee(e,t),this.dnsMappings=new yee(e,t),this.ipMappings=new wee(e,t),this.transportAddresses=new See(e,t),this.announceFilter=t.announceFilter??_ee,this.observedAddressFilter=Yo(1024),this.addressVerificationTTL=t.addressVerificationTTL??vv.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??vv.addressVerificationRetry,this._updatePeerStoreAddresses=Rd(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}[Symbol.toStringTag]="@libp2p/address-manager";_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getComponents().findLast(n=>n.code===qe)?.value===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses - %e",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Ye(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Ye(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Ye(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=ct(e);let n;switch(t.type){case"ip4":{n=`${t.host}:${t.port}`;break}case"ip6":{n=`[${t.host}]:${t.port}`;break}default:return}this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=gy(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=gy(e,this.components.peerId);let n=!0;(t?.type==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1),(t?.type==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,t?.ttl??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,t?.ttl??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=gy(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,t?.ttl??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,t?.ttl??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const s=n.multiaddr.toString();return e.has(s)?!1:(e.add(s),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{const s=Ye(n);return s.getComponents().pop()?.value===this.components.peerId.toString()?s:s.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(e)}),e.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(s=>this.transportAddresses.get(s,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(s=>{s.updateAnnounceAddrs(n)}),t=t.concat(n.map(s=>({multiaddr:s,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Ye(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,s=t,i="tcp"){this.ipMappings.add(e,t,n,s,i),this.observed.removePrefixed(`/ip${ci(n)?4:6}/${n}/${i}/${s}`)}removePublicAddressMapping(e,t,n,s=t,i="tcp"){this.ipMappings.remove(Ye(`/ip${ci(n)?4:6}/${n}/${i}/${s}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e)||!vs(e))return!1;const t=ct(e);if(t.type!=="ip4"||m5(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),s=[i=>Vd.exactMatch(i)||o0.exactMatch(i),i=>i0.exactMatch(i),i=>fX.exactMatch(i)];for(const i of s){if(!i(e))continue;const o=n.filter(l=>l.getAddrs().filter(u=>ct(u).type==="ip4"&&i(u)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>!N3(l)).pop();if(a==null)continue;const c=ct(a);return c.port==null?!1:(this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.protocol),!0)}return!1}}var Ev;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(Ev||(Ev={}));class Aee extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class Cee extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class my extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class Sv extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class kee extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class Iee extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class Tee extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class _v extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class Ree extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class Pee extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class Dee extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class Nee extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class Oee extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class sp extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class x1 extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class Lee extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class Bee extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}class Mee{components={};_started=!1;constructor(e={}){this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=zg())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>Hw(t)).map(async t=>{await t[e]?.()}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const $ee=["metrics","connectionProtector","dns"],Uee=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function Fee(r={}){const e=new Mee(r);return new Proxy(e,{get(n,s,i){if(typeof s=="string"&&!Uee.includes(s)){const o=e.components[s];if(o==null&&!$ee.includes(s))throw new Aee(`${s} not set`);return o}return Reflect.get(n,s,i)},set(n,s,i){return typeof s=="string"?e.components[s]=i:Reflect.set(n,s,i),!0}})}function Vee(r){const e={};for(const t of Object.values(r.components))for(const n of zee(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of Hee(t))if(e[n]!==!0)throw new Cee(`Service "${qee(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function zee(r){return Array.isArray(r?.[yr])?r[yr]:[]}function Hee(r){return Array.isArray(r?.[ja])?r[ja]:[]}function qee(r){return r?.[Symbol.toStringTag]??r?.toString()??"unknown"}function Kee(r={}){return r.denyDialMultiaddr==null&&(r.denyDialMultiaddr=e=>Vd.matches(e)?!0:Zn(e)),r}function uR(r){if(Oa(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getComponents().findLast(s=>s.code===qe)?.value;t=n==null?void 0:On(n),e.forEach(s=>{if(!Zg(s))throw new Bg("Invalid multiaddr");const i=s.getComponents().findLast(o=>o.code===qe)?.value;if(i==null){if(t!=null)throw new ue("Multiaddrs must all have the same peer id or have no peer id")}else{const o=On(i);if(t?.equals(o)!==!0)throw new ue("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!lX.exactMatch(n)),{peerId:t,multiaddrs:e}}const jee=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function Wee(r,e){const t=r?.streams?.map(s=>s.protocol)??[],n=e?.closableProtocols??jee;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await r?.close(e)}catch(s){r?.abort(s)}}function J3(r){const e=ct(r);let t=e.cidr;if(e.type!=="ip4"&&e.type!=="ip6")throw new ue(`Multiaddr ${r} was not an IPv4 or IPv6 address`);if(t==null)switch(e.type){case"ip4":{t=32;break}case"ip6":{t=128;break}default:throw new ue(`Multiaddr ${r} was not an IPv4 or IPv6 address`)}return new cI(e.host,t)}function hR(r){return!li.exactMatch(r)}function dR(r,e,t){if(r==null||e==null)return;const n=e.sort((i,o)=>i.direct?-1:o.direct?1:0).find(i=>i.limits==null);if(n==null||n.direct||t==null)return n;if(!t.some(i=>hR(i)))return n}class Gee{connectionManager;peerStore;allow;events;log;constructor(e,t={}){this.allow=(t.allow??[]).map(n=>J3(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections - %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,n=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,n),t<=n)return;const s=new xc;for(const c of e){const l=c.remotePeer;if(!s.has(l)){s.set(l,0);try{const u=await this.peerStore.get(l);s.set(l,[...u.tags.values()].reduce((h,d)=>h+d.value,0))}catch(u){u.name!=="NotFoundError"&&this.log.error("error loading peer tags - %e",u)}}}const i=this.sortConnections(e,s),o=Math.max(t-n,0),a=[];for(const c of i)if(this.log("too many connections open - closing a connection to %p",c.remotePeer),this.allow.some(u=>{if(vs(c.remoteAddr)){const h=ct(c.remoteAddr);return u.contains(h.host)}return!0})||a.push(c),a.length===o)break;await Promise.all(a.map(async c=>{await Wee(c,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:a})}sortConnections(e,t){return e.sort((n,s)=>{const i=n.timeline.open,o=s.timeline.open;return i<o?1:i>o?-1:0}).sort((n,s)=>n.direction==="outbound"&&s.direction==="inbound"?1:n.direction==="inbound"&&s.direction==="outbound"?-1:0).sort((n,s)=>n.streams.length>s.streams.length?1:n.streams.length<s.streams.length?-1:0).sort((n,s)=>{const i=t.get(n.remotePeer)??0,o=t.get(s.remotePeer)??0;return i>o?1:i<o?-1:0})}}const fR=1e4,pR=1e3,Yee=1e4,f0=1e4,gR=25,Qee=5,Xee=10,Jee=5,Zee="last-dial-failure",ete="last-dial-success",mR=500,tte=32,rte=100,yR=50;function nte(r,e){const t=i0.exactMatch(r.multiaddr),n=i0.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const s=o0.exactMatch(r.multiaddr),i=o0.exactMatch(e.multiaddr);if(s&&!i)return-1;if(!s&&i)return 1;const o=Vd.exactMatch(r.multiaddr),a=Vd.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=K3.exactMatch(r.multiaddr),l=K3.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=q3.exactMatch(r.multiaddr),h=q3.exactMatch(e.multiaddr);if(u&&!h)return-1;if(!u&&h)return 1;const d=X9.exactMatch(r.multiaddr),f=X9.exactMatch(e.multiaddr);return d&&!f?-1:!d&&f?1:0}function ste(r,e){const t=N3(r.multiaddr),n=N3(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function ite(r,e){const t=Zn(r.multiaddr),n=Zn(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function ote(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function ate(r,e){const t=li.exactMatch(r.multiaddr),n=li.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function cte(r){return r.sort(nte).sort(ote).sort(ate).sort(ite).sort(ste)}class lte{dns;canResolve(e){return e.getComponents().some(({name:t})=>t==="dnsaddr")}async resolve(e,t){const n=e.getComponents().find(c=>c.name==="dnsaddr")?.value;if(n==null)return[e];const i=await this.getDNS(t).query(`_dnsaddr.${n}`,{signal:t?.signal,types:[Ko.TXT]}),o=e.getComponents().find(c=>c.name==="p2p")?.value,a=[];for(const c of i.Answer){const l=c.data.replace(/["']/g,"").trim().split("=")[1];l!=null&&(o!=null&&!l.includes(o)||a.push(Ye(l)))}return a}getDNS(e){return e.dns!=null?e.dns:(this.dns==null&&(this.dns=ek()),this.dns)}}const wR=new lte;async function bR(r,e,t){const n=t.depth??0;if(n>(t.maxRecursiveDepth??tte))throw new Bee("Max recursive depth reached");let s=!1;const i=[];for(const o of Object.values(e))if(o.canResolve(r)){s=!0;const a=await o.resolve(r,t);for(const c of a)i.push(...await bR(c,e,{...t,depth:n+1}))}return s===!1&&i.push(r),i}const ju={maxParallelDials:yR,maxDialQueueLength:mR,maxPeerAddrsToDial:gR,dialTimeout:fR,resolvers:{dnsaddr:wR}};class ute{queue;components;addressSorter;maxPeerAddrsToDial;maxDialQueueLength;dialTimeout;shutDownController;connections;log;resolvers;constructor(e,t={}){this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??ju.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??ju.maxDialQueueLength,this.dialTimeout=t.dialTimeout??ju.dialTimeout,this.connections=t.connections??new xc,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.resolvers=t.resolvers??ju.resolvers,this.shutDownController=new AbortController,this.shutDownController.signal,this.queue=new BG({concurrency:t.maxParallelDials??ju.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("failure",n=>{n.detail?.error.name!==Ka.name&&this.log.error("error in dial queue - %e",n.detail.error)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){const{peerId:n,multiaddrs:s}=uR(e);if(n!=null&&t.force!==!0){const o=dR(n,this.connections.get(n),s);if(o!=null)return this.log("already connected to %a",o.remoteAddr),t.onProgress?.(new Pe("dial-queue:already-connected")),o}const i=this.queue.queue.find(o=>{if(n?.equals(o.options.peerId)===!0)return!0;const a=o.options.multiaddrs;if(a==null)return!1;for(const c of s)if(a.has(c.toString()))return!0;return!1});if(i!=null){this.log("joining existing dial target for %p",n);for(const o of s)i.options.multiaddrs.add(o.toString());return t.onProgress?.(new Pe("dial-queue:already-in-dial-queue")),i.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new X1("Dial queue is full");return this.log("creating dial target for %p",n,s.map(o=>o.toString())),t.onProgress?.(new Pe("dial-queue:add-to-dial-queue")),this.queue.add(async o=>{o.onProgress?.(new Pe("dial-queue:start-dial"));const a=xt([this.shutDownController.signal,o.signal]);try{return await this.dialPeer(o,a)}finally{a.clear()}},{peerId:n,priority:t.priority??vR,multiaddrs:new Set(s.map(o=>o.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){const n=e.peerId,s=e.multiaddrs,i=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||s.size>0;){c++,o=!1;const u=[],h=new Set(e.multiaddrs);s.clear(),this.log("calculating addrs to dial %p from %s",n,[...h]);const d=await this.calculateMultiaddrs(n,h,{...e,signal:t});for(const f of d){if(i.has(f.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",f.multiaddr,n);continue}u.push(f)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,u.map(f=>f.multiaddr.toString())),e?.onProgress?.(new Pe("dial-queue:calculated-addresses",u));for(const f of u){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new X1("Peer had more than maxPeerAddrsToDial");a++;try{const g=await this.components.transportManager.dial(f.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",f.multiaddr);try{await this.components.peerStore.merge(g.remotePeer,{multiaddrs:[g.remoteAddr],metadata:{[ete]:le(Date.now().toString())}})}catch(m){this.log.error("could not update last dial failure key for %p - %e",n,m)}return g}catch(g){if(this.log.error("dial failed to %a - %e",f.multiaddr,g),i.add(f.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[Zee]:le(Date.now().toString())}})}catch(m){this.log.error("could not update last dial failure key for %p - %e",n,m)}if(t.aborted)throw new Mg(g.message);l.push(g)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){const s=[...t].map(h=>({multiaddr:Ye(h),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new X1("Tried to dial self");if(await this.components.connectionGater.denyDialPeer?.(e)===!0)throw new _v("The dial request is blocked by gater.allowDialPeer");if(s.length===0){this.log("loading multiaddrs for %p",e);try{const h=await this.components.peerStore.get(e);s.push(...h.addresses),this.log("loaded multiaddrs for %p",e,s.map(({multiaddr:d})=>d.toString()))}catch(h){if(h.name!=="NotFoundError")throw h}}if(s.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const h=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,s.map(({multiaddr:d})=>d.toString())),s.push(...h.multiaddrs.map(d=>({multiaddr:d,isCertified:!1})))}catch(h){h.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,h)}}}let i=(await Promise.all(s.map(async h=>{const d=await bR(h.multiaddr,this.resolvers,{dns:this.components.dns,log:this.log,...n});return d.length===1&&d[0].equals(h.multiaddr)?h:d.map(f=>({multiaddr:f,isCertified:!1}))}))).flat();if(e!=null){const h=`/p2p/${e.toString()}`;i=i.map(d=>d.multiaddr.getComponents().pop()?.name!=="p2p"?{multiaddr:d.multiaddr.encapsulate(h),isCertified:d.isCertified}:d)}const o=i.filter(h=>{if(this.components.transportManager.dialTransportForMultiaddr(h.multiaddr)==null)return!1;const d=h.multiaddr.getComponents().findLast(f=>f.code===qe)?.value;return e!=null&&d!=null?e.equals(d):!0}),a=new Map;for(const h of o){const d=h.multiaddr.toString(),f=a.get(d);if(f!=null){f.isCertified=f.isCertified||h.isCertified||!1;continue}a.set(d,h)}const c=[...a.values()];if(c.length===0)throw new Dee("The dial request has no valid addresses");const l=[];for(const h of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(h.multiaddr)||l.push(h);const u=this.addressSorter==null?cte(l):l.sort(this.addressSorter);if(u.length===0)throw new _v("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",i.map(({multiaddr:h})=>h.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:h})=>h.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(s=>s.toString())),t);return t.runOnLimitedConnection===!1?n.find(s=>!li.matches(s.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}const hte=Object.prototype.toString,dte=r=>hte.call(r)==="[object Error]",fte=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function pte(r){if(!(r&&dte(r)&&r.name==="TypeError"&&typeof r.message=="string"))return!1;const{message:t,stack:n}=r;return t==="Load failed"?n===void 0||"__sentry_captured__"in r:t.startsWith("error sending request for url")?!0:fte.has(t)}function gte(r){if(typeof r=="number"){if(r<0)throw new TypeError("Expected `retries` to be a non-negative number.");if(Number.isNaN(r))throw new TypeError("Expected `retries` to be a valid number or Infinity, got NaN.")}else if(r!==void 0)throw new TypeError("Expected `retries` to be a number or Infinity.")}function A1(r,e,{min:t=0,allowInfinity:n=!1}={}){if(e!==void 0){if(typeof e!="number"||Number.isNaN(e))throw new TypeError(`Expected \`${r}\` to be a number${n?" or Infinity":""}.`);if(!n&&!Number.isFinite(e))throw new TypeError(`Expected \`${r}\` to be a finite number.`);if(e<t)throw new TypeError(`Expected \`${r}\` to be ≥ ${t}.`)}}let mte=class extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};function yte(r,e){const t=Math.max(1,r+1),n=e.randomize?Math.random()+1:1;let s=Math.round(n*e.minTimeout*e.factor**(t-1));return s=Math.min(s,e.maxTimeout),s}function xv(r,e){return Number.isFinite(e)?e-(performance.now()-r):e}async function wte({error:r,attemptNumber:e,retriesConsumed:t,startTime:n,options:s}){const i=r instanceof Error?r:new TypeError(`Non-error was thrown: "${r}". You should only throw errors.`);if(i instanceof mte)throw i.originalError;const o=Number.isFinite(s.retries)?Math.max(0,s.retries-t):s.retries,a=s.maxRetryTime??Number.POSITIVE_INFINITY,c=Object.freeze({error:i,attemptNumber:e,retriesLeft:o,retriesConsumed:t});if(await s.onFailedAttempt(c),xv(n,a)<=0)throw i;const l=await s.shouldConsumeRetry(c),u=xv(n,a);if(u<=0||o<=0)throw i;if(i instanceof TypeError&&!pte(i)){if(l)throw i;return s.signal?.throwIfAborted(),!1}if(!await s.shouldRetry(c))throw i;if(!l)return s.signal?.throwIfAborted(),!1;const h=yte(t,s),d=Math.min(h,u);return d>0&&await new Promise((f,g)=>{const m=()=>{clearTimeout(b),s.signal?.removeEventListener("abort",m),g(s.signal.reason)},b=setTimeout(()=>{s.signal?.removeEventListener("abort",m),f()},d);s.unref&&b.unref?.(),s.signal?.addEventListener("abort",m,{once:!0})}),s.signal?.throwIfAborted(),!0}async function bte(r,e={}){if(e={...e},gte(e.retries),Object.hasOwn(e,"forever"))throw new Error("The `forever` option is no longer supported. For many use-cases, you can set `retries: Infinity` instead.");e.retries??=10,e.factor??=2,e.minTimeout??=1e3,e.maxTimeout??=Number.POSITIVE_INFINITY,e.maxRetryTime??=Number.POSITIVE_INFINITY,e.randomize??=!1,e.onFailedAttempt??=()=>{},e.shouldRetry??=()=>!0,e.shouldConsumeRetry??=()=>!0,A1("factor",e.factor,{min:0,allowInfinity:!1}),A1("minTimeout",e.minTimeout,{min:0,allowInfinity:!1}),A1("maxTimeout",e.maxTimeout,{min:0,allowInfinity:!0}),A1("maxRetryTime",e.maxRetryTime,{min:0,allowInfinity:!0}),e.factor>0||(e.factor=1),e.signal?.throwIfAborted();let t=0,n=0;const s=performance.now();for(;!Number.isFinite(e.retries)||n<=e.retries;){t++;try{e.signal?.throwIfAborted();const i=await r(t);return e.signal?.throwIfAborted(),i}catch(i){await wte({error:i,attemptNumber:t,retriesConsumed:n,startTime:s,options:e})&&n++}}throw new Error("Retry attempts exhausted without throwing an error.")}class vte{log;queue;started;peerStore;retries;retryInterval;backoffFactor;connectionManager;events;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new Jo({concurrency:t.maxParallelReconnects??Jee,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(s=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,s)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);Av(t)&&(this.queue.has(e)||this.queue.add(async n=>{await bte(async s=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n?.signal})}catch(i){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,s,this.retries,i),i}},{signal:n?.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const s={};[...t.tags.keys()].forEach(i=>{i.startsWith(Ug)&&(s[i]=void 0)}),await this.peerStore.merge(e,{tags:s}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>Av(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not open connection to keepalive peer - %e",n)})}))}).catch(e=>{this.log.error("error reconnect to peers after start - %e",e)})}stop(){this.started=!1,this.queue.abort()}}function Av(r){for(const e of r.tags.keys())if(e.startsWith(Ug))return!0;return!1}const vR=50,yy={maxConnections:rte,inboundConnectionThreshold:Qee,maxIncomingPendingConnections:Xee};class Ete{started;connections;allow;deny;maxIncomingPendingConnections;incomingPendingConnections;outboundPendingConnections;maxConnections;dialQueue;reconnectQueue;connectionPruner;inboundConnectionRateLimiter;peerStore;metrics;events;log;peerId;constructor(e,t={}){if(this.maxConnections=t.maxConnections??yy.maxConnections,this.maxConnections<1)throw new ue("Connection Manager maxConnections must be greater than 0");this.connections=new xc,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(n=>J3(Ye(n))),this.deny=(t.deny??[]).map(n=>J3(Ye(n))),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??yy.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new $I({points:t.inboundConnectionThreshold??yy.inboundConnectionThreshold,duration:1}),this.connectionPruner=new Gee({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:t.allow?.map(n=>Ye(n))}),this.dialQueue=new ute(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??yR,maxDialQueueLength:t.maxDialQueueLength??mR,maxPeerAddrsToDial:t.maxPeerAddrsToDial??gR,dialTimeout:t.dialTimeout??fR,resolvers:t.resolvers??{dnsaddr:wR},connections:this.connections}),this.reconnectQueue=new vte({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}[Symbol.toStringTag]="@libp2p/connection-manager";async start(){this.metrics?.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const e={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const t of this.connections.values())for(const n of t)e[n.direction]++;return e}}),this.metrics?.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const e={};for(const t of this.connections.values())for(const n of t)for(const s of n.streams){const i=`${s.direction} ${s.protocol??"unnegotiated"}`;e[i]=(e[i]??0)+1}return e}}),this.metrics?.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const e={};for(const n of this.connections.values())for(const s of n){const i={};for(const o of s.streams){const a=`${o.direction} ${o.protocol??"unnegotiated"}`;i[a]=(i[a]??0)+1}for(const[o,a]of Object.entries(i))e[o]=e[o]??[],e[o].push(a)}const t={};for(let[n,s]of Object.entries(e)){s=s.sort((o,a)=>o-a);const i=Math.floor(s.length*.9);t[n]=s[i]}return t}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await oi(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await eo(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push(Promise.all([sr(n,"close",{signal:AbortSignal.timeout(500)}),n.close({signal:AbortSignal.timeout(500)})]).catch(s=>{n.abort(s)}));this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new ue("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(t=>{this.log.error("could not connect - %e",t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,s=!this.connections.has(n),i=this.connections.get(n)??[];i.push(t),this.connections.set(n,i),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),s&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,i=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,i),i.length===0&&(this.log.trace("peer %p disconnected, removing connection map entry",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:n}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){if(!this.started)throw new Rl("Not started");this.outboundPendingConnections++;try{t.signal?.throwIfAborted();const{peerId:n,multiaddrs:s}=uR(e);if(this.peerId.equals(n))throw new NC("Can not dial self");if(n!=null&&t.force!==!0){this.log("dial %p",n);const c=dR(n,this.getConnections(n),s);if(c!=null)return this.log("had an existing connection to %p as %a",n,c.remoteAddr),t.onProgress?.(new Pe("dial-queue:already-connected")),c}const i=await this.dialQueue.dial(e,{...t,priority:t.priority??vR});if(i.status!=="open")throw new b3("Remote closed connection during opening");let o=this.connections.get(i.remotePeer);o==null&&(o=[],this.connections.set(i.remotePeer,o));let a=!1;for(const c of o)if(c.id===i.id&&(a=!0),t.force!==!0&&c.id!==i.id&&c.remoteAddr.equals(i.remoteAddr))return i.abort(new Bg("Duplicate multiaddr connection")),c;return a||o.push(i),i}finally{this.outboundPendingConnections--}}async openStream(e,t,n={}){return(await this.openConnection(e,n)).newStream(t,n)}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async s=>{try{await Promise.all([sr(s,"close",t),s.close(t)])}catch(i){s.abort(i)}}))}acceptIncomingConnection(e){if(this.deny.some(s=>{if(vs(e.remoteAddr)){const i=ct(e.remoteAddr);return s.contains(i.host)}return!1}))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(s=>{if(vs(e.remoteAddr)){const i=ct(e.remoteAddr);return s.contains(i.host)}return!0}))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(vs(e.remoteAddr)){const s=ct(e.remoteAddr);try{this.inboundConnectionRateLimiter.consume(s.host,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,s.host),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Ye(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const Ste=1e4,_te="1.0.0",xte="ping",Ate="ipfs",Cv=32,Cte=!0;class kte{protocol;components;log;heartbeatInterval;pingIntervalMs;abortController;timeout;abortConnectionOnPingFailure;constructor(e,t={}){this.components=e,this.protocol=`/${t.protocolPrefix??Ate}/${xte}/${_te}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??Ste,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??Cte,this.timeout=new Pd({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}[Symbol.toStringTag]="@libp2p/connection-monitor";[yr]=["@libp2p/connection-monitor"];start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{let t=Date.now();try{const n=this.timeout.getTimeoutSignal({signal:this.abortController?.signal}),s=await e.newStream(this.protocol,{signal:n,runOnLimitedConnection:!0}),i=_I(s);t=Date.now(),await Promise.all([i.write(Qa(Cv),{signal:n}),i.read({bytes:Cv,signal:n})]),e.rtt=Date.now()-t,await s.close({signal:n})}catch(n){if(n.name!=="UnsupportedProtocolError")throw n;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat - %e",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){this.abortController?.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}class Ite{routers;started;components;constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=e.metrics?.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],s)=>({...s,cid:n.toString()}),getAttributesFromYieldedValue:(n,s)=>({...s,providers:[...Array.isArray(s.providers)?s.providers:[],n.id.toString()]})})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],s)=>({...s,cid:n.toString()})})??this.provide,this.cancelReprovide=e.metrics?.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],s)=>({...s,cid:n.toString()})})??this.cancelReprovide,this.put=e.metrics?.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([n])=>({key:he(n,"base36")})})??this.put,this.get=e.metrics?.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([n])=>({key:he(n,"base36")})})??this.get}[Symbol.toStringTag]="@libp2p/content-routing";isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new my("No content routers available");const n=this,s=new Js;for await(const i of Bo(...n.routers.filter(o=>o.findProviders instanceof Function).map(o=>o.findProviders(e,t))))i!=null&&(i.multiaddrs.length>0&&await this.components.peerStore.merge(i.id,{multiaddrs:i.multiaddrs},t),!s.has(i.id)&&(s.add(i.id),yield i))}async provide(e,t={}){if(this.routers.length===0)throw new my("No content routers available");await Promise.all(this.routers.filter(n=>n.provide instanceof Function).map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new my("No content routers available");await Promise.all(this.routers.filter(n=>n.cancelReprovide instanceof Function).map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Rl;await Promise.all(this.routers.filter(s=>s.put instanceof Function).map(async s=>{await s.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Rl;return Promise.any(this.routers.filter(n=>n.get instanceof Function).map(async n=>n.get(e,t)))}}const C1=globalThis.CustomEvent??Event;async function*Ac(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,s=new EventTarget,i=[];let o=Lt(),a=Lt(),c=!1,l,u=!1;s.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const g of r){if(i.length===t&&(o=Lt(),await o.promise),u)break;const m={done:!1};i.push(m),g().then(b=>{m.done=!0,m.ok=!0,m.value=b,s.dispatchEvent(new C1("task-complete"))},b=>{m.done=!0,m.err=b,s.dispatchEvent(new C1("task-complete"))})}c=!0,s.dispatchEvent(new C1("task-complete"))}catch(g){l=g,s.dispatchEvent(new C1("task-complete"))}});function h(){return n?i[0]?.done:!!i.find(g=>g.done)}function*d(){for(;i.length>0&&i[0].done;){const g=i[0];if(i.shift(),g.ok)yield g.value;else throw u=!0,o.resolve(),g.err;o.resolve()}}function*f(){for(;h();)for(let g=0;g<i.length;g++)if(i[g].done){const m=i[g];if(i.splice(g,1),g--,m.ok)yield m.value;else throw u=!0,o.resolve(),m.err;o.resolve()}}for(;;){if(h()||(a=Lt(),await a.promise),l!=null||(n?yield*d():yield*f(),l!=null))throw l;if(c&&i.length===0)break}}class Tte{log;peerId;peerStore;routers;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=e.metrics?.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],s)=>({...s,peer:n.toString()})})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([n],s)=>({...s,key:he(n,"base36")}),getAttributesFromYieldedValue:(n,s)=>({...s,peers:[...Array.isArray(s.peers)?s.peers:[],n.id.toString()]})})??this.getClosestPeers}[Symbol.toStringTag]="@libp2p/peer-routing";async findPeer(e,t){if(this.routers.length===0)throw new Sv("No peer routers available");if(e.toString()===this.peerId.toString())throw new kee("Should not try to find self");const n=this,s=Bo(...this.routers.filter(i=>i.findPeer instanceof Function).map(i=>(async function*(){try{yield await i.findPeer(e,t)}catch(o){n.log.error("router failed to find peer - %e",o)}})()));for await(const i of s)if(i!=null)return i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs},t),i;throw new dn}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Sv("No peer routers available");const n=this,s=Yo(1024);for await(const i of Ac((async function*(){const o=Bo(...n.routers.filter(a=>a.getClosestPeers instanceof Function).map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs - %e",c);return}return a}})()))i!=null&&(i.multiaddrs.length>0&&await this.peerStore.merge(i.id,{multiaddrs:i.multiaddrs},t),!s.has(i.id.toMultihash().bytes)&&(s.add(i.id.toMultihash().bytes),yield i))}}class Rte extends Nt{peerRouting;log;walking;walkers;shutdownController;walkController;needNext;constructor(e){super(),this.log=e.logger.forComponent("libp2p:random-walk"),this.peerRouting=e.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}[Symbol.toStringTag]="@libp2p/random-walk";start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(e){this.walking||this.startWalk(),this.walkers++;const t=xt([this.shutdownController.signal,e?.signal]);try{for(;;)this.needNext?.resolve(),this.needNext=Lt(),yield(await sr(this,"walk:peer",{signal:t,rejectionEvents:["walk:error"]})).detail}catch(n){throw n.detail!=null?n.detail:n}finally{t.clear(),this.walkers--,this.walkers===0&&(this.walkController?.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const e=xt([this.walkController.signal,this.shutdownController.signal]),t=Date.now();let n=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=Qa(32);let i=Date.now();for await(const o of this.peerRouting.getClosestPeers(s,{signal:e}))e.aborted&&this.log("aborting walk"),e.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",o.id,Date.now()-i,this.walkers),n++,this.safeDispatchEvent("walk:peer",{detail:o}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await es(this.needNext.promise,e)),i=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,n)}catch(s){this.log.error("random walk errored - %e",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored - %e",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",n,Date.now()-t),this.walking=!1})}}const ER=32,SR=64;class Pte{log;topologies;handlers;components;middleware;constructor(e){this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.middleware=new Map,this.topologies=new Map,e.metrics?.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const t={};for(const[n,s]of this.topologies)t[n]=s.size;return t}}),this.handlers=ks({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}[Symbol.toStringTag]="@libp2p/registrar";getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new Iee(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&n?.force!==!0)throw new Tee(`Handler already registered for protocol ${e}`);this.handlers.set(e,{handler:t,options:{maxInboundStreams:ER,maxOutboundStreams:SR,...n}}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]},n)}async unhandle(e,t){(Array.isArray(e)?e:[e]).forEach(s=>{this.handlers.delete(s)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)}async register(e,t){if(t==null)throw new ue("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let s=this.topologies.get(e);return s==null&&(s=new Map,this.topologies.set(e,s)),s.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}use(e,t){this.middleware.set(e,t)}unuse(e){this.middleware.delete(e)}getMiddleware(e){return this.middleware.get(e)??[]}async _onDisconnect(e){const t=e.detail,n={signal:AbortSignal.timeout(5e3)};try{const s=await this.components.peerStore.get(t,n);for(const i of s.protocols){const o=this.topologies.get(i);o!=null&&await Promise.all([...o.values()].map(async a=>{a.filter?.has(t)!==!1&&(a.filter?.remove(t),await a.onDisconnect?.(t))}))}}catch(s){if(s.name==="NotFoundError")return;this.log.error("could not inform topologies of disconnecting peer %p - %e",t,s)}}async _onPeerUpdate(e){const{peer:t,previous:n}=e.detail,s=(n?.protocols??[]).filter(i=>!t.protocols.includes(i));try{for(const i of s){const o=this.topologies.get(i);o!=null&&await Promise.all([...o.values()].map(async a=>{a.filter?.has(t.id)!==!1&&(a.filter?.remove(t.id),await a.onDisconnect?.(t.id))}))}}catch(i){this.log.error("could not inform topologies of updated peer %p - %e",t.id,i)}}async _onPeerIdentify(e){const t=e.detail.protocols,n=e.detail.connection,s=e.detail.peerId;try{for(const i of t){const o=this.topologies.get(i);o!=null&&await Promise.all([...o.values()].map(async a=>{n.limits!=null&&a.notifyOnLimitedConnection!==!0||a.filter?.has(s)!==!0&&(a.filter?.add(s),await a.onConnect?.(s,n))}))}}catch(i){this.log.error("could not inform topologies of updated peer after identify %p - %e",s,i)}}}class Dte{log;components;transports;listeners;faultTolerance;started;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=ks({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=ks({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??Np.FATAL_ALL}[Symbol.toStringTag]="@libp2p/transport-manager";add(e){const t=e[Symbol.toStringTag];if(t==null)throw new ue("Transport must have a valid tag");if(this.transports.has(t))throw new ue(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const s=n.pop();s!=null&&e.push(s.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const n=this.dialTransportForMultiaddr(e);if(n==null)throw new Lee(`No transport available for address ${String(e)}`);return t?.onProgress?.(new Pe("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Rl("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(i=>{t.errors.set(i.toString(),new Ree)});const n=[];for(const[i,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",i,c);const l=o.createListener({upgrader:this.components.upgrader});let u=this.listeners.get(i)??[];u==null&&(u=[],this.listeners.set(i,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const h=u.findIndex(d=>d===l);u.splice(h,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),Y9.matches(c)?t.ipv4.attempts++:Q9.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),Y9.matches(c)&&t.ipv4.success++,Q9.matches(c)&&t.ipv6.success++},h=>{throw this.log.error("transport %s could not listen on address %a - %e",i,c,h),t.errors.set(c.toString(),h),h}))}}const s=await Promise.allSettled(n);if(!(s.length>0&&s.every(i=>i.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===Np.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new Pee(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([i,o])=>`
  ${i}: ${`${Nte(o)}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const s=t.pop();s!=null&&n.push(s.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}function Nte(r){return r.stack!=null&&r.stack.trim()!==""?r.stack:r.message!=null?r.message:r.toString()}const Ca="/multistream/1.0.0",_R=1024,Ote=le(`
`);async function Z3(r,e){const n=(await r.read(e)).subarray();if(n.byteLength===0||n[n.length-1]!==Ote[0])throw new Bt("Missing newline");return he(n).trimEnd()}async function e4(r,e,t={}){if(e=Array.isArray(e)?[...e]:[e],e.length===0)throw new Error("At least one protocol must be specified");const n=r.log.newScope("mss:select"),s=Nd(r,{...t,maxDataLength:_R});for(let i=0;i<e.length;i++){const o=e[i];let a;if(i===0){n.trace('write ["%s", "%s"]',Ca,o);const c=le(`${Ca}
`),l=le(`${o}
`);if(await s.writeV([c,l],t),n.trace("reading multistream-select header"),a=await Z3(s,t),n.trace('read "%s"',a),a!==Ca){n.error("did not read multistream-select header from response");break}}else n.trace('write "%s"',o),await s.write(le(`${o}
`),t);if(n.trace("reading protocol response"),a=await Z3(s,t),n.trace('read "%s"',a),a===o)return n.trace('selected "%s" after negotiation',a),s.unwrap(),o}throw new LC(`Protocol selection failed - could not negotiate ${e}`)}async function t4(r,e,t={}){e=Array.isArray(e)?e:[e];const n=r.log.newScope("mss:handle"),s=Nd(r,{...t,maxDataLength:_R,maxLengthLength:2});for(;;){n.trace("reading incoming string");const i=await Z3(s,t);if(n.trace('read "%s"',i),i===Ca){n.trace('respond with "%s" for "%s"',Ca,i),await s.write(le(`${Ca}
`),t),n.trace('responded with "%s" for "%s"',Ca,i);continue}if(e.includes(i))return n.trace('respond with "%s" for "%s"',i,i),await s.write(le(`${i}
`),t),n.trace('responded with "%s" for "%s"',i,i),s.unwrap(),i;if(i==="ls"){const o=new ze(...e.map(a=>Bd.single(le(`${a}
`))),le(`
`));n.trace('respond with "%s" for %s',e,i),await s.write(o,t),n.trace('responded with "%s" for %s',e,i);continue}n.trace('respond with "na" for "%s"',i),await s.write(le(`na
`),t),n('responded with "na" for "%s"',i)}}class Lte extends Nt{id;remoteAddr;remotePeer;direction;timeline;direct;multiplexer;encryption;limits;log;maConn;muxer;components;outboundStreamProtocolNegotiationTimeout;inboundStreamProtocolNegotiationTimeout;closeTimeout;constructor(e,t){super(),this.components=e,this.id=t.id,this.remoteAddr=t.maConn.remoteAddr,this.remotePeer=t.remotePeer,this.direction=t.direction??"outbound",this.timeline=t.maConn.timeline,this.encryption=t.cryptoProtocol,this.limits=t.limits,this.maConn=t.maConn,this.log=t.maConn.log,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??f0,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??f0,this.closeTimeout=t.closeTimeout??pR,this.direct=hR(t.maConn.remoteAddr),this.onIncomingStream=this.onIncomingStream.bind(this),this.remoteAddr.getComponents().find(n=>n.code===qe)==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),t.muxer!=null&&(this.multiplexer=t.muxer.protocol,this.muxer=t.muxer,this.muxer.addEventListener("stream",this.onIncomingStream)),this.maConn.addEventListener("close",n=>{this.dispatchEvent(new $g(n.local,n.error))})}[Symbol.toStringTag]="Connection";[dF]=!0;get streams(){return this.muxer?.streams??[]}get status(){return this.maConn.status}newStream=async(e,t={})=>{if(this.muxer==null)throw new sp("Connection is not multiplexed");if(this.muxer.status!=="open")throw new b3(`The connection muxer is "${this.muxer.status}" and not "open"`);if(this.maConn.status!=="open")throw new b3(`The connection is "${this.status}" and not "open"`);if(this.limits!=null&&t?.runOnLimitedConnection!==!0)throw new D7("Cannot open protocol stream on limited connection");Array.isArray(e)||(e=[e]),this.log.trace("starting new stream for protocols %s",e);const n=await this.muxer.createStream({...t,protocol:e.length===1?e[0]:void 0});this.log.trace("started new stream %s for protocols %s",n.id,e);try{if(t.signal==null){n.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e);const a=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);t={...t,signal:a}}n.protocol===""?(n.log.trace("selecting protocol from protocols %s",e),n.protocol=await e4(n,e,t),n.log("negotiated protocol %s",n.protocol)):n.log("pre-negotiated protocol %s",n.protocol);const s=$te(n.protocol,this.components.registrar,t),i=kv(n.protocol,"outbound",this);if(i>s){const a=new BC(`Too many outbound protocol streams for protocol "${n.protocol}" - ${i}/${s}`);throw n.abort(a),a}await this.components.peerStore.merge(this.remotePeer,{protocols:[n.protocol]}),this.components.metrics?.trackProtocolStream(n);const o=this.components.registrar.getMiddleware(n.protocol);return await this.runMiddlewareChain(n,this,o)}catch(s){throw n.status==="open"?n.abort(s):this.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",this.direction==="inbound"?"from":"to",this.remoteAddr,e,s),s}};async onIncomingStream(e){const t=e.detail,n=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);t.log("start protocol negotiation, timing out after %dms",this.inboundStreamProtocolNegotiationTimeout);try{if(t.protocol===""){const l=this.components.registrar.getProtocols();t.log.trace("selecting protocol from protocols %s",l),t.protocol=await t4(t,l,{signal:n}),t.log("negotiated protocol %s",t.protocol)}else t.log("pre-negotiated protocol %s",t.protocol);const s=Mte(t.protocol,this.components.registrar);if(kv(t.protocol,"inbound",this)>s)throw new yF(`Too many inbound protocol streams for protocol "${t.protocol}" - limit ${s}`);await this.components.peerStore.merge(this.remotePeer,{protocols:[t.protocol]},{signal:n}),this.components.metrics?.trackProtocolStream(t);const{handler:o,options:a}=this.components.registrar.getHandler(t.protocol);if(this.limits!=null&&a.runOnLimitedConnection!==!0)throw new D7("Cannot open protocol stream on limited connection");const c=this.components.registrar.getMiddleware(t.protocol);c.push(async(l,u,h)=>{await o(l,u),h(l,u)}),await this.runMiddlewareChain(t,this,c)}catch(s){t.abort(s)}}async runMiddlewareChain(e,t,n){for(let s=0;s<n.length;s++){const i=n[s];e.log.trace("running middleware",s,i),await new Promise((o,a)=>{try{const c=i(e,t,(l,u)=>{e=l,t=u,o()});c instanceof Promise&&c.catch(a)}catch(c){a(c)}}),e.log.trace("ran middleware",s,i)}return e}async close(e={}){if(this.log("closing connection to %a",this.remoteAddr),e.signal==null){const t=AbortSignal.timeout(this.closeTimeout);e={...e,signal:t}}await this.muxer?.close(e),await this.maConn.close(e)}abort(e){this.muxer?.abort(e),this.maConn.abort(e)}}function Bte(r,e){return new Lte(r,e)}function Mte(r,e){try{const{options:t}=e.getHandler(r);if(t.maxInboundStreams!=null)return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return ER}function $te(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??SR}function kv(r,e,t){let n=0;return t.streams.forEach(s=>{s.direction===e&&s.protocol===r&&n++}),n}class Ute{components;connectionEncrypters;streamMuxers;inboundUpgradeTimeout;inboundStreamProtocolNegotiationTimeout;outboundStreamProtocolNegotiationTimeout;events;metrics;connectionCloseTimeout;constructor(e,t){this.components=e,this.connectionEncrypters=ks({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(n=>{this.connectionEncrypters.set(n.protocol,n)}),this.streamMuxers=ks({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(n=>{this.streamMuxers.set(n.protocol,n)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??Yee,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??f0,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??f0,this.connectionCloseTimeout=t.connectionCloseTimeout??pR,this.events=e.events,this.metrics={dials:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:e.metrics?.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}[Symbol.toStringTag]="@libp2p/upgrader";async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new Nee(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return xt([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){let n=!1;const s=this.createInboundAbortSignal(t.signal);try{if(this.metrics.dials?.increment({inbound:!0}),n=this.components.connectionManager.acceptIncomingConnection(e),!n)throw new Oee("Connection denied");await es(this.shouldBlockConnection("denyInboundConnection",e),s),await this._performUpgrade(e,"inbound",{...t,signal:s})}catch(i){throw this.metrics.errors?.increment({inbound:!0}),this.metrics.inboundErrors?.increment({[i.name??"Error"]:!0}),i}finally{s.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){try{this.metrics.dials?.increment({outbound:!0});const n=e.remoteAddr.getComponents().findLast(o=>o.code===qe)?.value;let s;n!=null&&(s=On(n),await es(this.shouldBlockConnection("denyOutboundConnection",s,e),t.signal));let i="outbound";return t.initiator===!1&&(i="inbound"),await this._performUpgrade(e,i,t)}catch(n){throw this.metrics.errors?.increment({outbound:!0}),this.metrics.outboundErrors?.increment({[n.name??"Error"]:!0}),n}}async _performUpgrade(e,t,n){let s=e,i,o,a,c;const l=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`;if(e.log=e.log.newScope(`${t}:${l}`),this.components.metrics?.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t),n?.skipProtection!==!0){const h=this.components.connectionProtector;h!=null&&(e.log("protecting the %s connection",t),s=await h.protect(s,n))}try{if(Fte(n)){if(n.remotePeer==null)throw new Bg(`${t} connection that skipped encryption must have a peer id`);c="native",i=n.remotePeer}else{const h=e.remoteAddr.getComponents().findLast(f=>f.code===qe)?.value;let d;h!=null&&(d=On(h)),n?.onProgress?.(new Pe(`upgrader:encrypt-${t}-connection`)),{connection:s,remotePeer:i,protocol:c,streamMuxer:o}=await(t==="inbound"?this._encryptInbound(s,{...n,remotePeer:d}):this._encryptOutbound(s,{...n,remotePeer:d}))}if(i.equals(this.components.peerId)){const h=new NC("Can not dial self");throw e.abort(h),h}await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",i,e),n?.muxerFactory!=null?o=n.muxerFactory:o==null&&this.streamMuxers.size>0&&(n?.onProgress?.(new Pe(`upgrader:multiplex-${t}-connection`)),o=await(t==="inbound"?this._multiplexInbound(s,this.streamMuxers,n):this._multiplexOutbound(s,this.streamMuxers,n)))}catch(h){throw e.log.error("failed to upgrade %s connection %s %a - %e",t,t==="inbound"?"from":"to",e.remoteAddr,h),h}o!=null&&(e.log("create muxer %s",o.protocol),a=o.createStreamMuxer(s)),await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",i,e);const u=this._createConnection({id:l,cryptoProtocol:c,direction:t,maConn:e,stream:s,muxer:a,remotePeer:i,limits:n?.limits,closeTimeout:this.connectionCloseTimeout});return u.log("successfully upgraded connection"),u}_createConnection(e){const t=Bte(this.components,{...e,outboundStreamProtocolNegotiationTimeout:this.outboundStreamProtocolNegotiationTimeout,inboundStreamProtocolNegotiationTimeout:this.inboundStreamProtocolNegotiationTimeout});return t.addEventListener("close",()=>{this.events.safeDispatchEvent("connection:close",{detail:t})}),this.events.safeDispatchEvent("connection:open",{detail:t}),t}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const s=await t4(e,n,t),i=this.connectionEncrypters.get(s);if(i==null)throw new x1(`no crypto module found for ${s}`);return e.log("encrypting inbound connection using %s",s),{...await i.secureInbound(e,t),protocol:s}}catch(s){throw new x1(s.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const s=await e4(e,n,t),i=this.connectionEncrypters.get(s);if(i==null)throw new x1(`no crypto module found for ${s}`);return e.log("encrypting outbound connection using %s",s),{...await i.secureOutbound(e,t),protocol:s}}catch(s){throw new x1(s.message)}}async _multiplexOutbound(e,t,n){const s=Array.from(t.keys());e.log("outbound selecting muxer %s",s);try{e.log.trace("selecting stream muxer from %s",s);const i=await e4(e,s,n),o=t.get(i);if(o==null)throw new sp(`No muxer configured for protocol "${i}"`);return e.log("selected %s as muxer protocol",i),o}catch(i){throw e.log.error("error multiplexing outbound connection - %e",i),new sp(String(i))}}async _multiplexInbound(e,t,n){const s=Array.from(t.keys());e.log("inbound handling muxers %s",s);try{e.log.trace("selecting stream muxer from %s",s);const i=await t4(e,s,n),o=t.get(i);if(o==null)throw new sp(`No muxer configured for protocol "${i}"`);return e.log("selected %s as muxer protocol",i),o}catch(i){throw e.log.error("error multiplexing inbound connection - %e",i),i}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}function Fte(r){return r.skipEncryption===!0}const xR="3.0.6",AR="js-libp2p";function CR(r,e){return`${r??AR}/${e??xR} browser/${globalThis.navigator.userAgent}`}class kR extends Nt{peerId;peerStore;contentRouting;peerRouting;metrics;services;logger;status;components;log;constructor(e){super(),this.status="stopped";const t=new Nt,n=t.dispatchEvent.bind(t);t.dispatchEvent=l=>{const u=n(l),h=this.dispatchEvent(new CustomEvent(l.type,{detail:l.detail}));return u||h},this.peerId=e.peerId,this.logger=e.logger??zg(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=e.nodeInfo?.name??AR,i=e.nodeInfo?.version??xR,o=this.components=Fee({peerId:e.peerId,privateKey:e.privateKey,nodeInfo:{name:s,version:i,userAgent:e.nodeInfo?.userAgent??CR(s,i)},logger:this.logger,events:t,datastore:e.datastore??new sR,connectionGater:Kee(e.connectionGater),dns:e.dns});e.metrics!=null&&(this.metrics=this.configureComponent("metrics",e.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",mee(o,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore})),o.events.addEventListener("peer:update",l=>{if(l.detail.previous==null){const u={id:l.detail.peer.id,multiaddrs:l.detail.peer.addresses.map(h=>h.multiaddr)};o.events.safeDispatchEvent("peer:discovery",{detail:u})}}),e.connectionProtector!=null&&this.configureComponent("connectionProtector",e.connectionProtector(o)),this.components.upgrader=new Ute(this.components,{connectionEncrypters:(e.connectionEncrypters??[]).map((l,u)=>this.configureComponent(`connection-encryption-${u}`,l(this.components))),streamMuxers:(e.streamMuxers??[]).map((l,u)=>this.configureComponent(`stream-muxers-${u}`,l(this.components))),inboundUpgradeTimeout:e.connectionManager?.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:e.connectionManager?.inboundStreamProtocolNegotiationTimeout,outboundStreamProtocolNegotiationTimeout:e.connectionManager?.outboundStreamProtocolNegotiationTimeout,connectionCloseTimeout:e.connectionManager?.connectionCloseTimeout}),this.configureComponent("transportManager",new Dte(this.components,e.transportManager)),this.configureComponent("connectionManager",new Ete(this.components,e.connectionManager)),e.connectionMonitor?.enabled!==!1&&this.configureComponent("connectionMonitor",new kte(this.components,e.connectionMonitor)),this.configureComponent("registrar",new Pte(this.components)),this.configureComponent("addressManager",new xee(this.components,e.addresses));const a=(e.peerRouters??[]).map((l,u)=>this.configureComponent(`peer-router-${u}`,l(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new Tte(this.components,{routers:a}));const c=(e.contentRouters??[]).map((l,u)=>this.configureComponent(`content-router-${u}`,l(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new Ite(this.components,{routers:c})),this.configureComponent("randomWalk",new Rte(this.components)),(e.peerDiscovery??[]).forEach((l,u)=>{this.configureComponent(`peer-discovery-${u}`,l(this.components)).addEventListener("peer",d=>{this.#e(d)})}),e.transports?.forEach((l,u)=>{this.components.transportManager.add(this.configureComponent(`transport-${u}`,l(this.components)))}),e.services!=null)for(const l of Object.keys(e.services)){const u=e.services[l],h=u(this.components);if(h==null){this.log.error("service factory %s returned null or undefined instance",l);continue}this.services[l]=h,this.configureComponent(l,h),h[vd]!=null&&(this.log("registering service %s for content routing",l),c.push(h[vd])),h[Ed]!=null&&(this.log("registering service %s for peer routing",l),a.push(h[Ed])),h[Dp]!=null&&(this.log("registering service %s for peer discovery",l),h[Dp].addEventListener?.("peer",d=>{this.#e(d)}))}Vee(o)}configureComponent(e,t){return t==null&&this.log.error("component %s was null or undefined",e),this.components[e]=t,t}async start(){if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await this.components.beforeStart?.(),await this.components.start(),await this.components.afterStart?.(),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started with peer id %p",this.peerId)}catch(e){throw this.log.error("an error occurred starting libp2p - %e",e),this.status="started",await this.stop(),e}}}async stop(){this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await this.components.beforeStop?.(),await this.components.stop(),await this.components.afterStop?.(),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(e){return this.components.connectionManager.getConnections(e)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const e=new Js;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){return this.components.connectionManager.openConnection(e,{priority:75,...t})}async dialProtocol(e,t,n={}){if(t==null)throw new ue("no protocols were provided to open a stream");if(t=Array.isArray(t)?t:[t],t.length===0)throw new ue("no protocols were provided to open a stream");return this.components.connectionManager.openStream(e,t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(e,t={}){Zg(e)&&(e=On(e.getComponents().findLast(n=>n.code===qe)?.value??"")),await this.components.connectionManager.closeConnections(e,t)}async getPublicKey(e,t={}){if(this.log("getPublicKey %p",e),e.publicKey!=null)return e.publicKey;try{const o=await this.peerStore.get(e,t);if(o.id.publicKey!=null)return o.id.publicKey}catch(o){if(o.name!=="NotFoundError")throw o}const n=Wt([le("/pk/"),e.toMultihash().bytes]),s=await this.contentRouting.get(n,t),i=Cs(s);return await this.peerStore.patch(e,{publicKey:i},t),i}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async s=>{await this.components.registrar.handle(s,t,n)}))}async unhandle(e,t){Array.isArray(e)||(e=[e]),await Promise.all(e.map(async n=>{await this.components.registrar.unhandle(n,t)}))}async register(e,t,n){return this.components.registrar.register(e,t,n)}unregister(e){this.components.registrar.unregister(e)}use(e,t){this.components.registrar.use(e,Array.isArray(t)?t:[t])}unuse(e){this.components.registrar.unuse(e)}async isDialable(e,t={}){return this.components.connectionManager.isDialable(e,t)}#e(e){const{detail:t}=e;if(t.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(t.id,{multiaddrs:t.multiaddrs}).catch(n=>{this.log.error("could not update multiaddrs of discovered peer - %e",n)})}}async function Vte(r={}){r.privateKey??=await d5("Ed25519");const e=new kR({...await QZ(r),peerId:VQ(r.privateKey)});return r.start!==!1&&await e.start(),e}const zte=["dial","dialProtocol","hangUp","handle","unhandle","getMultiaddrs","getProtocols"];function Hte(r){return r==null?!1:r instanceof kR?!0:zte.every(e=>typeof r[e]=="function")}var wy,Iv;function qte(){if(Iv)return wy;Iv=1;function r(t){return t>=55296&&t<=56319}function e(t){return t>=56320&&t<=57343}return wy=function(n,s,i){if(typeof s!="string")throw new Error("Input must be string");for(var o=s.length,a=0,c,l,u=0;u<o;u+=1){if(c=s.charCodeAt(u),l=s[u],r(c)&&e(s.charCodeAt(u+1))&&(u+=1,l+=s[u]),a+=n(l),a===i)return s.slice(0,u+1);if(a>i)return s.slice(0,u-l.length+1)}return s},wy}var by,Tv;function Kte(){if(Tv)return by;Tv=1;function r(t){return t>=55296&&t<=56319}function e(t){return t>=56320&&t<=57343}return by=function(n){if(typeof n!="string")throw new Error("Input must be string");for(var s=n.length,i=0,o=null,a=null,c=0;c<s;c++)o=n.charCodeAt(c),e(o)?a!=null&&r(a)?i+=1:i+=3:o<=127?i+=1:o>=128&&o<=2047?i+=2:o>=2048&&o<=65535&&(i+=3),a=o;return i},by}var vy,Rv;function jte(){if(Rv)return vy;Rv=1;var r=qte(),e=Kte();return vy=r.bind(null,e),vy}var Ey,Pv;function Wte(){if(Pv)return Ey;Pv=1;var r=jte(),e=/[\/\?<>\\:\*\|"]/g,t=/[\x00-\x1f\x80-\x9f]/g,n=/^\.+$/,s=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,i=/[\. ]+$/;function o(a,c){if(typeof a!="string")throw new Error("Input must be string");var l=a.replace(e,c).replace(t,c).replace(n,c).replace(s,c).replace(i,c);return r(l,255)}return Ey=function(a,c){var l=c&&c.replacement||"",u=o(a,l);return l===""?u:o(u,"")},Ey}var Gte=Wte();const Yte=sa(Gte),Dv={keyLength:512/8,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"},Sy={alg:"A128GCM",ext:!0,k:"scm9jmO_4BJAgdwWGVulLg",key_ops:["encrypt","decrypt"],kty:"oct"};function IR(r){const e="AES-GCM";let t=16;const n=12,s="SHA-256",i=16,o=32767,a=rn.get();t*=8;async function c(h,d){const f=a.getRandomValues(new Uint8Array(i)),g=a.getRandomValues(new Uint8Array(n)),m={name:e,iv:g};typeof d=="string"&&(d=le(d));let b;if(d.length===0){b=await a.subtle.importKey("jwk",Sy,{name:"AES-GCM"},!0,["encrypt"]);try{const A={name:"PBKDF2",salt:f,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",d,{name:"PBKDF2"},!1,["deriveKey"]);b=await a.subtle.deriveKey(A,w,{name:e,length:t},!0,["encrypt"])}catch{b=await a.subtle.importKey("jwk",Sy,{name:"AES-GCM"},!0,["encrypt"])}}else{const A={name:"PBKDF2",salt:f,iterations:o,hash:{name:s}},w=await a.subtle.importKey("raw",d,{name:"PBKDF2"},!1,["deriveKey"]);b=await a.subtle.deriveKey(A,w,{name:e,length:t},!0,["encrypt"])}const v=await a.subtle.encrypt(m,b,h);return Wt([f,m.iv,new Uint8Array(v)])}async function l(h,d){const f=h.subarray(0,i),g=h.subarray(i,i+n),m=h.subarray(i+n),b={name:e,iv:g};typeof d=="string"&&(d=le(d));let v;if(d.length===0)try{const w={name:"PBKDF2",salt:f,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",d,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,E,{name:e,length:t},!0,["decrypt"])}catch{v=await a.subtle.importKey("jwk",Sy,{name:"AES-GCM"},!0,["decrypt"])}else{const w={name:"PBKDF2",salt:f,iterations:o,hash:{name:s}},E=await a.subtle.importKey("raw",d,{name:"PBKDF2"},!1,["deriveKey"]);v=await a.subtle.deriveKey(w,E,{name:e,length:t},!0,["decrypt"])}const A=await a.subtle.decrypt(b,v,m);return new Uint8Array(A)}return{encrypt:c,decrypt:l}}/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const Qte="[object ArrayBuffer]";class ve{static isArrayBuffer(e){return Object.prototype.toString.call(e)===Qte}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=ve.toUint8Array(e),s=ve.toUint8Array(t);if(n.length!==s.byteLength)return!1;for(let i=0;i<n.length;i++)if(n[i]!==s[i])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const s=new Uint8Array(n);let i=0;for(const o of t){const a=this.toUint8Array(o);s.set(a,i),i+=a.length}return e[e.length-1]instanceof Function?this.toView(s,e[e.length-1]):s.buffer}}const _y="string",Xte=/^[0-9a-f\s]+$/i,Jte=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,Zte=/^[a-zA-Z0-9-_]+$/;class Nv{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let s=0;s<t.length;s++)n[s]=t.charCodeAt(s);return n.buffer}static toString(e){const t=ve.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return decodeURIComponent(escape(n))}}class Ms{static toString(e,t=!1){const n=ve.toArrayBuffer(e),s=new DataView(n);let i="";for(let o=0;o<n.byteLength;o+=2){const a=s.getUint16(o,t);i+=String.fromCharCode(a)}return i}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),s=new DataView(n);for(let i=0;i<e.length;i++)s.setUint16(i*2,e.charCodeAt(i),t);return n}}class Ne{static isHex(e){return typeof e===_y&&Xte.test(e)}static isBase64(e){return typeof e===_y&&Jte.test(e)}static isBase64Url(e){return typeof e===_y&&Zte.test(e)}static ToString(e,t="utf8"){const n=ve.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return Ms.toString(n,!0);case"utf16":case"utf16be":return Ms.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return Ms.fromString(e,!0);case"utf16":case"utf16be":return Ms.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=ve.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ne.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ne.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ne.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return Nv.fromString(e);case"utf16":case"utf16be":return Ms.fromString(e);case"utf16le":case"usc2":return Ms.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ne.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return Nv.toString(e);case"utf16":case"utf16be":return Ms.toString(e);case"utf16le":case"usc2":return Ms.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);return n.buffer}static ToBinary(e){const t=ve.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return n}static ToHex(e){const t=ve.toUint8Array(e);let n="";const s=t.length;for(let i=0;i<s;i++){const o=t[i];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ne.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let s=0;s<t.length;s=s+2){const i=t.slice(s,s+2);n[s/2]=parseInt(i,16)}return n.buffer}static ToUtf16String(e,t=!1){return Ms.toString(e,t)}static FromUtf16String(e,t=!1){return Ms.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return e?.replace(/[\n\r\t ]/g,"")||""}}Ne.DEFAULT_UTF8_ENCODING="utf8";function ere(...r){const e=r.map(s=>s.byteLength).reduce((s,i)=>s+i),t=new Uint8Array(e);let n=0;return r.map(s=>new Uint8Array(s)).forEach(s=>{for(const i of s)t[n++]=i}),t.buffer}function TR(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<r.byteLength;s++)if(t[s]!==n[s])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function zl(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function Za(r,e,t=-1){const n=t;let s=r,i=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),i=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),i=n}const l=new Uint8Array(c);for(let u=a-1;u>=0;u--){const h=Math.pow(2,u*e);l[i-u-1]=Math.floor(s/h),s-=l[i-u-1]*h}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function r4(...r){let e=0,t=0;for(const i of r)e+=i.length;const n=new ArrayBuffer(e),s=new Uint8Array(n);for(const i of r)s.set(i,t),t+=i.length;return s}function RR(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=zl(t,8),s=new ArrayBuffer(this.valueHex.byteLength),i=new Uint8Array(s);for(let a=0;a<this.valueHex.byteLength;a++)i[a]=r[a];return i[0]&=127,zl(i,8)-n}function tre(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=Za(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let s=Za(e,8,n),i=new Uint8Array(s);if(i[0]&128){const o=s.slice(0),a=new Uint8Array(o);s=new ArrayBuffer(s.byteLength+1),i=new Uint8Array(s);for(let c=0;c<o.byteLength;c++)i[c+1]=a[c];i[0]=0}return s}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function rre(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<t.length;s++)if(t[s]!==n[s])return!1;return!0}function Sn(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,s=new Array(n);for(let o=0;o<n;o++)s[o]="0";return s.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function p0(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function a8(r){let e=0,t=0;for(let s=0;s<r.length;s++){const i=r[s];e+=i.byteLength}const n=new Uint8Array(e);for(let s=0;s<r.length;s++){const i=r[s];n.set(new Uint8Array(i),t),t+=i.byteLength}return n.buffer}function ro(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class d2{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return a8(this.items)}}const Wu=[new Uint8Array([1])],Ov="0123456789",xy="name",Lv="valueHexView",nre="isHexOnly",sre="idBlock",ire="tagClass",ore="tagNumber",are="isConstructed",cre="fromBER",lre="toBER",ure="local",hn="",Ds=new ArrayBuffer(0),f2=new Uint8Array(0),Hd="EndOfContent",PR="OCTET STRING",DR="BIT STRING";function pi(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var s;super(...n);const i=n[0]||{};this.isHexOnly=(s=i.isHexOnly)!==null&&s!==void 0?s:!1,this.valueHexView=i.valueHex?ve.toUint8Array(i.valueHex):f2}fromBER(n,s,i){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!ro(this,o,s,i))return-1;const a=s+i;return this.valueHexView=o.subarray(s,a),this.valueHexView.length?(this.blockLength=i,a):(this.warnings.push("Zero buffer length"),s)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",Ds)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ne.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class Cc{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=hn,warnings:n=[],valueBeforeDecode:s=f2}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=ve.toUint8Array(s)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ne.ToHex(this.valueBeforeDecodeView)}}}Cc.NAME="baseBlock";class on extends Cc{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}on.NAME="valueBlock";class NR extends pi(Cc){constructor({idBlock:e={}}={}){var t,n,s,i;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?ve.toUint8Array(e.valueHex):f2,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(s=e.tagNumber)!==null&&s!==void 0?s:-1,this.isConstructed=(i=e.isConstructed)!==null&&i!==void 0?i:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",Ds}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const s=new Uint8Array(1);if(!e){let i=this.tagNumber;i&=31,t|=i,s[0]=t}return s.buffer}if(!this.isHexOnly){const s=Za(this.tagNumber,7),i=new Uint8Array(s),o=s.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=i[c]|128;a[o]=i[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const s=this.valueHexView;for(let i=0;i<s.length-1;i++)n[i+1]=s[i]|128;n[this.valueHexView.byteLength]=s[s.length-1]}return n.buffer}fromBER(e,t,n){const s=ve.toUint8Array(e);if(!ro(this,s,t,n))return-1;const i=s.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;switch(i[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(i[0]&32)===32,this.isHexOnly=!1;const a=i[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;i[c]&128;){if(l[c-1]=i[c]&127,c++,c>=i.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;const d=new Uint8Array(u);for(let f=0;f<l.length;f++)d[f]=l[f];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=i[c]&127;const h=new Uint8Array(c);for(let d=0;d<c;d++)h[d]=l[d];l=this.valueHexView=new Uint8Array(c),l.set(h),this.blockLength<=9?this.tagNumber=zl(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}NR.NAME="identificationBlock";class OR extends Cc{constructor({lenBlock:e={}}={}){var t,n,s;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(s=e.length)!==null&&s!==void 0?s:0}fromBER(e,t,n){const s=ve.toUint8Array(e);if(!ro(this,s,t,n))return-1;const i=s.subarray(t,t+n);if(i.length===0)return this.error="Zero buffer length",-1;if(i[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=i[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(i[0]&128),this.longFormUsed===!1)return this.length=i[0],this.blockLength=1,t+this.blockLength;const o=i[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>i.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=s.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=zl(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const s=Za(this.length,8);if(s.byteLength>127)return this.error="Too big length",Ds;if(t=new ArrayBuffer(s.byteLength+1),e)return t;const i=new Uint8Array(s);n=new Uint8Array(t),n[0]=s.byteLength|128;for(let o=0;o<s.byteLength;o++)n[o+1]=i[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}OR.NAME="lengthBlock";const Ie={};class Tr extends Cc{constructor({name:e=hn,optional:t=!1,primitiveSchema:n,...s}={},i){super(s),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new NR(s),this.lenBlock=new OR(s),this.valueBlock=i?new i(s):new on(s)}fromBER(e,t,n){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}toBER(e,t){const n=t||new d2;t||LR(this);const s=this.idBlock.toBER(e);if(n.write(s),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const i=this.valueBlock.toBER(e);this.lenBlock.length=i.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(i)}return t?Ds:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ne.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ne.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return rre(t,n)}}Tr.NAME="BaseBlock";function LR(r){var e;if(r instanceof Ie.Constructed)for(const t of r.valueBlock.value)LR(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class c8 extends Tr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=hn,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}c8.NAME="BaseStringBlock";class BR extends pi(on){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}BR.NAME="PrimitiveValueBlock";var MR;class kf extends Tr{constructor(e={}){super(e,BR),this.idBlock.isConstructed=!1}}MR=kf;Ie.Primitive=MR;kf.NAME="PRIMITIVE";function hre(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function Au(r,e=0,t=r.length){const n=e;let s=new Tr({},on);const i=new Cc;if(!ro(i,r,e,t))return s.error=i.error,{offset:-1,result:s};if(!r.subarray(e,e+t).length)return s.error="Zero buffer length",{offset:-1,result:s};let a=s.idBlock.fromBER(r,e,t);if(s.idBlock.warnings.length&&s.warnings.concat(s.idBlock.warnings),a===-1)return s.error=s.idBlock.error,{offset:-1,result:s};if(e=a,t-=s.idBlock.blockLength,a=s.lenBlock.fromBER(r,e,t),s.lenBlock.warnings.length&&s.warnings.concat(s.lenBlock.warnings),a===-1)return s.error=s.lenBlock.error,{offset:-1,result:s};if(e=a,t-=s.lenBlock.blockLength,!s.idBlock.isConstructed&&s.lenBlock.isIndefiniteForm)return s.error="Indefinite length form used for primitive encoding form",{offset:-1,result:s};let c=Tr;switch(s.idBlock.tagClass){case 1:if(s.idBlock.tagNumber>=37&&s.idBlock.isHexOnly===!1)return s.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:s};switch(s.idBlock.tagNumber){case 0:if(s.idBlock.isConstructed&&s.lenBlock.length>0)return s.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:s};c=Ie.EndOfContent;break;case 1:c=Ie.Boolean;break;case 2:c=Ie.Integer;break;case 3:c=Ie.BitString;break;case 4:c=Ie.OctetString;break;case 5:c=Ie.Null;break;case 6:c=Ie.ObjectIdentifier;break;case 10:c=Ie.Enumerated;break;case 12:c=Ie.Utf8String;break;case 13:c=Ie.RelativeObjectIdentifier;break;case 14:c=Ie.TIME;break;case 15:return s.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:s};case 16:c=Ie.Sequence;break;case 17:c=Ie.Set;break;case 18:c=Ie.NumericString;break;case 19:c=Ie.PrintableString;break;case 20:c=Ie.TeletexString;break;case 21:c=Ie.VideotexString;break;case 22:c=Ie.IA5String;break;case 23:c=Ie.UTCTime;break;case 24:c=Ie.GeneralizedTime;break;case 25:c=Ie.GraphicString;break;case 26:c=Ie.VisibleString;break;case 27:c=Ie.GeneralString;break;case 28:c=Ie.UniversalString;break;case 29:c=Ie.CharacterString;break;case 30:c=Ie.BmpString;break;case 31:c=Ie.DATE;break;case 32:c=Ie.TimeOfDay;break;case 33:c=Ie.DateTime;break;case 34:c=Ie.Duration;break;default:{const l=s.idBlock.isConstructed?new Ie.Constructed:new Ie.Primitive;l.idBlock=s.idBlock,l.lenBlock=s.lenBlock,l.warnings=s.warnings,s=l}}break;case 2:case 3:case 4:default:c=s.idBlock.isConstructed?Ie.Constructed:Ie.Primitive}return s=hre(s,c),a=s.fromBER(r,e,s.lenBlock.isIndefiniteForm?t:s.lenBlock.length),s.valueBeforeDecodeView=r.subarray(n,n+s.blockLength),{offset:a,result:s}}function Bi(r){if(!r.byteLength){const e=new Tr({},on);return e.error="Input buffer has zero length",{offset:-1,result:e}}return Au(ve.toUint8Array(r).slice(),0,r.byteLength)}function dre(r,e){return r?1:e}class Mo extends on{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const s=ve.toUint8Array(e);if(!ro(this,s,t,n))return-1;if(this.valueBeforeDecodeView=s.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let i=t;for(;dre(this.isIndefiniteForm,n)>0;){const o=Au(s,i,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(i=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Hd)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Hd?this.value.pop():this.warnings.push("No EndOfContent block encoded")),i}toBER(e,t){const n=t||new d2;for(let s=0;s<this.value.length;s++)this.value[s].toBER(e,n);return t?Ds:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Mo.NAME="ConstructedValueBlock";var $R;class tn extends Tr{constructor(e={}){super(e,Mo),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const s=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return s===-1?(this.error=this.valueBlock.error,s):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),s)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(s=>`  ${s}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}$R=tn;Ie.Constructed=$R;tn.NAME="CONSTRUCTED";class UR extends on{fromBER(e,t,n){return t}toBER(e){return Ds}}UR.override="EndOfContentValueBlock";var FR;class l8 extends Tr{constructor(e={}){super(e,UR),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}FR=l8;Ie.EndOfContent=FR;l8.NAME=Hd;var VR;class qi extends Tr{constructor(e={}){super(e,on),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const s=new Uint8Array(n);s[0]=5,s[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}VR=qi;Ie.Null=VR;qi.NAME="NULL";class zR extends pi(on){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=ve.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const s=ve.toUint8Array(e);return ro(this,s,t,n)?(this.valueHexView=s.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,RR.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}zR.NAME="BooleanValueBlock";var HR;let p2=class extends Tr{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,zR),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};HR=p2;Ie.Boolean=HR;p2.NAME="BOOLEAN";class qR extends pi(Mo){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let s=0;if(this.isConstructed){if(this.isHexOnly=!1,s=Mo.prototype.fromBER.call(this,e,t,n),s===-1)return s;for(let i=0;i<this.value.length;i++){const o=this.value[i].constructor.NAME;if(o===Hd){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==PR)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,s=super.fromBER(e,t,n),this.blockLength=n;return s}toBER(e,t){return this.isConstructed?Mo.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}qR.NAME="OctetStringValueBlock";var u8;let ps=class extends Tr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},qR),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const i=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(i.byteLength){const o=Au(i,0,i.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return tn.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ne.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof u8&&e.push(t.valueBlock.valueHexView);return ve.concat(e)}};u8=ps;Ie.OctetString=u8;ps.NAME=PR;class KR extends pi(Mo){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let s=-1;if(this.isConstructed){if(s=Mo.prototype.fromBER.call(this,e,t,n),s===-1)return s;for(const a of this.value){const c=a.constructor.NAME;if(c===Hd){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==DR)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return s}const i=ve.toUint8Array(e);if(!ro(this,i,t,n))return-1;const o=i.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=Au(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Mo.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return Ds;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}KR.NAME="BitStringValueBlock";var jR;let Ua=class extends Tr{constructor({idBlock:e={},lenBlock:t={},...n}={}){var s,i;(s=n.isConstructed)!==null&&s!==void 0||(n.isConstructed=!!(!((i=n.value)===null||i===void 0)&&i.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},KR),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return tn.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),s=this.constructor.NAME,i=n.substring(0,n.length-this.valueBlock.unusedBits);return`${s} : ${i}`}}};jR=Ua;Ie.BitString=jR;Ua.NAME=DR;var WR;function fre(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),s=new Uint8Array(e);let i=n.slice(0);const o=i.length-1,a=s.slice(0),c=a.length-1;let l=0;const u=c<o?o:c;let h=0;for(let d=u;d>=0;d--,h++){switch(!0){case h<a.length:l=i[o-h]+a[c-h]+t[0];break;default:l=i[o-h]+t[0]}switch(t[0]=l/10,!0){case h>=i.length:i=r4(new Uint8Array([l%10]),i);break;default:i[o-h]=l%10}}return t[0]>0&&(i=r4(t,i)),i}function Bv(r){if(r>=Wu.length)for(let e=Wu.length;e<=r;e++){const t=new Uint8Array([0]);let n=Wu[e-1].slice(0);for(let s=n.length-1;s>=0;s--){const i=new Uint8Array([(n[s]<<1)+t[0]]);t[0]=i[0]/10,n[s]=i[0]%10}t[0]>0&&(n=r4(t,n)),Wu.push(n)}return Wu[r]}function pre(r,e){let t=0;const n=new Uint8Array(r),s=new Uint8Array(e),i=n.slice(0),o=i.length-1,a=s.slice(0),c=a.length-1;let l,u=0;for(let h=c;h>=0;h--,u++)switch(l=i[o-u]-a[c-u]-t,!0){case l<0:t=1,i[o-u]=l+10;break;default:t=0,i[o-u]=l}if(t>0)for(let h=o-c+1;h>=0;h--,u++)if(l=i[o-u]-t,l<0)t=1,i[o-u]=l+10;else{t=0,i[o-u]=l;break}return i.slice()}class h8 extends pi(on){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=RR.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(tre(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,s=0){const i=this.fromBER(e,t,n);if(i===-1)return i;const o=this.valueHexView;return o[0]===0&&(o[1]&128)!==0?this.valueHexView=o.subarray(1):s!==0&&o.length<s&&(s-o.length>1&&(s=o.length+1),this.valueHexView=o.subarray(s-o.length)),i}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const s=super.fromBER(e,t,n);return s===-1||this.setValueHex(),s}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,s;const i=this.valueHexView;let o="",a=!1;for(let c=i.byteLength-1;c>=0;c--){s=i[c];for(let l=0;l<8;l++){if((s&1)===1)switch(n){case e:t=pre(Bv(n),t),o="-";break;default:t=fre(t,Bv(n))}n++,s>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=Ov.charAt(t[c]));return a===!1&&(o+=Ov.charAt(0)),o}}WR=h8;h8.NAME="IntegerValueBlock";Object.defineProperty(WR.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var jh;class Mi extends Tr{constructor(e={}){super(e,h8),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return p0(),BigInt(this.valueBlock.toString())}static fromBigInt(e){p0();const t=BigInt(e),n=new d2,s=t.toString(16).replace(/^-/,""),i=new Uint8Array(Ne.FromHex(s));if(t<0){const a=new Uint8Array(i.length+(i[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Ne.ToHex(a)}`)+t,u=ve.toUint8Array(Ne.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else i[0]&128&&n.write(new Uint8Array([0])),n.write(i);return new jh({valueHex:n.final()})}convertToDER(){const e=new jh({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new jh({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}jh=Mi;Ie.Integer=jh;Mi.NAME="INTEGER";var GR;class g2 extends Mi{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}GR=g2;Ie.Enumerated=GR;g2.NAME="ENUMERATED";class n4 extends pi(on){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const s=ve.toUint8Array(e);if(!ro(this,s,t,n))return-1;const i=s.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=zl(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){p0();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let s=0;s<n.length;s++)n[s]=parseInt(t.slice(s*7,s*7+7),2)+(s+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Za(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ds;const n=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n}toString(){let e="";if(this.isHexOnly)e=Ne.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}n4.NAME="sidBlock";class YR extends on{constructor({value:e=hn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let s=t;for(;n>0;){const i=new n4;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.value.length===0&&(i.isFirstSid=!0),this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const s=this.value[n].toBER(e);if(s.byteLength===0)return this.error=this.value[n].error,Ds;t.push(s)}return a8(t)}fromString(e){this.value=[];let t=0,n=0,s="",i=!1;do if(n=e.indexOf(".",t),n===-1?s=e.substring(t):s=e.substring(t,n),t=n+1,i){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(s,10);if(isNaN(c))return;o.valueDec=c+a,i=!1}else{const o=new n4;if(s>Number.MAX_SAFE_INTEGER){p0();const a=BigInt(s);o.valueBigInt=a}else if(o.valueDec=parseInt(s,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,i=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),t?(s=`{${s}}`,this.value[n].isFirstSid?e=`2.{${s} - 80}`:e+=s):e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}YR.NAME="ObjectIdentifierValueBlock";var QR;class Ii extends Tr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,YR),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}QR=Ii;Ie.ObjectIdentifier=QR;Ii.NAME="OBJECT IDENTIFIER";class s4 extends pi(Cc){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const s=ve.toUint8Array(e);if(!ro(this,s,t,n))return-1;const i=s.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=i[a]&127,this.blockLength++,(i[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(i[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=zl(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const s=this.valueHexView,i=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)i[o]=s[o]|128;return i[this.blockLength-1]=s[this.blockLength-1],i.buffer}const t=Za(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",Ds;const n=new Uint8Array(t.byteLength);if(!e){const s=new Uint8Array(t),i=t.byteLength-1;for(let o=0;o<i;o++)n[o]=s[o]|128;n[i]=s[i]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ne.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}s4.NAME="relativeSidBlock";class XR extends on{constructor({value:e=hn,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let s=t;for(;n>0;){const i=new s4;if(s=i.fromBER(e,s,n),s===-1)return this.blockLength=0,this.error=i.error,s;this.blockLength+=i.blockLength,n-=i.blockLength,this.value.push(i)}return s}toBER(e,t){const n=[];for(let s=0;s<this.value.length;s++){const i=this.value[s].toBER(e);if(i.byteLength===0)return this.error=this.value[s].error,Ds;n.push(i)}return a8(n)}fromString(e){this.value=[];let t=0,n=0,s="";do{n=e.indexOf(".",t),n===-1?s=e.substring(t):s=e.substring(t,n),t=n+1;const i=new s4;if(i.valueDec=parseInt(s,10),isNaN(i.valueDec))return!0;this.value.push(i)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let s=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(s=`{${s}}`),e+=s}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}XR.NAME="RelativeObjectIdentifierValueBlock";var JR;class d8 extends Tr{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,XR),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}JR=d8;Ie.RelativeObjectIdentifier=JR;d8.NAME="RelativeObjectIdentifier";var ZR;class nr extends tn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}ZR=nr;Ie.Sequence=ZR;nr.NAME="SEQUENCE";var eP;let ei=class extends tn{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};eP=ei;Ie.Set=eP;ei.NAME="SET";class tP extends pi(on){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=hn}toJSON(){return{...super.toJSON(),value:this.value}}}tP.NAME="StringValueBlock";class rP extends tP{}rP.NAME="SimpleStringValueBlock";class Ln extends c8{constructor({...e}={}){super(e,rP)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,ve.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let s=0;s<t;s++)n[s]=e.charCodeAt(s);this.valueBlock.value=e}}Ln.NAME="SIMPLE STRING";class nP extends Ln{fromBuffer(e){this.valueBlock.valueHexView=ve.toUint8Array(e);try{this.valueBlock.value=Ne.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ne.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ne.FromUtf8String(e)),this.valueBlock.value=e}}nP.NAME="Utf8StringValueBlock";var sP;class no extends nP{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}sP=no;Ie.Utf8String=sP;no.NAME="UTF8String";class iP extends Ln{fromBuffer(e){this.valueBlock.value=Ne.ToUtf16String(e),this.valueBlock.valueHexView=ve.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ne.FromUtf16String(e))}}iP.NAME="BmpStringValueBlock";var oP;class m2 extends iP{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}oP=m2;Ie.BmpString=oP;m2.NAME="BMPString";class aP extends Ln{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let s=0;s<n.length;s+=4)n[s]=n[s+3],n[s+1]=n[s+2],n[s+2]=0,n[s+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let s=0;s<t;s++){const i=Za(e.charCodeAt(s),8),o=new Uint8Array(i);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[s*4+c+a]=o[c]}this.valueBlock.value=e}}aP.NAME="UniversalStringValueBlock";var cP;class y2 extends aP{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}cP=y2;Ie.UniversalString=cP;y2.NAME="UniversalString";var lP;class w2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}lP=w2;Ie.NumericString=lP;w2.NAME="NumericString";var uP;class b2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}uP=b2;Ie.PrintableString=uP;b2.NAME="PrintableString";var hP;class v2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}hP=v2;Ie.TeletexString=hP;v2.NAME="TeletexString";var dP;class E2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}dP=E2;Ie.VideotexString=dP;E2.NAME="VideotexString";var fP;class S2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}fP=S2;Ie.IA5String=fP;S2.NAME="IA5String";var pP;class _2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}pP=_2;Ie.GraphicString=pP;_2.NAME="GraphicString";var gP;class If extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}gP=If;Ie.VisibleString=gP;If.NAME="VisibleString";var mP;class x2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}mP=x2;Ie.GeneralString=mP;x2.NAME="GeneralString";var yP;class A2 extends Ln{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}yP=A2;Ie.CharacterString=yP;A2.NAME="CharacterString";var wP;class Tf extends If{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let s=0;s<e.length;s++)this.valueBlock.valueHexView[s]=e.charCodeAt(s)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,ve.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let s=0;s<e.length;s++)n[s]=e.charCodeAt(s);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const s=parseInt(n[1],10);s>=50?this.year=1900+s:this.year=2e3+s,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Sn(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Sn(this.month,2),t[2]=Sn(this.day,2),t[3]=Sn(this.hour,2),t[4]=Sn(this.minute,2),t[5]=Sn(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}wP=Tf;Ie.UTCTime=wP;Tf.NAME="UTCTime";var bP;class C2 extends Tf{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",s="",i=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const h=new Number(e[e.length-1]);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let h=1,d=n.indexOf("+"),f="";if(d===-1&&(d=n.indexOf("-"),h=-1),d!==-1){if(f=n.substring(d+1),n=n.substring(0,d),f.length!==2&&f.length!==4)throw new Error("Wrong input string for conversion");let g=parseInt(f.substring(0,2),10);if(isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");if(a=h*g,f.length===4){if(g=parseInt(f.substring(2,4),10),isNaN(g.valueOf()))throw new Error("Wrong input string for conversion");c=h*g}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const h=new Number(`0${n.substring(l)}`);if(isNaN(h.valueOf()))throw new Error("Wrong input string for conversion");i=h.valueOf(),s=n.substring(0,l)}else s=n;switch(!0){case s.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case s.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*i;this.minute=Math.floor(h),h=60*(h-this.minute),this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case s.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let h=60*i;this.second=Math.floor(h),h=1e3*(h-this.second),this.millisecond=Math.floor(h)}break;case s.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const h=1e3*i;this.millisecond=Math.floor(h)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(s);if(u===null)throw new Error("Wrong input string for conversion");for(let h=1;h<u.length;h++)switch(h){case 1:this.year=parseInt(u[h],10);break;case 2:this.month=parseInt(u[h],10);break;case 3:this.day=parseInt(u[h],10);break;case 4:this.hour=parseInt(u[h],10)+a;break;case 5:this.minute=parseInt(u[h],10)+c;break;case 6:this.second=parseInt(u[h],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const h=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=h.getUTCFullYear(),this.month=h.getUTCMonth(),this.day=h.getUTCDay(),this.hour=h.getUTCHours(),this.minute=h.getUTCMinutes(),this.second=h.getUTCSeconds(),this.millisecond=h.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Sn(this.year,4)),t.push(Sn(this.month,2)),t.push(Sn(this.day,2)),t.push(Sn(this.hour,2)),t.push(Sn(this.minute,2)),t.push(Sn(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Sn(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}bP=C2;Ie.GeneralizedTime=bP;C2.NAME="GeneralizedTime";var vP;class f8 extends no{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}vP=f8;Ie.DATE=vP;f8.NAME="DATE";var EP;class p8 extends no{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}EP=p8;Ie.TimeOfDay=EP;p8.NAME="TimeOfDay";var SP;class g8 extends no{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}SP=g8;Ie.DateTime=SP;g8.NAME="DateTime";var _P;class m8 extends no{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}_P=m8;Ie.Duration=_P;m8.NAME="Duration";var xP;class y8 extends no{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}xP=y8;Ie.TIME=xP;y8.NAME="TIME";class ec{constructor({name:e=hn,optional:t=!1}={}){this.name=e,this.optional=t}}class w8 extends ec{constructor({value:e=[],...t}={}){super(t),this.value=e}}class g0 extends ec{constructor({value:e=new ec,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class gre{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=ve.toUint8Array(e)}constructor({data:e=f2}={}){this.dataView=ve.toUint8Array(e)}fromBER(e,t,n){const s=t+n;return this.dataView=ve.toUint8Array(e).subarray(t,s),s}toBER(e){return this.dataView.slice().buffer}}function To(r,e,t){if(t instanceof w8){for(const i of t.value)if(To(r,e,i).verified)return{verified:!0,result:r};{const i={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(xy)&&(i.name=t.name),i}}if(t instanceof ec)return t.hasOwnProperty(xy)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(sre in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(cre in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(lre in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(ire)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(ore)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(are)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(nre in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(Lv in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const i=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(i.length!==o.length)return{verified:!1,result:r};for(let a=0;a<i.length;a++)if(i[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&(r[t.name]=e)),t instanceof Ie.Constructed){let i=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof g0&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-i>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof g0){if(o=To(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&delete r[t.name]),o;if(xy in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};ure in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=To(r,e.valueBlock.value[c-i],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)i++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&Lv in e.valueBlock){const i=Au(e.valueBlock.valueHexView);if(i.offset===-1){const o={verified:!1,result:i.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,hn),t.name&&(delete r[t.name],o.name=t.name)),o}return To(r,i.result,t.primitiveSchema)}return{verified:!0,result:r}}function mre(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=Au(ve.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:To(t.result,t.result,e)}const AP=Object.freeze(Object.defineProperty({__proto__:null,Any:ec,BaseBlock:Tr,BaseStringBlock:c8,BitString:Ua,BmpString:m2,Boolean:p2,CharacterString:A2,Choice:w8,Constructed:tn,DATE:f8,DateTime:g8,Duration:m8,EndOfContent:l8,Enumerated:g2,GeneralString:x2,GeneralizedTime:C2,GraphicString:_2,HexBlock:pi,IA5String:S2,Integer:Mi,Null:qi,NumericString:w2,ObjectIdentifier:Ii,OctetString:ps,Primitive:kf,PrintableString:b2,RawData:gre,RelativeObjectIdentifier:d8,Repeated:g0,Sequence:nr,Set:ei,TIME:y8,TeletexString:v2,TimeOfDay:p8,UTCTime:Tf,UniversalString:y2,Utf8String:no,ValueBlock:on,VideotexString:E2,ViewWriter:d2,VisibleString:If,compareSchema:To,fromBER:Bi,verifySchema:mre},Symbol.toStringTag,{value:"Module"})),yre=16,i4=32,o4=1e4;async function k2(r,e){const n=await IR().encrypt(r,e);return gn.encode(n)}async function Mv(r,e,t){if(r.type==="RSA")return Ere(r,e,t);if(r.type==="Ed25519")return wre(r,e,t);if(r.type==="secp256k1")return bre(r,e,t);if(r.type==="ECDSA")return vre(r,e,t);throw new pu}async function wre(r,e,t="libp2p-key"){if(t==="libp2p-key")return k2(Ef(r),e);throw new ue(`export format '${t}' is not supported`)}async function bre(r,e,t="libp2p-key"){if(t==="libp2p-key")return k2(Ef(r),e);throw new ue("Export format is not supported")}async function vre(r,e,t="libp2p-key"){if(t==="libp2p-key")return k2(Ef(r),e);throw new ue(`export format '${t}' is not supported`)}async function Ere(r,e,t="pkcs-8"){if(t==="pkcs-8")return Sre(r,e);if(t==="libp2p-key")return k2(Ef(r),e);throw new ue("Export format is not supported")}async function Sre(r,e){const t=rn.get(),s=new nr({value:[new Mi({value:0}),new nr({value:[new Ii({value:"1.2.840.113549.1.1.1"}),new qi]}),new ps({valueHex:r.raw})]}).toBER(),i=new Uint8Array(s,0,s.byteLength),o=Qa(yre),a=await Jk(jg,e,o,{c:o4,dkLen:i4}),c=Qa(16),l=await t.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),u=await t.subtle.encrypt({name:"AES-CBC",iv:c},l,i),h=new nr({value:[new ps({valueHex:o}),new Mi({value:o4}),new Mi({value:i4}),new nr({value:[new Ii({value:"1.2.840.113549.2.11"}),new qi]})]}),d=new nr({value:[new Ii({value:"1.2.840.113549.1.5.13"}),new nr({value:[new nr({value:[new Ii({value:"1.2.840.113549.1.5.12"}),h]}),new nr({value:[new Ii({value:"2.16.840.1.101.3.4.1.42"}),new ps({valueHex:c})]})]})]}),g=new nr({value:[d,new ps({valueHex:u})]}).toBER(),m=new Uint8Array(g,0,g.byteLength);return["-----BEGIN ENCRYPTED PRIVATE KEY-----",...he(m,"base64pad").split(/(.{64})/).filter(Boolean),"-----END ENCRYPTED PRIVATE KEY-----"].join(`
`)}async function $v(r,e){try{const t=await _re(r,e);return aK(t)}catch{}if(!r.includes("BEGIN"))throw new ue("Encrypted key was not a libp2p-key or a PEM file");return xre(r,e)}async function _re(r,e){const t=gn.decode(r);return IR().decrypt(t,e)}async function xre(r,e){const t=rn.get();let n;if(r.includes("-----BEGIN ENCRYPTED PRIVATE KEY-----")){const i=le(r.replace("-----BEGIN ENCRYPTED PRIVATE KEY-----","").replace("-----END ENCRYPTED PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Bi(i),{iv:a,salt:c,iterations:l,keySize:u,cipherText:h}=Are(o),d=await Jk(jg,e,c,{c:l,dkLen:u}),f=await t.subtle.importKey("raw",d,"AES-CBC",!1,["decrypt"]),g=Wh(await t.subtle.decrypt({name:"AES-CBC",iv:a},f,h)),{result:m}=Bi(g);n=Uv(m)}else if(r.includes("-----BEGIN PRIVATE KEY-----")){const i=le(r.replace("-----BEGIN PRIVATE KEY-----","").replace("-----END PRIVATE KEY-----","").replace(/\n/g,"").trim(),"base64pad"),{result:o}=Bi(i);n=Uv(o)}else throw new ue("Could not parse private key from PEM data");const s=cK(n);if(s.type!=="RSA")throw new ue("Could not parse RSA private key from PEM data");return s}function Are(r){const e=r.valueBlock.value[0];if(e.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.13")throw new ue("Only pkcs5PBES2 encrypted private keys are supported");const n=e.valueBlock.value[1].valueBlock.value[0];if(n.valueBlock.value[0].toString()!=="OBJECT IDENTIFIER : 1.2.840.113549.1.5.12")throw new ue("Only pkcs5PBKDF2 key derivation functions are supported");const i=n.valueBlock.value[1],o=Wh(i.valueBlock.value[0].getValue());let a=o4,c=i4;if(i.valueBlock.value.length===3)a=Number(i.valueBlock.value[1].toBigInt()),c=Number(i.valueBlock.value[2].toBigInt());else if(i.valueBlock.value.length===2)throw new ue("Could not derive key size and iterations from PEM file - please use @libp2p/rsa to re-import your key");const l=e.valueBlock.value[1].valueBlock.value[1],u=l.valueBlock.value[0].toString();if(u!=="OBJECT IDENTIFIER : 1.2.840.113549.3.7"){if(u!=="OBJECT IDENTIFIER : 1.3.14.3.2.7"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.2"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.22"){if(u!=="OBJECT IDENTIFIER : 2.16.840.1.101.3.4.1.42")throw new ue("Only AES-CBC encryption schemes are supported")}}}}const h=Wh(l.valueBlock.value[1].getValue());return{cipherText:Wh(r.valueBlock.value[1].getValue()),salt:o,iterations:a,keySize:c,iv:h}}function Uv(r){return Wh(r.valueBlock.value[2].getValue())}function Wh(r){return new Uint8Array(r,0,r.byteLength)}const Cre="/pkcs8/",a4="/info/",Gu=new WeakMap,pa={minKeyLength:112/8,minSaltLength:128/8,minIterationCount:1e3};function Lc(r){return r==null||typeof r!="string"?!1:r===Yte(r.trim())&&r.length>0}async function vr(){const t=Math.random()*800+200;await new Promise(n=>setTimeout(n,t))}function ga(r){return new Pt(Cre+r)}function Bc(r){return new Pt(a4+r)}async function kre(r){const e=Ef(r),t=await Zt.digest(e);return Dt.encode(t.bytes).substring(1)}class Ire{components;init;log;self;constructor(e,t){if(this.components=e,this.log=e.logger.forComponent("libp2p:keychain"),this.init={...t,dek:{...Dv,...t.dek}},this.self=t.selfKey??"self",this.init.pass!=null&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(this.init.dek?.keyLength!=null&&this.init.dek.keyLength<pa.minKeyLength)throw new Error(`dek.keyLength must be least ${pa.minKeyLength} bytes`);if(this.init.dek?.salt?.length!=null&&this.init.dek.salt.length<pa.minSaltLength)throw new Error(`dek.saltLength must be least ${pa.minSaltLength} bytes`);if(this.init.dek?.iterationCount!=null&&this.init.dek.iterationCount<pa.minIterationCount)throw new Error(`dek.iterationCount must be least ${pa.minIterationCount}`);const n=this.init.pass!=null&&this.init.dek?.salt!=null?p9(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Gu.set(this,{dek:n})}[Symbol.toStringTag]="@libp2p/keychain";[yr]=["@libp2p/keychain"];static generateOptions(){const e=Object.assign({},this.options),t=Math.ceil(pa.minSaltLength/3)*3;return e.dek!=null&&(e.dek.salt=he(Qa(t),"base64")),e}static get options(){return{dek:{...Dv}}}async findKeyByName(e){if(!Lc(e))throw await vr(),new ue(`Invalid key name '${e}'`);const t=Bc(e);try{const n=await this.components.datastore.get(t);return JSON.parse(he(n))}catch(n){throw await vr(),this.log.error("could not read key from datastore - %e",n),new dn(`Key '${e}' does not exist.`)}}async findKeyById(e){try{const t={prefix:a4};for await(const n of this.components.datastore.query(t)){const s=JSON.parse(he(n.value));if(s.id===e)return s}throw new ue(`Key with id '${e}' does not exist.`)}catch(t){throw await vr(),t}}async importKey(e,t){if(!Lc(e))throw await vr(),new ue(`Invalid key name '${e}'`);if(t==null)throw await vr(),new ue("Key is required");const n=ga(e);if(await this.components.datastore.has(n))throw await vr(),new ue(`Key '${e}' already exists`);let i,o;try{i=await kre(t);const l=Gu.get(this);if(l==null)throw new ue("dek missing");const u=l.dek;o=await Mv(t,u,t.type==="RSA"?"pkcs-8":"libp2p-key")}catch(l){throw await vr(),l}const a={name:e,id:i},c=this.components.datastore.batch();return c.put(n,le(o)),c.put(Bc(e),le(JSON.stringify(a))),await c.commit(),a}async exportKey(e){if(!Lc(e))throw await vr(),new ue(`Invalid key name '${e}'`);const t=ga(e);try{const n=await this.components.datastore.get(t),s=he(n),i=Gu.get(this);if(i==null)throw new ue("dek missing");const o=i.dek;return await $v(s,o)}catch(n){throw await vr(),n}}async removeKey(e){if(!Lc(e)||e===this.self)throw await vr(),new ue(`Invalid key name '${e}'`);const t=ga(e),n=await this.findKeyByName(e),s=this.components.datastore.batch();return s.delete(t),s.delete(Bc(e)),await s.commit(),n}async listKeys(){const e={prefix:a4},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(he(n.value)));return t}async renameKey(e,t){if(!Lc(e)||e===this.self)throw await vr(),new ue(`Invalid old key name '${e}'`);if(!Lc(t)||t===this.self)throw await vr(),new ue(`Invalid new key name '${t}'`);const n=ga(e),s=ga(t),i=Bc(e),o=Bc(t);if(await this.components.datastore.has(s))throw await vr(),new ue(`Key '${t}' already exists`);try{const c=await this.components.datastore.get(n),l=await this.components.datastore.get(i),u=JSON.parse(he(l));u.name=t;const h=this.components.datastore.batch();return h.put(s,c),h.put(o,le(JSON.stringify(u))),h.delete(n),h.delete(i),await h.commit(),u}catch(c){throw await vr(),c}}async rotateKeychainPass(e,t){if(typeof e!="string")throw await vr(),new ue(`Invalid old pass type '${typeof e}'`);if(typeof t!="string")throw await vr(),new ue(`Invalid new pass type '${typeof t}'`);if(t.length<20)throw await vr(),new ue(`Invalid pass length ${t.length}`);this.log("recreating keychain");const n=Gu.get(this);if(n==null)throw new ue("dek missing");const s=n.dek;this.init.pass=t;const i=t!=null&&this.init.dek?.salt!=null?p9(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";Gu.set(this,{dek:i});const o=await this.listKeys();for(const a of o){const c=await this.components.datastore.get(ga(a.name)),l=he(c),u=await $v(l,s),h=i.toString(),d=await Mv(u,h,u.type==="RSA"?"pkcs-8":"libp2p-key"),f=this.components.datastore.batch(),g={name:a.name,id:a.id};f.put(ga(a.name),le(d)),f.put(Bc(a.name),le(JSON.stringify(g))),await f.commit()}this.log("keychain reconstructed")}}function CP(r={}){return e=>new Ire(e,r)}async function Tre(r,e={}){const t=e.selfKey??"self",n=CP(e)({datastore:r,logger:zg()});let s;return await r.has(new Pt(`/pkcs8/${t}`))?s=await n.exportKey(t):(s=await d5(e.keyType??"Ed25519"),await n.importKey(t,s)),s}var Rre={};const qd=65535,Fv=qd-16,Rf=!!Rre?.DUMP_SESSION_KEYS,Vv=16;/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Pre(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function c4(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Ay(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Jr(r,e,t=""){const n=Pre(r),s=r?.length,i=e!==void 0;if(!n||i&&s!==e){const o=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function zv(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Dre(r,e){Jr(r,void 0,"output");const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function $o(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Hl(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Nre(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}const Ore=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Lre(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function Bre(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const Mre=(r,e)=>{function t(n,...s){if(Jr(n,void 0,"key"),!Ore)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){const u=s[0];Jr(u,r.varSizeNonce?void 0:r.nonceLength,"nonce")}const i=r.tagLength;i&&s[1]!==void 0&&Jr(s[1],void 0,"AAD");const o=e(n,...s),a=(u,h)=>{if(h!==void 0){if(u!==2)throw new Error("cipher output not supported");Jr(h,void 0,"output")}};let c=!1;return{encrypt(u,h){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Jr(u),a(o.encrypt.length,h),o.encrypt(u,h)},decrypt(u,h){if(Jr(u),i&&u.length<i)throw new Error('"ciphertext" expected length bigger than tagLength='+i);return a(o.decrypt.length,h),o.decrypt(u,h)}}}return Object.assign(t,r),t};function Hv(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error('"output" expected Uint8Array of length '+r+", got: "+e.length);if(t&&!Ure(e))throw new Error("invalid output, must be aligned");return e}function $re(r,e,t){c4(t);const n=new Uint8Array(16),s=Nre(n);return s.setBigUint64(0,BigInt(e),t),s.setBigUint64(8,BigInt(r),t),n}function Ure(r){return r.byteOffset%4===0}function m0(r){return Uint8Array.from(r)}const kP=r=>Uint8Array.from(r.split(""),e=>e.charCodeAt(0)),Fre=kP("expand 16-byte k"),Vre=kP("expand 32-byte k"),zre=$o(Fre),Hre=$o(Vre);function pt(r,e){return r<<e|r>>>32-e}function l4(r){return r.byteOffset%4===0}const k1=64,qre=16,IP=2**32-1,qv=Uint32Array.of();function Kre(r,e,t,n,s,i,o,a){const c=s.length,l=new Uint8Array(k1),u=$o(l),h=l4(s)&&l4(i),d=h?$o(s):qv,f=h?$o(i):qv;for(let g=0;g<c;o++){if(r(e,t,n,u,o,a),o>=IP)throw new Error("arx: counter overflow");const m=Math.min(k1,c-g);if(h&&m===k1){const b=g/4;if(g%4!==0)throw new Error("arx: invalid block position");for(let v=0,A;v<qre;v++)A=b+v,f[A]=d[A]^u[v];g+=k1;continue}for(let b=0,v;b<m;b++)v=g+b,i[v]=s[v]^l[b];g+=m}}function jre(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=Lre({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Ay(s),Ay(o),c4(i),c4(t),(a,c,l,u,h=0)=>{Jr(a,void 0,"key"),Jr(c,void 0,"nonce"),Jr(l,void 0,"data");const d=l.length;if(u===void 0&&(u=new Uint8Array(d)),Jr(u,void 0,"output"),Ay(h),h<0||h>=IP)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);const f=[];let g=a.length,m,b;if(g===32)f.push(m=m0(a)),b=Hre;else if(g===16&&t)m=new Uint8Array(32),m.set(a),m.set(a,16),b=zre,f.push(m);else throw Jr(a,32,"arx key"),new Error("invalid key size");l4(c)||f.push(c=m0(c));const v=$o(m);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(b,v,$o(c.subarray(0,16)),v),c=c.subarray(16)}const A=16-s;if(A!==c.length)throw new Error(`arx: nonce must be ${A} or 16 bytes`);if(A!==12){const E=new Uint8Array(12);E.set(c,i?0:12-c.length),c=E,f.push(c)}const w=$o(c);return Kre(r,b,v,w,l,u,h,o),Hl(...f),u}}function Er(r,e){return r[e++]&255|(r[e++]&255)<<8}class Wre{blockLen=16;outputLen=16;buffer=new Uint8Array(16);r=new Uint16Array(10);h=new Uint16Array(10);pad=new Uint16Array(8);pos=0;finished=!1;constructor(e){e=m0(Jr(e,32,"key"));const t=Er(e,0),n=Er(e,2),s=Er(e,4),i=Er(e,6),o=Er(e,8),a=Er(e,10),c=Er(e,12),l=Er(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Er(e,16+2*u)}process(e,t,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],f=o[6],g=o[7],m=o[8],b=o[9],v=Er(e,t+0),A=Er(e,t+2),w=Er(e,t+4),E=Er(e,t+6),x=Er(e,t+8),P=Er(e,t+10),T=Er(e,t+12),D=Er(e,t+14);let C=i[0]+(v&8191),R=i[1]+((v>>>13|A<<3)&8191),O=i[2]+((A>>>10|w<<6)&8191),V=i[3]+((w>>>7|E<<9)&8191),B=i[4]+((E>>>4|x<<12)&8191),z=i[5]+(x>>>1&8191),$=i[6]+((x>>>14|P<<2)&8191),K=i[7]+((P>>>11|T<<5)&8191),X=i[8]+((T>>>8|D<<8)&8191),te=i[9]+(D>>>5|s),W=0,ie=W+C*a+R*(5*b)+O*(5*m)+V*(5*g)+B*(5*f);W=ie>>>13,ie&=8191,ie+=z*(5*d)+$*(5*h)+K*(5*u)+X*(5*l)+te*(5*c),W+=ie>>>13,ie&=8191;let ce=W+C*c+R*a+O*(5*b)+V*(5*m)+B*(5*g);W=ce>>>13,ce&=8191,ce+=z*(5*f)+$*(5*d)+K*(5*h)+X*(5*u)+te*(5*l),W+=ce>>>13,ce&=8191;let de=W+C*l+R*c+O*a+V*(5*b)+B*(5*m);W=de>>>13,de&=8191,de+=z*(5*g)+$*(5*f)+K*(5*d)+X*(5*h)+te*(5*u),W+=de>>>13,de&=8191;let oe=W+C*u+R*l+O*c+V*a+B*(5*b);W=oe>>>13,oe&=8191,oe+=z*(5*m)+$*(5*g)+K*(5*f)+X*(5*d)+te*(5*h),W+=oe>>>13,oe&=8191;let Se=W+C*h+R*u+O*l+V*c+B*a;W=Se>>>13,Se&=8191,Se+=z*(5*b)+$*(5*m)+K*(5*g)+X*(5*f)+te*(5*d),W+=Se>>>13,Se&=8191;let Le=W+C*d+R*h+O*u+V*l+B*c;W=Le>>>13,Le&=8191,Le+=z*a+$*(5*b)+K*(5*m)+X*(5*g)+te*(5*f),W+=Le>>>13,Le&=8191;let xe=W+C*f+R*d+O*h+V*u+B*l;W=xe>>>13,xe&=8191,xe+=z*c+$*a+K*(5*b)+X*(5*m)+te*(5*g),W+=xe>>>13,xe&=8191;let ee=W+C*g+R*f+O*d+V*h+B*u;W=ee>>>13,ee&=8191,ee+=z*l+$*c+K*a+X*(5*b)+te*(5*m),W+=ee>>>13,ee&=8191;let pe=W+C*m+R*g+O*f+V*d+B*h;W=pe>>>13,pe&=8191,pe+=z*u+$*l+K*c+X*a+te*(5*b),W+=pe>>>13,pe&=8191;let se=W+C*b+R*m+O*g+V*f+B*d;W=se>>>13,se&=8191,se+=z*h+$*u+K*l+X*c+te*a,W+=se>>>13,se&=8191,W=(W<<2)+W|0,W=W+ie|0,ie=W&8191,W=W>>>13,ce+=W,i[0]=ie,i[1]=ce,i[2]=de,i[3]=oe,i[4]=Se,i[5]=Le,i[6]=xe,i[7]=ee,i[8]=pe,i[9]=se}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Hl(n)}update(e){zv(this),Jr(e),e=m0(e);const{buffer:t,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Hl(this.h,this.r,this.buffer,this.pad)}digestInto(e){zv(this),Dre(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function Gre(r){const e=(n,s)=>r(s).update(n).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const Yre=Gre(r=>new Wre(r));function Qre(r,e,t,n,s,i=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],h=e[1],d=e[2],f=e[3],g=e[4],m=e[5],b=e[6],v=e[7],A=s,w=t[0],E=t[1],x=t[2],P=o,T=a,D=c,C=l,R=u,O=h,V=d,B=f,z=g,$=m,K=b,X=v,te=A,W=w,ie=E,ce=x;for(let oe=0;oe<i;oe+=2)P=P+R|0,te=pt(te^P,16),z=z+te|0,R=pt(R^z,12),P=P+R|0,te=pt(te^P,8),z=z+te|0,R=pt(R^z,7),T=T+O|0,W=pt(W^T,16),$=$+W|0,O=pt(O^$,12),T=T+O|0,W=pt(W^T,8),$=$+W|0,O=pt(O^$,7),D=D+V|0,ie=pt(ie^D,16),K=K+ie|0,V=pt(V^K,12),D=D+V|0,ie=pt(ie^D,8),K=K+ie|0,V=pt(V^K,7),C=C+B|0,ce=pt(ce^C,16),X=X+ce|0,B=pt(B^X,12),C=C+B|0,ce=pt(ce^C,8),X=X+ce|0,B=pt(B^X,7),P=P+O|0,ce=pt(ce^P,16),K=K+ce|0,O=pt(O^K,12),P=P+O|0,ce=pt(ce^P,8),K=K+ce|0,O=pt(O^K,7),T=T+V|0,te=pt(te^T,16),X=X+te|0,V=pt(V^X,12),T=T+V|0,te=pt(te^T,8),X=X+te|0,V=pt(V^X,7),D=D+B|0,W=pt(W^D,16),z=z+W|0,B=pt(B^z,12),D=D+B|0,W=pt(W^D,8),z=z+W|0,B=pt(B^z,7),C=C+R|0,ie=pt(ie^C,16),$=$+ie|0,R=pt(R^$,12),C=C+R|0,ie=pt(ie^C,8),$=$+ie|0,R=pt(R^$,7);let de=0;n[de++]=o+P|0,n[de++]=a+T|0,n[de++]=c+D|0,n[de++]=l+C|0,n[de++]=u+R|0,n[de++]=h+O|0,n[de++]=d+V|0,n[de++]=f+B|0,n[de++]=g+z|0,n[de++]=m+$|0,n[de++]=b+K|0,n[de++]=v+X|0,n[de++]=A+te|0,n[de++]=w+W|0,n[de++]=E+ie|0,n[de++]=x+ce|0}const Xre=jre(Qre,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Jre=new Uint8Array(16),Kv=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(Jre.subarray(t))},Zre=new Uint8Array(32);function jv(r,e,t,n,s){s!==void 0&&Jr(s,void 0,"AAD");const i=r(e,t,Zre),o=$re(n.length,s?s.length:0,!0),a=Yre.create(i);s&&Kv(a,s),Kv(a,n),a.update(o);const c=a.digest();return Hl(i,o),c}const ene=r=>(e,t,n)=>({encrypt(i,o){const a=i.length;o=Hv(a+16,o,!1),o.set(i);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=jv(r,e,t,c,n);return o.set(l,a),Hl(l),o},decrypt(i,o){o=Hv(i.length-16,o,!1);const a=i.subarray(0,-16),c=i.subarray(-16),l=jv(r,e,t,a,n);if(!Bre(c,l))throw new Error("invalid tag");return o.set(i.subarray(0,-16)),r(e,t,o,o,1),Hl(l),o}}),Wv=Mre({blockSize:64,nonceLength:12,tagLength:16},ene(Xre));function tne(r,e,t){return yf(r),t===void 0&&(t=new Uint8Array(r.outputLen)),vf(r,t,e)}const Cy=Uint8Array.of(0),Gv=Uint8Array.of();function rne(r,e,t,n=32){yf(r),bs(n,"length");const s=r.outputLen;if(n>255*s)throw new Error("Length must be <= 255*HashLen");const i=Math.ceil(n/s);t===void 0?t=Gv:st(t,void 0,"info");const o=new Uint8Array(i*s),a=vf.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)Cy[0]=u+1,c.update(u===0?Gv:l).update(t).update(Cy).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),ai(l,Cy),o.slice(0,n)}const nne={hashSHA256(r){return Lo(r.subarray())},getHKDF(r,e){const t=tne(Lo,e,r),s=rne(Lo,t,void 0,96),i=s.subarray(0,32),o=s.subarray(32,64),a=s.subarray(64,96);return[i,o,a]},generateX25519KeyPair(){const r=o1.utils.randomSecretKey();return{publicKey:o1.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:o1.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return o1.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return Wv(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,s){return Wv(n,e,t).decrypt(r.subarray(),s)}},sne=nne;function ine(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const y0=r=>{const e=Dn(2);return e[0]=r>>8,e[1]=r,e};y0.bytes=2;const w0=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};w0.bytes=2;function one(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function TP(r,e){!e.enabled||!Rf||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${he(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${he(r.privateKey,"hex")}`)):e("Missing local static keys."))}function RP(r,e){!e.enabled||!Rf||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${he(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${he(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function ane(r,e){!e.enabled||!Rf||e(r?`REMOTE_STATIC_PUBLIC_KEY ${he(r.subarray(),"hex")}`:"Missing remote static public key.")}function PP(r,e){!e.enabled||!Rf||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${he(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function DP(r,e,t){!t.enabled||!Rf||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&he(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&he(e.k,"hex")}`))}function ql(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=Dn(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}class Gh extends Error{code;constructor(e="Invalid crypto exchange"){super(e),this.code=Gh.code}static code="ERR_INVALID_CRYPTO_EXCHANGE"}const cne=0,lne=4294967295,une="Cipherstate has reached maximum n, a new handshake must be performed";class hne{n;bytes;view;constructor(e=cne){this.n=e,this.bytes=ot(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>lne)throw new Error(une)}}const yl=ot(0);class I1{k;n;crypto;constructor(e,t=void 0,n=0){this.crypto=e,this.k=t,this.n=new hne(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const s=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),s}}class dne{cs;ck;h;crypto;constructor(e,t){this.crypto=e;const n=le(t,"utf-8");this.h=pne(e,n),this.ck=this.h,this.cs=new I1(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new I1(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new ze(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,yl);return[new I1(this.crypto,e),new I1(this.crypto,t)]}}class fne{ss;s;e;rs;re;initiator;crypto;constructor(e){const{crypto:t,protocolName:n,prologue:s,initiator:i,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new dne(t,n),this.ss.mixHash(s),this.initiator=i,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const s=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(s),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class NP extends fne{writeMessageA(e){return new ze(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new ze(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new ze(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new Gh(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new Gh(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new Gh(`handshake stage 2 validation fail: ${t.message}`)}}}function pne(r,e){if(e.length<=32){const t=ot(32);return t.set(e),t}else return r.hash(e)}var b0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const i of t.webtransportCerthashes)n.uint32(10),n.bytes(i);if(t.streamMuxers!=null)for(const i of t.streamMuxers)n.uint32(18),n.string(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{if(s.limits?.webtransportCerthashes!=null&&i.webtransportCerthashes.length===s.limits.webtransportCerthashes)throw new Ir('Decode error - map field "webtransportCerthashes" had too many elements');i.webtransportCerthashes.push(t.bytes());break}case 2:{if(s.limits?.streamMuxers!=null&&i.streamMuxers.length===s.limits.streamMuxers)throw new Ir('Decode error - map field "streamMuxers" had too many elements');i.streamMuxers.push(t.string());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(b0||(b0={}));var v0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),b0.codec().encode(t.extensions,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={identityKey:ot(0),identitySig:ot(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.identityKey=t.bytes();break}case 2:{i.identitySig=t.bytes();break}case 4:{i.extensions=b0.codec().decode(t,t.uint32(),{limits:s.limits?.extensions});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(v0||(v0={}));async function OP(r,e,t){const n=await r.sign(BP(e));return v0.encode({identityKey:Qs(r.publicKey),identitySig:n,extensions:t})}async function LP(r,e,t){try{const n=v0.decode(r),s=Cs(n.identityKey);if(t?.equals(s)===!1)throw new Error(`Payload identity key ${s} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const i=BP(e);if(!await s.verify(i,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new fF(n.message)}}function BP(r){const e=le("noise-libp2p-static-key:");return r instanceof Uint8Array?Wt([e,r],e.length+r.length):(r.prepend(e),r)}class gne extends y5{stream;handshake;metrics;decoder;constructor(e,t,n){super({log:e.log,inactivityTimeout:e.inactivityTimeout,maxReadBufferLength:e.maxReadBufferLength,direction:e.direction}),this.stream=e,this.handshake=t,this.metrics=n,this.decoder=new pW({lengthDecoder:w0,maxBufferSize:16*1024*1024,encodingLength:()=>2});const s=c=>{try{for(const l of this.decoder.decode(c.data))this.onData(this.decrypt(l))}catch(l){this.abort(l)}};this.stream.addEventListener("message",s);const i=c=>{c.error!=null?c.local===!0?this.abort(c.error):this.onRemoteReset():this.onTransportClosed()};this.stream.addEventListener("close",i);const o=()=>{this.safeDispatchEvent("drain")};this.stream.addEventListener("drain",o);const a=()=>{this.onRemoteCloseWrite()};this.stream.addEventListener("remoteCloseWrite",a)}encrypt(e){const t=new ze;for(let n=0;n<e.byteLength;n+=Fv){let s=n+Fv;s>e.byteLength&&(s=e.byteLength);let i;e instanceof Uint8Array?i=this.handshake.encrypt(e.subarray(n,s)):i=this.handshake.encrypt(e.sublist(n,s)),this.metrics?.encryptedPackets.increment(),t.append(y0(i.byteLength)),t.append(i)}return t}decrypt(e){const t=new ze;for(let n=0;n<e.byteLength;n+=qd){let s=n+qd;if(s>e.byteLength&&(s=e.byteLength),s-Vv<n)throw new Error("Invalid chunk");let i;e instanceof Uint8Array?i=e.subarray(n,s):i=e.sublist(n,s);const o=e.subarray(n,s-Vv);try{const a=this.handshake.decrypt(i,o);this.metrics?.decryptedPackets.increment(),t.append(a)}catch(a){throw this.metrics?.decryptErrors.increment(),a}}return t}close(e){return this.stream.close(e)}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}sendReset(e){this.stream.abort(e)}sendData(e){return{sentBytes:e.byteLength,canSendMore:this.stream.send(this.encrypt(e))}}}function Yv(r,e,t){return new gne(r,e,t)}async function mne(r,e){const{log:t,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await OP(i,a.publicKey,l),h=new NP({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});TP(h.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(h.writeMessageA(yl),e),t.trace("Stage 0 - Initiator finished sending first message."),RP(h.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const d=h.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),PP(h.re,t),ane(h.rs,t),t.trace("Initiator going to check remote's signature...");const f=await LP(d,h.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(h.writeMessageC(u),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[g,m]=h.ss.split();return DP(g,m,t),{payload:f,encrypt:b=>g.encryptWithAd(yl,b),decrypt:(b,v)=>m.decryptWithAd(yl,b,v)}}async function yne(r,e){const{log:t,connection:n,crypto:s,privateKey:i,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await OP(i,a.publicKey,l),h=new NP({crypto:s,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});TP(h.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),h.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),PP(h.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(h.writeMessageB(u),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),RP(h.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const d=h.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const f=await LP(d,h.rs,c),[g,m]=h.ss.split();return DP(g,m,t),{payload:f,encrypt:b=>m.encryptWithAd(yl,b),decrypt:(b,v)=>g.decryptWithAd(yl,b,v)}}class wne{protocol="/noise";crypto;prologue;staticKey;extensions;metrics;components;log;constructor(e,t={}){const{staticNoiseKey:n,extensions:s,crypto:i,prologueBytes:o}=t,{metrics:a}=e;this.components=e,this.log=e.logger.forComponent("libp2p:noise");const c=i??sne;this.crypto=ine(c),this.extensions={webtransportCerthashes:[],...s},this.metrics=a?one(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??ot(0)}[Symbol.toStringTag]="@chainsafe/libp2p-noise";[yr]=["@libp2p/connection-encryption","@chainsafe/libp2p-noise"];async secureOutbound(e,t){const n=e.log?.newScope("noise")??this.log,s=Nd(e,{lengthEncoder:y0,lengthDecoder:w0,maxDataLength:qd}),i=await this.performHandshakeInitiator(s,this.components.privateKey,n,t?.remotePeer?.publicKey,t),o=Cs(i.payload.identityKey);return{connection:Yv(s.unwrap(),i,this.metrics),remoteExtensions:i.payload.extensions,remotePeer:Fl(o),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(i.payload.extensions?.streamMuxers)}}getStreamMuxer(e){if(e==null||e.length===0)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const s=t.get(n);if(s!=null)return s}if(e.length)throw new pF("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){const n=e.log?.newScope("noise")??this.log,s=Nd(e,{lengthEncoder:y0,lengthDecoder:w0,maxDataLength:qd}),i=await this.performHandshakeResponder(s,this.components.privateKey,n,t?.remotePeer?.publicKey,t),o=Cs(i.payload.identityKey);return{connection:Yv(s.unwrap(),i,this.metrics),remoteExtensions:i.payload.extensions,remotePeer:Fl(o),streamMuxer:t?.skipStreamMuxerNegotiation===!0?void 0:this.getStreamMuxer(i.payload.extensions?.streamMuxers)}}async performHandshakeInitiator(e,t,n,s,i){let o;const a=i?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{o=await mne({connection:e,privateKey:t,remoteIdentityKey:s,log:n.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:a,webtransportCerthashes:[],...this.extensions}},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return o}async performHandshakeResponder(e,t,n,s,i){let o;const a=i?.skipStreamMuxerNegotiation===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{o=await yne({connection:e,privateKey:t,remoteIdentityKey:s,log:n.newScope("xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:a,webtransportCerthashes:[],...this.extensions}},i),this.metrics?.xxHandshakeSuccesses.increment()}catch(c){throw this.metrics?.xxHandshakeErrors.increment(),c}return o}}function MP(r={}){return e=>new wne(e,r)}var rr;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(rr||(rr={}));var vt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(vt||(vt={}));Object.values(vt).filter(r=>typeof r!="string");const bne=0;var _n;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(_n||(_n={}));const ka=12;let I2=class extends Error{static name="ProtocolError";reason;constructor(e,t){super(e),this.name="ProtocolError",this.reason=t}};function vne(r){return r?.reason!==null}class Qc extends I2{static name="InvalidFrameError";constructor(e="The frame was invalid"){super(e,_n.ProtocolError),this.name="InvalidFrameError"}}class Ene extends I2{static name="UnRequestedPingError";constructor(e="Un-requested ping error"){super(e,_n.ProtocolError),this.name="UnRequestedPingError"}}class Sne extends I2{static name="NotMatchingPingError";constructor(e="Not matching ping error"){super(e,_n.ProtocolError),this.name="NotMatchingPingError"}}class _ne extends I2{static name="ReceiveWindowExceededError";constructor(e="Receive window exceeded"){super(e,_n.ProtocolError),this.name="ReceiveWindowExceededError"}}const $P=256*1024,xne=16*1024*1024,T1={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3};function Ane(r){if(r.keepAliveInterval!=null&&r.keepAliveInterval<=0)throw new ue("keep-alive interval must be positive");if(r.maxInboundStreams!=null&&r.maxInboundStreams<0)throw new ue("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams!=null&&r.maxOutboundStreams<0)throw new ue("max outbound streams must be larger or equal 0");if(r.maxMessageSize!=null&&r.maxMessageSize<1024)throw new ue("MaxMessageSize must be greater than a kilobyte");if(r.streamOptions?.initialStreamWindowSize!=null&&r.streamOptions?.initialStreamWindowSize<$P)throw new ue("InitialStreamWindowSize must be larger or equal 256 kB");if(r.streamOptions?.maxStreamWindowSize!=null&&r.streamOptions?.initialStreamWindowSize!=null&&r.streamOptions?.maxStreamWindowSize<r.streamOptions?.initialStreamWindowSize)throw new ue("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.streamOptions?.maxStreamWindowSize!=null&&r.streamOptions?.maxStreamWindowSize>2**32-1)throw new ue("MaxStreamWindowSize must be less than equal MAX_UINT32")}function Cne(r){return r.header.type===rr.Data&&r.data!==null}const Qv=2**24;function kne(r){if(r[0]!==bne)throw new Qc("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*Qv+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*Qv+(r[9]<<16)+(r[10]<<8)+r[11]}}let Ine=class{buffer;constructor(){this.buffer=new ze}*emitFrames(e){for(this.buffer.append(e);;){const t=this.readFrame();if(t===void 0)break;yield t}}readFrame(){let e=ka;if(this.buffer.byteLength<ka)return;const t=kne(this.buffer.subarray(0,ka));if(t.type===rr.Data){if(e+=t.length,this.buffer.byteLength<e)return;const n=this.buffer.sublist(ka,e);return this.buffer.consume(e),{header:t,data:n}}return this.buffer.consume(e),{header:t}}};function Xv(r){const e=new Uint8Array(ka);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}var un;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished",r[r.Paused=5]="Paused"})(un||(un={}));class Tne extends v5{streamId;state;sendWindowCapacity;recvWindow;recvWindowCapacity;maxStreamWindowSize;epochStart;getRTT;sendFrame;constructor(e){const t=e.initialStreamWindowSize??$P;super({...e,maxMessageSize:t-ka}),this.streamId=e.streamId,this.state=e.state,this.sendWindowCapacity=t,this.recvWindow=t,this.recvWindowCapacity=this.recvWindow,this.maxStreamWindowSize=e.maxStreamWindowSize??xne,this.epochStart=Date.now(),this.getRTT=e.getRTT,this.sendFrame=e.sendFrame;const n=()=>{this.state=un.Finished};this.addEventListener("close",n)}sendData(e){const t=e.byteLength;let n=0,s=!0;for(this.log?.trace("send window capacity is %d bytes",this.sendWindowCapacity);e.byteLength>0;){if(this.sendWindowCapacity===0){s=!1,this.log?.trace("sent %d/%d bytes, exhausted send window, waiting for window update",n,t);break}const i=Math.min(this.sendWindowCapacity,e.byteLength),o=this.getSendFlags(),a=e.sublist(0,i);e.consume(i);const c=this.sendFrame({type:rr.Data,flag:o,streamID:this.streamId,length:i},a);if(this.sendWindowCapacity-=i,n+=i,!c){s=c,this.log.trace("sent %d/%d bytes, wait for muxer to have more send capacity",n,t);break}}return{sentBytes:n,canSendMore:s}}async sendReset(){this.sendFrame({type:rr.WindowUpdate,flag:vt.RST,streamID:this.streamId,length:0})}async sendCloseWrite(){const e=this.getSendFlags()|vt.FIN;this.sendFrame({type:rr.WindowUpdate,flag:e,streamID:this.streamId,length:0})}async sendCloseRead(e){e?.signal?.throwIfAborted()}sendPause(){this.state=un.Paused}sendResume(){this.state=un.Established,this.sendWindowUpdate()}handleWindowUpdate(e){this.processFlags(e.header.flag),this.sendWindowCapacity+=e.header.length,this.maxMessageSize=this.sendWindowCapacity-ka,this.maxMessageSize<0&&(this.maxMessageSize=0),this.maxMessageSize!==0&&this.writeBuffer.byteLength>0&&(this.log?.trace("window update of %d bytes allows more data to be sent, have %d bytes queued, sending data %s",e.header.length,this.writeBuffer.byteLength,this.sendingData),this.safeDispatchEvent("drain"))}handleData(e){if(!Cne(e))throw new Qc("Frame was not data frame");if(this.processFlags(e.header.flag),this.recvWindowCapacity<e.header.length)throw new _ne("Receive window exceeded");this.recvWindowCapacity-=e.header.length,this.onData(e.data),this.sendWindowUpdate()}processFlags(e){(e&vt.ACK)===vt.ACK&&this.state===un.SYNSent&&(this.state=un.Established),(e&vt.FIN)===vt.FIN&&this.onRemoteCloseWrite(),(e&vt.RST)===vt.RST&&this.onRemoteReset()}getSendFlags(){switch(this.state){case un.Init:return this.state=un.SYNSent,vt.SYN;case un.SYNReceived:return this.state=un.Established,vt.ACK;default:return 0}}sendWindowUpdate(){if(this.state===un.Paused){this.epochStart=Date.now();return}const e=this.getSendFlags(),t=Date.now(),n=this.getRTT();if(e===0&&n>-1&&t-this.epochStart<=n*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&e===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=t,this.sendFrame({type:rr.WindowUpdate,flag:e,streamID:this.streamId,length:s})}}function Jv(r){return{type:rr[r.type],flags:[(r.flag&vt.SYN)===vt.SYN?"SYN":void 0,(r.flag&vt.ACK)===vt.ACK?"ACK":void 0,(r.flag&vt.FIN)===vt.FIN?"FIN":void 0,(r.flag&vt.RST)===vt.RST?"RST":void 0].filter(Boolean),streamID:r.streamID,length:r.length}}const UP="/yamux/1.0.0";class Rne{protocol=UP;_init;constructor(e={}){this._init=e}[Symbol.toStringTag]="@chainsafe/libp2p-yamux";[yr]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new Pne(e,{...this._init})}}class Pne extends b5{nextStreamID;nextPingID;activePing;rtt;client;localGoAway;remoteGoAway;numInboundStreams;numOutboundStreams;decoder;keepAlive;enableKeepAlive;keepAliveInterval;maxInboundStreams;maxOutboundStreams;constructor(e,t={}){super(e,{...t,protocol:UP,name:"yamux"}),this.client=e.direction==="outbound",Ane(t),this.enableKeepAlive=t.enableKeepAlive??T1.enableKeepAlive,this.keepAliveInterval=t.keepAliveInterval??T1.keepAliveInterval,this.maxInboundStreams=t.maxInboundStreams??T1.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??T1.maxOutboundStreams,this.decoder=new Ine,this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,this.log.trace("muxer created"),this.enableKeepAlive&&(this.log.trace("muxer keepalive enabled interval=%s",this.keepAliveInterval),this.keepAlive=V5(async n=>{try{await this.ping(n)}catch(s){this.log.error("ping error: %s",s)}},this.keepAliveInterval,{runImmediately:!0}),this.keepAlive.start())}onData(e){for(const t of this.decoder.emitFrames(e))this.handleFrame(t)}onCreateStream(){if(this.remoteGoAway!==void 0)throw new Wc("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Wc("Muxer closed locally");const e=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.maxOutboundStreams)throw new BC("max outbound streams exceeded");this.log.trace("new outgoing stream id=%s",e);const t=this._newStream(e,un.Init,"outbound");return this.numOutboundStreams++,queueMicrotask(()=>{t.sendWindowUpdate()}),t}async ping(e){if(this.remoteGoAway!==void 0)throw new Wc("Muxer closed remotely");if(this.localGoAway!==void 0)throw new Wc("Muxer closed locally");if(this.activePing!=null)return es(this.activePing.promise,e?.signal);this.activePing=Object.assign(Promise.withResolvers(),{id:this.nextPingID++,start:Date.now()}),this.sendPing(this.activePing.id);try{this.rtt=await es(this.activePing.promise,e?.signal)}finally{this.activePing=void 0}return this.rtt}getRTT(){return this.rtt}async close(e={}){if(this.status==="open")try{const t=e?.reason??_n.NormalTermination;this.log.trace("muxer close reason=%s",_n[t]),await super.close(e),this.sendGoAway(t)}finally{this.keepAlive?.stop()}}abort(e){if(this.status==="open")try{super.abort(e);let t=_n.InternalError;vne(e)&&(t=e.reason),this.log.error("muxer abort reason=%s error=%s",t,e),this.sendGoAway(t)}finally{this.keepAlive?.stop()}}onTransportClosed(){try{super.onTransportClosed()}finally{this.keepAlive?.stop()}}_newStream(e,t,n){if(this.streams.find(i=>i.streamId===e)!=null)throw new ue("Stream already exists with that id");const s=new Tne({...this.streamOptions,id:`${e}`,streamId:e,state:t,direction:n,sendFrame:this.sendFrame.bind(this),log:this.log.newScope(`${n}:${e}`),getRTT:this.getRTT.bind(this)});return s.addEventListener("close",()=>{this.closeStream(e)},{once:!0}),s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--}handleFrame(e){const{streamID:t,type:n,length:s}=e.header;if(this.log.trace("received frame %o",Jv(e.header)),t===0)switch(n){case rr.Ping:{this.handlePing(e.header);return}case rr.GoAway:{this.handleGoAway(s);return}default:throw new Qc("Invalid frame type")}else switch(e.header.type){case rr.Data:case rr.WindowUpdate:{this.handleStreamMessage(e);return}default:throw new Qc("Invalid frame type")}}handlePing(e){if(e.flag===vt.SYN)this.log.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,vt.ACK);else if(e.flag===vt.ACK)this.log.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new Qc("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new Ene("ping not requested");if(this.activePing.id!==e)throw new Sne("ping doesn't match our id");this.activePing.resolve(Date.now()-this.activePing.start)}handleGoAway(e){this.log.trace("received GoAway reason=%s",_n[e]??"unknown"),this.remoteGoAway=e,e===_n.NormalTermination?this.onTransportClosed():this.abort(new Error("Remote sent GoAway"))}handleStreamMessage(e){const{streamID:t,flag:n,type:s}=e.header;(n&vt.SYN)===vt.SYN&&this.incomingStream(t);const i=this.streams.find(o=>o.streamId===t);if(i===void 0){this.log.trace("frame for missing stream id=%s",t);return}switch(s){case rr.WindowUpdate:{i.handleWindowUpdate(e);return}case rr.Data:{i.handleData(e);return}default:throw new Error("unreachable")}}incomingStream(e){if(this.client!==(e%2===0))throw new ue("Both endpoints are clients");if(this.streams.find(n=>n.streamId===e))return;if(this.log.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:rr.WindowUpdate,flag:vt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.maxInboundStreams){this.log("maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:rr.WindowUpdate,flag:vt.RST,streamID:e,length:0});return}const t=this._newStream(e,un.SYNReceived,"inbound");this.numInboundStreams++,this.onRemoteStream(t)}sendFrame(e,t){let n;if(e.type===rr.Data){if(t==null)throw new Qc("Invalid frame");n=new ze(Xv(e),t)}else n=Xv(e);return this.log.trace("sending frame %o",Jv(e)),this.send(n)}sendPing(e,t=vt.SYN){t===vt.SYN?this.log.trace("sending ping request pingId=%s",e):this.log.trace("sending ping response pingId=%s",e),this.sendFrame({type:rr.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=_n.NormalTermination){this.log("sending GoAway reason=%s",_n[e]),this.localGoAway=e,this.sendFrame({type:rr.GoAway,flag:0,streamID:0,length:e})}}function Dne(r={}){return()=>new Rne(r)}const Nne="libp2p",One="autonat",Lne="1.0.0",Bne=3e4,Mne=2,$ne=20,Une=80,Fne=8192;var Ft;(function(r){(function(s){s.DIAL="DIAL",s.DIAL_RESPONSE="DIAL_RESPONSE"})(r.MessageType||(r.MessageType={}));let e;(function(s){s[s.DIAL=0]="DIAL",s[s.DIAL_RESPONSE=1]="DIAL_RESPONSE"})(e||(e={})),(function(s){s.codec=()=>nn(e)})(r.MessageType||(r.MessageType={})),(function(s){s.OK="OK",s.E_DIAL_ERROR="E_DIAL_ERROR",s.E_DIAL_REFUSED="E_DIAL_REFUSED",s.E_BAD_REQUEST="E_BAD_REQUEST",s.E_INTERNAL_ERROR="E_INTERNAL_ERROR"})(r.ResponseStatus||(r.ResponseStatus={}));let t;(function(s){s[s.OK=0]="OK",s[s.E_DIAL_ERROR=100]="E_DIAL_ERROR",s[s.E_DIAL_REFUSED=101]="E_DIAL_REFUSED",s[s.E_BAD_REQUEST=200]="E_BAD_REQUEST",s[s.E_INTERNAL_ERROR=300]="E_INTERNAL_ERROR"})(t||(t={})),(function(s){s.codec=()=>nn(t)})(r.ResponseStatus||(r.ResponseStatus={})),(function(s){let i;s.codec=()=>(i==null&&(i=tt((o,a,c={})=>{if(c.lengthDelimited!==!1&&a.fork(),o.id!=null&&(a.uint32(10),a.bytes(o.id)),o.addrs!=null)for(const l of o.addrs)a.uint32(18),a.bytes(l);c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={addrs:[]},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const h=o.uint32();switch(h>>>3){case 1:{l.id=o.bytes();break}case 2:{if(c.limits?.addrs!=null&&l.addrs.length===c.limits.addrs)throw new Ir('Decode error - map field "addrs" had too many elements');l.addrs.push(o.bytes());break}default:{o.skipType(h&7);break}}}return l})),i),s.encode=o=>et(o,s.codec()),s.decode=(o,a)=>Ze(o,s.codec(),a)})(r.PeerInfo||(r.PeerInfo={})),(function(s){let i;s.codec=()=>(i==null&&(i=tt((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.peer!=null&&(a.uint32(10),r.PeerInfo.codec().encode(o.peer,a)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const h=o.uint32();switch(h>>>3){case 1:{l.peer=r.PeerInfo.codec().decode(o,o.uint32(),{limits:c.limits?.peer});break}default:{o.skipType(h&7);break}}}return l})),i),s.encode=o=>et(o,s.codec()),s.decode=(o,a)=>Ze(o,s.codec(),a)})(r.Dial||(r.Dial={})),(function(s){let i;s.codec=()=>(i==null&&(i=tt((o,a,c={})=>{c.lengthDelimited!==!1&&a.fork(),o.status!=null&&(a.uint32(8),r.ResponseStatus.codec().encode(o.status,a)),o.statusText!=null&&(a.uint32(18),a.string(o.statusText)),o.addr!=null&&(a.uint32(26),a.bytes(o.addr)),c.lengthDelimited!==!1&&a.ldelim()},(o,a,c={})=>{const l={},u=a==null?o.len:o.pos+a;for(;o.pos<u;){const h=o.uint32();switch(h>>>3){case 1:{l.status=r.ResponseStatus.codec().decode(o);break}case 2:{l.statusText=o.string();break}case 3:{l.addr=o.bytes();break}default:{o.skipType(h&7);break}}}return l})),i),s.encode=o=>et(o,s.codec()),s.decode=(o,a)=>Ze(o,s.codec(),a)})(r.DialResponse||(r.DialResponse={}));let n;r.codec=()=>(n==null&&(n=tt((s,i,o={})=>{o.lengthDelimited!==!1&&i.fork(),s.type!=null&&(i.uint32(8),r.MessageType.codec().encode(s.type,i)),s.dial!=null&&(i.uint32(18),r.Dial.codec().encode(s.dial,i)),s.dialResponse!=null&&(i.uint32(26),r.DialResponse.codec().encode(s.dialResponse,i)),o.lengthDelimited!==!1&&i.ldelim()},(s,i,o={})=>{const a={},c=i==null?s.len:s.pos+i;for(;s.pos<c;){const l=s.uint32();switch(l>>>3){case 1:{a.type=r.MessageType.codec().decode(s);break}case 2:{a.dial=r.Dial.codec().decode(s,s.uint32(),{limits:o.limits?.dial});break}case 3:{a.dialResponse=r.DialResponse.codec().decode(s,s.uint32(),{limits:o.limits?.dialResponse});break}default:{s.skipType(l&7);break}}}return a})),n),r.encode=s=>et(s,r.codec()),r.decode=(s,i)=>Ze(s,r.codec(),i)})(Ft||(Ft={}));const Vne=4,zne=8;class Hne{components;protocol;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;started;log;topologyId;dialResults;findPeers;addressFilter;connectionThreshold;constructor(e,t){this.components=e,this.log=e.logger.forComponent("libp2p:auto-nat"),this.started=!1,this.protocol=`/${t.protocolPrefix??Nne}/${One}/${Lne}`,this.timeout=t.timeout??Bne,this.maxInboundStreams=t.maxInboundStreams??Mne,this.maxOutboundStreams=t.maxOutboundStreams??$ne,this.connectionThreshold=t.connectionThreshold??Une,this.maxMessageSize=t.maxMessageSize??Fne,this.dialResults=ks({name:"libp2p_autonat_dial_results",metrics:e.metrics}),this.findPeers=V5(this.findRandomPeers.bind(this),6e4),this.addressFilter=Yo(1024)}[Symbol.toStringTag]="@libp2p/autonat";[yr]=["@libp2p/autonat"];get[ja](){return["@libp2p/identify"]}isStarted(){return this.started}async start(){this.started||(await this.components.registrar.handle(this.protocol,(e,t)=>{this.handleIncomingAutonatStream(e,t).catch(n=>{this.log.error("error handling incoming autonat stream - %e",n)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}),this.topologyId=await this.components.registrar.register(this.protocol,{onConnect:(e,t)=>{this.verifyExternalAddresses(t).catch(n=>{this.log.error("could not verify addresses - %e",n)})}}),this.findPeers.start(),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.topologyId!=null&&await this.components.registrar.unhandle(this.topologyId),this.dialResults.clear(),this.findPeers.stop(),this.started=!1}allAddressesAreVerified(){return this.components.addressManager.getAddressesWithMetadata().every(e=>e.expires>Date.now()?!0:e.verified)}async findRandomPeers(e){if(this.allAddressesAreVerified())return;const t=xt([AbortSignal.timeout(1e4),e?.signal]);try{this.log("starting random walk to find peers to run AutoNAT");for await(const n of this.components.randomWalk.walk({signal:t})){if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable %s",n.id,n.multiaddrs.map(s=>s.toString()).join(", "));continue}try{this.log.trace("dial random peer %p",n.id),await this.components.connectionManager.openConnection(n.multiaddrs,{signal:t})}catch{}if(this.allAddressesAreVerified()){this.log("stopping random walk, all addresses are verified");return}if(!this.hasConnectionCapacity()){this.log("stopping random walk, too close to max connections");return}}}catch{}}async handleIncomingAutonatStream(e,t){const n=AbortSignal.timeout(this.timeout);try{const s=Wr(e,{maxDataLength:this.maxMessageSize}).pb(Ft),i=await s.read({signal:n}),o=await this.handleAutonatMessage(i,t,{signal:n});await s.write(o,{signal:n}),await e.close({signal:n})}catch(s){this.log.error("error handling incoming autonat stream - %e",s),e.abort(s)}}async handleAutonatMessage(e,t,n){const s=this.components.addressManager.getAddresses().map(h=>ct(h).host),i=e.dial;if(i==null)return this.log.error("dial was missing from message"),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_BAD_REQUEST,statusText:"No Dial message found in message"}};let o;const a=i.peer;if(a?.id==null)return this.log.error("peerId missing from message"),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_BAD_REQUEST,statusText:"missing peer info"}};try{const h=wr(a.id);o=Ps(h)}catch(h){return this.log.error("invalid PeerId - %e",h),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_BAD_REQUEST,statusText:"bad peer id"}}}if(this.log("incoming request from %p",o),!t.remotePeer.equals(o))return this.log("target peer %p did not equal sending peer %p",o,t.remotePeer),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_BAD_REQUEST,statusText:"peer id mismatch"}};const c=a.addrs.map(h=>Ye(h)).filter(h=>{try{const d=ct(h);return Zn(h)?!1:d.host!==ct(t.remoteAddr).host?(this.log.trace("not dialing %a - target host did not match remote host %a",h,t.remoteAddr),!1):s.includes(d.host)?!1:this.components.transportManager.dialTransportForMultiaddr(h)==null?(this.log.trace("not dialing %a - transport unsupported",h),!1):!0}catch{return!1}}).map(h=>(h.getComponents().find(d=>d.code===qe)?.value==null&&(h=h.encapsulate(`/p2p/${o.toString()}`)),h));if(c.length===0)return this.log("refused to dial all multiaddrs for %p from message",o),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_DIAL_REFUSED,statusText:"no dialable addresses"}};this.log("dial multiaddrs %s for peer %p",c.map(h=>h.toString()).join(", "),o);let l="",u=c[0];for(const h of c){let d;u=h;try{if(d=await this.components.connectionManager.openConnection(h,n),!d.remoteAddr.equals(h))throw this.log.error("tried to dial %a but dialed %a",h,d.remoteAddr),new Error("Unexpected remote address");return this.log("successfully dialed %p via %a",o,h),{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.OK,addr:d.remoteAddr.decapsulateCode(qe).bytes}}}catch(f){this.log.error("could not dial %p - %e",o,f),l=f.message}finally{d!=null&&await d.close()}}return{type:Ft.MessageType.DIAL_RESPONSE,dialResponse:{status:Ft.ResponseStatus.E_DIAL_ERROR,statusText:l,addr:u.bytes}}}getFirstUnverifiedMultiaddr(e,t){const n=this.components.addressManager.getAddressesWithMetadata().sort((s,i)=>s.type==="observed"&&i.type!=="observed"?1:i.type==="observed"&&s.type!=="observed"?-1:0).filter(s=>!(!(s.expires<Date.now())||ct(s.multiaddr).type==="ip6"&&(!t||!lI(s.multiaddr))||Zn(s.multiaddr)));for(const s of n){const i=s.multiaddr.toString();let o=this.dialResults.get(i);if(o!=null){if(o.networkSegments.includes(e)){this.log.trace("%a already has a network segment result from %s",o.multiaddr,e);continue}if(o.queue.size>10){this.log.trace("%a already has enough peers queued",o.multiaddr);continue}}if(o==null){const a=s.expires<Date.now();if(a&&this.addressFilter.remove?.(i),this.addressFilter.has(i))continue;this.addressFilter.add(i),this.log.trace("creating dial result %s %s",a?"to revalidate":"for",i),o={multiaddr:s.multiaddr,success:0,failure:0,networkSegments:[],verifyingPeers:qQ(),queue:new Jo({concurrency:3,maxSize:50}),type:s.type,lastVerified:s.lastVerified},this.dialResults.set(i,o)}return o}}removeOutdatedMultiaddrResults(){const e=new Set(this.components.addressManager.getAddressesWithMetadata().filter(({expires:t})=>t<Date.now()).map(({multiaddr:t})=>t.toString()));for(const t of this.dialResults.keys())e.has(t)||(this.log.trace("remove results for %a",t),this.dialResults.delete(t))}async verifyExternalAddresses(e){if(!this.isStarted())return;this.removeOutdatedMultiaddrResults();const n=(await this.components.peerStore.get(e.remotePeer)).addresses.some(({multiaddr:o})=>ct(o).type==="ip6"),s=this.getNetworkSegment(e.remoteAddr),i=this.getFirstUnverifiedMultiaddr(s,n);if(i==null){this.log.trace("no unverified public addresses found for peer %p to verify, not requesting verification",e.remotePeer);return}if(!this.hasConnectionCapacity()){i.lastVerified!=null?(this.log("automatically re-verifying %a because we are too close to the connection limit",i.multiaddr),this.confirmAddress(i)):this.log("skipping verifying %a because we are too close to the connection limit",i.multiaddr);return}i.queue.add(async o=>{await this.askPeerToVerify(e,s,o)},{peerId:e.remotePeer,multiaddr:i.multiaddr}).catch(o=>{i?.result==null&&this.log.error("error from %p verifying address %a - %e",e.remotePeer,i?.multiaddr,o)})}async askPeerToVerify(e,t,n){let s=this.dialResults.get(n.multiaddr.toString());if(s==null){this.log("%a was verified while %p was queued",n.multiaddr,e.remotePeer);return}const i=AbortSignal.timeout(this.timeout);this.log.trace("asking %a to verify multiaddr %s",e.remoteAddr,n.multiaddr);const o=await e.newStream(this.protocol,{signal:i});try{const a=Wr(o).pb(Ft),[,c]=await Promise.all([a.write({type:Ft.MessageType.DIAL,dial:{peer:{id:this.components.peerId.toMultihash().bytes,addrs:[n.multiaddr.bytes]}}},{signal:i}),a.read({signal:i})]);if(c.type!==Ft.MessageType.DIAL_RESPONSE||c.dialResponse==null){this.log("invalid autonat response from %p - %j",e.remotePeer,c);return}const l=c.dialResponse.status;if(this.log.trace("autonat response from %p for %a is %s",e.remotePeer,n.multiaddr,l),l!==Ft.ResponseStatus.OK&&l!==Ft.ResponseStatus.E_DIAL_ERROR)return;if(s=this.dialResults.get(n.multiaddr.toString()),s==null){this.log.trace("peer reported %a as %s but there is no result object",n.multiaddr,c.dialResponse.status);return}if(s.networkSegments.includes(t)){this.log.trace("%a results included network segment %s",n.multiaddr,t);return}if(s.result!=null){this.log.trace("already resolved result for %a, ignoring response from",n.multiaddr,e.remotePeer);return}if(s.verifyingPeers.has(e.remotePeer)){this.log.trace("peer %p has already verified %a, ignoring response",e.remotePeer,n.multiaddr);return}if(s.verifyingPeers.add(e.remotePeer),s.networkSegments.push(t),l===Ft.ResponseStatus.OK){if(s.success++,s.type!=="observed"){this.confirmAddress(s);return}}else l===Ft.ResponseStatus.E_DIAL_ERROR&&s.failure++;this.log("%a success %d failure %d",s.multiaddr,s.success,s.failure),s.success===Vne&&this.confirmAddress(s),s.failure===zne&&this.unconfirmAddress(s)}finally{try{await o.close({signal:i})}catch(a){o.abort(a)}}}hasConnectionCapacity(){const t=this.components.connectionManager.getConnections().length,n=this.components.connectionManager.getMaxConnections();return t/n*100<this.connectionThreshold}confirmAddress(e){this.log("%s address %a is externally dialable",e.type,e.multiaddr),this.components.addressManager.confirmObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!0,e.queue.abort()}unconfirmAddress(e){this.log("%s address %a is not externally dialable",e.type,e.multiaddr),this.components.addressManager.removeObservedAddr(e.multiaddr),this.dialResults.delete(e.multiaddr.toString()),e.result=!1,e.queue.abort()}getNetworkSegment(e){const t=ct(e);switch(t.type){case"ip4":return t.host.split(".")[0].padStart(3,"0");case"ip6":return t.host.split(":")[0].padStart(4,"0");default:throw new ue(`Remote address ${e} was not an IPv4 or Ipv6 address`)}}}function qne(r={}){return e=>new Hne(e,r)}const Kne="bootstrap",jne=50,Wne=1e3;class Gne extends Nt{static tag="bootstrap";log;timer;list;timeout;components;_init;constructor(e,t={list:[]}){if(t.list==null||t.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.log=e.logger.forComponent("libp2p:bootstrap"),this.timeout=t.timeout??Wne,this.list=t.list.map(n=>Ye(n)).filter(n=>r8.matches(n)?n.getComponents().findLast(i=>i.code===qe)?.value==null?(this.log.error("invalid bootstrap multiaddr without peer id"),!1):!0:(this.log.error("invalid multiaddr %a",n),!1)).map(n=>({id:On(n.getComponents().findLast(s=>s.code===qe)?.value??""),multiaddrs:[n]})),this._init=t}[Dp]=this;[Symbol.toStringTag]="@libp2p/bootstrap";[yr]=["@libp2p/peer-discovery"];isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(e=>{this.log.error("failed to discover bootstrap peers - %e",e)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const e of this.list){if(await this.components.peerStore.merge(e.id,{tags:{[this._init.tagName??Kne]:{value:this._init.tagValue??jne,ttl:this._init.tagTTL}},multiaddrs:e.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:e}),this.components.connectionManager.openConnection(e.id).catch(t=>{this.log.error("could not dial bootstrap peer %p - %e",e.id,t)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}function Yne(r){return e=>new Gne(e,r)}const Qne=1,FP=5e3,Xne=100,R1=`${Ug}-circuit-relay`;BigInt(1<<17);const E0="/libp2p/circuit/relay/0.2.0/hop",Zv="/libp2p/circuit/relay/0.2.0/stop",eE=300,Jne=4096,Zne=.001;var Kl;(function(r){(function(n){n.RESERVE="RESERVE",n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.RESERVE=0]="RESERVE",n[n.CONNECT=1]="CONNECT",n[n.STATUS=2]="STATUS"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.peer!=null&&(s.uint32(18),jl.codec().encode(n.peer,s)),n.reservation!=null&&(s.uint32(26),S0.codec().encode(n.reservation,s)),n.limit!=null&&(s.uint32(34),Wl.codec().encode(n.limit,s)),n.status!=null&&(s.uint32(40),Zr.codec().encode(n.status,s)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=jl.codec().decode(n,n.uint32(),{limits:i.limits?.peer});break}case 3:{o.reservation=S0.codec().decode(n,n.uint32(),{limits:i.limits?.reservation});break}case 4:{o.limit=Wl.codec().decode(n,n.uint32(),{limits:i.limits?.limit});break}case 5:{o.status=Zr.codec().decode(n);break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(Kl||(Kl={}));var Ai;(function(r){(function(n){n.CONNECT="CONNECT",n.STATUS="STATUS"})(r.Type||(r.Type={}));let e;(function(n){n[n.CONNECT=0]="CONNECT",n[n.STATUS=1]="STATUS"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.peer!=null&&(s.uint32(18),jl.codec().encode(n.peer,s)),n.limit!=null&&(s.uint32(26),Wl.codec().encode(n.limit,s)),n.status!=null&&(s.uint32(32),Zr.codec().encode(n.status,s)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.peer=jl.codec().decode(n,n.uint32(),{limits:i.limits?.peer});break}case 3:{o.limit=Wl.codec().decode(n,n.uint32(),{limits:i.limits?.limit});break}case 4:{o.status=Zr.codec().decode(n);break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(Ai||(Ai={}));var jl;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.addrs!=null)for(const i of t.addrs)n.uint32(18),n.bytes(i);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={id:ot(0),addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(s.limits?.addrs!=null&&i.addrs.length===s.limits.addrs)throw new Ir('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(jl||(jl={}));var S0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.expire!=null&&t.expire!==0n&&(n.uint32(8),n.uint64(t.expire)),t.addrs!=null)for(const i of t.addrs)n.uint32(18),n.bytes(i);t.voucher!=null&&(n.uint32(26),x0.codec().encode(t.voucher,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={expire:0n,addrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.expire=t.uint64();break}case 2:{if(s.limits?.addrs!=null&&i.addrs.length===s.limits.addrs)throw new Ir('Decode error - map field "addrs" had too many elements');i.addrs.push(t.bytes());break}case 3:{i.voucher=x0.codec().decode(t,t.uint32(),{limits:s.limits?.voucher});break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(S0||(S0={}));var Wl;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.duration!=null&&(n.uint32(8),n.uint32(t.duration)),t.data!=null&&(n.uint32(16),n.uint64(t.data)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.duration=t.uint32();break}case 2:{i.data=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Wl||(Wl={}));var Zr;(function(r){r.UNUSED="UNUSED",r.OK="OK",r.RESERVATION_REFUSED="RESERVATION_REFUSED",r.RESOURCE_LIMIT_EXCEEDED="RESOURCE_LIMIT_EXCEEDED",r.PERMISSION_DENIED="PERMISSION_DENIED",r.CONNECTION_FAILED="CONNECTION_FAILED",r.NO_RESERVATION="NO_RESERVATION",r.MALFORMED_MESSAGE="MALFORMED_MESSAGE",r.UNEXPECTED_MESSAGE="UNEXPECTED_MESSAGE"})(Zr||(Zr={}));var u4;(function(r){r[r.UNUSED=0]="UNUSED",r[r.OK=100]="OK",r[r.RESERVATION_REFUSED=200]="RESERVATION_REFUSED",r[r.RESOURCE_LIMIT_EXCEEDED=201]="RESOURCE_LIMIT_EXCEEDED",r[r.PERMISSION_DENIED=202]="PERMISSION_DENIED",r[r.CONNECTION_FAILED=203]="CONNECTION_FAILED",r[r.NO_RESERVATION=204]="NO_RESERVATION",r[r.MALFORMED_MESSAGE=400]="MALFORMED_MESSAGE",r[r.UNEXPECTED_MESSAGE=401]="UNEXPECTED_MESSAGE"})(u4||(u4={}));(function(r){r.codec=()=>nn(u4)})(Zr||(Zr={}));var _0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.relay!=null&&t.relay.byteLength>0&&(n.uint32(10),n.bytes(t.relay)),t.peer!=null&&t.peer.byteLength>0&&(n.uint32(18),n.bytes(t.peer)),t.expiration!=null&&t.expiration!==0n&&(n.uint32(24),n.uint64(t.expiration)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={relay:ot(0),peer:ot(0),expiration:0n},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.relay=t.bytes();break}case 2:{i.peer=t.bytes();break}case 3:{i.expiration=t.uint64();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(_0||(_0={}));var x0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&(n.uint32(26),_0.codec().encode(t.payload,n)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={publicKey:ot(0),payloadType:ot(0),signature:ot(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.publicKey=t.bytes();break}case 2:{i.payloadType=t.bytes();break}case 3:{i.payload=_0.codec().decode(t,t.uint32(),{limits:s.limits?.payload});break}case 5:{i.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(x0||(x0={}));class tE extends Error{static name="HadEnoughRelaysError";name="HadEnoughRelaysError"}class ese extends Error{static name="DoubleRelayError";name="DoubleRelayError"}class tse extends Error{static name="RelayQueueFullError";name="RelayQueueFullError"}function rE(r){const e=r*BigInt(1e3),t=new Date().getTime();return Number(e-BigInt(t))}class nE{expires;bytes;constructor(e){e?.duration!=null&&e?.duration!==0&&(this.expires=Date.now()+e.duration*1e3),this.bytes=e?.data,this.bytes===0n&&(this.bytes=void 0),this.onData=this.onData.bind(this)}onData(e){this.bytes!=null&&(this.bytes-=BigInt(e.byteLength),this.bytes<0n&&(this.bytes=0n))}getLimits(){if(this.expires==null&&this.bytes==null)return;const e={};if(this.bytes!=null){const t=this;Object.defineProperty(e,"bytes",{get(){return t.bytes}})}if(this.expires!=null){const t=this;Object.defineProperty(e,"seconds",{get(){return Math.round(((t.expires??0)-Date.now())/1e3)}})}return e}}const VP=Tt(St(r8.matchers[0],It(wu))),zP=Tt(It(wu));class rse extends Nt{components;started;running;topologyId;log;discoveryController;filter;queue;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:discover-relays"),this.components=e,this.started=!1,this.running=!1,this.filter=t.filter,this.discoveryController=new AbortController,this.discoveryController.signal,this.dialPeer=this.dialPeer.bind(this),this.onPeer=this.onPeer.bind(this)}isStarted(){return this.started}async start(){this.topologyId=await this.components.registrar.register(E0,{filter:this.filter,onConnect:e=>{this.log.trace("discovered relay %p queue (length: %d, active %d)",e,this.queue?.size,this.queue?.running),this.safeDispatchEvent("relay:discover",{detail:e})}}),this.started=!0}stop(){this.topologyId!=null&&this.components.registrar.unregister(this.topologyId),this.running&&this.stopDiscovery(),this.started=!1}startDiscovery(){this.running||(this.log("start discovery"),this.running=!0,this.discoveryController=new AbortController,this.discoveryController.signal,this.components.events.addEventListener("peer:discovery",this.onPeer),Promise.resolve().then(async()=>{this.log("searching peer store for relays");const e=await this.components.peerStore.all({filters:[n=>n.protocols.includes(E0)],orders:[()=>Math.random()<.5?1:-1,(n,s)=>{const i=sE(n),o=sE(s);return i>o?-1:o>i?1:0}]});for(const n of e)this.log.trace("found relay peer %p in peer store",n.id),this.safeDispatchEvent("relay:discover",{detail:n.id});this.log("found %d relay peers in peer store",e.length);const t=this.queue=new Jo({concurrency:5});this.log("start random walk");for await(const n of this.components.randomWalk.walk({signal:this.discoveryController.signal})){if(this.log.trace("found random peer %p",n.id),t.has(n.id)){this.log.trace("random peer %p was already in queue",n.id);continue}if(this.components.connectionManager.getConnections(n.id)?.length>0){this.log.trace("random peer %p was already connected",n.id);continue}if(!await this.components.connectionManager.isDialable(n.multiaddrs)){this.log.trace("random peer %p was not dialable",n.id,n.multiaddrs.map(s=>s.toString()));continue}t.queued>10&&(this.log.trace("wait for space in queue for %p",n.id),await t.onSizeLessThan(10,{signal:this.discoveryController.signal})),this.log("adding random peer %p to dial queue (length: %d, active %d)",n.id,t.size,t.running),t.add(this.dialPeer,{peerId:n.id,signal:this.discoveryController.signal}).catch(s=>{this.log.error("error opening connection to random peer %p - %e",n.id,s)})}this.log("stop random walk"),await t.onIdle()}).catch(e=>{this.discoveryController.signal.aborted||this.log.error("failed when finding relays on the network - %e",e)}))}stopDiscovery(){this.log("stop discovery"),this.running=!1,this.discoveryController?.abort(),this.queue?.clear(),this.components.events.removeEventListener("peer:discovery",this.onPeer)}onPeer(e){this.log.trace("maybe dialing discovered peer %p",e.detail.id),this.maybeDialPeer(e).catch(t=>{this.log.trace("error dialing discovered peer %p - %e",e.detail.id,t)})}async maybeDialPeer(e){if(this.queue==null)return;const t=e.detail.id,n=e.detail.multiaddrs;if(this.queue.has(t)){this.log.trace("random peer %p was already in queue",t);return}if(this.components.connectionManager.getConnections(t)?.length>0){this.log.trace("random peer %p was already connected",t);return}if(!await this.components.connectionManager.isDialable(n)){this.log.trace("random peer %p was not dialable",t);return}this.queue?.add(this.dialPeer,{peerId:e.detail.id,signal:this.discoveryController.signal}).catch(s=>{this.log.error("error opening connection to discovered peer %p - %e",e.detail.id,s)})}async dialPeer({peerId:e,signal:t}){const n=xt([AbortSignal.timeout(5e3),t]);try{await this.components.connectionManager.openConnection(e,{signal:n})}finally{n.clear()}}}function sE(r){const e=r.metadata.get("last-dial-success");return e==null?0:new Date(he(e)).getTime()}class nse extends Nt{connectionManager;addressManager;reservationStore;listeningAddrs;log;listenTimeout;reservationId;relay;constructor(e,t={}){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:listener"),this.connectionManager=e.connectionManager,this.addressManager=e.addressManager,this.reservationStore=e.reservationStore,this.listeningAddrs=[],this.listenTimeout=t.listenTimeout??FP,this.reservationStore.addEventListener("relay:removed",this._onRemoveRelayPeer),this.reservationStore.addEventListener("relay:created-reservation",this._onAddRelayPeer)}_onRemoveRelayPeer=e=>{this.log("relay removed %p our relay %p",e.detail.relay,this.relay,this.relay?.equals(e.detail.relay)),this.relay?.equals(e.detail.relay)===!0&&(this.log("relay peer removed %p",e.detail.relay),this.listeningAddrs.forEach(t=>{this.addressManager.removeObservedAddr(t)}),this.listeningAddrs=[],this.safeDispatchEvent("listening"))};_onAddRelayPeer=e=>{const{details:t}=e.detail;t.type!=="configured"&&t.id===this.reservationId&&this.addedRelay(e.detail)};async listen(e){if(zP.exactMatch(e))this.log("searching for circuit relay servers"),this.reservationId=this.reservationStore.reserveRelay();else if(VP.exactMatch(e)){this.log("listen on specific relay server %a",e);const t=AbortSignal.timeout(this.listenTimeout),n=e.decapsulate("/p2p-circuit"),s=await this.connectionManager.openConnection(n,{signal:t});if(!this.reservationStore.hasReservation(s.remotePeer)){this.log("making reservation on peer %p",s.remotePeer);const i=await this.reservationStore.addRelay(s.remotePeer,"configured");this.addedRelay(i)}}else throw new v3(`Could not listen on p2p-circuit address "${e}"`)}getAddrs(){return[...this.listeningAddrs.values()].flat()}updateAnnounceAddrs(){}async close(){this.reservationStore.cancelReservations(),this.listeningAddrs=[],this.reservationStore.removeEventListener("relay:removed",this._onRemoveRelayPeer),queueMicrotask(()=>{this.safeDispatchEvent("close")})}addedRelay(e){this.log("relay peer added %p",e.relay),this.relay=e.relay,this.listeningAddrs=e.details.reservation.addrs.map(t=>Ye(t).encapsulate("/p2p-circuit")),this.listeningAddrs.forEach(t=>{this.addressManager.confirmObservedAddr(t,{type:"transport"})}),queueMicrotask(()=>{this.safeDispatchEvent("listening")})}}function sse(r){return new nse(r)}const ise="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ose=(r=21)=>{let e="",t=crypto.getRandomValues(new Uint8Array(r|=0));for(;r--;)e+=ise[t[r]&63];return e};const ase=60*1e3*10,cse=60*1e3*5,lse=30*1e3;class use extends Nt{peerId;connectionManager;peerStore;events;reserveQueue;reservations;pendingReservations;maxReservationQueueLength;reservationCompletionTimeout;started;log;relayFilter;constructor(e,t){super(),this.log=e.logger.forComponent("libp2p:circuit-relay:transport:reservation-store"),this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.reservations=new xc,this.pendingReservations=[],this.maxReservationQueueLength=t?.maxReservationQueueLength??Xne,this.reservationCompletionTimeout=t?.reservationCompletionTimeout??FP,this.started=!1,this.relayFilter=Yo(100),this.reserveQueue=new Jo({concurrency:t?.reservationConcurrency??Qne,metricName:"libp2p_relay_reservation_queue",metrics:e.metrics}),this.events.addEventListener("connection:close",n=>{[...this.reservations.values()].find(i=>i.connection===n.detail.id)!=null&&this.#t(n.detail.remotePeer).catch(i=>{this.log("could not remove relay %p - %e",n.detail,i)})})}isStarted(){return this.started}start(){this.started=!0}afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>t.tags.has(R1)]});this.log("removing tag from %d old relays",e.length),await Promise.all(e.map(async t=>{await this.peerStore.merge(t.id,{tags:{[R1]:void 0}})})),this.log("redialing %d old relays",e.length),await Promise.all(e.map(async t=>this.addRelay(t.id,"discovered"))),this.#r()}).catch(e=>{this.log.error("failed to clean up and redial old relays during afterStart - %e",e)})}stop(){this.reserveQueue.clear(),this.reservations.forEach(({timeout:e})=>{clearTimeout(e)}),this.reservations.clear(),this.started=!1}reserveRelay(){const e=ose();return this.pendingReservations.push(e),this.#r(),e}async addRelay(e,t){if(this.peerId.equals(e))throw this.log.trace("not trying to use self as relay"),new v3("Cannot use self as relay");if(this.reserveQueue.size>this.maxReservationQueueLength)throw new tse("The reservation queue is full");const n=this.reserveQueue.find(e);if(n!=null)return this.log.trace("potential relay peer %p is already in the reservation queue",e),n.join();if(this.relayFilter.has(e.toMultihash().bytes))throw new v3("The relay was previously invalid");return this.log.trace("try to reserve relay slot with %p",e),this.reserveQueue.add(async()=>{const s=Date.now();try{const i=this.reservations.get(e);if(i!=null){const g=this.connectionManager.getConnections(e);let m=!1;if(g.length===0&&this.log("already have relay reservation with %p but we are no longer connected",e),g.map(b=>b.id).includes(i.connection)&&(this.log("already have relay reservation with %p and the original connection is still open",e),m=!0),m&&rE(i.reservation.expire)>ase)return this.log("already have relay reservation with %p but we are still connected and it does not expire soon",e),{relay:e,details:i};await this.#t(e)}if(t==="discovered"&&this.pendingReservations.length===0)throw new tE("Not making reservation on discovered relay because we do not need any more relays");const o=AbortSignal.timeout(this.reservationCompletionTimeout);const a=await this.connectionManager.openConnection(e,{signal:o});if(li.matches(a.remoteAddr))throw new ese("not creating reservation over relayed connection");const c=await this.#e(a,{signal:o}),l=rE(c.expire);this.log("created reservation on relay peer %p, expiry date is %s",e,new Date(Date.now()+l).toString());const u=Math.min(Math.max(l-cse,lse),Math.pow(2,31)-1),h=setTimeout(()=>{this.log("refresh reservation to relay %p",e),this.addRelay(e,t).catch(async g=>{this.log.error("could not refresh reservation to relay %p - %e",e,g),await this.#t(e)}).catch(g=>{this.log.error("could not remove expired reservation to relay %p - %e",e,g)})},u);let d;if(t==="discovered"){const g=this.pendingReservations.pop();if(g==null)throw new tE("Made reservation on relay but did not need any more discovered relays");d={timeout:h,reservation:c,type:t,connection:a.id,id:g}}else d={timeout:h,reservation:c,type:t,connection:a.id};this.reservations.set(e,d),await this.peerStore.merge(e,{tags:{[R1]:{value:1,ttl:l}}}),this.#r();const f={relay:e,details:d};return this.safeDispatchEvent("relay:created-reservation",{detail:f}),f}catch(i){throw t==="discovered"&&i.name==="HadEnoughRelaysError"||this.log.error("could not reserve slot on %p after %dms - %e",e,Date.now()-s,i),(i.name==="DialError"||i.name==="UnsupportedProtocolError")&&this.relayFilter.add(e.toMultihash().bytes),this.#t(e).catch(o=>{this.log.error("could not remove reservation on %p after reserving slot failed - %e",e,o)}),i}},{peerId:e})}hasReservation(e){return this.reservations.has(e)}getReservation(e){return this.reservations.get(e)?.reservation}reservationCount(e){return e==null?this.reservations.size:[...this.reservations.values()].reduce((t,n)=>(n.type===e&&t++,t),0)}cancelReservations(){[...this.reservations.values()].forEach(e=>{clearTimeout(e.timeout)}),this.reservations.clear()}async#e(e,t){t.signal?.throwIfAborted(),this.log("requesting reservation from %p",e.remotePeer);const n=await e.newStream(E0,t),i=Wr(n).pb(Kl);this.log.trace("send RESERVE to %p",e.remotePeer),await i.write({type:Kl.Type.RESERVE},t);let o;try{this.log.trace("reading response from %p",e.remotePeer),o=await i.read(t)}catch(c){throw n.abort(c),c}finally{n.status!=="closed"&&await n.close(t)}if(this.log.trace("read response %s",o.status),o.status===Zr.OK&&o.reservation!=null){const c=new Set;c.add(e.remoteAddr.toString());for(const l of o.reservation.addrs){let u=Ye(l);u.getComponents().find(h=>h.code===qe)==null&&(u=u.encapsulate(`/p2p/${e.remotePeer}`)),u=Ye(u.toString().replace(`/p2p/${e.remotePeer}/p2p/${e.remotePeer}`,`/p2p/${e.remotePeer}`)),c.add(u.toString())}return o.reservation.addrs=[...c].map(l=>Ye(l).bytes),o.reservation}const a=`reservation failed with status ${o.status??"undefined"}`;throw this.log.error(a),new Error(a)}async#t(e){const t=this.reservations.get(e);t!=null&&(this.log("removing relay reservation with %p from local store",e),clearTimeout(t.timeout),this.reservations.delete(e),t.type==="discovered"&&this.pendingReservations.push(t.id),await this.peerStore.merge(e,{tags:{[R1]:void 0}}),this.safeDispatchEvent("relay:removed",{detail:{relay:e,details:t}}),this.#r())}#r(){if(this.pendingReservations.length===0){this.log.trace("have discovered enough relays"),this.reserveQueue.clear(),this.safeDispatchEvent("relay:found-enough-relays");return}this.relayFilter=Yo(100),this.log("not discovered enough relays %d/%d",this.reservations.size,this.pendingReservations.length),this.safeDispatchEvent("relay:not-enough-relays")}}class hse extends w5{stream;init;constructor(e){super({...e,direction:e.stream.direction}),this.init=e,this.stream=e.stream,this.stream.addEventListener("close",t=>{this.onTransportClosed(t.error)}),this.stream.addEventListener("remoteCloseWrite",t=>{this.onRemoteCloseWrite(),this.close().catch(n=>{this.abort(n)})}),this.stream.addEventListener("message",t=>{e.onDataRead?.(t.data),this.onData(t.data)}),this.stream.addEventListener("drain",()=>{this.safeDispatchEvent("drain")})}sendData(e){return this.init.onDataWrite?.(e),{sentBytes:e.byteLength,canSendMore:this.stream.send(e)}}async sendClose(e){await this.stream.close(e)}sendReset(){this.stream.abort(new Error("An error occurred"))}sendPause(){this.stream.pause()}sendResume(){this.stream.resume()}}function iE(r){return new hse(r)}const dse=r=>{if(r.peer==null)return!1;try{r.peer.addrs.forEach(Ye)}catch{return!1}return!0},oE={maxInboundStopStreams:eE,maxOutboundStopStreams:eE};class fse{components;discovery;reservationStore;maxInboundStopStreams;maxOutboundStopStreams;started;log;shutdownController;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:circuit-relay:transport"),this.maxInboundStopStreams=t.maxInboundStopStreams??oE.maxInboundStopStreams,this.maxOutboundStopStreams=t.maxOutboundStopStreams??oE.maxOutboundStopStreams,this.shutdownController=new AbortController,this.discovery=new rse(e,{filter:t.discoveryFilter??jQ(Jne,Zne)}),this.discovery.addEventListener("relay:discover",n=>{this.reservationStore.addRelay(n.detail,"discovered").catch(s=>{s.name!=="HadEnoughRelaysError"&&s.name!=="RelayQueueFullError"&&this.log.error("could not add discovered relay %p - %e",n.detail,s)})}),this.reservationStore=new use(e,t),this.reservationStore.addEventListener("relay:not-enough-relays",()=>{this.discovery?.startDiscovery()}),this.reservationStore.addEventListener("relay:found-enough-relays",()=>{this.discovery?.stopDiscovery()}),this.started=!1,this.onStop=this.onStop.bind(this)}[Symbol.toStringTag]="@libp2p/circuit-relay-v2-transport";[yr]=["@libp2p/transport","@libp2p/circuit-relay-v2-transport"];get[ja](){return this.discovery!=null?["@libp2p/identify"]:[]}[Fg]=!0;isStarted(){return this.started}async start(){this.shutdownController=new AbortController,this.shutdownController.signal,await this.components.registrar.handle(Zv,this.onStop,{maxInboundStreams:this.maxInboundStopStreams,maxOutboundStreams:this.maxOutboundStopStreams,runOnLimitedConnection:!0}),await oi(this.discovery,this.reservationStore),this.started=!0}async stop(){this.shutdownController.abort(),await eo(this.discovery,this.reservationStore),await this.components.registrar.unhandle(Zv),this.started=!1}async dial(e,t){const n=e.toString().split("/p2p-circuit"),s=Ye(n[0]),i=Ye(n[n.length-1]),o=s.getComponents().find(f=>f.code===qe)?.value,a=i.getComponents().find(f=>f.code===qe)?.value;if(o==null||a==null){const f=`ircuit relay dial to ${e.toString()} failed as address did not have both relay and destination PeerIDs`;throw this.log.error(`c${f}`),new X1(`C${f}`)}const c=On(o),l=On(a);let h=this.components.connectionManager.getConnections(c)[0];h==null?(await this.components.peerStore.merge(c,{multiaddrs:[s]}),t.onProgress?.(new Pe("circuit-relay:open-connection")),h=await this.components.connectionManager.openConnection(c,t)):t.onProgress?.(new Pe("circuit-relay:reuse-connection"));let d;try{t.onProgress?.(new Pe("circuit-relay:open-hop-stream")),d=await h.newStream(E0,t);const f=Wr(d).pb(Kl);t.onProgress?.(new Pe("circuit-relay:write-connect-message")),await f.write({type:Kl.Type.CONNECT,peer:{id:l.toMultihash().bytes,addrs:[Ye(i).bytes]}},t),t.onProgress?.(new Pe("circuit-relay:read-connect-response"));const g=await f.read(t);if(g.status!==Zr.OK)throw new Bt(`failed to connect via relay with status ${g?.status?.toString()??"undefined"}`);const m=new nE(g.limit),b=iE({stream:f.unwrap().unwrap(),remoteAddr:e,localAddr:s.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),onDataRead:m.onData,onDataWrite:m.onData,log:d.log.newScope("circuit-relay:connection")}),v=await this.components.upgrader.upgradeOutbound(b,{...t,limits:m.getLimits()});return v.log("outbound relayed connection established to %p with limits %o, over connection %s",v.remotePeer,g.limit??"none",h.id),v}catch(f){throw this.log.error("circuit relay dial to destination %p via relay %p failed - %e",l,c,f),d?.abort(f),f}}createListener(e){return sse({peerId:this.components.peerId,connectionManager:this.components.connectionManager,addressManager:this.components.addressManager,reservationStore:this.reservationStore,logger:this.components.logger})}listenFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>VP.exactMatch(t)||zP.exactMatch(t))}dialFilter(e){return e=Array.isArray(e)?e:[e],e.filter(t=>li.exactMatch(t))}async onStop(e,t){const n=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);try{if(!this.reservationStore.hasReservation(t.remotePeer))try{this.log("dialed via relay we did not have a reservation on, start listening on that relay address"),await this.components.transportManager.listen([t.remoteAddr.encapsulate("/p2p-circuit")])}catch(h){this.log.error("failed to listen on a relay peer we were dialed via but did not have a reservation on - %e",h)}const s=Wr(e).pb(Ai),i=await s.read({signal:n});if(this.log("new circuit relay v2 stop stream from %p with type %s",t.remotePeer,i.type),i?.type===void 0){this.log.error("type was missing from circuit v2 stop protocol request from %s",t.remotePeer),await s.write({type:Ai.Type.STATUS,status:Zr.MALFORMED_MESSAGE},{signal:n}),await e.close({signal:n});return}if(i.type!==Ai.Type.CONNECT){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await s.write({type:Ai.Type.STATUS,status:Zr.UNEXPECTED_MESSAGE},{signal:n}),await e.close({signal:n});return}if(!dse(i)){this.log.error("invalid stop connect request via peer %p",t.remotePeer),await s.write({type:Ai.Type.STATUS,status:Zr.MALFORMED_MESSAGE},{signal:n}),await e.close({signal:n});return}const o=Ps(wr(i.peer.id));if(await this.components.connectionGater.denyInboundRelayedConnection?.(t.remotePeer,o)===!0){this.log.error("connection gater denied inbound relayed connection from %p",t.remotePeer),await s.write({type:Ai.Type.STATUS,status:Zr.PERMISSION_DENIED},{signal:n}),await e.close({signal:n});return}this.log.trace("sending success response to %p",t.remotePeer),await s.write({type:Ai.Type.STATUS,status:Zr.OK},{signal:n});const a=new nE(i.limit),c=t.remoteAddr.encapsulate(`/p2p-circuit/p2p/${o.toString()}`),l=this.components.addressManager.getAddresses()[0],u=iE({stream:s.unwrap().unwrap(),remoteAddr:c,localAddr:l,onDataRead:a.onData,onDataWrite:a.onData,log:e.log.newScope("circuit-relay:connection")});await this.components.upgrader.upgradeInbound(u,{limits:a.getLimits(),signal:n}),u.log("inbound relayed connection established to %p with limits %o, over connection %s",o,i.limit??"none",t.id)}finally{n?.clear()}}}function pse(r={}){return e=>new fse(e,r)}var Us;(function(r){(function(n){n.UNUSED="UNUSED",n.CONNECT="CONNECT",n.SYNC="SYNC"})(r.Type||(r.Type={}));let e;(function(n){n[n.UNUSED=0]="UNUSED",n[n.CONNECT=100]="CONNECT",n[n.SYNC=300]="SYNC"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{if(i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.observedAddresses!=null)for(const o of n.observedAddresses)s.uint32(18),s.bytes(o);i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={observedAddresses:[]},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{if(i.limits?.observedAddresses!=null&&o.observedAddresses.length===i.limits.observedAddresses)throw new Ir('Decode error - map field "observedAddresses" had too many elements');o.observedAddresses.push(n.bytes());break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(Us||(Us={}));function aE(r,e){return li.matches(r)||e.dialTransportForMultiaddr(r)==null?!1:_T.matches(r)?!0:hX.matches(r)?!Zn(r):!1}const cE=1024*4,lE=100,P1={timeout:5e3,retries:3,maxInboundStreams:1,maxOutboundStreams:1};class gse{started;timeout;retries;maxInboundStreams;maxOutboundStreams;peerStore;registrar;connectionManager;addressManager;transportManager;topologyId;log;constructor(e,t){this.log=e.logger.forComponent("libp2p:dcutr"),this.started=!1,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.connectionManager=e.connectionManager,this.transportManager=e.transportManager,this.timeout=t.timeout??P1.timeout,this.retries=t.retries??P1.retries,this.maxInboundStreams=t.maxInboundStreams??P1.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??P1.maxOutboundStreams,this.handleIncomingUpgrade=this.handleIncomingUpgrade.bind(this)}[Symbol.toStringTag]="@libp2p/dcutr";[ja]=["@libp2p/identify"];isStarted(){return this.started}async start(){this.started||(this.topologyId=await this.registrar.register(D1,{notifyOnLimitedConnection:!0,onConnect:(e,t)=>{li.exactMatch(t.remoteAddr)&&t.direction==="inbound"&&this.upgradeInbound(t).catch(n=>{this.log.error("error during outgoing DCUtR attempt - %e",n)})}}),await this.registrar.handle(D1,this.handleIncomingUpgrade,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:!0}),this.started=!0)}async stop(){await this.registrar.unhandle(D1),this.topologyId!=null&&this.registrar.unregister(this.topologyId),this.started=!1}async upgradeInbound(e){if(await this.attemptUnilateralConnectionUpgrade(e))return;let t;for(let n=0;n<this.retries;n++){const s={signal:AbortSignal.timeout(this.timeout)};try{t=await e.newStream([D1],{signal:s.signal,runOnLimitedConnection:!0});const i=Wr(t,{maxDataLength:cE}).pb(Us);this.log("B sending connect to %p",e.remotePeer);const o=Date.now();await i.write({type:Us.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(h=>h.bytes)},s),this.log("B receiving connect from %p",e.remotePeer);const a=await i.read(s);if(a.type!==Us.Type.CONNECT)throw this.log("A sent wrong message type"),new Bt("DCUtR message type was incorrect");const c=this.getDialableMultiaddrs(a.observedAddresses);if(c.length===0)throw this.log("A did not have any dialable multiaddrs"),new Bt("DCUtR connect message had no multiaddrs");const l=Date.now()-o;this.log("A sending sync, rtt %dms",l),await i.write({type:Us.Type.SYNC,observedAddresses:[]},s),this.log("A waiting for half RTT"),await LG(l/2),this.log("B dialing",c);const u=await this.connectionManager.openConnection(c,{signal:s.signal,priority:lE,force:!0,initiator:!1});this.log("DCUtR to %p succeeded to address %a, closing relayed connection",e.remotePeer,u.remoteAddr),await e.close(s);break}catch(i){if(this.log.error("error while attempting DCUtR on attempt %d of %d - %e",n+1,this.retries,i),t?.abort(i),n===this.retries)throw i}finally{t!=null&&await t.close(s)}}}async attemptUnilateralConnectionUpgrade(e){const n=(await this.peerStore.get(e.remotePeer)).addresses.map(s=>{const i=s.multiaddr;return i.getComponents().find(o=>o.code===qe)?.value==null?i.encapsulate(`/p2p/${e.remotePeer}`):i}).filter(s=>aE(s,this.transportManager));if(n.length>0){const s=AbortSignal.timeout(this.timeout);try{this.log("attempting unilateral connection upgrade to %a",n);const i=await this.connectionManager.openConnection(n,{signal:s,force:!0});if(li.exactMatch(i.remoteAddr))throw new Error("Could not open a new, non-limited, connection");return this.log("unilateral connection upgrade to %p succeeded via %a, closing relayed connection",e.remotePeer,i.remoteAddr),await e.close({signal:s}),!0}catch(i){this.log.error("unilateral connection upgrade to %p on addresses %a failed - %e",e.remotePeer,n,i)}}else this.log("peer %p has no public addresses, not attempting unilateral connection upgrade",e.remotePeer);return!1}async handleIncomingUpgrade(e,t){const n={signal:AbortSignal.timeout(this.timeout)},s=Wr(e,{maxDataLength:cE}).pb(Us);this.log("A receiving connect");const i=await s.read(n);if(i.type!==Us.Type.CONNECT)throw this.log("B sent wrong message type"),new Bt("DCUtR message type was incorrect");if(i.observedAddresses.length===0)throw this.log("B sent no multiaddrs"),new Bt("DCUtR connect message had no multiaddrs");const o=this.getDialableMultiaddrs(i.observedAddresses);if(o.length===0)throw this.log("B had no dialable multiaddrs in %o",i.observedAddresses.map(l=>Ye(l))),new Bt("DCUtR connect message had no dialable multiaddrs");if(this.log("A sending connect"),await s.write({type:Us.Type.CONNECT,observedAddresses:this.addressManager.getAddresses().map(l=>l.bytes)}),this.log("A receiving sync"),(await s.read(n)).type!==Us.Type.SYNC)throw new Bt("DCUtR message type was incorrect");this.log("A dialing",o);const c=await this.connectionManager.openConnection(o,{signal:n.signal,priority:lE,force:!0});this.log("DCUtR to %p succeeded via %a, closing relayed connection",t.remotePeer,c.remoteAddr),await t.close(n),await e.close(n)}getDialableMultiaddrs(e){const t=[];for(const n of e)if(!(n==null||n.length===0))try{const s=Ye(n);if(!aE(s,this.transportManager))continue;t.push(s)}catch{}return t}}const D1="/libp2p/dcutr";function mse(r={}){return e=>new gse(e,r)}class uE extends Error{type;code;constructor(e,t,n){super(e??"The operation was aborted"),this.type="aborted",this.name=n??"AbortError",this.code=t??"ABORT_ERR"}}async function hE(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new uE(t?.errorMessage,t?.errorCode,t?.errorName));let n;const s=new uE(t?.errorMessage,t?.errorCode,t?.errorName);try{return await Promise.race([r,new Promise((i,o)=>{n=()=>{o(s)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}class yse extends Error{name="UnexpectedEOFError";code="ERR_UNEXPECTED_EOF"}function HP(r,e){const t=e2();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const s=new ze;return{read:async o=>{if(o?.signal?.throwIfAborted(),o?.bytes==null){const{done:c,value:l}=await hE(n.next(),o?.signal);return c===!0?null:l}for(;s.byteLength<o.bytes;){const{value:c,done:l}=await hE(n.next(),o?.signal);if(l===!0)throw new yse("unexpected end of input");s.append(c)}const a=s.sublist(0,o.bytes);return s.consume(o.bytes),a},write:async(o,a)=>{a?.signal?.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(s.byteLength>0){const o=r.source;r.source=(async function*(){yield*s,yield*o})()}return r}}}function De(r){if(r!==void 0&&r!==De.REQUEST&&r!==De.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");r===void 0||this.initialize(r),this.maxHeaderSize=De.maxHeaderSize}De.prototype.initialize=function(r,e){if(r!==De.REQUEST&&r!==De.RESPONSE)throw new Error("type must be REQUEST or RESPONSE");this.type=r,this.state=r+"_LINE",this.info={headers:[],upgrade:!1},this.trailers=[],this.line="",this.isChunked=!1,this.connection="",this.headerSize=0,this.body_bytes=null,this.isUserCall=!1,this.hadError=!1};De.encoding="ascii";De.maxHeaderSize=80*1024;De.REQUEST="REQUEST";De.RESPONSE="RESPONSE";var qP=De.kOnHeaders=1,h4=De.kOnHeadersComplete=2,T2=De.kOnBody=3,b8=De.kOnMessageComplete=4;De.prototype[qP]=De.prototype[h4]=De.prototype[T2]=De.prototype[b8]=function(){};var KP=!0;Object.defineProperty(De,"kOnExecute",{get:function(){return KP=!1,99}});const jP=De.methods=["DELETE","GET","HEAD","POST","PUT","CONNECT","OPTIONS","TRACE","COPY","LOCK","MKCOL","MOVE","PROPFIND","PROPPATCH","SEARCH","UNLOCK","BIND","REBIND","UNBIND","ACL","REPORT","MKACTIVITY","CHECKOUT","MERGE","M-SEARCH","NOTIFY","SUBSCRIBE","UNSUBSCRIBE","PATCH","PURGE","MKCALENDAR","LINK","UNLINK","SOURCE"];var WP=jP.indexOf("CONNECT");De.prototype.reinitialize=De;De.prototype.close=De.prototype.pause=De.prototype.resume=De.prototype.remove=De.prototype.free=function(){};De.prototype._compatMode0_11=!1;De.prototype.getAsyncId=function(){return 0};var wse={REQUEST_LINE:!0,RESPONSE_LINE:!0,HEADER:!0};De.prototype.execute=function(r,e,t){if(!(this instanceof De))throw new TypeError("not a HTTPParser");e=e||0,t=typeof t=="number"?t:r.length,this.chunk=r,this.offset=e;var n=this.end=e+t;try{for(;this.offset<n&&!this[this.state](););}catch(s){if(this.isUserCall)throw s;return this.hadError=!0,s}return this.chunk=null,t=this.offset-e,wse[this.state]&&(this.headerSize+=t,this.headerSize>(this.maxHeaderSize||De.maxHeaderSize))?new Error("max header size exceeded"):t};var bse={REQUEST_LINE:!0,RESPONSE_LINE:!0,BODY_RAW:!0};De.prototype.finish=function(){if(!this.hadError){if(!bse[this.state])return new Error("invalid state for EOF");this.state==="BODY_RAW"&&this.userCall()(this[b8]())}};De.prototype.consume=De.prototype.unconsume=De.prototype.getCurrentBuffer=function(){};De.prototype.userCall=function(){this.isUserCall=!0;var r=this;return function(e){return r.isUserCall=!1,e}};De.prototype.nextRequest=function(){this.userCall()(this[b8]()),this.reinitialize(this.type)};De.prototype.consumeLine=function(){for(var r=this.end,e=this.chunk,t=this.offset;t<r;t++)if(e[t]===10){var n=this.line+he(e.subarray(this.offset,t),De.encoding);return n.charAt(n.length-1)==="\r"&&(n=n.substr(0,n.length-1)),this.line="",this.offset=t+1,n}this.line+=he(e.subarray(this.offset,this.end),De.encoding),this.offset=this.end};var vse=/^([^: \t]+):[ \t]*((?:.*[^ \t])|)/,Ese=/^[ \t]+(.*[^ \t])/;De.prototype.parseHeader=function(r,e){if(r.indexOf("\r")!==-1)throw R2("HPE_LF_EXPECTED");var t=vse.exec(r),n=t&&t[1];if(n)e.push(n),e.push(t[2]);else{var s=Ese.exec(r);s&&e.length&&(e[e.length-1]&&(e[e.length-1]+=" "),e[e.length-1]+=s[1])}};var Sse=/^([A-Z-]+) ([^ ]+) HTTP\/(\d)\.(\d)$/;De.prototype.REQUEST_LINE=function(){var r=this.consumeLine();if(r){var e=Sse.exec(r);if(e===null)throw R2("HPE_INVALID_CONSTANT");if(this.info.method=this._compatMode0_11?e[1]:jP.indexOf(e[1]),this.info.method===-1)throw new Error("invalid request method");this.info.url=e[2],this.info.versionMajor=+e[3],this.info.versionMinor=+e[4],this.body_bytes=0,this.state="HEADER"}};var _se=/^HTTP\/(\d)\.(\d) (\d{3}) ?(.*)$/;De.prototype.RESPONSE_LINE=function(){var r=this.consumeLine();if(r){var e=_se.exec(r);if(e===null)throw R2("HPE_INVALID_CONSTANT");this.info.versionMajor=+e[1],this.info.versionMinor=+e[2];var t=this.info.statusCode=+e[3];this.info.statusMessage=e[4],((t/100|0)===1||t===204||t===304)&&(this.body_bytes=0),this.state="HEADER"}};De.prototype.shouldKeepAlive=function(){if(this.info.versionMajor>0&&this.info.versionMinor>0){if(this.connection.indexOf("close")!==-1)return!1}else if(this.connection.indexOf("keep-alive")===-1)return!1;return!!(this.body_bytes!==null||this.isChunked)};De.prototype.HEADER=function(){var r=this.consumeLine();if(r!==void 0){var e=this.info;if(r)this.parseHeader(r,e.headers);else{for(var t=e.headers,n=!1,s,i=!1,o=0;o<t.length;o+=2)switch(t[o].toLowerCase()){case"transfer-encoding":this.isChunked=t[o+1].toLowerCase()==="chunked";break;case"content-length":if(s=+t[o+1],n){if(s!==this.body_bytes)throw R2("HPE_UNEXPECTED_CONTENT_LENGTH")}else n=!0,this.body_bytes=s;break;case"connection":this.connection+=t[o+1].toLowerCase();break;case"upgrade":i=!0;break}this.isChunked&&n&&(n=!1,this.body_bytes=null),i&&this.connection.indexOf("upgrade")!=-1?e.upgrade=this.type===De.REQUEST||e.statusCode===101:e.upgrade=e.method===WP,this.isChunked&&e.upgrade&&(this.isChunked=!1),e.shouldKeepAlive=this.shouldKeepAlive();var a;if(KP?a=this.userCall()(this[h4](e)):a=this.userCall()(this[h4](e.versionMajor,e.versionMinor,e.headers,e.method,e.url,e.statusCode,e.statusMessage,e.upgrade,e.shouldKeepAlive)),a===2)return this.nextRequest(),!0;if(this.isChunked&&!a)this.state="BODY_CHUNKHEAD";else{if(a||this.body_bytes===0)return this.nextRequest(),e.upgrade;this.body_bytes===null?this.state="BODY_RAW":this.state="BODY_SIZED"}}}};De.prototype.BODY_CHUNKHEAD=function(){var r=this.consumeLine();r!==void 0&&(this.body_bytes=parseInt(r,16),this.body_bytes?this.state="BODY_CHUNK":this.state="BODY_CHUNKTRAILERS")};De.prototype.BODY_CHUNK=function(){var r=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[T2](this.chunk.slice(this.offset,this.offset+r),0,r)),this.offset+=r,this.body_bytes-=r,this.body_bytes||(this.state="BODY_CHUNKEMPTYLINE")};De.prototype.BODY_CHUNKEMPTYLINE=function(){var r=this.consumeLine();if(r!==void 0){if(r!=="")throw new Error("Expected empty line");this.state="BODY_CHUNKHEAD"}};De.prototype.BODY_CHUNKTRAILERS=function(){var r=this.consumeLine();r!==void 0&&(r?this.parseHeader(r,this.trailers):(this.trailers.length&&this.userCall()(this[qP](this.trailers,"")),this.nextRequest()))};De.prototype.BODY_RAW=function(){this.userCall()(this[T2](this.chunk.slice(this.offset,this.end),0,this.end-this.offset)),this.offset=this.end};De.prototype.BODY_SIZED=function(){var r=Math.min(this.end-this.offset,this.body_bytes);this.userCall()(this[T2](this.chunk.slice(this.offset,this.offset+r),0,r)),this.offset+=r,this.body_bytes-=r,this.body_bytes||this.nextRequest()};["Headers","HeadersComplete","Body","MessageComplete"].forEach(function(r){var e=De["kOn"+r];Object.defineProperty(De.prototype,"on"+r,{get:function(){return this[e]},set:function(t){return this._compatMode0_11=!0,WP="CONNECT",this[e]=t}})});function R2(r){var e=new Error("Parse Error");return e.code=r,e}const v8=Symbol.for("@libp2p/peer-id");function xse(r){return!!r?.[v8]}let E8=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}};class Ase extends Error{static name="InvalidCIDError";constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}class Cse extends Error{static name="InvalidMultihashError";constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}class dE extends Error{static name="ProtocolError";constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}const GP=Symbol.for("nodejs.util.inspect.custom"),kse=114;class S8{type;multihash;publicKey;string;constructor(e){this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}[v8]=!0;toString(){return this.string==null&&(this.string=Dt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return Ee.createV1(kse,this.multihash)}toJSON(){return this.toString()}equals(e){if(e==null)return!1;if(e instanceof Uint8Array)return Qe(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(e?.toMultihash()?.bytes!=null)return Qe(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[GP](){return`PeerId(${this.toString()})`}}class Ise extends S8{type="RSA";publicKey;constructor(e){super({...e,type:"RSA"}),this.publicKey=e.publicKey}}class Tse extends S8{type="Ed25519";publicKey;constructor(e){super({...e,type:"Ed25519"}),this.publicKey=e.publicKey}}class Rse extends S8{type="secp256k1";publicKey;constructor(e){super({...e,type:"secp256k1"}),this.publicKey=e.publicKey}}const Pse=2336;class YP{type="url";multihash;publicKey;url;constructor(e){this.url=e.toString(),this.multihash=Pn.digest(le(this.url))}[GP](){return`PeerId(${this.url})`}[v8]=!0;toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return Ee.createV1(Pse,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=he(e)),e.toString()===this.toString())}}const Dse=114,fE=2336;function Nse(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=wr(Dt.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return Ose(Ee.parse(r));throw new E8('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return QP(t)}function QP(r){if(Bse(r))return new Ise({multihash:r});if(Lse(r))try{const e=Xg(r);if(e.type==="Ed25519")return new Tse({multihash:r,publicKey:e});if(e.type==="secp256k1")return new Rse({multihash:r,publicKey:e})}catch{const t=he(r.digest);return new YP(new URL(t))}throw new Cse("Supplied PeerID Multihash is invalid")}function Ose(r){if(r?.multihash==null||r.version==null||r.version===1&&r.code!==Dse&&r.code!==fE)throw new Ase("Supplied PeerID CID is invalid");if(r.code===fE){const e=he(r.multihash.digest);return new YP(new URL(e))}return QP(r.multihash)}function Lse(r){return r.code===Pn.code}function Bse(r){return r.code===Zt.code}class Yn extends Error{static name="InvalidMultiaddrError";name="InvalidMultiaddrError"}class Kd extends Error{static name="ValidationError";name="ValidationError"}let Mse=class extends Error{static name="InvalidParametersError";name="InvalidParametersError"};class $se extends Error{static name="UnknownProtocolError";name="UnknownProtocolError"}const d4=4,A0=6,f4=273,Use=33,Yh=41,XP=42,Fse=43,_8=53,x8=54,P2=55,A8=56,Vse=132,zse=301,Hse=302,qse=400,JP=421,Kse=444,jse=445,Wse=446,Gse=447,ZP=448,Yse=449,Qse=454,Xse=460,Jse=461,Zse=465,eie=466,tie=480,rie=481,nie=443,sie=477,iie=478,oie=479,aie=277,cie=275,lie=276,uie=280,hie=281,eD=290,die=777;function pE(r){return e=>he(e,r)}function gE(r){return e=>le(e,r)}function hh(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function Xc(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function fie(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=le(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Xc(n);return Wt([t,s],t.length+s.length)}function pie(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=_r.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const s=Xc(n);return Wt([t,s],t.length+s.length)}function mE(r){const e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=he(e,"base32"),s=hh(t);return`${n}:${s}`}const tD=function(r){r=r.toString().trim();const e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{const s=parseInt(t,10);if(isNaN(s)||s<0||s>255)throw new Yn("Invalid byte value in IP address");e[n]=s}),e},gie=function(r){let e=0;r=r.toString().trim();const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const i=ci(t[n]);let o;i&&(o=tD(t[n]),t[n]=he(o.subarray(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,he(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const i=[n,1];for(n=9-t.length;n>0;n--)i.push("0");t.splice.apply(t,i)}const s=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");const i=parseInt(t[n],16);if(isNaN(i)||i<0||i>65535)throw new Yn("Invalid byte value in IP address");s[e++]=i>>8&255,s[e++]=i&255}return s},mie=function(r){if(r.byteLength!==4)throw new Yn("IPv4 address was incorrect length");const e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},yie=function(r){if(r.byteLength!==16)throw new Yn("IPv6 address was incorrect length");const e=[];for(let n=0;n<r.byteLength;n+=2){const s=r[n],i=r[n+1],o=`${s.toString(16).padStart(2,"0")}${i.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new Yn(`Invalid IPv6 address "${t}"`)}};function wie(r){try{const e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Yn(`Invalid IPv6 address "${r}"`)}}const ky=Object.values(Ll).map(r=>r.decoder),bie=(function(){let r=ky[0].or(ky[1]);return ky.slice(2).forEach(e=>r=r.or(e)),r})();function vie(r){return bie.decode(r)}function Eie(r){return e=>r.encoder.encode(e)}function Sie(r){if(parseInt(r).toString()!==r)throw new Kd("Value must be an integer")}function _ie(r){if(r<0)throw new Kd("Value must be a positive integer, or zero")}function xie(r){return e=>{if(e>r)throw new Kd(`Value must be smaller than or equal to ${r}`)}}function Aie(...r){return e=>{for(const t of r)t(e)}}const N1=Aie(Sie,_ie,xie(65535)),Br=-1;let Cie=class{protocolsByCode=new Map;protocolsByName=new Map;getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new $se(`Protocol ${e} was unknown`);return t}addProtocol(e){this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),e.aliases?.forEach(t=>{this.protocolsByName.set(t,e)})}removeProtocol(e){const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),t.aliases?.forEach(n=>{this.protocolsByName.delete(n)}))}};const $i=new Cie,kie=[{code:d4,name:"ip4",size:32,valueToBytes:tD,bytesToValue:mie,validate:r=>{if(!ci(r))throw new Kd(`Invalid IPv4 address "${r}"`)}},{code:A0,name:"tcp",size:16,valueToBytes:Xc,bytesToValue:hh,validate:N1},{code:f4,name:"udp",size:16,valueToBytes:Xc,bytesToValue:hh,validate:N1},{code:Use,name:"dccp",size:16,valueToBytes:Xc,bytesToValue:hh,validate:N1},{code:Yh,name:"ip6",size:128,valueToBytes:gie,bytesToValue:yie,stringToValue:wie,validate:r=>{if(!Jg(r))throw new Kd(`Invalid IPv6 address "${r}"`)}},{code:XP,name:"ip6zone",size:Br},{code:Fse,name:"ipcidr",size:8,bytesToValue:pE("base10"),valueToBytes:gE("base10")},{code:_8,name:"dns",size:Br,resolvable:!0},{code:x8,name:"dns4",size:Br,resolvable:!0},{code:P2,name:"dns6",size:Br,resolvable:!0},{code:A8,name:"dnsaddr",size:Br,resolvable:!0},{code:Vse,name:"sctp",size:16,valueToBytes:Xc,bytesToValue:hh,validate:N1},{code:zse,name:"udt"},{code:Hse,name:"utp"},{code:qse,name:"unix",size:Br,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:JP,name:"p2p",aliases:["ipfs"],size:Br,bytesToValue:pE("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?gE("base58btc")(r):Ee.parse(r).multihash.bytes},{code:Kse,name:"onion",size:96,bytesToValue:mE,valueToBytes:fie},{code:jse,name:"onion3",size:296,bytesToValue:mE,valueToBytes:pie},{code:Wse,name:"garlic64",size:Br},{code:Gse,name:"garlic32",size:Br},{code:ZP,name:"tls"},{code:Yse,name:"sni",size:Br},{code:Qse,name:"noise"},{code:Xse,name:"quic"},{code:Jse,name:"quic-v1"},{code:Zse,name:"webtransport"},{code:eie,name:"certhash",size:Br,bytesToValue:Eie(mu),valueToBytes:vie},{code:tie,name:"http"},{code:rie,name:"http-path",size:Br,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:nie,name:"https"},{code:sie,name:"ws"},{code:iie,name:"wss"},{code:oie,name:"p2p-websocket-star"},{code:aie,name:"p2p-stardust"},{code:cie,name:"p2p-webrtc-star"},{code:lie,name:"p2p-webrtc-direct"},{code:uie,name:"webrtc-direct"},{code:hie,name:"webrtc"},{code:eD,name:"p2p-circuit"},{code:die,name:"memory",size:Br}];kie.forEach(r=>{$i.addProtocol(r)});function Iie(r){const e=[];let t=0;for(;t<r.length;){const n=Ts(r,t),s=$i.getProtocol(n),i=ht(n),o=Die(s,r,t+i);let a=0;o>0&&s.size===Br&&(a=ht(o));const c=i+a+o,l={code:n,name:s.name,bytes:r.subarray(t,t+c)};if(o>0){const u=t+i+a,h=r.subarray(u,u+o);l.value=s.bytesToValue?.(h)??he(h)}e.push(l),t+=c}return e}function Tie(r){let e=0;const t=[];for(const n of r){if(n.bytes==null){const s=$i.getProtocol(n.code),i=ht(n.code);let o,a=0,c=0;n.value!=null&&(o=s.valueToBytes?.(n.value)??le(n.value),a=o.byteLength,s.size===Br&&(c=ht(a)));const l=new Uint8Array(i+c+a);let u=0;Wo(n.code,l,u),u+=i,o!=null&&(s.size===Br&&(Wo(a,l,u),u+=c),l.set(o,u)),n.bytes=l}t.push(n.bytes),e+=n.bytes.byteLength}return Wt(t,e)}function Rie(r){if(r.charAt(0)!=="/")throw new Yn('String multiaddr must start with "/"');const e=[];let t="protocol",n="",s="";for(let i=1;i<r.length;i++){const o=r.charAt(i);o!=="/"&&(t==="protocol"?s+=r.charAt(i):n+=r.charAt(i));const a=i===r.length-1;if(o==="/"||a){const c=$i.getProtocol(s);if(t==="protocol"){if(c.size==null||c.size===0){e.push({code:c.code,name:c.name}),n="",s="",t="protocol";continue}else if(a)throw new Yn(`Component ${s} was missing value`);t="value"}else if(t==="value"){const l={code:c.code,name:c.name};if(c.size!=null&&c.size!==0){if(n==="")throw new Yn(`Component ${s} was missing value`);l.value=c.stringToValue?.(n)??n}e.push(l),n="",s="",t="protocol"}}}if(s!==""&&n!=="")throw new Yn("Incomplete multiaddr");return e}function Pie(r){return`/${r.flatMap(e=>{if(e.value==null)return e.name;const t=$i.getProtocol(e.code);if(t==null)throw new Yn(`Unknown protocol code ${e.code}`);return[e.name,t.valueToString?.(e.value)??e.value]}).join("/")}`}function Die(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:Ts(e,t)}const Nie=Symbol.for("nodejs.util.inspect.custom"),rD=Symbol.for("@multiformats/multiaddr"),Oie=[_8,x8,P2,A8];class Lie extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}function Bie(r){if(r==null&&(r="/"),nD(r))return r.getComponents();if(r instanceof Uint8Array)return Iie(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),Rie(r);if(Array.isArray(r))return r;throw new Yn("Must be a string, Uint8Array, Component[], or another Multiaddr")}class Jc{[rD]=!0;#e;#t;#r;constructor(e="/",t={}){this.#e=Bie(e),t.validate!==!1&&Mie(this)}get bytes(){return this.#r==null&&(this.#r=Tie(this.#e)),this.#r}toString(){return this.#t==null&&(this.#t=Pie(this.#e)),this.#t}toJSON(){return this.toString()}toOptions(){let e,t,n,s,i="";for(const{code:a,name:c,value:l}of this.#e)a===XP&&(i=`%${l??""}`),Oie.includes(a)&&(t="tcp",s=443,n=`${l??""}${i}`,e=a===P2?6:4),(a===A0||a===f4)&&(t=c==="tcp"?"tcp":"udp",s=parseInt(l??"")),(a===d4||a===Yh)&&(t="tcp",n=`${l??""}${i}`,e=a===Yh?6:4);if(e==null||t==null||n==null||s==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:s}}getComponents(){return[...this.#e]}protos(){return this.#e.map(({code:e,value:t})=>{const n=$i.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return this.#e.map(({code:e})=>e)}protoNames(){return this.#e.map(({name:e})=>e)}tuples(){return this.#e.map(({code:e,value:t})=>{if(t==null)return[e];const n=$i.getProtocol(e),s=[e];return t!=null&&s.push(n.valueToBytes?.(t)??le(t)),s})}stringTuples(){return this.#e.map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){const t=new Jc(e);return new Jc([...this.#e,...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),n=this.toString(),s=n.lastIndexOf(t);if(s<0)throw new Mse(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new Jc(n.slice(0,s),{validate:!1})}decapsulateCode(e){let t;for(let n=this.#e.length-1;n>-1;n--)if(this.#e[n].code===e){t=n;break}return new Jc(this.#e.slice(0,t),{validate:!1})}getPeerId(){try{let e=[];this.#e.forEach(({code:n,value:s})=>{n===JP&&e.push([n,s]),n===eD&&(e=[])});const t=e.pop();if(t?.[1]!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?he(Dt.decode(`z${n}`),"base58btc"):he(Ee.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const e of this.#e)if($i.getProtocol(e.code).path)return e.value??null;return null}equals(e){return Qe(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(i=>i.resolvable);if(t==null)return[this];const n=$ie.get(t.name);if(n==null)throw new Lie(`no available resolver for ${t.name}`);return(await n(this,e)).map(i=>Gl(i))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(this.#e.length!==2||this.#e[0].code!==d4&&this.#e[0].code!==Yh||this.#e[1].code!==A0&&this.#e[1].code!==f4)}[Nie](){return`Multiaddr(${this.toString()})`}}function Mie(r){r.getComponents().forEach(e=>{const t=$i.getProtocol(e.code);e.value!=null&&t.validate?.(e.value)})}const $ie=new Map;function nD(r){return!!r?.[rD]}function Gl(r){return new Jc(r)}const Uie=[A0,_8,A8,x8,P2];function yE(r){return sD("sni",r)?.value}function wE(r){const e=sD("tcp",r)?.value;return e==null?"":`:${e}`}function sD(r,e){return e.find(t=>t.name===r)}function bE(r){return r.some(({code:e})=>e===ZP)}function cs(r,e){const t=iD[r.name];if(t==null)throw new Error(`Can't interpret protocol ${r.name}`);const n=t(r,e);return r.code===Yh?`[${n}]`:n}const iD={ip4:(r,e)=>r.value,ip6:(r,e)=>e.length===0?r.value:`[${r.value}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${cs(t,e)}:${r.value}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${cs(t,e)}:${r.value}`},dnsaddr:(r,e)=>r.value,dns4:(r,e)=>r.value,dns6:(r,e)=>r.value,dns:(r,e)=>r.value,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${cs(t,e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${cs(t,e)}`},http:(r,e)=>{const t=bE(e),n=yE(e),s=wE(e);if(t&&n!=null)return`https://${n}${s}`;const i=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=cs(o,e);return a=a?.replace("tcp://",""),`${i}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=cs(t,e),s=decodeURIComponent(r.value??"");return`${n}${s}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return cs(t,e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return cs(t,e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=cs(t,e);return n=n?.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=bE(e),n=yE(e),s=wE(e);if(t&&n!=null)return`wss://${n}${s}`;const i=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=cs(o,e);return a=a?.replace("tcp://",""),`${i}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=cs(t,e);return n=n?.replace("tcp://",""),`wss://${n}`}};function Fie(r,e){const n=Gl(r).getComponents(),s=n.pop();if(s==null)throw new Error("Unexpected end of multiaddr");const i=iD[s.name];if(i==null)throw new Error(`No interpreter found for ${s.name}`);let o=i(s,n)??"";return Uie.includes(s.code)&&(o=o.replace(/^.*:\/\//,""),s.value==="443"?o=`https://${o}`:o=`http://${o}`),(o.startsWith("http://")||o.startsWith("https://")||o.startsWith("ws://")||o.startsWith("wss://"))&&(o=new URL(o).toString(),o.endsWith("/")&&(o=o.substring(0,o.length-1))),o}const vE={http:"80",https:"443",ws:"80",wss:"443"},Vie=["http","https","ws","wss"];function zie(r,e){e=e??{};const t=e.defaultDnsType??"dns",{scheme:n,hostname:s,port:i,path:o}=Hie(r),a=[qie(s,t),Kie(i,n),jie(n)];o!=null&&a.push(Wie(o));const c="/"+a.filter(l=>!!l).reduce((l,u)=>l.concat(u),[]).join("/");return Gl(c)}function Hie(r){const[e]=r.split(":");Vie.includes(e)||(r="http"+r.substring(e.length));let{protocol:t,hostname:n,port:s,pathname:i,search:o}=new URL(r);if(s==null||s===""){const c=Gie(e);c!=null&&(s=c),c==null&&t==="http:"&&(s="80")}let a;return i!=null&&i!==""&&i!=="/"&&(i.startsWith("/")&&(i=i.substring(1)),a=i),o!=null&&o!==""&&(a=a??"",a+=o),{scheme:e,hostname:n,port:s,path:a}}function qie(r,e){if(!(r==null||r==="")){if(nR(r))return["ip4",r];if(c0(r))return["ip6",r];if(r[0]==="["){const t=r.substring(1,r.length-1);if(c0(t))return["ip6",t]}return[e,r]}}function Kie(r,e){if(!(r==null||r===""))return e==="udp"?["udp",r]:["tcp",r]}function jie(r){if(r.match(/^tcp$|^udp$/)==null)return r==="https"?["/tls/http"]:r==="wss"?["/tls/ws"]:[r]}function Wie(r){if(!(r==null||r===""))return["http-path",encodeURIComponent(r)]}function Gie(r){if(!(r==null||r===""||vE[r]==null))return vE[r]}function Yie(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}function Qie(r,e={}){const t=Yie(r),n={_cancelled:!1,async start(){this._cancelled=!1},async pull(s){try{const{value:i,done:o}=await t.next();if(this._cancelled)return;if(o===!0){s.close();return}s.enqueue(i)}catch(i){s.error(i)}},cancel(){this._cancelled=!0}};return new globalThis.ReadableStream(n,e)}const Xie=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Jie=Hg({name:"sha-1",code:17,encode:Xie("SHA-1")});class Zie extends globalThis.Request{constructor(e,t={}){const n=t.method??"GET",s=wl(t),i=t.body;lD(n,s)&&(t.method="UPGRADE"),super(e,t),Object.defineProperties(this,{body:{value:i,writable:!1},method:{value:n,writable:!1},headers:{value:s,writable:!1}})}}const eoe={100:"Continue",101:"Switching Protocols",102:"Processing",103:"Early Hints",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",208:"Already Reported",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",308:"Permanent Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Payload Too Large",414:"URI Too Long",415:"Unsupported Media Type",416:"Range Not Satisfiable",417:"Expectation Failed",418:"I'm a Teapot",421:"Misdirected Request",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",425:"Too Early",426:"Upgrade Required",428:"Precondition Required",429:"Too Many Requests",431:"Request Header Fields Too Large",451:"Unavailable For Legal Reasons",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",508:"Loop Detected",509:"Bandwidth Limit Exceeded",510:"Not Extended",511:"Network Authentication Required"};let Qh=class extends globalThis.Response{constructor(e,t={}){const n=wl(t),s=t.status??200;(s<200||s>599)&&(t.status=200),super(e,t),Object.defineProperties(this,{status:{value:s,writable:!1},statusText:{value:eoe[s],writable:!1},headers:{value:n,writable:!1}})}};const toe=["dns","dns4","dns6","dnsaddr"];function p4(r,e){if(r instanceof URL)return r;const t=m4(r,e),{httpPath:n}=y4(r);return new URL(`http://${t}${n}`)}function g4(r){return r instanceof Uint8Array?r:r instanceof DataView?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r,0,r.byteLength)}function roe(r,e){const t={method:r.method,headers:r.headers};if((t.method!=="GET"||r.upgrade)&&t.method!=="HEAD"){let n=e.source;r.upgrade||(n=ioe(e.source,r.headers.get("content-length"))),t.body=Qie(n),t.duplex="half"}return new Zie(cD(r).toString(),t)}async function noe(r,e){const t=e2();if(e.sink(t).catch(i=>{e.abort(i)}),await t.push(le([`HTTP/1.1 ${r.status} ${r.statusText}`,...oD(r.headers),"",""].join(`\r
`))),r.body==null){await t.end();return}const n=r.body.getReader();let s=await n.read();for(;s.value!=null&&await t.push(s.value),!s.done;)s=await n.read();await t.end(),await e.closeWrite().catch(i=>{e.abort(i)})}const soe=le(["HTTP/1.1 404 Not Found","Connection: close","",""].join(`\r
`));le(["HTTP/1.1 400 Bad Request","Connection: close","",""].join(`\r
`));le(["HTTP/1.1 500 Internal Server Error","Connection: close","",""].join(`\r
`));le(["HTTP/1.1 501 Not Implemented","Connection: close","",""].join(`\r
`));function oD(r){const e=[];r.get("Connection")==null&&r.set("Connection","close");for(const[t,n]of r.entries())e.push(`${t}: ${n}`);return e}async function*ioe(r,e){if(e=parseInt(`${e??""}`),e==null||isNaN(e))return r;let t=0;for await(const n of r){if(t+=n.byteLength,t>e){yield n.subarray(0,t-e);return}if(yield n.subarray(),t===e)return}}function Yu(r,e){if(typeof r=="string"&&(r.startsWith("/")?r=Gl(r):r=new URL(r)),xse(r)&&(r=Gl(`/p2p/${r}`)),r instanceof URL&&r.protocol==="multiaddr:"&&(r=zie(r.toString())),nD(r)&&(r=[r]),Array.isArray(r)){for(const t of r)if(t.getComponents().some(({name:s})=>s==="http")){const s=Fie(t);return new URL(`${s}${e??""}`)}}return e==null?r:r instanceof URL?new URL(`${r}${e.substring(1)}`):r.map(t=>t.encapsulate(`/http-path/${encodeURIComponent(e.substring(1))}`))}function wl(r={}){return r.headers instanceof Headers||(r.headers=new Headers(r.headers)),r.headers}function Qu(r){return r!=null&&r!==""}function m4(r,e){let t,n=80,s="http:";if(r instanceof URL&&(t=r.hostname,n=parseInt(r.port,10),s=r.protocol),Qu(t)||(t=e.get("host")??void 0),!Qu(t)&&Array.isArray(r))for(const i of r){const a=i.getComponents().filter(({name:c})=>toe.includes(c))?.[0]?.value;if(a!=null){t=a;break}}if(!Qu(t)&&Array.isArray(r))for(const i of r){const o=i.getPeerId();try{n=i.toOptions().port}catch{}if(o!=null){t=Nse(o).toCID().toString(Oo);break}}if(!Qu(t)&&Array.isArray(r))for(const i of r)try{t=i.toOptions().host;break}catch{}if(Qu(t))return s==="http:"&&n!==80&&(t=`${t}:${n}`),s==="https:"&&n!==443&&(t=`${t}:${n}`),t;throw new E8("Could not determine request host name - a request must have a host header, be made to a DNS or IP-based multiaddr or an http(s) URL")}function y4(r){let e="/";return r=r.map(t=>Gl(t.getComponents().filter(n=>n.name==="http-path"?(e=n.value??"/",!1):!0))),{httpPath:e,addresses:r}}function aD(r,e=["GET"]){return r==null?e:(typeof r=="string"&&(r=[r]),r.map(t=>t.toUpperCase()))}function cD(r){const e=r.url??"/";if(e.startsWith("http"))return new URL(e);const t=ooe(r);return new URL(`http://${t}${e}`)}function ooe(r){let e=r.headers?.host;if(e==null&&(e=r.headers?.Host),e==null&&typeof r.headers.get=="function"&&(e=r.headers.get("host")),e==null)throw new E8("Could not read host");return e}function lD(r,e){return r==="GET"&&e.get("connection")?.toLowerCase()==="upgrade"&&e.get("upgrade")?.toLowerCase()==="websocket"}function EE(r,e){if(r instanceof Headers)return r.get(e)??void 0;const t=r[e];return Array.isArray(t)?t.join(","):t}async function aoe(r){if(EE(r,"sec-websocket-version")!=="13")throw new dE("Invalid version");const e=EE(r,"sec-websocket-key");if(e==null)throw new dE("Missing sec-websocket-key");const t=`${e}258EAFA5-E914-47DA-95CA-C5AB0DC85B11`,n=await Jie.digest(le(t)),s=qw.encode(n.digest).substring(1);return new Headers({Upgrade:"websocket",Connection:"upgrade","Sec-WebSocket-Accept":s})}async function coe(r){return new Promise((e,t)=>{const n=new De("REQUEST"),s=e2(),i=new ze;let o=!1;n[De.kOnHeadersComplete]=c=>{o=!0;const l=new Headers;for(let u=0;u<c.headers.length;u+=2)l.set(c.headers[u].toLowerCase(),c.headers[u+1]);e({...c,headers:l,raw:i,method:De.methods[c.method]})};const a=r.source;r.source=s,Promise.resolve().then(async()=>{for await(const c of a)o?await s.push(new ze(c)):(i.append(c),n.execute(c.subarray()));await s.end()}).catch(c=>{r.abort(c),t(c)}).finally(()=>{n.finish()})})}class loe extends Error{static name="InvalidResponseError";name="InvalidResponseError"}const uoe=[101,204,205,304];async function hoe(r,e,t){return new Promise((n,s)=>{const i=new TransformStream,o=i.writable.getWriter();let a=!1;const c=new De("RESPONSE");c.maxHeaderSize=t.maxHeaderSize??De.maxHeaderSize,c[De.kOnHeadersComplete]=l=>{t.log("response headers complete"),a=!0;const u=new Headers;for(let f=0;f<l.headers.length;f+=2)u.append(l.headers[f],l.headers[f+1]);let h=i.readable;uoe.includes(l.statusCode)&&(i.writable.close().catch(()=>{}),i.readable.cancel().catch(()=>{}),h=null);const d=new Qh(h,{status:l.statusCode,statusText:l.statusMessage,headers:u});n(d)},c[De.kOnBody]=l=>{t.log("response read body %d bytes",l.byteLength),o.write(l).catch(u=>{s(u)})},c[De.kOnMessageComplete]=()=>{t.log("response message complete"),o.close().catch(u=>{s(u)});const l=r.unwrap();l.close().catch(u=>{l.abort(u)})},Promise.resolve().then(async()=>{let l=0;for(;;){t.log("reading response");const u=await r.read({signal:t.signal??void 0});if(u==null){const h=c.finish();h!=null?t.log("response stream ended with error - %e",h):t.log("response stream ended"),a||s(new loe(`Response ended before headers were received, read ${l} bytes`));break}t.log("response stream read %d bytes",u.byteLength),l+=u.byteLength,c.execute(u.subarray(),0,u.byteLength)}}).catch(l=>{s(l)})})}function doe(r,e){return e.set("Content-Length",`${r.size}`),e.set("Content-Type",r.type!=null&&r.type!==""?r.type:"application/octet-stream"),r.stream()}function foe(r,e){return e.set("Content-Length",`${r.byteLength}`),e.set("Content-Type","application/octet-stream"),new ReadableStream({start(t){t.enqueue(g4(r)),t.close()}})}function poe(r,e,t){const n=[`--${t}`];let s=0;const i=2;return typeof e=="string"?(n.push(`Content-Disposition: form-data; name="${r}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${e.length}`,""),s=e.length+i):(n.push(`Content-Disposition: form-data; name="${r}"; filename="${encodeURIComponent(e.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${e.size}`,""),s=e.size+i),le(n.join(`\r
`)).byteLength+s}function goe(r,e){const t=`-----------------------------${crypto.randomUUID()}`;e.set("Content-Type",`multipart/form-data; boundary=${t}`);let n=0;for(const[c,l]of r.entries())n+=poe(c,l,t);e.set("Content-Length",`${n}`);const s=r.entries();let i;function o(c,l,u,h){const d=[`--${h}`];typeof u=="string"?d.push(`Content-Disposition: form-data; name="${l}"`,'Content-Type: text/plain; charset="UTF-8"',`Content-Length: ${u.length}`,"",u,""):(d.push(`Content-Disposition: form-data; name="${l}"; filename="${encodeURIComponent(u.name)}"`,"Content-Type: application/octet-stream",`Content-Length: ${u.size}`,""),i=u.stream().getReader()),c.enqueue(le(d.join(`\r
`)))}async function a(c,l){if(i!=null){const d=await i.read();d.value!=null&&c.enqueue(d.value),d.done&&(c.enqueue(le(`\r
`)),i=void 0);return}const{done:u,value:h}=s.next();if(h!=null){const[d,f]=h;o(c,d,f,l)}u===!0&&c.close()}return new ReadableStream({async pull(c){await a(c,t)}})}function moe(r,e){e.set("Content-Type","application/octet-stream"),e.set("Transfer-Encoding","chunked");const t=r.getReader();return new ReadableStream({async pull(n){const{done:s,value:i}=await t.read();i!=null&&(n.enqueue(le(`${i.byteLength}\r
`)),n.enqueue(i),n.enqueue(le(`\r
`))),s&&(n.enqueue(le(`0\r
\r
`)),n.close())}})}function SE(r,e){return e.set("Content-Length",`${r.length}`),e.set("Content-Type",'text/plain; charset="UTF-8"'),new ReadableStream({start(t){t.enqueue(le(r)),t.close()}})}function yoe(r,e){if(r!=null){if(typeof r=="string")return SE(r,e);if(r instanceof Blob)return doe(r,e);if(woe(r))return foe(r,e);if(r instanceof URLSearchParams)return SE(r.toString(),e);if(r instanceof ReadableStream)return moe(r,e);if(r instanceof FormData)return goe(r,e);throw new Error("Unsupported body type")}}function woe(r){return r==null?!1:r.byteLength!=null}async function boe(r,e,t){const n=new Headers(t.headers),s=n.get("host")??e.hostname;n.set("host",s),n.get("user-agent")==null&&n.set("user-agent","libp2p/fetch");const i=yoe(t.body,n),o=[`${t?.method?.toUpperCase()??"GET"} ${e.pathname??"/"} HTTP/1.1`,...oD(n),"",""];await r.write(le(o.join(`\r
`)),{signal:t.signal??void 0}),i!=null&&(t.log("request sending body"),await voe(r,i,t))}async function voe(r,e,t){const n=e.getReader();for(;;){const{done:s,value:i}=await n.read();if(i!=null&&(t.log("request send %d bytes",i.byteLength),await r.write(i,{signal:t.signal??void 0})),s){t.log("request finished sending body");break}}}async function Eoe(r,e,t){const n=t.logger.forComponent("libp2p:http:fetch");e=typeof e=="string"?new URL(e):e;const s=HP(r);return await boe(s,e,{...t,log:n}),hoe(s,e,{...t,log:n})}let uD=class extends Error{static name="InvalidParametersError";constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}};function Soe(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class _oe extends Event{message;error;filename="";lineno=0;colno=0;constructor(e){super("error"),this.error=e,this.message=e.message}}class _E extends Event{code;reason;wasClean;constructor(e,t){super(e),this.code=t?.code??0,this.reason=t?.reason??"",this.wasClean=t?.wasClean??!0}}const xoe={CONTINUATION:0,TEXT:1,BINARY:2,CONNECTION_CLOSE:8,PING:9,PONG:10},Iy={0:"CONTINUATION",1:"TEXT",2:"BINARY",8:"CONNECTION_CLOSE",9:"PING",10:"PONG"},hD={NORMAL_CLOSURE:1e3,MESSAGE_TOO_BIG:1009};function Aoe(r){let e=0;if(r.byteLength<e+1)return;const n=r.get(e)&15;if(e++,Iy[n]==null)throw new Error(`Unknown opcode: ${n}`);if(r.byteLength<e+1)return;const s=r.get(e),i=(s&128)===128;let o=s&127;if(e++,o===126){if(r.byteLength<e+2)return;o=r.getUint16(e),e+=2}else if(o===127){if(r.byteLength<e+8)return;o=r.getUint32(e),e+=8}if(o===0)return r.consume(e),{type:Iy[n]};let a;if(i){if(r.byteLength<e+4)return;a=r.subarray(e,e+4),e+=4}if(r.byteLength<e+o)return;let c=r.subarray(e,e+o);return e+=o,a!=null&&(c=dD(c,a)),r.consume(e),{type:Iy[n],data:c}}function dD(r,e){let t=0;for(let n=0;n<r.byteLength;n++)r[n]=r[n]^e[t],t++,t===e.byteLength&&(t=0);return r}function Coe(r,e,t){const n=new ze(Uint8Array.from([128|xoe[r]])),s=e?.byteLength??0;if(s<126)n.append(Uint8Array.from([s|(t===!0?128:0)]));else if(s<65535){const i=new ze(new Uint8Array(3));i.set(0,126|(t===!0?128:0)),i.setUint16(1,s),n.append(i)}else if(s<18446744073709552e3){const i=new ze(new Uint8Array(9));i.set(0,127|(t===!0?128:0)),i.setUint32(1,s),n.append(i)}else throw new Error("Payload too large");if(t===!0&&e!=null){const i=Uint8Array.from([0,0,0,0]);n.append(i),e=dD(e,i)}return e!=null&&n.append(e),n}function koe(r){if(r instanceof Uint8Array||r instanceof ArrayBuffer||r instanceof DataView)return g4(r);if(typeof r=="string")return le(r);if(r instanceof Blob)return r.arrayBuffer().then(e=>g4(e));throw new uD("Unsupported data type")}async function Ioe(r,e){return new Promise((t,n)=>{let s=!1;const i=new De("RESPONSE");i[De.kOnHeadersComplete]=o=>{s=!0;const a=[];for(let c=0;c<o.headers.length;c+=2)a.push([o.headers[c],o.headers[c+1]]);t(new Qh(null,{status:o.statusCode,statusText:o.statusMessage,headers:new Headers(a)}))},Promise.resolve().then(async()=>{for(;!s;){const o=await r.read(e);if(o==null)throw new Error("Stream ended before headers were received");i.execute(o.subarray(),0,o.byteLength)}}).catch(o=>{n(o)})})}async function*Toe(r,e=[],t){const n=qw.encode(crypto.getRandomValues(new Uint8Array(16))).substring(1);t.set("host",r.hostname),t.set("connection","upgrade"),t.set("upgrade","websocket"),t.set("pragma","no-cache"),t.set("cache-control","no-cache"),t.set("sec-websocket-version","13"),t.set("sec-websocket-key",n),e.length>0&&t.set("sec-websocket-protocol",e.join(", ")),yield le([`GET ${r.pathname??"/"} HTTP/1.1`,...[...t.entries()].map(([s,i])=>`${s}: ${i}`),"",""].join(`\r
`))}const Roe=["BINARY","TEXT","CONTINUATION"],Poe=10485760,Doe="/http/1.1";class fD extends Nt{binaryType="arraybuffer";bufferedAmount=0;extensions="";protocol="";readyState;url;CONNECTING=0;OPEN=1;CLOSING=2;CLOSED=3;_onclose;_onerror;_onmessage;_onopen;sentClose;isClient;buffer;maxMessageSize;_url;closeController;constructor(e,t={}){super(),this.readyState=this.CONNECTING,this.url=e.pathname,this.sentClose=!1,this.isClient=t.isClient??!0,this.buffer=new ze,this.closeController=new AbortController,this.maxMessageSize=t.maxMessageSize??Poe}send(e){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");const t=koe(e);Soe(t)?t.then(n=>{this._send("BINARY",n)}).catch(n=>{this._errored(n)}):this._send("BINARY",t)}_send(e,t){if(this.readyState!==this.OPEN)return;const n=Coe(e,t,this.isClient),s=n.byteLength;this.bufferedAmount+=s,this._write(n,i=>{this.bufferedAmount-=s,i!=null&&this._errored(i)})}close(e,t){if(this.readyState!==this.OPEN)throw new Error("WebSocket was not open");this.readyState=this.CLOSING,this.sentClose=!0,this._send("CONNECTION_CLOSE")}_errored(e){this.readyState=this.CLOSED,this.dispatchEvent(new _oe(e))}set onclose(e){this._onclose=e,this.addEventListener("close",e)}get onclose(){return this._onclose??null}set onerror(e){this._onerror=e,this.addEventListener("error",e)}get onerror(){return this._onerror??null}set onmessage(e){this._onmessage=e,this.addEventListener("message",e)}get onmessage(){return this._onmessage??null}set onopen(e){this._onopen=e,this.addEventListener("open",e)}get onopen(){return this._onopen??null}_push(e){if(this.buffer.append(e),this.buffer.byteLength>this.maxMessageSize){this.close(hD.MESSAGE_TOO_BIG,"Max message size exceeded");return}for(;;){const t=Aoe(this.buffer);if(t==null)break;if(Roe.includes(t.type)&&t.data!=null){let n;this.binaryType==="blob"?n=new Blob([t.data]):t.data.byteOffset===0&&t.data.byteLength===t.data.buffer.byteLength?n=t.data.buffer:(n=new ArrayBuffer(t.data.byteLength),new Uint8Array(n,0,n.byteLength).set(t.data)),this.dispatchEvent(new MessageEvent("message",{data:n,origin:this._url?.hostname}))}t.type==="PING"&&this._send("PONG",t.data),t.type==="CONNECTION_CLOSE"&&(this.sentClose||this.close(),this.closeController.abort(),this._close(void 0,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new _E("close"))}))}}_remoteClosed(e){this.readyState=this.CLOSING,this._close(e,()=>{this.readyState=this.CLOSED,this.dispatchEvent(new _E("close"))})}}class Noe extends fD{writer;writable;constructor(e,t,n={}){if(super(new URL(e.url),{...n,isClient:!1}),e.body==null)throw new uD("Request body cannot be null");this.readyState=this.OPEN,this.writable=t,this.writer=t.getWriter();const s=e.body.getReader();Promise.resolve().then(async()=>{for(this.dispatchEvent(new Event("open"));;){const{value:i,done:o}=await s.read();if(i!=null&&this._push(i),o){this._remoteClosed();break}}}).catch(i=>{this._errored(i)})}_write(e,t){this.writer?.write(e).then(()=>{t()},n=>{t(n)})}_close(e,t){e!=null?this.writable.abort(e).then(()=>{t()},()=>{t()}):this.writable.close().then(()=>{t()},()=>{t()})}}let Ooe=class extends fD{bytes;constructor(e,t,n,s){super(t,{...s,isClient:!0}),Promise.resolve().then(async()=>{const o=await(await n.openConnection(e,s)).newStream(Doe,s);this.bytes=HP(o);for await(const c of Toe(t,s.protocols,wl(s)))await this.bytes.write(c);const a=await Ioe(this.bytes,{});if(a.status!==101)throw new Error("Invalid WebSocket handshake - response status "+a.status);await s.onHandshakeResponse?.(a),this.protocol=a.headers.get("Sec-WebSocket-Protocol")??"",this.readyState=this.OPEN,this.dispatchEvent(new Event("open"));for await(const c of o.source)this._push(c)}).catch(i=>{this._errored(i)})}_write(e,t){if(this.bytes==null){t(new Error("WebSocket was not open"));return}this.bytes.write(e).then(()=>{t()},n=>{t(n)})}_close(e,t){if(this.bytes==null){t();return}const n=this.bytes.unwrap();if(e!=null){n.abort(e),t();return}n.close().catch(s=>{n.abort(s)}).finally(()=>{t()})}};const w4="/http/1.1",pD=Symbol.for("@libp2p/http/websocket-handler");var Xu={},xE;function Loe(){if(xE)return Xu;xE=1,Object.defineProperty(Xu,"__esModule",{value:!0}),Xu.parse=o,Xu.serialize=l;const r=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,s=Object.prototype.toString,i=(()=>{const d=function(){};return d.prototype=Object.create(null),d})();function o(d,f){const g=new i,m=d.length;if(m<2)return g;const b=f?.decode||u;let v=0;do{const A=d.indexOf("=",v);if(A===-1)break;const w=d.indexOf(";",v),E=w===-1?m:w;if(A>E){v=d.lastIndexOf(";",A-1)+1;continue}const x=a(d,v,A),P=c(d,A,x),T=d.slice(x,P);if(g[T]===void 0){let D=a(d,A+1,E),C=c(d,E,D);const R=b(d.slice(D,C));g[T]=R}v=E+1}while(v<m);return g}function a(d,f,g){do{const m=d.charCodeAt(f);if(m!==32&&m!==9)return f}while(++f<g);return g}function c(d,f,g){for(;f>g;){const m=d.charCodeAt(--f);if(m!==32&&m!==9)return f+1}return g}function l(d,f,g){const m=g?.encode||encodeURIComponent;if(!r.test(d))throw new TypeError(`argument name is invalid: ${d}`);const b=m(f);if(!e.test(b))throw new TypeError(`argument val is invalid: ${f}`);let v=d+"="+b;if(!g)return v;if(g.maxAge!==void 0){if(!Number.isInteger(g.maxAge))throw new TypeError(`option maxAge is invalid: ${g.maxAge}`);v+="; Max-Age="+g.maxAge}if(g.domain){if(!t.test(g.domain))throw new TypeError(`option domain is invalid: ${g.domain}`);v+="; Domain="+g.domain}if(g.path){if(!n.test(g.path))throw new TypeError(`option path is invalid: ${g.path}`);v+="; Path="+g.path}if(g.expires){if(!h(g.expires)||!Number.isFinite(g.expires.valueOf()))throw new TypeError(`option expires is invalid: ${g.expires}`);v+="; Expires="+g.expires.toUTCString()}if(g.httpOnly&&(v+="; HttpOnly"),g.secure&&(v+="; Secure"),g.partitioned&&(v+="; Partitioned"),g.priority)switch(typeof g.priority=="string"?g.priority.toLowerCase():void 0){case"low":v+="; Priority=Low";break;case"medium":v+="; Priority=Medium";break;case"high":v+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${g.priority}`)}if(g.sameSite)switch(typeof g.sameSite=="string"?g.sameSite.toLowerCase():g.sameSite){case!0:case"strict":v+="; SameSite=Strict";break;case"lax":v+="; SameSite=Lax";break;case"none":v+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${g.sameSite}`)}return v}function u(d){if(d.indexOf("%")===-1)return d;try{return decodeURIComponent(d)}catch{return d}}function h(d){return s.call(d)==="[object Date]"}return Xu}var Boe=Loe();const Moe=sa(Boe);class $oe{log;cookies;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:http:cookies"),this.cookies=new Map}async prepareRequest(e,t){if((t.credentials??"same-origin")==="omit")return;const s=t.headers.get("origin");if(s==null||s==="null")return;const i=p4(e,t.headers),o=(this.cookies.get(i.hostname)??[]).filter(a=>!(a.expires!=null&&a.expires<Date.now()||a.path!=null&&!i.pathname.startsWith(a.path))).map(a=>`${a.name}=${a.value}`).join("; ");o.length>0&&t.headers.set("cookie",o)}async processResponse(e,t,n){if((t.credentials??"same-origin")==="omit"){AE(n);return}const i=t.headers.get("origin");if(i==null||i==="null")return;const o=p4(e,t.headers);for(const a of n.headers.getSetCookie()){const c=[...this.cookies.get(o.hostname)??[],...Uoe(Moe.parse(a))];this.cookies.set(o.hostname,c)}AE(n)}}function AE(r){return r.headers.has("set-cookie")&&r.headers.delete("set-cookie"),r}function Uoe(r){const e={},t=[];return Object.entries(r).forEach(([n,s])=>{n.toLowerCase()==="domain"&&s!=null&&(e.domain=s),n.toLowerCase()==="max-age"&&s!=null&&(e.expires=Date.now()+parseInt(s,10)*1e3),!Foe.includes(n.toLowerCase())&&s!=null&&t.push({name:n,value:s})}),t.map(n=>({...n,...e}))}const Foe=["domain","expires","httponly","max-age","partitioned","path","samesite","secure"];class Voe{async prepareRequest(e,t){if(t.headers.get("origin")!=null||t.mode==="no-cors")return;const n=p4(e,t.headers);t.headers.set("origin",`${n.protocol}//${n.host}`)}}function zoe(r){return typeof r.init=="function"}function gD(r,e){if(zoe(r)){const t=r;return t.handler=r.init(e),delete t.init,t}return r}function Hoe(r){const e=aD(r.method,["GET"]);if(r.fallback==null&&e.filter(n=>n!=="GET").length>0)throw new ue("WebSocket handlers only support the GET HTTP method");const t={...r,init:n=>{const s=gD(r,n);return t[pD]=s.handler,async i=>{if(!lD(i.method,i.headers))return r?.fallback!=null?r.fallback(i):new Qh(null,{status:400});const o=new TransformStream;try{const a=new Qh(o.readable,{status:101,headers:await aoe(i.headers)}),c=new Noe(i,o.writable,r);return s.handler(c),a}catch{return new Qh(null,{status:500})}}}};return t}const mD="/.well-known/libp2p/protocols";function qoe(r){return Hoe({path:mD,method:["GET"],cors:!0,handler:e=>{const t=JSON.stringify(r.getProtocolMap());e.send(t),e.close()},fallback:async e=>{const t=JSON.stringify(r.getProtocolMap());return new Response(t,{headers:{"Content-Type":"application/json","Content-Length":`${t.length}`}})}})}class Koe{log;components;protocols;endpoint;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:http:registrar"),this.protocols=[],this.onStream=this.onStream.bind(this),this.endpoint=t.server,this.handle("",qoe(this))}async start(){await this.components.registrar.handle(w4,this.onStream.bind(this))}async stop(){await this.components.registrar.unhandle(w4)}async onStream(e,t){const n=await coe(e);if(this.canHandle(n)){this.log("handling incoming request %s %s",n.method,n.url);const s=await this.onRequest(roe(n,e));await noe(s,e),await e.close();return}if(this.endpoint==null){this.log("cannot handle incoming request %s %s and no endpoint configured",n.method,n.url),e.send(soe),await e.close();return}this.log("passing incoming request %s %s to endpoint",n.method,n.url),this.endpoint.inject(n,e,t).catch(s=>{this.log.error("error injecting request to endpoint - %e",s),e.abort(s)})}canHandle(e){const t=cD(e).pathname;return this.protocols.find(n=>n.route.path===t)!=null?(this.log.trace("can handle %s",t),!0):(this.log.trace("cannot handle %s",t),!1)}async onRequest(e){this.log("incoming request %s %s",e.method,e.url);const t=this.findHandler(e.url);if(t==null)return new Response(null,{status:404});let n;return t.route.method.includes(e.method)?n=await t.route.handler(e):e.method==="OPTIONS"?n=new Response(null,{status:204}):n=new Response(null,{status:405}),joe(n,e,t),this.log("%s %s %d %s",e.method,e.url,n.status,n.statusText),n}onWebSocket(e){const t=this.findHandler(e.url);if(t!=null){const n=t.route[pD];if(n!=null){n(e);return}}e.close(hD.NORMAL_CLOSURE)}findHandler(e){const t=e.startsWith("/")?e:new URL(e).pathname;this.log("search for handler on path %s",t);const n=this.protocols.find(s=>s.route.path===t);return n!=null&&this.log("found handler for HTTP protocol %s on path %s",n.protocol,e),n}handle(e,t){if(t.path=t.path??e,this.protocols.find(n=>n.protocol===e)!=null)throw new ue(`HTTP protocol handler for ${e} already registered`);(t.path===""||!t.path.startsWith("/"))&&(t.path=`/${t.path}`),t.cors=t.cors??!0,t.method=aD(t.method),t=gD(t,this.components),this.protocols.push({protocol:e,route:t}),this.protocols.sort(({route:{path:n}},{route:{path:s}})=>s.length-n.length)}unhandle(e){this.protocols=this.protocols.filter(t=>t.protocol===e)}getProtocolMap(){const e={};for(const t of this.protocols)t.protocol!==""&&(e[t.protocol]={path:t.route.path});return e}}function joe(r,e,t){const n=[...new Set(["OPTIONS",...t.route.method])].join(", ");t.route.cors&&(e.headers.get("Access-Control-Request-Method")!=null&&r.headers.set("access-control-allow-methods",n),e.headers.get("Access-Control-Request-Headers")!=null&&r.headers.set("access-control-allow-headers",e.headers.get("Access-Control-Request-Headers")??""),e.headers.get("Origin")!=null&&(r.headers.set("access-control-allow-origin",e.headers.get("Origin")??""),r.headers.set("vary","Origin"))),e.method==="OPTIONS"&&r.headers.set("allow",n)}async function Woe(r,e,t){for(const n of e.middleware)await n.prepareRequest?.(r,e);return t()}async function Goe(r,e,t){for(const n of e.middleware)await n.prepareRequest?.(r,e);return t()}async function Yoe(r,e,t){for(const n of e.middleware)await n.processResponse?.(r,e,t);return t}class Qoe{log;components;httpRegistrar;origin;cookies;constructor(e,t={}){this.components=e,this.log=e.logger.forComponent("libp2p:http"),this.httpRegistrar=new Koe(e,t),this.origin=new Voe,this.cookies=new $oe(e,t)}[Symbol.toStringTag]="@libp2p/http";[yr]=["@libp2p/http"];async start(){await oi(this.httpRegistrar)}async stop(){await eo(this.httpRegistrar)}agent(...e){throw new R7("This method is not supported in browsers")}dispatcher(...e){throw new R7("This method is not supported in browsers")}async connect(e,t={}){const n=Yu(e),s=wl(t),i={...t,headers:s,method:"GET",middleware:t.middleware?.map(o=>o(this.components))??[]};return s.set("connection","upgrade"),s.set("upgrade","websocket"),Goe(n,i,async()=>{if(n instanceof URL){const c=new globalThis.WebSocket(n,t.protocols);return c.binaryType="arraybuffer",c}const{addresses:o,httpPath:a}=y4(n);return new Ooe(o,new URL(`http://${m4(n,i.headers)}${decodeURIComponent(a)}`),this.components.connectionManager,i)})}async fetch(e,t={}){const n=Yu(e),s={...t,headers:wl(t),method:"GET",middleware:[this.origin,this.cookies,...t.middleware?.map(o=>o(this.components))??[]]},i=await Woe(n,s,async()=>this.sendRequest(n,t));return Yoe(n,s,i)}async connectProtocol(e,t,n){const s=await this.getProtocolPath(e,t,n),i=Yu(e,s);return this.connect(i,n)}async fetchProtocol(e,t,n={}){const s=await this.getProtocolPath(e,t,n),i=Yu(e,s);return this.fetch(i,n)}async getSupportedProtocols(e,t={}){const n=Yu(e,mD),s=await this.fetch(n,{method:"GET",headers:{Accept:"application/json"},signal:t.signal});if(s.status!==200)throw new Error(`Unexpected status code: ${s.status}`);return s.json()}async getProtocolPath(e,t,n={}){const s=await this.getSupportedProtocols(e,n);if(s[t]==null)throw new Error(`Peer does not serve protocol: ${t}`);return s[t].path}canHandle(e){return this.httpRegistrar.canHandle(e)}async onRequest(e){return this.httpRegistrar.onRequest(e)}onWebSocket(e){this.httpRegistrar.onWebSocket(e)}handle(e,t){this.httpRegistrar.handle(e,t)}unhandle(e){this.httpRegistrar.unhandle(e)}getProtocolMap(){return this.httpRegistrar.getProtocolMap()}async sendRequest(e,t){if(e instanceof URL)return this.log("making request to %s with global fetch"),globalThis.fetch(e,t);this.log("making request to %s with libp2p fetch",e);const n=m4(e,wl(t)),{addresses:s,httpPath:i}=y4(e),a=await(await this.components.connectionManager.openConnection(s,{signal:t.signal??void 0})).newStream(w4,{signal:t.signal??void 0});return Eoe(a,new URL(`http://${n}${decodeURIComponent(i)}`),t)}}function Xoe(r={}){return e=>new Qoe(e,r)}const Joe="0.1.0",Zoe="id",eae="id/push",tae="1.0.0",rae="1.0.0",nae=1024*8,sae=32,iae=1e3;var Yl;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const i of t.listenAddrs)n.uint32(18),n.bytes(i);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const i of t.protocols)n.uint32(26),n.string(i);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 5:{i.protocolVersion=t.string();break}case 6:{i.agentVersion=t.string();break}case 1:{i.publicKey=t.bytes();break}case 2:{if(s.limits?.listenAddrs!=null&&i.listenAddrs.length===s.limits.listenAddrs)throw new Ir('Decode error - map field "listenAddrs" had too many elements');i.listenAddrs.push(t.bytes());break}case 4:{i.observedAddr=t.bytes();break}case 3:{if(s.limits?.protocols!=null&&i.protocols.length===s.limits.protocols)throw new Ir('Decode error - map field "protocols" had too many elements');i.protocols.push(t.string());break}case 8:{i.signedPeerRecord=t.bytes();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Yl||(Yl={}));const Vn={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:nae,runOnConnectionOpen:!0,runOnSelfUpdate:!0,runOnLimitedConnection:!0,concurrency:sae};function oae(r){if(r!=null&&r.length>0)try{return Ye(r)}catch{}}async function yD(r,e,t,n,s){if(t("received identify from %p",n.remotePeer),s==null)throw new Bt("message was null or undefined");const i={};if(s.listenAddrs.length>0&&(i.addresses=s.listenAddrs.map(c=>({isCertified:!1,multiaddr:Ye(c)}))),s.protocols.length>0&&(i.protocols=s.protocols),s.publicKey!=null){const c=Cs(s.publicKey);if(!Fl(c).equals(n.remotePeer))throw new Bt("public key did not match remote PeerId");i.publicKey=c}let o;if(s.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=s.signedPeerRecord;const l=await Zs.openAndCertify(c,In.DOMAIN);let u=In.createFromProtobuf(l.payload);const h=xu(l.publicKey.toCID());if(!u.peerId.equals(h))throw new Bt("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new Bt("signing key does not match remote PeerId");let d;try{d=await r.get(u.peerId)}catch(f){if(f.name!=="NotFoundError")throw f}if(d!=null&&(i.metadata=d.metadata,d.peerRecordEnvelope!=null)){const f=Zs.createFromProtobuf(d.peerRecordEnvelope),g=In.createFromProtobuf(f.payload);g.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",g.seqNumber,u.seqNumber),u=g,c=d.peerRecordEnvelope)}i.peerRecordEnvelope=c,i.addresses=u.multiaddrs.map(f=>({isCertified:!0,multiaddr:f})),o={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,i),await r.patch(n.remotePeer,i),s.agentVersion!=null||s.protocolVersion!=null){const c={};s.agentVersion!=null&&(c.AgentVersion=le(s.agentVersion)),s.protocolVersion!=null&&(c.ProtocolVersion=le(s.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:s.protocolVersion,agentVersion:s.agentVersion,publicKey:s.publicKey,listenAddrs:s.listenAddrs.map(c=>Ye(c)),observedAddr:s.observedAddr==null?void 0:Ye(s.observedAddr),protocols:s.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class wD{host;components;protocol;started;timeout;maxInboundStreams;maxOutboundStreams;maxMessageSize;maxObservedAddresses;runOnLimitedConnection;log;constructor(e,t){this.protocol=t.protocol,this.started=!1,this.components=e,this.log=t.log,this.timeout=t.timeout??Vn.timeout,this.maxInboundStreams=t.maxInboundStreams??Vn.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Vn.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Vn.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Vn.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Vn.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Vn.protocolPrefix}/${Joe}`,agentVersion:e.nodeInfo.userAgent},this.handleProtocol=this.handleProtocol.bind(this)}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.merge(this.components.peerId,{metadata:{AgentVersion:le(this.host.agentVersion),ProtocolVersion:le(this.host.protocolVersion)}}),await this.components.registrar.handle(this.protocol,this.handleProtocol,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}}class aae extends wD{connectionManager;concurrency;_push;constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??Vn.protocolPrefix}/${eae}/${rae}`,log:e.logger.forComponent("libp2p:identify-push")}),this.connectionManager=e.connectionManager,this.concurrency=t.concurrency??Vn.concurrency,this._push=Rd(this.sendPushMessage.bind(this),t.debounce??iae),(t.runOnSelfUpdate??Vn.runOnSelfUpdate)&&e.events.addEventListener("self:peer:update",n=>{this.push().catch(s=>{this.log.error("error pushing updates to peers - %e",s)})})}[yr]=["@libp2p/identify-push"];async push(){this._push()}async sendPushMessage(){if(this.isStarted())try{const e=this.components.addressManager.getAddresses().map(u=>u.decapsulateCode(qe)),t=new In({peerId:this.components.peerId,multiaddrs:e}),n=await Zs.seal(t,this.components.privateKey),s=this.components.registrar.getProtocols(),i=await this.components.peerStore.get(this.components.peerId),o=he(i.metadata.get("AgentVersion")??le(this.host.agentVersion)),a=he(i.metadata.get("ProtocolVersion")??le(this.host.protocolVersion)),c=this;async function*l(){for(const u of c.connectionManager.getConnections())(await c.components.peerStore.get(u.remotePeer)).protocols.includes(c.protocol)&&(yield async()=>{let d;const f=AbortSignal.timeout(c.timeout);try{d=await u.newStream(c.protocol,{signal:f,runOnLimitedConnection:c.runOnLimitedConnection}),await Wr(d,{maxDataLength:c.maxMessageSize}).pb(Yl).write({listenAddrs:e.map(m=>m.bytes),signedPeerRecord:n.marshal(),protocols:s,agentVersion:o,protocolVersion:a},{signal:f}),await d.close({signal:f})}catch(g){d?.log.newScope("identify-push")?.error("could not push identify update to peer",g),d?.abort(g)}})}await jo(Ac(l(),{concurrency:this.concurrency}))}catch(e){this.log.error("error pushing updates to peers - %e",e)}}async handleProtocol(e,t){const n=e.log.newScope("identify-push");if(this.components.peerId.equals(t.remotePeer))throw new Error("received push from ourselves?");const s={signal:AbortSignal.timeout(this.timeout)},o=await Wr(e,{maxDataLength:this.maxMessageSize}).pb(Yl).read(s);await e.close(s),await yD(this.components.peerStore,this.components.events,n,t,o),n.trace("handled push from %p",t.remotePeer)}}class cae extends wD{constructor(e,t={}){super(e,{...t,protocol:`/${t.protocolPrefix??Vn.protocolPrefix}/${Zoe}/${tae}`,log:e.logger.forComponent("libp2p:identify")}),(t.runOnConnectionOpen??Vn.runOnConnectionOpen)&&e.events.addEventListener("connection:open",n=>{const s=n.detail;this.identify(s).catch(()=>{})})}[yr]=["@libp2p/identify"];async _identify(e,t={}){let n,s;if(t.signal==null){const i=AbortSignal.timeout(this.timeout);t={...t,signal:i}}this.log("run identify on new connection %a",e.remoteAddr);try{n=await e.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection}),s=n.log.newScope("identify");const i=Wr(n,{maxDataLength:this.maxMessageSize}).pb(Yl),o=await i.read(t);return await i.unwrap().unwrap().close(t),o}catch(i){throw s?.error("identify failed - %e",i),n?.abort(i),i}}async identify(e,t={}){const n=await this._identify(e,t),{publicKey:s,protocols:i,observedAddr:o}=n;if(s==null)throw new Bt("Public key was missing from identify message");const a=Cs(s),c=xu(a.toCID());if(!e.remotePeer.equals(c))throw new Bt("Identified peer does not match the expected peer");if(this.components.peerId.equals(c))throw new Bt("Identified peer is our own peer id?");return this.maybeAddObservedAddress(o),this.log("completed for peer %p and protocols %o",c,i),yD(this.components.peerStore,this.components.events,this.log,e,n)}maybeAddObservedAddress(e){const t=oae(e);if(t==null||(this.log.trace("our observed address was %a",t),Zn(t)))return;const n=t.getComponents();if((n[0].code===Xa||n[0].code===E5&&n[1].code===Xa)&&!lI(t)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}i0.exactMatch(t)||(this.log.trace("storing the observed address"),this.components.addressManager.addObservedAddr(t))}async handleProtocol(e,t){const n=e.log.newScope("identify");n("responding to identify");const s=AbortSignal.timeout(this.timeout),i=await this.components.peerStore.get(this.components.peerId,{signal:s}),o=this.components.addressManager.getAddresses().map(u=>u.decapsulateCode(qe));let a=i.peerRecordEnvelope;if(o.length>0&&a==null){const u=new In({peerId:this.components.peerId,multiaddrs:o});a=(await Zs.seal(u,this.components.privateKey,{signal:s})).marshal().subarray()}let c=t.remoteAddr.bytes;uX.matches(t.remoteAddr)||(c=void 0);const l=Wr(e).pb(Yl);n("send response"),await l.write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Qs(this.components.privateKey.publicKey),listenAddrs:o.map(u=>u.bytes),signedPeerRecord:a,observedAddr:c,protocols:i.protocols},{signal:s}),n("close write"),await l.unwrap().unwrap().close({signal:s})}}function lae(r={}){return e=>new cae(e,r)}function uae(r={}){return e=>new aae(e,r)}const Cu=1e3,C8=60*Cu,D2=60*C8,hae="/ipfs/kad/1.0.0",bD=48*D2,dae=24*D2,fae=10,pae=16384,gae=D2,CE=D2,mae=10*Cu,vD=20,N2=10,yae=5*C8,wae=Cu,bae=5*Cu,vae=5*C8,Eae=30*Cu,Sae=180*Cu,kE=`${Ug}-kad-dht`;var C0;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={key:ot(0),value:ot(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(C0||(C0={}));function _ae(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),s=String(r.getUTCHours()).padStart(2,"0"),i=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${s}:${i}:${o}.${c}Z`}function xae(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),s=parseInt(t[2],10)-1,i=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,s,i,o,a,c,l))}class Jn{key;value;timeReceived;constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return C0.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:_ae(this.timeReceived)}}static deserialize(e){const t=C0.decode(e);return new Jn(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=xae(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Jn(e.key,e.value,t)}}class k0 extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class Aae extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class Cae extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var IE;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.key=t.bytes();break}case 2:{i.value=t.bytes();break}case 3:{i.author=t.bytes();break}case 4:{i.signature=t.bytes();break}case 5:{i.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(IE||(IE={}));var zt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(zt||(zt={}));var I0;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(I0||(I0={}));(function(r){r.codec=()=>nn(I0)})(zt||(zt={}));var Ql;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(Ql||(Ql={}));var b4;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})(b4||(b4={}));(function(r){r.codec=()=>nn(b4)})(Ql||(Ql={}));var Zc;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const i of t.multiaddrs)n.uint32(18),n.bytes(i);t.connection!=null&&(n.uint32(24),Ql.codec().encode(t.connection,n)),s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={id:ot(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.id=t.bytes();break}case 2:{if(s.limits?.multiaddrs!=null&&i.multiaddrs.length===s.limits.multiaddrs)throw new Ir('Decode error - map field "multiaddrs" had too many elements');i.multiaddrs.push(t.bytes());break}case 3:{i.connection=Ql.codec().decode(t);break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(Zc||(Zc={}));var bl;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{if(s.lengthDelimited!==!1&&n.fork(),t.type!=null&&I0[t.type]!==0&&(n.uint32(8),zt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const i of t.closer)n.uint32(66),Zc.codec().encode(i,n);if(t.providers!=null)for(const i of t.providers)n.uint32(74),Zc.codec().encode(i,n);s.lengthDelimited!==!1&&n.ldelim()},(t,n,s={})=>{const i={type:zt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{i.type=zt.codec().decode(t);break}case 10:{i.clusterLevel=t.int32();break}case 2:{i.key=t.bytes();break}case 3:{i.record=t.bytes();break}case 8:{if(s.limits?.closer!=null&&i.closer.length===s.limits.closer)throw new Ir('Decode error - map field "closer" had too many elements');i.closer.push(Zc.codec().decode(t,t.uint32(),{limits:s.limits?.closer$}));break}case 9:{if(s.limits?.providers!=null&&i.providers.length===s.limits.providers)throw new Ir('Decode error - map field "providers" had too many elements');i.providers.push(Zc.codec().decode(t,t.uint32(),{limits:s.limits?.providers$}));break}default:{t.skipType(a&7);break}}}return i})),e),r.encode=t=>et(t,r.codec()),r.decode=(t,n)=>Ze(t,r.codec(),n)})(bl||(bl={}));function TE(r,e={}){const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return e.onProgress?.(new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function v4(r,e={}){const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return e.onProgress?.(new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function Ty(r,e={}){const t={...r,name:"FINAL_PEER",type:2};return e.onProgress?.(new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function Xl(r,e={}){const t={...r,name:"QUERY_ERROR",type:3};return e.onProgress?.(new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function RE(r,e={}){const t={...r,name:"PROVIDER",type:4};return e.onProgress?.(new CustomEvent("kad-dht:query:provider",{detail:t})),t}function E4(r,e={}){const t={...r,name:"VALUE",type:5};return e.onProgress?.(new CustomEvent("kad-dht:query:value",{detail:t})),t}function PE(r,e={}){const t={...r,name:"DIAL_PEER",type:7};return e.onProgress?.(new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function kae(r,e={}){const t={...r,name:"PATH_ENDED",type:8};return e.onProgress?.(new CustomEvent("kad-dht:query:path-ended",{detail:t})),t}function Iae(r,e,t){if(t.length===0)throw new ue("No records given");const s=he(e).split("/");if(s.length<3)throw new ue("Record key does not have a selector function");const i=r[s[1].toString()];if(i==null)throw new Cae(`No selector function configured for key type "${s[1]}"`);return t.length===1?0:i(e,t)}function Tae(r,e){return 0}const Rae={pk:Tae};async function k8(r,e,t){const n=e.key,i=he(n).split("/");if(i.length<3)return;const o=r[i[1].toString()];if(o==null)throw new ue(`No validator available for key type "${i[1]}"`);await o(n,e.value,t)}const Pae=async(r,e,t)=>{if(!(r instanceof Uint8Array))throw new ue('"key" must be a Uint8Array');if(r.byteLength<5)throw new ue("Invalid public key record");if(he(r.subarray(0,4))!=="/pk/")throw new ue("key was not prefixed with /pk/");const s=Cs(e),i=r.slice(4);if(!Qe(i,s.toMultihash().bytes))throw new ue("public key does not match passed in key")},Dae={pk:Pae},Nae=le("/pk/");function Oae(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>!Zn(e))}}async function jd(r,e){const t=await Zt.digest(r);return e?.signal?.throwIfAborted(),t.digest}async function Ki(r,e){return jd(r.toMultihash().bytes,e)}function Xh(r,e){return new Pt(`${r}/${he(e,"base32")}`,!1)}function Lae(r){return Wt([Nae,r.toMultihash().bytes])}function Bae(r){return he(r.subarray(0,4))==="/pk/"}function Mae(r){const e=wr(r.subarray(4));return Ps(e)}function DE(r,e){const t=new Date;return new Jn(r,e,t).serialize()}function ED(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:Ee.createV1(As,wr(le(n,"base32"))),peerId:On(t)}}function Ry(r,e,t){const n=typeof e=="string"?e:he(e.multihash.bytes,"base32"),s=[r,n];return t!=null&&s.push(t.toString()),new Pt(s.join("/"))}function SD(r){return new Date(Ts(r))}function Mc(r,e,t){return async function*(...n){const s=e.queryTime?.timer(t),i=e.errorTime?.timer(t);let o=!1;try{e.queries?.increment({[t]:!0}),yield*r(...n)}catch(a){throw o=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),o||s?.()}}}function _D(r,e,t){return async function(...n){const s=e?.queryTime?.timer(t),i=e?.errorTime?.timer(t);let o=!1;try{return e.queries?.increment({[t]:!0}),await r(...n)}catch(a){throw o=!0,i?.(),e.errors?.increment({[t]:!0}),a}finally{e.queries?.decrement({[t]:!0}),o||s?.()}}}class $ae{log;components;validators;selectors;peerRouting;queryManager;network;datastorePrefix;constructor(e,t){const{validators:n,selectors:s,peerRouting:i,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=s,this.peerRouting=i,this.queryManager=o,this.network=a,this.get=e.metrics?.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1})??this.get,this.put=e.metrics?.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2})??this.put}async getLocal(e,t){this.log("getLocal %b",e);const n=Xh(this.datastorePrefix,e);this.log("fetching record for key %k",n);const s=await this.components.datastore.get(n,t);this.log("found %k in local datastore",n);const i=Jn.deserialize(s);return await k8(this.validators,i,t),i}async*sendCorrectionRecord(e,t,n,s){this.log("sendCorrection for %b",e);const i=DE(e,n);for(const{value:o,from:a}of t){if(Qe(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=Xh(this.datastorePrefix,e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,i.subarray(),s)}catch(u){this.log.error("failed error correcting self - %e",u)}continue}let c=!1;const l={type:zt.PUT_VALUE,key:e,record:i};for await(const u of this.network.sendRequest(a,l,s))u.name==="PEER_RESPONSE"&&u.record!=null&&Qe(u.record.value,Jn.deserialize(i).value)&&(c=!0),yield u;if(!c)throw new k0("Could not send correction");this.log.error("failed error correcting entry")}}async*put(e,t,n){this.log("put key %b value %b",e,t);const s=DE(e,t),i=Xh(this.datastorePrefix,e);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,s.subarray(),n),yield*wc(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>oa(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:zt.PUT_VALUE,key:e,record:s};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,l,{...n,path:a.path}))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&Qe(u.record.value,Jn.deserialize(s).value)||c.push(Xl({from:a.peer.id,error:new k0("Value not put correctly"),path:u.path},n)));return c}),o=>Ac(o,{ordered:!1,concurrency:N2}),async function*(o){for await(const a of o)yield*a})}async*get(e,t){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t)){if(a.name==="VALUE"){n.push(a);continue}yield a}if(n.length===0)return;const s=n.map(a=>a.value);let i=0;try{i=Iae(this.selectors,e,s)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=s[i];if(this.log("GetValue %b %b",e,o),o==null)throw new dn("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,{...t,path:{index:-1,queued:0,running:0,total:0}}),yield n[i]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const i=await this.getLocal(e,t);yield E4({value:i.value,from:this.components.peerId,path:{index:-1,running:0,queued:0,total:0}},t)}catch(i){this.log("error getting local value for %b",e,i)}const n=this,s=async function*({peer:i,signal:o,path:a}){for await(const c of n.peerRouting.getValueOrPeers(i.id,e,{...t,signal:o,path:a}))yield c,c.name==="PEER_RESPONSE"&&c.record!=null&&(yield E4({from:i.id,value:c.record.value,path:a},t))};yield*this.queryManager.run(e,s,t)}}function Uae(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function O1(r){if(r.id==null)throw new Error("Invalid peer in message");const e=wr(r.id);return{id:Ps(e),multiaddrs:(r.multiaddrs??[]).map(t=>Ye(t))}}class Fae{log;components;network;peerRouting;queryManager;routingTable;providers;constructor(e,t){const{network:n,peerRouting:s,queryManager:i,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.providers=a,this.findProviders=e.metrics?.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PROVIDER"&&(u.providers??=[],u.providers.push(...l.providers.map(h=>h.id.toString()))),u)})??this.findProviders,this.provide=e.metrics?.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(l,u)=>(l.name==="PEER_RESPONSE"&&l.messageName==="ADD_PROVIDER"&&(u.providers??=[],u.providers.push(l.from.toString())),u)})??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const s=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId,n);const i={type:zt.ADD_PROVIDER,key:s,providers:[Uae({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=this;async function*c(h){try{a.log("sending provider record for %s to %p",e,h.peer.id);for await(const d of a.network.sendMessage(h.peer.id,i,{...n,path:h.path}))d.name==="PEER_RESPONSE"&&(a.log("sent provider record for %s to %p",e,h.peer.id),o++),yield d}catch(d){a.log.error("error sending provide record to peer %p - %e",h.peer.id,d),yield Xl({from:h.peer.id,error:d,path:h.path},n)}}const l=to({objectMode:!0}),u=new Qo({concurrency:N2});u.addEventListener("idle",()=>{l.end()}),u.addEventListener("failure",h=>{this.log.error("error publishing provider record to peer - %e",h.detail.error)}),u.add(async()=>{const h=[];for await(const d of this.peerRouting.getClosestPeers(s,n))l.push(d),d.name==="FINAL_PEER"&&h.push(d);h.forEach(d=>{u.add(async()=>{for await(const f of c(d))l.push(f)}).catch(f=>{this.log.error("error publishing provider record to peer - %e",f)})})}).catch(h=>{l.end(h)}),yield*l,this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let s=0;const i=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e,t);if(a.length>0){const u=[];for(const h of a.slice(0,n))try{const d=await this.components.peerStore.get(h,t);u.push({id:h,multiaddrs:d.addresses.map(({multiaddr:f})=>f)})}catch(d){if(d.name!=="NotFoundError")throw d;this.log("no peer store entry for %p",h)}if(yield v4({from:this.components.peerId,messageType:zt.GET_PROVIDERS,providers:u,path:{index:-1,queued:0,running:0,total:0}},t),yield RE({from:this.components.peerId,providers:u,path:{index:-1,queued:0,running:0,total:0}},t),s+=u.length,s>=n)return}const c=async function*({peer:u,signal:h,path:d}){const f={type:zt.GET_PROVIDERS,key:i};yield*o.network.sendRequest(u.id,f,{...t,signal:h,path:d})},l=new Js(a);for await(const u of this.queryManager.run(i,c,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const h=[];for(const d of u.providers)l.has(d.id)||(l.add(d.id),h.push(d));if(h.length>0&&(yield RE({from:u.from,providers:h,path:u.path},t),s+=h.length,s>=n))return}}}class Vae extends Nt{log;protocol;running;components;timeout;metrics;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:network`),this.running=!1,this.protocol=t.protocol,this.timeout=new Pd({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=e.metrics?.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([n,s],i){return{...i,to:n.toString(),"message type":`${s.type}`}},getAttributesFromYieldedValue:(n,s)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,o)=>{s[`providers-${o}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,o)=>{s[`closer-${o}`]=i.id.toString()})),s)})??this.sendRequest,this.sendMessage=e.metrics?.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([n,s],i){return{...i,to:n.toString(),"message type":`${s.type}`}},getAttributesFromYieldedValue:(n,s)=>(n.name==="PEER_RESPONSE"&&(n.providers.length>0&&n.providers.forEach((i,o)=>{s[`providers-${o}`]=i.id.toString()}),n.closer.length>0&&n.closer.forEach((i,o)=>{s[`closer-${o}`]=i.id.toString()})),s)})??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n){if(!this.running)return;const s=t.type;if(s==null)throw new ue("Message type was missing");let i;const o=this.timeout.getTimeoutSignal(n);n={...n,signal:o};try{this.metrics.operations?.increment({[s]:!0}),this.log("dialling %p",e),yield PE({peer:e,path:n.path},n),i=await this.components.connectionManager.openStream(e,this.protocol,n),this.log("sending %s to %p",t.type,e),yield TE({to:e,type:s,path:n.path},n);const a=await this._writeReadMessage(i,t,n);i.close(n).catch(c=>{this.log.error("error closing stream to %p - %e",e,c),i?.abort(c)}),yield v4({from:e,messageType:a.type,closer:a.closer.map(O1),providers:a.providers.map(O1),record:a.record==null?void 0:Jn.deserialize(a.record),path:n.path},n)}catch(a){this.metrics.errors?.increment({[s]:!0}),i?.abort(a),n.signal?.aborted!==!0&&this.log.error("could not send %s to %p - %e",t.type,e,a),yield Xl({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(o)}}async*sendMessage(e,t,n){if(!this.running)return;const s=t.type;if(s==null)throw new ue("Message type was missing");let i;const o=this.timeout.getTimeoutSignal(n);n={...n,signal:o};try{this.metrics.operations?.increment({[s]:!0}),this.log("dialling %p",e),yield PE({peer:e,path:n.path},n),i=await this.components.connectionManager.openStream(e,this.protocol,n),this.log("sending %s to %p",t.type,e),yield TE({to:e,type:s,path:n.path},n),await this._writeMessage(i,t,n),i.close(n).catch(a=>{this.log.error("error closing stream to %p - %e",e,a),i?.abort(a)}),yield v4({from:e,messageType:s,path:n.path},n)}catch(a){this.metrics.errors?.increment({[s]:!0}),i?.abort(a),yield Xl({from:e,error:a,path:n.path},n)}finally{this.timeout.cleanUp(o)}}async _writeMessage(e,t,n){await Wr(e).write(t,bl,n)}async _writeReadMessage(e,t,n){const s=Wr(e);await s.write(t,bl,n);const i=await s.read(bl,n);return i.closer.forEach(o=>{this.safeDispatchEvent("peer",{detail:O1(o)})}),i.providers.forEach(o=>{this.safeDispatchEvent("peer",{detail:O1(o)})}),i}}function Jh(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class I8{originDhtKey;capacity;peerDistances;constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return[...this.peerDistances]}async add(e,t={index:-1,queued:0,running:0,total:0},n){const s=await Ki(e.id,n);this.addWithKadId(e,s,t)}addWithKadId(e,t,n={index:-1,queued:0,running:0,total:0}){if(this.peerDistances.find(o=>o.peer.id.equals(e.id))!=null)return;const s={peer:e,distance:ql(this.originDhtKey,t),path:n};if(this.peerDistances.length===this.capacity){const o=this.peerDistances[this.peerDistances.length-1];if(o!=null&&Jh(s.distance,o.distance)!==-1)return}let i=!1;for(let o=0;o<this.peerDistances.length;o++){const a=Jh(this.peerDistances[o].distance,s.distance);if(a===0||a===1){i=!0,this.peerDistances.splice(o,0,s);break}}i||this.peerDistances.push(s),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e,t){if(this.length===0)return!0;const n=await Ki(e,t),s=ql(n,this.originDhtKey),i=this.peerDistances[this.peerDistances.length-1].distance;return Jh(s,i)===-1}async anyCloser(e,t){return e.length===0?!1:Promise.any(e.map(async n=>this.isCloser(n,t)))}}class zae{log;routingTable;network;validators;queryManager;components;constructor(e,t){this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=e.metrics?.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1})??this.findPeer,this.getClosestPeers=e.metrics?.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1})??this.getClosestPeers}async findPeerLocal(e,t){let n;const s=await this.routingTable.find(e,t);if(s!=null){this.log("findPeerLocal found %p in routing table",e);try{n=await this.components.peerStore.get(s,t)}catch(i){if(i.name!=="NotFoundError")throw i}}if(n==null)try{n=await this.components.peerStore.get(e,t)}catch(i){if(i.name!=="NotFoundError")throw i}if(n!=null)return this.log("findPeerLocal found %p in peer store",e),{id:n.id,multiaddrs:n.addresses.map(i=>i.multiaddr)}}async*_getValueSingle(e,t,n){const s={type:zt.GET_VALUE,key:t};yield*this.network.sendRequest(e,s,n)}async*getPublicKeyFromNode(e,t={}){const n=Lae(e),s={index:-1,queued:0,running:0,total:0};for await(const i of this._getValueSingle(e,n,{...t,path:s}))if(yield i,i.name==="PEER_RESPONSE"&&i.record!=null){const o=Cs(i.record.value),a=Fl(o);if(!a.equals(e))throw new Pp("public key does not match id");if(a.publicKey==null)throw new Pp("public key missing");yield E4({from:e,value:i.record.value,path:s},t)}throw new k0(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const s=await this.findPeerLocal(e,t);if(s!=null){this.log("found local"),yield Ty({from:this.components.peerId,peer:s,path:{index:-1,queued:0,running:0,total:0}},t);return}}let n=!1;if(t.useNetwork!==!1){const s=this,i=async function*({peer:o,signal:a,path:c}){const l={type:zt.FIND_NODE,key:e.toMultihash().bytes};for await(const u of s.network.sendRequest(o.id,l,{...t,signal:a,path:c}))if(yield u,u.name==="PEER_RESPONSE"){const h=u.closer.find(d=>d.id.equals(e));h!=null&&(yield Ty({from:u.from,peer:h,path:u.path},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,i,t))o.name==="FINAL_PEER"&&(n=!0),yield o}if(!n)throw new dn("Not found")}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await jd(e,t),s=new I8(n,this.routingTable.kBucketSize),i=this,o=async function*({peer:a,path:c,peerKadId:l,signal:u}){i.log("getClosestPeers asking %p",a.id);const h={type:zt.FIND_NODE,key:e};yield*i.network.sendRequest(a.id,h,{...t,signal:u,path:c}),s.addWithKadId(a,l,c)};yield*this.queryManager.run(e,o,t),this.log("found %d peers close to %b",s.length,e);for(let{peer:a,path:c}of s.peers)try{if(a.multiaddrs.length===0&&(a=await i.components.peerStore.getInfo(a.id,t)),a.multiaddrs.length===0)continue;yield Ty({from:this.components.peerId,peer:await i.components.peerStore.getInfo(a.id,t),path:{index:c.index,queued:0,running:0,total:0}},t)}catch{continue}}async*getValueOrPeers(e,t,n){for await(const s of this._getValueSingle(e,t,n)){if(s.name==="PEER_RESPONSE"&&s.record!=null)try{await this._verifyRecordOnline(s.record,n)}catch{const o="invalid record received, discarded";this.log(o),yield Xl({from:s.from,error:new k0(o),path:n.path},n);continue}yield s}}async _verifyRecordOnline(e,t){if(e.timeReceived==null)throw new Aae("invalid record received");await k8(this.validators,new Jn(e.key,e.value,e.timeReceived),t)}async getClosestPeersOffline(e,t){const n=[];try{const o=wr(e),a=Ps(o),c=await this.components.peerStore.get(a,t);n.push({id:c.id,multiaddrs:c.addresses.map(({multiaddr:l})=>l)})}catch{}const s=await jd(e,t),i=this.routingTable.closestPeers(s,t);for(const o of i)try{n.push(await this.components.peerStore.getInfo(o,t))}catch(a){if(a.name!=="NotFoundError")throw a}return n.length>0?this.log("getClosestPeersOffline returning the %d closest peer(s) we know to %b",n.length,e):this.log("getClosestPeersOffline could not any peers close to %b with %d peers in the routing table",e,this.routingTable.size),n}}class Hae{log;datastore;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore}async addProvider(e,t,n){this.log.trace("%p provides %s",t,e),await this.writeProviderEntry(e,t,n)}async removeProvider(e,t,n){const s=Ry(this.datastorePrefix,e,t);this.log.trace("%p no longer provides %s",t,e),await this.datastore.delete(s,n)}async getProviders(e,t){this.log.trace("get providers for %c",e);const n=await this.loadProviders(e,t);return this.log.trace("got %d providers for %c",n.size,e),[...n.keys()]}async writeProviderEntry(e,t,n){const s=Ry(this.datastorePrefix,e,t),i=Ys(n?.time?.getTime()??Date.now());await this.datastore.put(s,i,n)}async loadProviders(e,t){const n=new xc,s=Ry(this.datastorePrefix,e);for await(const i of this.datastore.query({prefix:s.toString()},t)){const{peerId:o}=ED(i.key);n.set(o,SD(i.value))}return n}}async function*qae(r){const{key:e,startingPeers:t,ourPeerId:n,query:s,alpha:i,path:o,numPaths:a,log:c,peersSeen:l,connectionManager:u,signal:h}=r,d=to({objectMode:!0}),f=new Qo({concurrency:i,sort:(b,v)=>Jh(b.options.distance,v.options.distance)});f.addEventListener("idle",()=>{d.push(kae({path:{index:o,queued:f.queued,running:f.running,total:f.size}},r)),d.end()}),f.addEventListener("failure",b=>{c.error("error during query - %e",b.detail.error)});const g=()=>{f.abort(),d.end(new Ka)};h.addEventListener("abort",g);try{let v=function(A,w){if(A==null)return;l.add(A.id.toMultihash().bytes);const E=ql(w,b);f.add(async()=>{try{for await(const x of s({...r,key:e,peer:A,path:{index:o,queued:f.queued,running:f.running,total:f.size},numPaths:a,peerKadId:w,signal:h})){if(x.name==="PEER_RESPONSE")for(const P of x.closer){if(l.has(P.id.toMultihash().bytes)){c("already seen %p in query",P.id);continue}if(n.equals(P.id)){c("not querying ourselves");continue}if(!await u.isDialable(P.multiaddrs)){c("not querying undialable peer");continue}const T=await Ki(P.id,{signal:h}),D=ql(T,b);if(Jh(D,E)!==-1){c("skipping %p as they are not closer to %b than %p",P.id,e,A.id);continue}c("querying closer peer %p",P.id),v(P,T)}d.push({...x,path:{index:o,queued:f.queued,running:f.running,total:f.size}})}}catch(x){d.push(Xl({from:A.id,error:x,path:{index:o,queued:f.queued,running:f.running-1,total:f.size-1}},r))}},{distance:E}).catch(x=>{c.error("error during query - %e",x)})};var m=v;const b=await jd(e,{signal:h});await Promise.all(t.map(async A=>{v({id:A,multiaddrs:[]},await Ki(A,{signal:h}))})),yield*d}finally{h.removeEventListener("abort",g)}}class Kae{disjointPaths;alpha;shutDownController;running;logger;peerId;connectionManager;routingTable;initialQuerySelfHasRun;logPrefix;allowQueryWithZeroPeers;constructor(e,t){this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??vD,this.alpha=t.alpha??N2,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.allowQueryWithZeroPeers=t.allowQueryWithZeroPeers??!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(Sae);n={...n,signal:c}}const s=new AbortController,i=xt([this.shutDownController.signal,s.signal,n.signal]);s.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+he(e,"base58btc"));let a=!1;try{this.routingTable.size===0&&!this.allowQueryWithZeroPeers&&(o("routing table was empty, waiting for some peers before running%s query",n.isSelfQuery===!0?" self":""),await sr(this.routingTable,"peer:add",{signal:i,filter:f=>!this.peerId.equals(f.detail)}),o("routing table has peers, continuing with%s query",n.isSelfQuery===!0?" self":"")),n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial self query before continuing"),await es(this.initialQuerySelfHasRun.promise,i),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await jd(e,{signal:i}),l=this.routingTable.closestPeers(c,{count:this.routingTable.kBucketSize}),u=l.sort(()=>Math.random()>.5?1:-1).reduce((f,g,m)=>(f[m%this.disjointPaths].push(g),f),new Array(this.disjointPaths).fill(0).map(()=>[])).filter(f=>f.length>0);if(l.length===0){o.error("running query with no peers");return}const h=Yo(1024),d=u.map((f,g)=>qae({...n,key:e,startingPeers:f,ourPeerId:this.peerId,signal:i,query:t,path:g,numPaths:u.length,alpha:this.alpha,log:o,peersSeen:h,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const f of Bo(...d)){if(f.name==="QUERY_ERROR"&&o.error("query error - %e",f.error),f.name==="PEER_RESPONSE")for(const g of[...f.closer,...f.providers])await this.connectionManager.isDialable(g.multiaddrs,{signal:i})&&await this.routingTable.add(g.id,{signal:i});i.throwIfAborted(),yield f}a=!0}catch(c){if(this.running)throw c}finally{a||(o("query exited early"),s.abort()),i.clear(),o("query finished")}}}function jae(r){return r[Symbol.asyncIterator]!=null}function xD(r){if(jae(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}class Wae{log;peerId;peerRouting;events;count;interval;initialInterval;queryTimeout;running;timeoutId;controller;initialQuerySelfHasRun;querySelfPromise;constructor(e,t){this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.events=e.events,this.running=!1,this.peerRouting=t.peerRouting,this.count=t.count??vD,this.interval=t.interval??yae,this.initialInterval=t.initialInterval??wae,this.queryTimeout=t.queryTimeout??bae,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=_D(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query - %e",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=Lt(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=xt(e);this.controller.signal;try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),s=await wc(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),o=>r0(o,this.count),async o=>xD(o));t?.throwIfAborted();const i=Date.now()-n;this.log("self-query found %d peers in %dms",s,i),this.events.dispatchEvent(new CustomEvent("kad-dht:query:self",{detail:{peers:s,duration:i}}))}catch(n){this.log.error("self-query error - %e",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query - %e",e)})},this.interval))}}class Gae extends Nt{log;reprovideQueue;maxQueueSize;datastore;timeout;reprovideTimeout;running;shutdownController;reprovideThreshold;contentRouting;datastorePrefix;addressManager;validity;interval;peerId;constructor(e,t){super(),this.log=e.logger.forComponent(`${t.logPrefix}:reprovider`),this.peerId=e.peerId,this.reprovideQueue=new Qo({concurrency:t.concurrency??fae,metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Pd({...t.timeout??{},metrics:e.metrics,metricName:`${t.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=e.datastore,this.addressManager=e.addressManager,this.datastorePrefix=`${t.datastorePrefix}/provider`,this.reprovideThreshold=t.threshold??dae,this.maxQueueSize=t.maxQueueSize??pae,this.validity=t.validity??bD,this.interval=t.interval??gae,this.contentRouting=t.contentRouting,this.running=!1,this.reprovide=_D(this.reprovide.bind(this),t.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.processRecords({signal:AbortSignal.timeout(CE)}).catch(e=>{this.log.error("error running process to reprovide/cleanup - %e",e)})},this.interval))}stop(){this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),this.shutdownController?.abort()}async processRecords(e){try{this.safeDispatchEvent("reprovide:start"),this.log("starting reprovide/cleanup");for await(const t of this.datastore.query({prefix:this.datastorePrefix},e))try{const{cid:n,peerId:s}=ED(t.key),o=SD(t.value).getTime()+this.validity,a=Date.now(),c=a>o,l=this.peerId.equals(s);this.log.trace("comparing: %d (now) < %d (expires) = %s %s",a,o,c,c?"(expired)":"(valid)"),c&&!l&&await this.datastore.delete(t.key,e),this.shouldReprovide(l,o)&&(this.log("reproviding %c as it is within the reprovide threshold (%d)",n,this.reprovideThreshold),this.queueReprovide(n).catch(u=>{this.log.error("could not reprovide %c - %e",n,u)}))}catch(n){this.log.error("error processing datastore key %s - %s",t.key,n.message)}this.log("reprovide/cleanup successful")}finally{this.safeDispatchEvent("reprovide:end"),this.running&&(this.log("queuing next re-provide/cleanup run in %d ms",this.interval),this.timeout=setTimeout(()=>{this.processRecords({signal:AbortSignal.timeout(CE)}).catch(t=>{this.log.error("error running re-provide - %e",t)})},this.interval))}}shouldReprovide(e,t){if(!e)return!1;const n=Date.now();return t<n?!0:t-n<this.reprovideThreshold}async queueReprovide(e,t){if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",e),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize,t);const n=this.reprovideQueue.queue.find(s=>s.options.cid.equals(e));if(n!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",e),n.join();this.log.trace("adding %c to re-provide queue",e),this.reprovideQueue.add(async s=>{if(s.signal?.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",e);const i=this.reprovideTimeout.getTimeoutSignal(s);try{await this.reprovide(s.cid,s)}finally{this.reprovideTimeout.cleanUp(i)}this.log.trace("re-provided %c",e)},{signal:this.shutdownController?.signal,cid:e}).catch(s=>{this.log.error("could not re-provide key %c - %e",e,s)})}async reprovide(e,t){await jo(this.contentRouting.provide(e,this.addressManager.getAddresses(),t))}}const Yae=20,Qae=5e3,Xae="kad-close",Jae=50;class Zae{routingTable;components;closestPeers;newPeers;refreshInterval;peerSetSize;timeout;closeTagName;closeTagValue;log;running;constructor(e,t){this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??Qae,this.peerSetSize=t.peerSetSize??Yae,this.closeTagName=t.closeTagName??Xae,this.closeTagValue=t.closeTagValue??Jae,this.closestPeers=new Js,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await Ki(this.components.peerId);this.newPeers=new I8(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){this.newPeers?.add({id:e.detail,multiaddrs:[]}).catch(t=>{this.log.error("error adding peer to distance list - %e",t)})}async updatePeerTags(){const e=new Js(this.newPeers?.peers.map(({peer:s})=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[kE]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[kE]:void 0}})})])}}function ip(r){return Array.isArray(r?.peers)}class ece{peerId;root;localPeer;prefixLength;splitThreshold;kBucketSize;numberOfNodesToPing;lastPingThreshold;ping;verify;onAdd;onRemove;onMove;addingPeerMap;constructor(e,t){this.peerId=e.peerId,this.prefixLength=t.prefixLength??nce,this.kBucketSize=t.kBucketSize??T8,this.splitThreshold=t.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=t.numberOfOldContactsToPing??oce,this.lastPingThreshold=t.lastPingThreshold??uce,this.ping=t.ping,this.verify=t.verify,this.onAdd=t.onAdd,this.onRemove=t.onRemove,this.addingPeerMap=i2({name:`${t.metricsPrefix}_adding_peer_map`,metrics:e.metrics}),this.root={prefix:"",depth:0,peers:[]}}async start(){await this.addSelfPeer(this.peerId)}stop(){this.addingPeerMap.clear(),this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e,t){this.localPeer={peerId:e,kadId:await Ki(e,t),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await Ki(e,t),lastPing:0},s=this.addingPeerMap.get(e);if(s!=null)return s;try{const i=this._add(n,t);this.addingPeerMap.set(e,i),await i}finally{this.addingPeerMap.delete(e)}}async _add(e,t){const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n,t),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!rce(e,this.lastPingThreshold)){n.peers.push(e),await this.onAdd?.(e,n,t);return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const s=n.peers.filter(o=>!(o.peerId.equals(this.localPeer?.peerId)||o.lastPing>Date.now()-this.lastPingThreshold)).sort((o,a)=>o.lastPing<a.lastPing?-1:o.lastPing>a.lastPing?1:0).slice(0,this.numberOfNodesToPing);let i=!1;for await(const o of this.ping(s,t))i=!0,await this.remove(o.kadId,t);i&&await this._add(e,t)}*closest(e,t){const n=new I8(e,t?.count??this.kBucketSize);for(const s of this.toIterable())t?.exclude?.some(i=>i.equals(s.peerId))!==!0&&n.addWithKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*oa(n.peers,({peer:s})=>s.id)}count(){function e(t){if(ip(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e,t){const n=this._determineBucket(e),s=this._indexOf(n,e);if(s>-1){const i=n.peers.splice(s,1)[0];await this.onRemove?.(i,n,t)}}*toIterable(){function*e(t){if(ip(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+he(ql(e,t),"base16"))}_determineBucket(e){const t=he(e,"base2");function n(s,i=0){return ip(s)?s:t[i]==="0"?n(s.left,i+1):n(s.right,i+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>Qe(n.kadId,t))}async _split(e,t){const n={prefix:"0",depth:e.depth+1,peers:[]},s={prefix:"1",depth:e.depth+1,peers:[]};for(const i of e.peers)he(i.kadId,"base2")[e.depth]==="0"?(n.peers.push(i),await this.onMove?.(i,e,n,t)):(s.peers.push(i),await this.onMove?.(i,e,s,t));tce(e,n,s)}}function tce(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function rce(r,e){return r.lastPing<Date.now()-e}const T8=20,nce=6,sce=20,ice=100,oce=3,ace=20,cce=100,NE="kad-peer",lce=1,uce=6e5,hce=!0,dce=1e3;class fce extends Nt{kBucketSize;kb;network;closestPeerTagger;log;components;running;pingNewContactTimeout;pingNewContactQueue;pingOldContactTimeout;pingOldContactQueue;populateFromDatastoreOnStart;populateFromDatastoreLimit;protocol;peerTagName;peerTagValue;metrics;shutdownController;constructor(e,t){super(),this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.kBucketSize=t.kBucketSize??T8,this.running=!1,this.protocol=t.protocol,this.network=t.network,this.peerTagName=t.peerTagName??NE,this.peerTagValue=t.peerTagValue??lce,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=t.populateFromDatastoreOnStart??hce,this.populateFromDatastoreLimit=t.populateFromDatastoreLimit??dce,this.shutdownController=new AbortController,this.shutdownController.signal,this.pingOldContactQueue=new Jo({concurrency:t.pingOldContactConcurrency??ace,metricName:`${t.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:t.pingOldContactMaxQueueSize??cce}),this.pingOldContactTimeout=new Pd({...t.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new Jo({concurrency:t.pingNewContactConcurrency??sce,metricName:`${t.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:t.pingNewContactMaxQueueSize??ice}),this.pingNewContactTimeout=new Pd({...t.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${t.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new ece(e,{kBucketSize:t.kBucketSize,prefixLength:t.prefixLength,splitThreshold:t.splitThreshold,numberOfOldContactsToPing:t.numberOfOldContactsToPing,lastPingThreshold:t.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved,metricsPrefix:t.metricsPrefix}),this.closestPeerTagger=new Zae(this.components,{logPrefix:t.logPrefix,routingTable:this,peerSetSize:t.closestPeerSetSize,refreshInterval:t.closestPeerSetRefreshInterval,closeTagName:t.closeTagName,closeTagValue:t.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${t.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${t.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,await oi(this.closestPeerTagger,this.kb))}async afterStart(){let e=0;Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;const t=xt([this.shutdownController.signal,AbortSignal.timeout(2e4)]);try{for(const n of await this.components.peerStore.all({filters:[s=>s.protocols.includes(this.protocol)&&s.tags.has(NE)],limit:this.populateFromDatastoreLimit,signal:t})){if(!this.running)return;try{await this.add(n.id,{signal:t}),e++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(n.id,{tags:{[this.peerTagName]:void 0}})}}}finally{t.clear()}this.log("added %d peer store peers to the routing table",e)}).catch(t=>{this.log.error("error adding %d, peer store peers to the routing table - %e",e,t)})}async stop(){this.running=!1,await eo(this.closestPeerTagger,this.kb),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort(),this.shutdownController.abort()}async peerAdded(e,t,n){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}},n),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:e.peerId})}async peerRemoved(e,t,n){this.components.peerId.equals(e.peerId)||await this.components.peerStore.merge(e.peerId,{tags:{[this.peerTagName]:void 0}},n),this.updateMetrics(),this.metrics?.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:e.peerId})}async*pingOldContacts(e,t){if(!this.running)return;const n=[];for(const s of e){if(this.kb.get(s.kadId)==null){this.log("asked to ping contact %p that was not in routing table",s.peerId);continue}this.metrics?.kadBucketEvents.increment({ping_old_contact:!0}),n.push(async()=>{const i=this.pingOldContactQueue.find(s.peerId);if(i!=null)return this.log("asked to ping contact %p was already being pinged",s.peerId),await i.join(t)?void 0:s;if(!await this.pingOldContactQueue.add(async a=>{const c=this.pingOldContactTimeout.getTimeoutSignal(),l=xt([c,this.shutdownController.signal,a?.signal]);try{return await this.pingContact(s,a)}catch{return this.metrics?.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(c),l.clear()}},{peerId:s.peerId,signal:t?.signal}))return s})}for await(const s of Ac(n))s!=null&&(yield s)}async verifyNewContact(e,t){const n=this.pingNewContactTimeout.getTimeoutSignal(),s=xt([n,this.shutdownController.signal,t?.signal]);try{const i=this.pingNewContactQueue.find(e.peerId);return i!=null?(this.log("joining existing ping to add new peer %p to routing table",e.peerId),await i.join({signal:s})):await this.pingNewContactQueue.add(async o=>(this.metrics?.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",e.peerId),this.pingContact(e,o)),{peerId:e.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",e.peerId),this.metrics?.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(n),s.clear()}}async pingContact(e,t){try{return this.log("pinging contact %p",e.peerId),await this.components.ping.ping(e.peerId,t),this.log("contact %p ping ok",e.peerId),this.safeDispatchEvent("peer:ping",{detail:e.peerId}),!0}catch(n){return this.log("error pinging old contact %p - %e",e.peerId,n),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(e,t){const n=await Ki(e,t);return this.kb.get(n)?.peerId}closestPeer(e){const t=this.closestPeers(e,{count:1});if(t.length>0)return t[0]}closestPeers(e,t){return this.kb==null?[]:[...this.kb.closest(e,t)]}async add(e,t){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(e,t)}async remove(e,t){if(this.kb==null)throw new Error("RoutingTable is not started");const n=await Ki(e,t);await this.kb.remove(n,t)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let e=0,t=0,n=0,s=20,i=0;function o(a){if(ip(a)){a.depth>n&&(n=a.depth),t++,e+=a.peers.length,a.peers.length<s&&(s=a.peers.length),a.peers.length>i&&(i=a.peers.length);return}o(a.left),o(a.right)}o(this.kb.root),this.metrics.routingTableSize.update(e),this.metrics.routingTableKadBucketTotal.update(t),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(e/t)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(i),this.metrics.routingTableKadBucketMaxDepth.update(n)}}const pce=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],L1=15;class gce{log;peerRouting;routingTable;refreshInterval;refreshQueryTimeout;commonPrefixLengthRefreshedAt;refreshTimeoutId;constructor(e,t){const{peerRouting:n,routingTable:s,refreshInterval:i,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=s,this.refreshInterval=i??vae,this.refreshQueryTimeout=o??Eae,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1,t){this.log("refreshing routing table");const n=this._maxCommonPrefix(),s=this._getTrackedCommonPrefixLengthsForRefresh(n);this.log(`max common prefix length ${n}`),this.log(`tracked CPLs [ ${s.map(i=>i.toISOString()).join(", ")} ]`),Promise.all(s.map(async(i,o)=>{try{if(await this._refreshCommonPrefixLength(o,i,e,t),this._numPeersForCpl(n)===0){const a=Math.min(2*(o+1),s.length-1);for(let c=o+1;c<a+1;c++)try{await this._refreshCommonPrefixLength(c,i,e,t)}catch(l){this.log.error("failed to refresh entries with common prefix length %d - %e",c,l)}}}catch(a){this.log.error("failed to refresh entries with common prefix length - %e",a)}})).catch(i=>{this.log.error("failed to refresh table - %e",i)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(i=>{this.log.error("failed to set refresh timeout - %e",i)})}async _refreshCommonPrefixLength(e,t,n,s){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const i=this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,i,this.routingTable.size);const o=xt([s?.signal,AbortSignal.timeout(this.refreshQueryTimeout)]);try{const a=await xD(this.peerRouting.getClosestPeers(i.toMultihash().bytes,{signal:o}));this.log(`found ${a} peers that were close to imaginary peer %p`,i),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,i,this.routingTable.size)}finally{o.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>L1&&(e=L1);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}_generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=Qa(2),n=(t[1]<<8)+t[0],s=this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),i=wr(s);return Ps(i)}_makePeerId(e,t,n){if(n>L1)throw new Error(`Cannot generate peer ID for common prefix length greater than ${L1}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=pce[c],u=new ArrayBuffer(34),h=new DataView(u,0,u.byteLength);return h.setUint8(0,Zt.code),h.setUint8(1,32),h.setUint32(2,l,!1),new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(this.routingTable.kb?.localPeer!=null)for(const{kadId:e}of this.routingTable.kb.toIterable()){const t=ql(this.routingTable.kb.localPeer.kadId,e);let n=0;for(const s of t)if(s===0)n++;else break;yield n}}}class mce{peerId;providers;peerStore;log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new Bt("Missing key");let n;try{n=Ee.decode(t.key)}catch{throw new Bt("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async s=>{const i=wr(s.id),o=Ps(i),a=s.multiaddrs.map(c=>Ye(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",s.id,e);return}if(s.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class yce{peerRouting;peerInfoMapper;peerId;addressManager;log;constructor(e,t){const{peerRouting:n,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){this.log("incoming request from %p for peers close to %b",e,t.key);try{if(t.key==null)throw new Bt("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getClosestPeersOffline(t.key,{exclude:[e,this.peerId]});Qe(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(i=>i.decapsulateCode(qe))});const s={type:zt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:i})=>i.length).map(i=>({id:i.id.toMultihash().bytes,multiaddrs:i.multiaddrs.map(o=>o.bytes)})),providers:[]};return s.closer.length===0?this.log("could not find any peers closer to %b for %p",t.key,e):this.log("found %d peers close to %b for %p",s.closer.length,t.key,e),s}catch(n){throw this.log("error during finding peers closer to %b for %p - %e",t.key,e,n),n}}}class wce{peerId;peerRouting;providers;peerStore;peerInfoMapper;log;constructor(e,t){const{peerRouting:n,providers:s,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=s,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new Bt("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=Ee.decode(t.key)}catch{throw new Bt("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[s,i]=await Promise.all([Vl(oa(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}})),this.peerRouting.getClosestPeersOffline(t.key)]),o={type:zt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class bce{peerStore;datastore;peerRouting;log;datastorePrefix;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new Bt("Invalid key");const s={type:zt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(Bae(n)){this.log("is public key");const a=Mae(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new dn("No public key found in key book");c=Qs(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),s.record=new Jn(n,c,new Date).serialize(),s}const[i,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getClosestPeersOffline(n)]);return i!=null&&(this.log("had record for %b in local datastore",n),s.record=i.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),s.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),s}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=Xh(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(i){if(i.name==="NotFoundError")return;throw i}const s=Jn.deserialize(n);if(s.timeReceived==null||Date.now()-s.timeReceived.getTime()>bD){await this.datastore.delete(t);return}return s}}class vce{log;constructor(e,t){this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class Ece{components;validators;log;datastorePrefix;constructor(e,t){const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null)throw this.log.error("empty record from %p",e),new Bt(`Empty record from: ${e}`);try{const s=Jn.deserialize(t.record);await k8(this.validators,s),s.timeReceived=new Date;const i=Xh(this.datastorePrefix,s.key);await this.components.datastore.put(i,s.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,i)}catch(s){this.log("did not put record for key %b into datastore %o",n,s)}return t}}class Sce{handlers;log;metrics;incomingMessageTimeout;constructor(e,t){this.metrics={operations:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:e.metrics?.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`),rpcTime:e.metrics?.registerMetricGroup(`${t.metricsPrefix}_inbound_rpc_time_seconds`,{label:"operation"})},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.incomingMessageTimeout=t.incomingMessageTimeout??1e4,this.handlers={[zt.GET_VALUE.toString()]:new bce(e,t),[zt.PUT_VALUE.toString()]:new Ece(e,t),[zt.FIND_NODE.toString()]:new yce(e,t),[zt.ADD_PROVIDER.toString()]:new mce(e,t),[zt.GET_PROVIDERS.toString()]:new wce(e,t),[zt.PING.toString()]:new vce(e,t)}}async handleMessage(e,t){const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return this.metrics.operations?.increment({[t.type]:!0}),await n.handle(e,t)}catch{this.metrics.errors?.increment({[t.type]:!0})}}async onIncomingStream(e,t){const n=()=>{e.abort(new Mg)};let s=AbortSignal.timeout(this.incomingMessageTimeout);s.addEventListener("abort",n);const i=Wr(e).pb(bl);for(;;){if(e.readStatus!=="readable"){await e.close({signal:s});break}const o=await i.read({signal:s}),a=this.metrics?.rpcTime?.timer(o.type.toString()),c=this.metrics?.rpcTime?.timer(o.type.toString());let l=!1;try{this.log("incoming %s from %p",o.type,t.remotePeer);const u=await this.handleMessage(t.remotePeer,o);u!=null&&await i.write(u,{signal:s})}catch(u){throw l=!0,c?.(),u}finally{l||a?.()}s.removeEventListener("abort",n),s=AbortSignal.timeout(this.incomingMessageTimeout),s.addEventListener("abort",n)}}}class _ce extends Nt{log;components;protocol;running;registrarId;constructor(e,t){super();const{protocol:n,logPrefix:s}=t;this.components=e,this.log=e.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:e}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class xce{dht;constructor(e){this.dht=e}async provide(e,t={}){await jo(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await jo(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new dn("Could not find value for key")}}class Ace{dht;constructor(e){this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new dn("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const Cce=32,kce=64;class Ice extends Nt{k;a;d;protocol;routingTable;providers;network;peerRouting;components;log;running;clientMode;validators;selectors;queryManager;contentFetching;contentRouting;routingTableRefresh;rpc;topologyListener;querySelf;maxInboundStreams;maxOutboundStreams;dhtContentRouting;dhtPeerRouting;peerInfoMapper;reprovider;onPeerConnectTimeout;constructor(e,t={}){super();const n=t.logPrefix??"libp2p:kad-dht",s=t.datastorePrefix??"/dht",i=t.metricsPrefix??"libp2p_kad_dht",o={queries:e.metrics?.registerMetricGroup(`${i}_operations_total`,{label:"operation"}),errors:e.metrics?.registerCounterGroup(`${i}_operation_errors_total`,{label:"operation"}),queryTime:e.metrics?.registerMetricGroup(`${i}_operation_time_seconds`,{label:"operation"}),errorTime:e.metrics?.registerMetricGroup(`${i}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=e,this.log=e.logger.forComponent(n),this.k=t.kBucketSize??T8,this.a=t.alpha??N2,this.d=t.disjointPaths??this.a,this.protocol=t.protocol??hae,this.clientMode=t.clientMode??!0,this.maxInboundStreams=t.maxInboundStreams??Cce,this.maxOutboundStreams=t.maxOutboundStreams??kce,this.peerInfoMapper=t.peerInfoMapper??Oae,this.onPeerConnectTimeout=t.onPeerConnectTimeout??mae,this.providers=new Hae(e,{...t.providers,logPrefix:n,datastorePrefix:s}),this.validators={...Dae,...t.validators},this.selectors={...Rae,...t.selectors},this.network=new Vae(e,{protocol:this.protocol,logPrefix:n,metricsPrefix:i}),this.routingTable=new fce(e,{kBucketSize:this.k,pingOldContactTimeout:t.pingOldContactTimeout,pingOldContactConcurrency:t.pingOldContactConcurrency,pingOldContactMaxQueueSize:t.pingOldContactMaxQueueSize,pingNewContactTimeout:t.pingNewContactTimeout,pingNewContactConcurrency:t.pingNewContactConcurrency,pingNewContactMaxQueueSize:t.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:n,metricsPrefix:i,prefixLength:t.prefixLength,splitThreshold:t.kBucketSplitThreshold,network:this.network});const a=Lt();t.allowQueryWithZeroPeers===!0&&a.resolve(),this.queryManager=new Kae(e,{disjointPaths:this.d,alpha:this.a,logPrefix:n,metricsPrefix:i,initialQuerySelfHasRun:a,routingTable:this.routingTable,allowQueryWithZeroPeers:t.allowQueryWithZeroPeers}),this.peerRouting=new zae(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:n}),this.contentFetching=new $ae(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:n,datastorePrefix:s}),this.contentRouting=new Fae(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:n}),this.routingTableRefresh=new gce(e,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:n}),this.rpc=new Sce(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:n,metricsPrefix:i,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new _ce(e,{protocol:this.protocol,logPrefix:n}),this.querySelf=new Wae(e,{peerRouting:this.peerRouting,interval:t.querySelfInterval,initialInterval:t.initialQuerySelfInterval,logPrefix:n,initialQuerySelfHasRun:a,operationMetrics:o}),this.reprovider=new Gae(e,{...t.reprovide,logPrefix:n,metricsPrefix:i,datastorePrefix:s,contentRouting:this.contentRouting,operationMetrics:o}),this.network.addEventListener("peer",c=>{const l=c.detail;this.onPeerConnect(l).catch(u=>{this.log.error("could not add %p to routing table - %e",l.id,u)}),this.dispatchEvent(new CustomEvent("peer",{detail:l}))}),this.topologyListener.addEventListener("peer",c=>{const l=c.detail;Promise.resolve().then(async()=>{const u=await this.components.peerStore.get(l),h={id:l,multiaddrs:u.addresses.map(({multiaddr:d})=>d),protocols:u.protocols};await this.onPeerConnect(h)}).catch(u=>{this.log.error("could not add %p to routing table - %e",l,u)})}),this.dhtPeerRouting=new Ace(this),this.dhtContentRouting=new xce(this),t.clientMode==null&&e.events.addEventListener("self:peer:update",c=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const l=c.detail.peer.addresses.some(({multiaddr:h})=>!Zn(h)&&!li.exactMatch(h)),u=this.getMode();l&&u==="client"?await this.setMode("server"):u==="server"&&!l&&await this.setMode("client")}).catch(l=>{this.log.error("error setting dht server mode - %e",l)})}),this.get=Mc(this.get.bind(this),o,"GET_VALUE"),this.findProviders=Mc(this.findProviders.bind(this),o,"FIND_PROVIDERS"),this.findPeer=Mc(this.findPeer.bind(this),o,"FIND_PEER"),this.getClosestPeers=Mc(this.getClosestPeers.bind(this),o,"GET_CLOSEST_PEERS"),this.provide=Mc(this.provide.bind(this),o,"PROVIDE"),this.put=Mc(this.put.bind(this),o,"PUT_VALUE")}[Symbol.toStringTag]="@libp2p/kad-dht";[yr]=["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery","@libp2p/kad-dht"];[ja]=["@libp2p/identify","@libp2p/ping"];get[vd](){return this.dhtContentRouting}get[Ed](){return this.dhtPeerRouting}get[Dp](){return this}async onPeerConnect(e){if(this.log.trace("peer %p connected",e.id,e.multiaddrs),e=this.peerInfoMapper(e),e.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",e.id,e.multiaddrs.map(n=>n.toString()));return}const t=AbortSignal.timeout(this.onPeerConnectTimeout);try{await this.routingTable.add(e.id,{signal:t})}catch(n){this.log.error("could not add %p to routing table - %e",e.id,n)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(e,t){if(e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}if(await this.components.registrar.unhandle(this.protocol,t),e===this.getMode()&&t?.force!==!0){this.log("already in %s mode",e);return}e==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{signal:t?.signal,maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",{force:!0}),await oi(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await oi(this.querySelf))}async stop(){this.running=!1,await eo(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async cancelReprovide(e,t){await this.providers.removeProvider(e,this.components.peerId,t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(e){this.routingTableRefresh.refreshTable(!0,e)}}var OE;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER",r[r.PATH_ENDED=8]="PATH_ENDED"})(OE||(OE={}));function Tce(r={}){return e=>new Ice(e,r)}var At;(function(r){r[r.NEW_STREAM=0]="NEW_STREAM",r[r.MESSAGE_RECEIVER=1]="MESSAGE_RECEIVER",r[r.MESSAGE_INITIATOR=2]="MESSAGE_INITIATOR",r[r.CLOSE_RECEIVER=3]="CLOSE_RECEIVER",r[r.CLOSE_INITIATOR=4]="CLOSE_INITIATOR",r[r.RESET_RECEIVER=5]="RESET_RECEIVER",r[r.RESET_INITIATOR=6]="RESET_INITIATOR"})(At||(At={}));const R8=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),LE=Object.freeze({NEW_STREAM:At.NEW_STREAM,MESSAGE:At.MESSAGE_INITIATOR,CLOSE:At.CLOSE_INITIATOR,RESET:At.RESET_INITIATOR}),Rce=Object.freeze({MESSAGE:At.MESSAGE_RECEIVER,CLOSE:At.CLOSE_RECEIVER,RESET:At.RESET_RECEIVER}),P8=1<<20,AD=4<<20;class Pce{_buffer;_headerInfo;_maxMessageSize;_maxUnprocessedMessageQueueSize;constructor(e=P8,t=AD){this._buffer=new ze,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(e==null||e.length===0)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw new Bt("Unprocessed message queue size too large!");const t=[];for(;this._buffer.length!==0;){if(this._headerInfo==null)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(l){if(l.name==="InvalidMessageError")throw l;break}const{id:n,type:s,length:i,offset:o}=this._headerInfo;if(this._buffer.length-o<i)break;const c={id:n,type:s};(s===At.NEW_STREAM||s===At.MESSAGE_INITIATOR||s===At.MESSAGE_RECEIVER)&&(c.data=this._buffer.sublist(o,o+i)),t.push(c),this._buffer.consume(o+i),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=ME(e),{value:s,offset:i}=ME(e,n),o=t&7;if(R8[o]==null)throw new Error(`Invalid type received: ${o}`);if(s>this._maxMessageSize)throw new Bt("Message size too large");return{id:t>>3,type:o,offset:n+i,length:s}}}const Dce=128,BE=127;function ME(r,e=0){let t=0,n=0,s=e,i;const o=r.length;do{if(s>=o||n>49)throw e=0,new RangeError("Could not decode varint");i=r.get(s++),t+=n<28?(i&BE)<<n:(i&BE)*Math.pow(2,n),n+=7}while(i>=Dce);return e=s-e,{value:t,offset:e}}const Py=10*1024;class Nce{_pool;_poolOffset;constructor(){this._pool=Dn(Py),this._poolOffset=0}write(e,t){const n=this._pool;let s=this._poolOffset;Ys(e.id<<3|e.type,n,s),s+=ht(e.id<<3|e.type),(e.type===At.NEW_STREAM||e.type===At.MESSAGE_INITIATOR||e.type===At.MESSAGE_RECEIVER)&&e.data!=null?(Ys(e.data.length,n,s),s+=ht(e.data.length)):(Ys(0,n,s),s+=ht(0));const i=n.subarray(this._poolOffset,s);Py-s<100?(this._pool=Dn(Py),this._poolOffset=0):this._poolOffset=s,t.append(i),(e.type===At.NEW_STREAM||e.type===At.MESSAGE_INITIATOR||e.type===At.MESSAGE_RECEIVER)&&e.data!=null&&t.append(e.data)}}const Oce=new Nce;function B1(r){const e=new ze;return Oce.write(r,e),e}class Lce extends v5{streamId;types;maxDataSize;muxer;constructor(e){super(e),this.types=e.direction==="outbound"?LE:Rce,this.maxDataSize=e.maxDataSize,this.muxer=e.muxer,this.streamId=parseInt(this.id.substring(1)),e.direction==="outbound"&&queueMicrotask(()=>{this.muxer.send(B1({id:this.streamId,type:LE.NEW_STREAM,data:new ze(le(this.id))}))})}sendData(e){const t=new ze,n=e.byteLength;for(;e.byteLength>0;){const s=Math.min(e.byteLength,this.maxDataSize),i=e.sublist(0,s);e=e.sublist(s),t.append(B1({id:this.streamId,type:this.types.MESSAGE,data:i}))}return{sentBytes:n,canSendMore:this.muxer.send(t)}}sendReset(){return this.muxer.send(B1({id:this.streamId,type:this.types.RESET}))}async sendCloseWrite(e){this.muxer.send(B1({id:this.streamId,type:this.types.CLOSE})),e?.signal?.throwIfAborted()}async sendCloseRead(e){e?.signal?.throwIfAborted()}sendPause(){}sendResume(){}}function Bce(r){const{id:e,muxer:t,direction:n,maxMsgSize:s=P8}=r;return new Lce({...r,id:n==="outbound"?`i${e}`:`r${e}`,direction:n,maxDataSize:s,muxer:t,log:r.log.newScope(`${n}:${e}`),protocol:""})}const Mce=5;function $ce(r){const e={...r,type:`${R8[r.type]} (${r.type})`};return r.type===At.NEW_STREAM&&(e.data=he(r.data.subarray())),(r.type===At.MESSAGE_INITIATOR||r.type===At.MESSAGE_RECEIVER)&&(e.data=he(r.data.subarray(),"base16")),e}class Uce extends b5{_streamId;rateLimiter;maxMessageSize;maxUnprocessedMessageQueueSize;decoder;constructor(e,t){super(e,{...t,protocol:"/mplex/6.7.0",name:"mplex"}),this._streamId=0,this.maxMessageSize=t.maxMessageSize??P8,this.maxUnprocessedMessageQueueSize=t.maxUnprocessedMessageQueueSize??AD,this.decoder=new Pce(this.maxMessageSize,this.maxUnprocessedMessageQueueSize),this.rateLimiter=new $I({points:t.disconnectThreshold??Mce,duration:1})}onData(e){for(const t of this.decoder.write(e))this.handleMessage(t)}onCreateStream(e){if(this.status!=="open")throw new Wc("Muxer already closed");const t=this._streamId++;return this._newStream(t,"outbound",e)}_newStream(e,t,n){return this.log("new %s stream %s",t,e),Bce({...n,id:e,direction:t,maxMsgSize:this.maxMessageSize,log:this.log,muxer:this})}handleMessage(e){if(this.log.enabled&&this.log.trace("incoming message",$ce(e)),e.type===At.NEW_STREAM){try{this.rateLimiter.consume("new-stream",1)}catch{this.log("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),this.abort(new Error("Too many open streams"));return}const s=this._newStream(e.id,"inbound",this.streamOptions);this.onRemoteStream(s);return}const t=`${(e.type&1)===1?"i":"r"}${e.id}`,n=this.streams.find(s=>s.id===t);if(n==null){this.log("missing stream %s for message type %s",t,R8[e.type]);try{this.rateLimiter.consume("missing-stream",1)}catch{this.log("rate limit hit when receiving messages for streams that do not exist - closing remote connection"),this.abort(new Error("Too many messages for missing streams"));return}return}try{switch(e.type){case At.MESSAGE_INITIATOR:case At.MESSAGE_RECEIVER:n.onData(e.data);break;case At.CLOSE_INITIATOR:case At.CLOSE_RECEIVER:n.onRemoteCloseWrite();break;case At.RESET_INITIATOR:case At.RESET_RECEIVER:n.onRemoteReset();break;default:this.log("unknown message type")}}catch(s){this.log.error("error while processing message - %e",s),n.abort(s)}}}class Fce{protocol="/mplex/6.7.0";_init;constructor(e={}){this._init=e}[Symbol.toStringTag]="@libp2p/mplex";[yr]=["@libp2p/stream-multiplexing"];createStreamMuxer(e){return new Uce(e,{...this._init})}}function Vce(r={}){return()=>new Fce(r)}const $E=32,zce="1.0.0",Hce="ping",qce="ipfs",Kce=1e4,jce=2,Wce=1;class Gce{protocol;components;started;timeout;maxInboundStreams;maxOutboundStreams;runOnLimitedConnection;constructor(e,t={}){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix??qce}/${Hce}/${zce}`,this.timeout=t.timeout??Kce,this.maxInboundStreams=t.maxInboundStreams??jce,this.maxOutboundStreams=t.maxOutboundStreams??Wce,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handlePing=this.handlePing.bind(this)}[Symbol.toStringTag]="@libp2p/ping";[yr]=["@libp2p/ping"];async start(){await this.components.registrar.handle(this.protocol,this.handlePing,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async handlePing(e,t){const n=e.log.newScope("ping");n.trace("ping from %p",t.remotePeer);const s=AbortSignal.timeout(this.timeout);s.addEventListener("abort",()=>{e.abort(new Mg("Ping timed out"))});const i=Date.now();for await(const o of e){if(e.status!=="open"){n("stream status changed to %s",e.status);break}e.send(o)||(n("waiting for stream to drain"),await sr(e,"drain",{rejectionEvents:["close"],signal:s}),n("stream drained"))}n("ping from %p complete in %dms",t.remotePeer,Date.now()-i),await e.close({signal:s})}async ping(e,t={}){const n=Qa($E),s=await this.components.connectionManager.openStream(e,this.protocol,{runOnLimitedConnection:this.runOnLimitedConnection,...t}),i=s.log.newScope("ping");try{const o=Date.now(),a=Promise.withResolvers(),c=new ze,l=u=>{if(c.append(u.data),c.byteLength===$E){s.removeEventListener("message",l);const h=Date.now()-o;Promise.all([s.closeRead(t)]).then(()=>{if(Qe(n,c.subarray()))a.resolve(h);else throw new mF(`Received wrong ping ack after ${h}ms`)}).catch(d=>{s.abort(d),a.reject(d)})}};return s.addEventListener("message",l),s.send(n),await s.close(t),await es(a.promise,t.signal)}catch(o){throw i.error("error while pinging %o - %e",e,o),s?.abort(o),o}finally{s?.close()}}}function Yce(r={}){return e=>new Gce(e,r)}var cn;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.flag!=null&&(s.uint32(8),r.Flag.codec().encode(n.flag,s)),n.message!=null&&(s.uint32(18),s.bytes(n.message)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(cn||(cn={}));const Qce=["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478","stun:stun.cloudflare.com:3478","stun:stun.services.mozilla.com:3478"],UE=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),Xce="libp2p+webrtc+v1/",Jce=2*1024*1024,O2=16*1024;function Zce(r=O2){const e=ht(r-ht(r)),t=1+ht(Object.keys(cn.Flag).length-1),n=1,s=r-e-t-n,i=ht(s);return e+t+n+i}const ele=Zce(),tle=1e4,CD="/webrtc",S4="/webrtc-signaling/0.0.1",rle="/libp2p/webrtc-direct/certificate",nle="webrtc-direct-certificate-private-key",sle=12096e5,FE=864e5;var VE=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},ile=(function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r})(),ole=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})(),ale=(function(){function r(e,t,n,s){this.name=e,this.version=t,this.os=n,this.bot=s,this.type="bot-device"}return r})(),cle=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})(),lle=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})(),ule=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,hle=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,zE=3,dle=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",ule]],HE=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function fle(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new lle:typeof navigator<"u"?gle(navigator.userAgent):yle()}function ple(r){return r!==""&&dle.reduce(function(e,t){var n=t[0],s=t[1];if(e)return e;var i=s.exec(r);return!!i&&[n,i]},!1)}function gle(r){var e=ple(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new cle;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<zE&&(s=VE(VE([],s,!0),wle(zE-s.length),!0)):s=[];var i=s.join("."),o=mle(r),a=hle.exec(r);return a&&a[1]?new ale(t,i,o,a[1]):new ile(t,i,o)}function mle(r){for(var e=0,t=HE.length;e<t;e++){var n=HE[e],s=n[0],i=n[1],o=i.exec(r);if(o)return s}return null}function yle(){var r=typeof process<"u"&&process.version;return r?new ole(process.version.slice(1)):null}function wle(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}class D8 extends Error{name="TimeoutError";constructor(e,t){super(e,t),Error.captureStackTrace?.(this,D8)}}const qE=r=>r.reason??new DOMException("This operation was aborted.","AbortError");function ble(r,e){const{milliseconds:t,fallback:n,message:s,customTimers:i={setTimeout,clearTimeout},signal:o}=e;let a,c;const u=new Promise((h,d)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(o?.aborted){d(qE(o));return}if(o&&(c=()=>{d(qE(o))},o.addEventListener("abort",c,{once:!0})),r.then(h,d),t===Number.POSITIVE_INFINITY)return;const f=new D8;a=i.setTimeout.call(void 0,()=>{if(n){try{h(n())}catch(g){d(g)}return}typeof r.cancel=="function"&&r.cancel(),s===!1?h():s instanceof Error?d(s):(f.message=s??`Promise timed out after ${t} milliseconds`,d(f))},t)}).finally(()=>{u.clear(),c&&o&&o.removeEventListener("abort",c)});return u.clear=()=>{i.clearTimeout.call(void 0,a),a=void 0},u}const KE=fle(),kD=KE!=null&&KE.name==="firefox";async function jE(r){return r=r??{},typeof r=="function"&&(r=await r()),r.iceServers=r.iceServers??Qce.map(e=>({urls:[e]})),r}const vle=(r=32)=>Xce+[...Array(r)].map(()=>UE.at(Math.floor(Math.random()*UE.length))).join("");class Ele extends v5{channel;incomingData;maxBufferedAmount;receivedFinAck;finAckTimeout;constructor(e){super({...e,maxMessageSize:(e.maxMessageSize??O2)-ele}),this.channel=e.channel,this.channel.binaryType="arraybuffer",this.incomingData=to(),this.maxBufferedAmount=e.maxBufferedAmount??Jce,this.finAckTimeout=e.finAckTimeout??tle,this.channel.onclose=()=>{this.log.trace("received datachannel close event"),this.onRemoteCloseWrite(),this.onTransportClosed()},this.channel.onerror=n=>{const s=n.error;this.log.trace("received datachannel error event - %e",s),this.abort(s)},this.channel.onmessage=async n=>{this.log("incoming message %d bytes",n.data.byteLength);const{data:s}=n;s===null||s.byteLength===0||this.incomingData.push(new Uint8Array(s,0,s.byteLength))},this.channel.bufferedAmountLowThreshold=0,this.channel.onbufferedamountlow=()=>{this.writableNeedsDrain&&this.safeDispatchEvent("drain")},Promise.resolve().then(async()=>{for await(const n of Jp(this.incomingData))this.processIncomingProtobuf(n)}).catch(n=>{this.log.error("error processing incoming data channel messages - %e",n)});const t=()=>{this.channel.readyState==="open"&&(this.log.trace("stream closed, closing underlying datachannel"),this.channel.close())};this.addEventListener("close",t),this.channel.readyState!=="open"&&(this.log('channel ready state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),sr(this.channel,"open",{rejectionEvents:["close","error"]}).then(()=>{this.log('channel ready state is now "%s", dispatching drain',this.channel.readyState),this.safeDispatchEvent("drain")}).catch(n=>{this.abort(n.error??n)}))}sendNewStream(){}_sendMessage(e){if(this.channel.readyState!=="open")throw new zc(`Invalid datachannel state - ${this.channel.readyState}`);if(this.log.trace('sending message, channel state "%s"',this.channel.readyState),kD){this.channel.send(e.subarray());return}for(const t of e)this.channel.send(t)}sendData(e){return this.channel.readyState!=="open"?{sentBytes:0,canSendMore:!1}:(this._sendMessage(Bd.single(cn.encode({message:e.subarray()}))),{sentBytes:e.byteLength,canSendMore:this.channel.bufferedAmount<this.maxBufferedAmount})}sendReset(e){try{this.log.error("sending reset - %e",e),this._sendFlag(cn.Flag.RESET),this.receivedFinAck?.reject(e)}catch(t){this.log.error("failed to send reset - %e",t)}}async sendCloseWrite(e){this._sendFlag(cn.Flag.FIN),e?.signal?.throwIfAborted(),this.receivedFinAck=Promise.withResolvers();const t=e?.signal??AbortSignal.timeout(this.finAckTimeout),n=[sr(this.channel,"close",{signal:t}),sr(this.channel,"error",{signal:t})];await Promise.any([es(this.receivedFinAck.promise,t),...n]).finally(()=>{n.forEach(s=>s.cancel())})}async sendCloseRead(e){this._sendFlag(cn.Flag.STOP_SENDING),e?.signal?.throwIfAborted()}processIncomingProtobuf(e){const t=cn.decode(e);t.message!=null&&(this.readStatus==="readable"||this.readStatus==="paused")&&this.onData(new ze(t.message)),t.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',t.flag,this.writeStatus,this.readStatus),t.flag===cn.Flag.FIN&&(this._sendFlag(cn.Flag.FIN_ACK),this.onRemoteCloseWrite()),t.flag===cn.Flag.RESET&&(this.receivedFinAck?.reject(new DC("The stream was reset")),this.onRemoteReset()),t.flag===cn.Flag.STOP_SENDING&&this.onRemoteCloseRead(),t.flag===cn.Flag.FIN_ACK&&this.receivedFinAck?.resolve())}_sendFlag(e){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',e.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",e.toString());const t=cn.encode({flag:e}),n=Bd.single(t);try{return this._sendMessage(n),!0}catch(s){this.log.error("could not send flag %s - %e",e.toString(),s)}return!1}sendPause(){}sendResume(){}}function _4(r){const{channel:e,direction:t,isHandshake:n}=r;return new Ele({...r,id:`${e.id}`,log:r.log.newScope(`${n===!0?"handshake":t}:${e.id}`),protocol:""})}class N8{protocol;peerConnection;metrics;dataChannelOptions;earlyDataChannels;constructor(e){this.onEarlyDataChannel=this.onEarlyDataChannel.bind(this),this.peerConnection=e.peerConnection,this.metrics=e.metrics,this.protocol=e.protocol??CD,this.dataChannelOptions=e.dataChannelOptions??{},this.peerConnection.addEventListener("datachannel",this.onEarlyDataChannel),this.earlyDataChannels=[]}onEarlyDataChannel(e){this.earlyDataChannels.push(e.channel)}createStreamMuxer(e){return this.peerConnection.removeEventListener("datachannel",this.onEarlyDataChannel),new Sle(e,{peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,protocol:this.protocol,earlyDataChannels:this.earlyDataChannels})}}class Sle extends b5{peerConnection;dataChannelOptions;constructor(e,t){super(e,{...t,name:"muxer"}),this.peerConnection=t.peerConnection,this.protocol=t.protocol??CD,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{this.onDataChannel(n)},queueMicrotask(()=>{if(this.status!=="open"){t.earlyDataChannels.forEach(n=>{n.close()});return}t.earlyDataChannels.forEach(n=>{this.onDataChannel(n)})})}onDataChannel(e){if(this.log("incoming datachannel with channel id %d, protocol %s and status %s",e.id,e.protocol,e.readyState),e.label==="init"){this.log.trace("closing init channel %d",e.id),e.close();return}const t=_4({...this.streamOptions,...this.dataChannelOptions,channel:e,direction:"inbound",log:this.log});this.onRemoteStream(t)}async onCreateStream(e){const t=this.peerConnection.createDataChannel("",{});return this.log("open channel %d for protocol %s",t.id,e?.protocol),_4({...e,...this.dataChannelOptions,channel:t,direction:"outbound",log:this.log})}onData(){}}class _le extends w5{peerConnection;constructor(e){super(e),this.peerConnection=e.peerConnection;const t=e.peerConnection.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change %s initial state %s",this.peerConnection.connectionState,t),(this.peerConnection.connectionState==="disconnected"||this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="closed")&&(this.onTransportClosed(),this.peerConnection.close())}}sendData(e){return{sentBytes:e.byteLength,canSendMore:!0}}async sendClose(e){this.peerConnection.close(),e?.signal?.throwIfAborted()}sendReset(){this.peerConnection.close()}sendPause(){}sendResume(){}}const x4=r=>new _le(r),ID=globalThis.RTCPeerConnection,TD=globalThis.RTCSessionDescription,xle=globalThis.RTCIceCandidate;class Pf extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class Ro extends Pf{constructor(e="SDP handshake failed"){super(e),this.name="SDPHandshakeFailedError"}}class Ale extends Pf{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class Cle extends Pf{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class kle extends Pf{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var gs;(function(r){(function(n){n.SDP_OFFER="SDP_OFFER",n.SDP_ANSWER="SDP_ANSWER",n.ICE_CANDIDATE="ICE_CANDIDATE"})(r.Type||(r.Type={}));let e;(function(n){n[n.SDP_OFFER=0]="SDP_OFFER",n[n.SDP_ANSWER=1]="SDP_ANSWER",n[n.ICE_CANDIDATE=2]="ICE_CANDIDATE"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.Type||(r.Type={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{i.lengthDelimited!==!1&&s.fork(),n.type!=null&&(s.uint32(8),r.Type.codec().encode(n.type,s)),n.data!=null&&(s.uint32(18),s.string(n.data)),i.lengthDelimited!==!1&&s.ldelim()},(n,s,i={})=>{const o={},a=s==null?n.len:n.pos+s;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.type=r.Type.codec().decode(n);break}case 2:{o.data=n.string();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>et(n,r.codec()),r.decode=(n,s)=>Ze(n,r.codec(),s)})(gs||(gs={}));const RD=async(r,e,t)=>{try{const n=Promise.withResolvers();for(Ile(r,n);;){const s=await Promise.race([n.promise,e.read({signal:t.signal})]);if(s==null){t.signal?.throwIfAborted();break}if(s.type!==gs.Type.ICE_CANDIDATE)throw new Bt("ICE candidate message expected");const i=JSON.parse(s.data??"null");if(i===""||i===null){t.onProgress?.(new Pe("webrtc:end-of-ice-candidates")),t.log.trace("end-of-candidates received");continue}const o=new xle(i);t.log.trace("%s received new ICE candidate %o",t.direction,i);try{t.onProgress?.(new Pe("webrtc:add-ice-candidate",o.candidate)),await r.addIceCandidate(o)}catch(a){t.log.error("%s bad candidate received %o - %e",t.direction,i,a)}}}catch(n){if(t.log.error("%s error parsing ICE candidate - %e",t.direction,n),t.signal?.aborted===!0&&r.connectionState!=="connected")throw n}};function Ile(r,e){if(r.connectionState==="connected"){e.resolve();return}r.onconnectionstatechange=t=>{switch(r.connectionState){case"connected":e.resolve();break;case"failed":case"disconnected":case"closed":e.reject(new PC(`RTCPeerConnection connection state became "${r.connectionState}"`));break}}}function PD(r){let e;for(const t of r.getComponents())t.name==="p2p"&&(e=On(t.value??""));if(e==null)throw new Bg("Remote peerId must be present in multiaddr");return e}async function Tle({rtcConfiguration:r,dataChannel:e,signal:t,metrics:n,multiaddr:s,connectionManager:i,transportManager:o,log:a,logger:c,onProgress:l}){const{circuitAddress:u,targetPeer:h}=Dle(s);n?.dialerEvents.increment({open:!0}),a.trace("dialing circuit address: %a",u);const d=i.getConnections(h);let f;d.length===0?(l?.(new Pe("webrtc:dial-relay")),f=await o.dial(u,{signal:t,onProgress:l})):(l?.(new Pe("webrtc:reuse-relay-connection")),f=d[0]),l?.(new Pe("webrtc:open-signaling-stream"));const g=await f.newStream(S4,{signal:t,runOnLimitedConnection:!0}),m=Wr(g).pb(gs),b=new ID(r);b.addEventListener("connectionstatechange",()=>{switch(b.connectionState){case"closed":b.close();break}});const v=new N8({peerConnection:b,dataChannelOptions:e});try{const A=b.createDataChannel("init");b.onicecandidate=({candidate:P})=>{if(b.connectionState==="connected"){a.trace("ignore new ice candidate as peer connection is already connected");return}if(P==null||P?.candidate===""){a.trace("initiator detected end of ICE candidates");return}const T=JSON.stringify(P?.toJSON()??null);a.trace("initiator sending ICE candidate %o",P),m.write({type:gs.Type.ICE_CANDIDATE,data:T},{signal:t}).catch(D=>{a.error("error sending ICE candidate - %e",D)})},b.onicecandidateerror=P=>{a.error("initiator ICE candidate error",P)};const w=await b.createOffer().catch(P=>{throw a.error("could not execute createOffer - %e",P),new Ro("Failed to set createOffer")});a.trace("initiator send SDP offer %s",w.sdp),l?.(new Pe("webrtc:send-sdp-offer")),await m.write({type:gs.Type.SDP_OFFER,data:w.sdp},{signal:t}),await b.setLocalDescription(w).catch(P=>{throw a.error("could not execute setLocalDescription - %e",P),new Ro("Failed to set localDescription")}),l?.(new Pe("webrtc:read-sdp-answer")),a.trace("initiator read SDP answer");const E=await m.read({signal:t});if(E.type!==gs.Type.SDP_ANSWER)throw new Ro("Remote should send an SDP answer");a.trace("initiator received SDP answer %s",E.data);const x=new TD({type:"answer",sdp:E.data});return await b.setRemoteDescription(x).catch(P=>{throw a.error("could not execute setRemoteDescription - %e",P),new Ro("Failed to set remoteDescription")}),a.trace("initiator read candidates until connected"),l?.(new Pe("webrtc:read-ice-candidates")),await RD(b,m,{direction:"initiator",signal:t,log:a,onProgress:l}),a.trace("initiator connected"),A.readyState!=="open"&&(a.trace("wait for init channel to open"),await sr(A,"open",{signal:t})),a.trace("closing init channel"),A.close(),a.trace("waiting for init channel to close"),await sr(A,"close",{signal:t}),l?.(new Pe("webrtc:close-signaling-stream")),a.trace("closing signaling channel"),await g.close({signal:t}),a.trace("initiator connected to remote address %s",s),{remoteAddress:s,peerConnection:b,muxerFactory:v}}catch(A){throw a.error("outgoing signaling error - %e",A),b.close(),g.abort(A),A}finally{b.onicecandidate=null,b.onicecandidateerror=null}}const WE=Tt(r8.matchers[0],It(wu));class O8 extends Nt{transportManager;shutdownController;events;constructor(e,t){super(),this.transportManager=e.transportManager,this.events=e.events,this.shutdownController=t.shutdownController,this.onTransportListening=this.onTransportListening.bind(this)}async listen(){this.events.addEventListener("transport:listening",this.onTransportListening)}onTransportListening(e){e.detail.getAddrs().filter(n=>WE.exactMatch(n)).map(n=>n.encapsulate("/webrtc")).length>0&&this.safeDispatchEvent("listening")}getAddrs(){return this.transportManager.getListeners().filter(e=>!(e instanceof O8)).map(e=>e.getAddrs().filter(t=>WE.exactMatch(t)).map(t=>t.encapsulate("/webrtc"))).flat()}updateAnnounceAddrs(){}async close(){this.events.removeEventListener("transport:listening",this.onTransportListening),this.shutdownController.abort(),queueMicrotask(()=>{this.safeDispatchEvent("close")})}}async function Rle(r,e,{peerConnection:t,signal:n,log:s}){s.trace("new inbound signaling stream");const i=Wr(r).pb(gs);try{t.onicecandidate=({candidate:h})=>{if(t.connectionState==="connected"){s.trace("ignore new ice candidate as peer connection is already connected");return}if(h==null||h?.candidate===""){s.trace("recipient detected end of ICE candidates");return}const d=JSON.stringify(h?.toJSON()??null);s.trace("recipient sending ICE candidate %s",d),i.write({type:gs.Type.ICE_CANDIDATE,data:d},{signal:n}).catch(f=>{s.error("error sending ICE candidate - %e",f)})},s.trace("recipient read SDP offer");const c=await i.read({signal:n});if(c.type!==gs.Type.SDP_OFFER)throw new Ro(`expected message type SDP_OFFER, received: ${c.type??"undefined"} `);s.trace("recipient received SDP offer %s",c.data);const l=new TD({type:"offer",sdp:c.data});await t.setRemoteDescription(l).catch(h=>{throw s.error("could not execute setRemoteDescription - %e",h),new Ro("Failed to set remoteDescription")});const u=await t.createAnswer().catch(h=>{throw s.error("could not execute createAnswer - %e",h),new Ro("Failed to create answer")});s.trace("recipient send SDP answer %s",u.sdp),await i.write({type:gs.Type.SDP_ANSWER,data:u.sdp},{signal:n}),await t.setLocalDescription(u).catch(h=>{throw s.error("could not execute setLocalDescription - %e",h),new Ro("Failed to set localDescription")}),s.trace("recipient read candidates until connected"),await RD(t,i,{direction:"recipient",signal:n,log:s})}catch(c){if(t.connectionState!=="connected")throw s.error("error while handling signaling stream from peer %a - %e",e.remoteAddr,c),t.close(),c;s("error while handling signaling stream from peer %a, ignoring as the RTCPeerConnection is already connected",e.remoteAddr,c)}const o=PD(e.remoteAddr),a=Ye(`/webrtc/p2p/${o}`);return s.trace("recipient connected to remote address %s",a),{remoteAddress:a,remotePeer:o}}class Ple{components;init;log;_started=!1;metrics;shutdownController;constructor(e,t={}){this.components=e,this.init=t,this.log=e.logger.forComponent("libp2p:webrtc"),this.shutdownController=new AbortController,this.shutdownController.signal,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_dialer_events_total",{label:"event",help:"Total count of WebRTC dialer events by type"}),listenerEvents:e.metrics.registerCounterGroup("libp2p_webrtc_listener_events_total",{label:"event",help:"Total count of WebRTC listener events by type"})})}[Fg]=!0;[Symbol.toStringTag]="@libp2p/webrtc";[yr]=["@libp2p/transport"];[ja]=["@libp2p/identify","@libp2p/circuit-relay-v2-transport"];isStarted(){return this._started}async start(){await this.components.registrar.handle(S4,(e,t)=>{const n=this.components.upgrader.createInboundAbortSignal(this.shutdownController.signal);this._onProtocol(e,t,n).catch(s=>{this.log.error("failed to handle incoming connect from %p - %e",t.remotePeer,s)}).finally(()=>{n.clear()})},{runOnLimitedConnection:!0}),this._started=!0}async stop(){await this.components.registrar.unhandle(S4),this._started=!1}createListener(e){return new O8(this.components,{shutdownController:this.shutdownController})}listenFilter(e){return e.filter(K3.exactMatch)}dialFilter(e){return this.listenFilter(e)}async dial(e,t){this.log.trace("dialing address: %a",e);const{remoteAddress:n,peerConnection:s,muxerFactory:i}=await Tle({rtcConfiguration:await jE(this.init.rtcConfiguration),dataChannel:this.init.dataChannel,multiaddr:e,dataChannelOptions:this.init.dataChannel,signal:t.signal,connectionManager:this.components.connectionManager,transportManager:this.components.transportManager,log:this.log,logger:this.components.logger,onProgress:t.onProgress}),o=x4({peerConnection:s,remoteAddr:n,metrics:this.metrics?.dialerEvents,direction:"outbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")}),a=await t.upgrader.upgradeOutbound(o,{skipProtection:!0,skipEncryption:!0,remotePeer:PD(e),muxerFactory:i,onProgress:t.onProgress,signal:t.signal});return this._closeOnShutdown(s,o),a}async _onProtocol(e,t,n){const s=new ID(await jE(this.init.rtcConfiguration));s.addEventListener("connectionstatechange",()=>{switch(s.connectionState){case"closed":s.close();break}});const i=new N8({peerConnection:s,dataChannelOptions:this.init.dataChannel});try{const{remoteAddress:o,remotePeer:a}=await Rle(e,t,{peerConnection:s,signal:n,log:this.log});await e.close({signal:n});const c=x4({peerConnection:s,remoteAddr:o,metrics:this.metrics?.listenerEvents,direction:"inbound",log:this.components.logger.forComponent("libp2p:webrtc:connection")});await this.components.upgrader.upgradeInbound(c,{skipEncryption:!0,skipProtection:!0,remotePeer:a,muxerFactory:i,signal:n}),this._closeOnShutdown(s,c)}catch(o){throw this.log.error("incoming signaling error - %e",o),s.close(),e.abort(o),o}}_closeOnShutdown(e,t){const n=()=>{t.close().catch(s=>{this.log.error("could not close WebRTCMultiaddrConnection - %e",s)})};this.shutdownController.signal.addEventListener("abort",n),e.addEventListener("close",()=>{this.shutdownController.signal.removeEventListener("abort",n)})}}function Dle(r){const e=r.getComponents().filter(({name:n})=>n==="p2p").map(({value:n})=>n).pop();if(e==null)throw new ue("Destination peer id was missing");return{circuitAddress:Ye(r.getComponents().filter(({name:n})=>n!=="webrtc")),targetPeer:On(e)}}var GE={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var YE;function Nle(){if(YE)return GE;YE=1;var r;return(function(e){(function(t){var n=typeof globalThis=="object"?globalThis:typeof Un=="object"?Un:typeof self=="object"?self:typeof this=="object"?this:c(),s=i(e);typeof n.Reflect<"u"&&(s=i(n.Reflect,s)),t(s,n),typeof n.Reflect>"u"&&(n.Reflect=e);function i(l,u){return function(h,d){Object.defineProperty(l,h,{configurable:!0,writable:!0,value:d}),u&&u(h,d)}}function o(){try{return Function("return this;")()}catch{}}function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}function c(){return o()||a()}})(function(t,n){var s=Object.prototype.hasOwnProperty,i=typeof Symbol=="function",o=i&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=i&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",l={__proto__:[]}instanceof Array,u=!c&&!l,h={create:c?function(){return ft(Object.create(null))}:l?function(){return ft({__proto__:null})}:function(){return ft({})},has:u?function(Y,Z){return s.call(Y,Z)}:function(Y,Z){return Z in Y},get:u?function(Y,Z){return s.call(Y,Z)?Y[Z]:void 0}:function(Y,Z){return Y[Z]}},d=Object.getPrototypeOf(Function),f=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Me(),g=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Fe(),m=typeof WeakMap=="function"?WeakMap:$e(),b=i?Symbol.for("@reflect-metadata:registry"):void 0,v=H(),A=Q(v);function w(Y,Z,ne,fe){if(oe(ne)){if(!M(Y))throw new TypeError;if(!G(Z))throw new TypeError;return B(Y,Z)}else{if(!M(Y))throw new TypeError;if(!xe(Z))throw new TypeError;if(!xe(fe)&&!oe(fe)&&!Se(fe))throw new TypeError;return Se(fe)&&(fe=void 0),ne=He(ne),z(Y,Z,ne,fe)}}t("decorate",w);function E(Y,Z){function ne(fe,Te){if(!xe(fe))throw new TypeError;if(!oe(Te)&&!L(Te))throw new TypeError;W(Y,Z,fe,Te)}return ne}t("metadata",E);function x(Y,Z,ne,fe){if(!xe(ne))throw new TypeError;return oe(fe)||(fe=He(fe)),W(Y,Z,ne,fe)}t("defineMetadata",x);function P(Y,Z,ne){if(!xe(Z))throw new TypeError;return oe(ne)||(ne=He(ne)),$(Y,Z,ne)}t("hasMetadata",P);function T(Y,Z,ne){if(!xe(Z))throw new TypeError;return oe(ne)||(ne=He(ne)),K(Y,Z,ne)}t("hasOwnMetadata",T);function D(Y,Z,ne){if(!xe(Z))throw new TypeError;return oe(ne)||(ne=He(ne)),X(Y,Z,ne)}t("getMetadata",D);function C(Y,Z,ne){if(!xe(Z))throw new TypeError;return oe(ne)||(ne=He(ne)),te(Y,Z,ne)}t("getOwnMetadata",C);function R(Y,Z){if(!xe(Y))throw new TypeError;return oe(Z)||(Z=He(Z)),ie(Y,Z)}t("getMetadataKeys",R);function O(Y,Z){if(!xe(Y))throw new TypeError;return oe(Z)||(Z=He(Z)),ce(Y,Z)}t("getOwnMetadataKeys",O);function V(Y,Z,ne){if(!xe(Z))throw new TypeError;if(oe(ne)||(ne=He(ne)),!xe(Z))throw new TypeError;oe(ne)||(ne=He(ne));var fe=Ce(Z,ne,!1);return oe(fe)?!1:fe.OrdinaryDeleteMetadata(Y,Z,ne)}t("deleteMetadata",V);function B(Y,Z){for(var ne=Y.length-1;ne>=0;--ne){var fe=Y[ne],Te=fe(Z);if(!oe(Te)&&!Se(Te)){if(!G(Te))throw new TypeError;Z=Te}}return Z}function z(Y,Z,ne,fe){for(var Te=Y.length-1;Te>=0;--Te){var Ut=Y[Te],Gt=Ut(Z,ne,fe);if(!oe(Gt)&&!Se(Gt)){if(!xe(Gt))throw new TypeError;fe=Gt}}return fe}function $(Y,Z,ne){var fe=K(Y,Z,ne);if(fe)return!0;var Te=_(Z);return Se(Te)?!1:$(Y,Te,ne)}function K(Y,Z,ne){var fe=Ce(Z,ne,!1);return oe(fe)?!1:se(fe.OrdinaryHasOwnMetadata(Y,Z,ne))}function X(Y,Z,ne){var fe=K(Y,Z,ne);if(fe)return te(Y,Z,ne);var Te=_(Z);if(!Se(Te))return X(Y,Te,ne)}function te(Y,Z,ne){var fe=Ce(Z,ne,!1);if(!oe(fe))return fe.OrdinaryGetOwnMetadata(Y,Z,ne)}function W(Y,Z,ne,fe){var Te=Ce(ne,fe,!0);Te.OrdinaryDefineOwnMetadata(Y,Z,ne,fe)}function ie(Y,Z){var ne=ce(Y,Z),fe=_(Y);if(fe===null)return ne;var Te=ie(fe,Z);if(Te.length<=0)return ne;if(ne.length<=0)return Te;for(var Ut=new g,Gt=[],nt=0,Ae=ne;nt<Ae.length;nt++){var Re=Ae[nt],Oe=Ut.has(Re);Oe||(Ut.add(Re),Gt.push(Re))}for(var Be=0,it=Te;Be<it.length;Be++){var Re=it[Be],Oe=Ut.has(Re);Oe||(Ut.add(Re),Gt.push(Re))}return Gt}function ce(Y,Z){var ne=Ce(Y,Z,!1);return ne?ne.OrdinaryOwnMetadataKeys(Y,Z):[]}function de(Y){if(Y===null)return 1;switch(typeof Y){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Y===null?1:6;default:return 6}}function oe(Y){return Y===void 0}function Se(Y){return Y===null}function Le(Y){return typeof Y=="symbol"}function xe(Y){return typeof Y=="object"?Y!==null:typeof Y=="function"}function ee(Y,Z){switch(de(Y)){case 0:return Y;case 1:return Y;case 2:return Y;case 3:return Y;case 4:return Y;case 5:return Y}var ne="string",fe=q(Y,o);if(fe!==void 0){var Te=fe.call(Y,ne);if(xe(Te))throw new TypeError;return Te}return pe(Y)}function pe(Y,Z){var ne,fe,Te;{var Ut=Y.toString;if(F(Ut)){var fe=Ut.call(Y);if(!xe(fe))return fe}var ne=Y.valueOf;if(F(ne)){var fe=ne.call(Y);if(!xe(fe))return fe}}throw new TypeError}function se(Y){return!!Y}function ye(Y){return""+Y}function He(Y){var Z=ee(Y);return Le(Z)?Z:ye(Z)}function M(Y){return Array.isArray?Array.isArray(Y):Y instanceof Object?Y instanceof Array:Object.prototype.toString.call(Y)==="[object Array]"}function F(Y){return typeof Y=="function"}function G(Y){return typeof Y=="function"}function L(Y){switch(de(Y)){case 3:return!0;case 4:return!0;default:return!1}}function U(Y,Z){return Y===Z||Y!==Y&&Z!==Z}function q(Y,Z){var ne=Y[Z];if(ne!=null){if(!F(ne))throw new TypeError;return ne}}function re(Y){var Z=q(Y,a);if(!F(Z))throw new TypeError;var ne=Z.call(Y);if(!xe(ne))throw new TypeError;return ne}function k(Y){return Y.value}function p(Y){var Z=Y.next();return Z.done?!1:Z}function y(Y){var Z=Y.return;Z&&Z.call(Y)}function _(Y){var Z=Object.getPrototypeOf(Y);if(typeof Y!="function"||Y===d||Z!==d)return Z;var ne=Y.prototype,fe=ne&&Object.getPrototypeOf(ne);if(fe==null||fe===Object.prototype)return Z;var Te=fe.constructor;return typeof Te!="function"||Te===Y?Z:Te}function N(){var Y;!oe(b)&&typeof n.Reflect<"u"&&!(b in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(Y=ge(n.Reflect));var Z,ne,fe,Te=new m,Ut={registerProvider:Gt,getProvider:Ae,setProvider:Oe};return Ut;function Gt(Be){if(!Object.isExtensible(Ut))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case Y===Be:break;case oe(Z):Z=Be;break;case Z===Be:break;case oe(ne):ne=Be;break;case ne===Be:break;default:fe===void 0&&(fe=new g),fe.add(Be);break}}function nt(Be,it){if(!oe(Z)){if(Z.isProviderFor(Be,it))return Z;if(!oe(ne)){if(ne.isProviderFor(Be,it))return Z;if(!oe(fe))for(var Ot=re(fe);;){var Xt=p(Ot);if(!Xt)return;var ss=k(Xt);if(ss.isProviderFor(Be,it))return y(Ot),ss}}}if(!oe(Y)&&Y.isProviderFor(Be,it))return Y}function Ae(Be,it){var Ot=Te.get(Be),Xt;return oe(Ot)||(Xt=Ot.get(it)),oe(Xt)&&(Xt=nt(Be,it),oe(Xt)||(oe(Ot)&&(Ot=new f,Te.set(Be,Ot)),Ot.set(it,Xt))),Xt}function Re(Be){if(oe(Be))throw new TypeError;return Z===Be||ne===Be||!oe(fe)&&fe.has(Be)}function Oe(Be,it,Ot){if(!Re(Ot))throw new Error("Metadata provider not registered.");var Xt=Ae(Be,it);if(Xt!==Ot){if(!oe(Xt))return!1;var ss=Te.get(Be);oe(ss)&&(ss=new f,Te.set(Be,ss)),ss.set(it,Ot)}return!0}}function H(){var Y;return!oe(b)&&xe(n.Reflect)&&Object.isExtensible(n.Reflect)&&(Y=n.Reflect[b]),oe(Y)&&(Y=N()),!oe(b)&&xe(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,b,{enumerable:!1,configurable:!1,writable:!1,value:Y}),Y}function Q(Y){var Z=new m,ne={isProviderFor:function(Re,Oe){var Be=Z.get(Re);return oe(Be)?!1:Be.has(Oe)},OrdinaryDefineOwnMetadata:Gt,OrdinaryHasOwnMetadata:Te,OrdinaryGetOwnMetadata:Ut,OrdinaryOwnMetadataKeys:nt,OrdinaryDeleteMetadata:Ae};return v.registerProvider(ne),ne;function fe(Re,Oe,Be){var it=Z.get(Re),Ot=!1;if(oe(it)){if(!Be)return;it=new f,Z.set(Re,it),Ot=!0}var Xt=it.get(Oe);if(oe(Xt)){if(!Be)return;if(Xt=new f,it.set(Oe,Xt),!Y.setProvider(Re,Oe,ne))throw it.delete(Oe),Ot&&Z.delete(Re),new Error("Wrong provider for target.")}return Xt}function Te(Re,Oe,Be){var it=fe(Oe,Be,!1);return oe(it)?!1:se(it.has(Re))}function Ut(Re,Oe,Be){var it=fe(Oe,Be,!1);if(!oe(it))return it.get(Re)}function Gt(Re,Oe,Be,it){var Ot=fe(Be,it,!0);Ot.set(Re,Oe)}function nt(Re,Oe){var Be=[],it=fe(Re,Oe,!1);if(oe(it))return Be;for(var Ot=it.keys(),Xt=re(Ot),ss=0;;){var xb=p(Xt);if(!xb)return Be.length=ss,Be;var yO=k(xb);try{Be[ss]=yO}catch(wO){try{y(Xt)}finally{throw wO}}ss++}}function Ae(Re,Oe,Be){var it=fe(Oe,Be,!1);if(oe(it)||!it.delete(Re))return!1;if(it.size===0){var Ot=Z.get(Oe);oe(Ot)||(Ot.delete(Be),Ot.size===0&&Z.delete(Ot))}return!0}}function ge(Y){var Z=Y.defineMetadata,ne=Y.hasOwnMetadata,fe=Y.getOwnMetadata,Te=Y.getOwnMetadataKeys,Ut=Y.deleteMetadata,Gt=new m,nt={isProviderFor:function(Ae,Re){var Oe=Gt.get(Ae);return!oe(Oe)&&Oe.has(Re)?!0:Te(Ae,Re).length?(oe(Oe)&&(Oe=new g,Gt.set(Ae,Oe)),Oe.add(Re),!0):!1},OrdinaryDefineOwnMetadata:Z,OrdinaryHasOwnMetadata:ne,OrdinaryGetOwnMetadata:fe,OrdinaryOwnMetadataKeys:Te,OrdinaryDeleteMetadata:Ut};return nt}function Ce(Y,Z,ne){var fe=v.getProvider(Y,Z);if(!oe(fe))return fe;if(ne){if(v.setProvider(Y,Z,A))return A;throw new Error("Illegal state.")}}function Me(){var Y={},Z=[],ne=(function(){function nt(Ae,Re,Oe){this._index=0,this._keys=Ae,this._values=Re,this._selector=Oe}return nt.prototype["@@iterator"]=function(){return this},nt.prototype[a]=function(){return this},nt.prototype.next=function(){var Ae=this._index;if(Ae>=0&&Ae<this._keys.length){var Re=this._selector(this._keys[Ae],this._values[Ae]);return Ae+1>=this._keys.length?(this._index=-1,this._keys=Z,this._values=Z):this._index++,{value:Re,done:!1}}return{value:void 0,done:!0}},nt.prototype.throw=function(Ae){throw this._index>=0&&(this._index=-1,this._keys=Z,this._values=Z),Ae},nt.prototype.return=function(Ae){return this._index>=0&&(this._index=-1,this._keys=Z,this._values=Z),{value:Ae,done:!0}},nt})(),fe=(function(){function nt(){this._keys=[],this._values=[],this._cacheKey=Y,this._cacheIndex=-2}return Object.defineProperty(nt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),nt.prototype.has=function(Ae){return this._find(Ae,!1)>=0},nt.prototype.get=function(Ae){var Re=this._find(Ae,!1);return Re>=0?this._values[Re]:void 0},nt.prototype.set=function(Ae,Re){var Oe=this._find(Ae,!0);return this._values[Oe]=Re,this},nt.prototype.delete=function(Ae){var Re=this._find(Ae,!1);if(Re>=0){for(var Oe=this._keys.length,Be=Re+1;Be<Oe;Be++)this._keys[Be-1]=this._keys[Be],this._values[Be-1]=this._values[Be];return this._keys.length--,this._values.length--,U(Ae,this._cacheKey)&&(this._cacheKey=Y,this._cacheIndex=-2),!0}return!1},nt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Y,this._cacheIndex=-2},nt.prototype.keys=function(){return new ne(this._keys,this._values,Te)},nt.prototype.values=function(){return new ne(this._keys,this._values,Ut)},nt.prototype.entries=function(){return new ne(this._keys,this._values,Gt)},nt.prototype["@@iterator"]=function(){return this.entries()},nt.prototype[a]=function(){return this.entries()},nt.prototype._find=function(Ae,Re){if(!U(this._cacheKey,Ae)){this._cacheIndex=-1;for(var Oe=0;Oe<this._keys.length;Oe++)if(U(this._keys[Oe],Ae)){this._cacheIndex=Oe;break}}return this._cacheIndex<0&&Re&&(this._cacheIndex=this._keys.length,this._keys.push(Ae),this._values.push(void 0)),this._cacheIndex},nt})();return fe;function Te(nt,Ae){return nt}function Ut(nt,Ae){return Ae}function Gt(nt,Ae){return[nt,Ae]}}function Fe(){var Y=(function(){function Z(){this._map=new f}return Object.defineProperty(Z.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Z.prototype.has=function(ne){return this._map.has(ne)},Z.prototype.add=function(ne){return this._map.set(ne,ne),this},Z.prototype.delete=function(ne){return this._map.delete(ne)},Z.prototype.clear=function(){this._map.clear()},Z.prototype.keys=function(){return this._map.keys()},Z.prototype.values=function(){return this._map.keys()},Z.prototype.entries=function(){return this._map.entries()},Z.prototype["@@iterator"]=function(){return this.keys()},Z.prototype[a]=function(){return this.keys()},Z})();return Y}function $e(){var Y=16,Z=h.create(),ne=fe();return(function(){function Ae(){this._key=fe()}return Ae.prototype.has=function(Re){var Oe=Te(Re,!1);return Oe!==void 0?h.has(Oe,this._key):!1},Ae.prototype.get=function(Re){var Oe=Te(Re,!1);return Oe!==void 0?h.get(Oe,this._key):void 0},Ae.prototype.set=function(Re,Oe){var Be=Te(Re,!0);return Be[this._key]=Oe,this},Ae.prototype.delete=function(Re){var Oe=Te(Re,!1);return Oe!==void 0?delete Oe[this._key]:!1},Ae.prototype.clear=function(){this._key=fe()},Ae})();function fe(){var Ae;do Ae="@@WeakMap@@"+nt();while(h.has(Z,Ae));return Z[Ae]=!0,Ae}function Te(Ae,Re){if(!s.call(Ae,ne)){if(!Re)return;Object.defineProperty(Ae,ne,{value:h.create()})}return Ae[ne]}function Ut(Ae,Re){for(var Oe=0;Oe<Re;++Oe)Ae[Oe]=Math.random()*255|0;return Ae}function Gt(Ae){if(typeof Uint8Array=="function"){var Re=new Uint8Array(Ae);return typeof crypto<"u"?crypto.getRandomValues(Re):typeof msCrypto<"u"?msCrypto.getRandomValues(Re):Ut(Re,Ae),Re}return Ut(new Array(Ae),Ae)}function nt(){var Ae=Gt(Y);Ae[6]=Ae[6]&79|64,Ae[8]=Ae[8]&191|128;for(var Re="",Oe=0;Oe<Y;++Oe){var Be=Ae[Oe];(Oe===4||Oe===6||Oe===8)&&(Re+="-"),Be<16&&(Re+="0"),Re+=Be.toString(16).toLowerCase()}return Re}}function ft(Y){return Y.__=void 0,delete Y.__,Y}})})(r||(r={})),GE}Nle();var ae;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(ae||(ae={}));var j;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(j||(j={}));class L2{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(ve.isBufferSource(e))this.unusedBits=t,this.value=ve.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof Ua))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new Ua({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new Ua({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const s=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let i=0;for(;i<n;)s[i]=parseInt(t.slice(i<<3,(i<<3)+8),2),i++;this.value=s.buffer}}class ut{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):ve.isBufferSource(e)?this.buffer=ve.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ps))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ps({valueHex:this.buffer})}toSchema(e){return new ps({name:e})}}const Ole={fromASN:r=>r instanceof qi?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new qi;const e=Bi(r);if(e.result.error)throw new Error(e.result.error);return e.result}},Lle={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new Mi({value:+r})},Ble={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new g2({value:r})},$t={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Mi({valueHex:r})},Mle={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new Ua({valueHex:r})},$le={fromASN:r=>r.valueBlock.toString(),toASN:r=>new Ii({value:r})},Ule={fromASN:r=>r.valueBlock.value,toASN:r=>new p2({value:r})},T0={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ps({valueHex:r})},Fle={fromASN:r=>new ut(r.getValue()),toASN:r=>r.toASN()};function ns(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const DD=ns(no),Vle=ns(m2),zle=ns(y2),Hle=ns(w2),qle=ns(b2),Kle=ns(v2),jle=ns(E2),Wle=ns(S2),Gle=ns(_2),Yle=ns(If),Qle=ns(x2),Xle=ns(A2),Jle={fromASN:r=>r.toDate(),toASN:r=>new Tf({valueDate:r})},Zle={fromASN:r=>r.toDate(),toASN:r=>new C2({valueDate:r})},eue={fromASN:()=>null,toASN:()=>new qi};function Zh(r){switch(r){case j.Any:return Ole;case j.BitString:return Mle;case j.BmpString:return Vle;case j.Boolean:return Ule;case j.CharacterString:return Xle;case j.Enumerated:return Ble;case j.GeneralString:return Qle;case j.GeneralizedTime:return Zle;case j.GraphicString:return Gle;case j.IA5String:return Wle;case j.Integer:return Lle;case j.Null:return eue;case j.NumericString:return Hle;case j.ObjectIdentifier:return $le;case j.OctetString:return T0;case j.PrintableString:return qle;case j.TeletexString:return Kle;case j.UTCTime:return Jle;case j.UniversalString:return zle;case j.Utf8String:return DD;case j.VideotexString:return jle;case j.VisibleString:return Yle;default:return null}}function Ri(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:Ri(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function ND(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t?.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:ND(t)}return!1}function tue(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let s=0;s<r.byteLength;s++)if(t[s]!==n[s])return!1;return!0}class rue{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:ae.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),s=[];for(const i in n.items){const o=n.items[i],a=t?i:"";let c;if(typeof o.type=="number"){const u=j[o.type],h=AP[u];if(!h)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new h({name:a})}else Ri(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===ae.Choice?c=new ec({name:a}):(c=this.create(o.type,!1),c.name=a):c=new ec({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const u=o.repeated==="set"?ei:nr;c=new u({name:"",value:[new g0({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||Ri(o.type)){const u=o.repeated?tn:kf;s.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const u=!!o.repeated;let h=u?c:this.get(o.type,!0).schema;h="valueBlock"in h?h.valueBlock.value:h.value,s.push(new tn({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:h}))}else s.push(new tn({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,s.push(c)}switch(n.type){case ae.Sequence:return new nr({value:s,name:""});case ae.Set:return new ei({value:s,name:""});case ae.Choice:return new w8({value:s,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const or=new rue,me=r=>e=>{let t;or.has(e)?t=or.get(e):(t=or.createDefault(e),or.set(e,t)),Object.assign(t,r)},I=r=>(e,t)=>{let n;or.has(e.constructor)?n=or.get(e.constructor):(n=or.createDefault(e.constructor),or.set(e.constructor,n));const s=Object.assign({},r);if(typeof s.type=="number"&&!s.converter){const i=Zh(r.type);if(!i)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);s.converter=i}s.raw=r.raw,n.items[t]=s};class Ju extends Error{constructor(){super(...arguments),this.schemas=[]}}class nue{static parse(e,t){const n=Bi(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){try{if(Ri(t))return new t().fromASN(e);const n=or.get(t);or.cache(t);let s=n.schema;const i=this.handleChoiceTypes(e,n,t,s);if(i?.result)return i.result;i?.targetSchema&&(s=i.targetSchema);const o=this.handleSequenceTypes(e,n,t,s);if(o&&"isManualMapping"in o)return o.result;const a=o,c=new t;return ND(t)?this.handleArrayTypes(e,n,t):(this.processSchemaItems(n,a,c),c)}catch(n){throw n instanceof Ju&&n.schemas.push(t.name),n}}static handleChoiceTypes(e,t,n,s){if(e.constructor===tn&&t.type===ae.Choice&&e.idBlock.tagClass===3)for(const i in t.items){const o=t.items[i];if(o.context===e.idBlock.tagNumber&&o.implicit&&typeof o.type=="function"&&or.has(o.type)){const a=or.get(o.type);if(a&&a.type===ae.Sequence){const c=new nr;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in c.valueBlock){c.valueBlock.value=e.valueBlock.value;const l=this.fromASN(c,o.type),u=new n;return u[i]=l,{result:u}}}}}else if(e.constructor===tn&&t.type!==ae.Choice){const i=new tn({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:t.schema.valueBlock.value});for(const o in t.items)delete e[o];return{targetSchema:i}}return null}static handleSequenceTypes(e,t,n,s){if(t.type===ae.Sequence){if(Object.keys(t.items).filter(a=>{const c=t.items[a];return c.optional&&typeof c.type=="function"&&or.has(c.type)&&or.get(c.type).type===ae.Choice}).length>0&&"value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&n.name==="CertReqMsg")return this.handleManualMapping(e,t,n);const o=To({},e,s);if(!o.verified)throw new Ju(`Data does not match to ${n.name} ASN1 schema.${o.result.error?` ${o.result.error}`:""}`);return o}else{const i=To({},e,s);if(!i.verified)throw new Ju(`Data does not match to ${n.name} ASN1 schema.${i.result.error?` ${i.result.error}`:""}`);return i}}static handleManualMapping(e,t,n){const s=new n,i=e.valueBlock.value,o=Object.keys(t.items);let a=0;for(let c=0;c<o.length;c++){const l=o[c],u=t.items[l];if(a>=i.length)break;if(u.repeated){s[l]=this.processRepeatedField(i,a,u);break}else if(typeof u.type=="number")s[l]=this.processPrimitiveField(i[a],u),a++;else if(this.isOptionalChoiceField(u)){const h=this.processOptionalChoiceField(i[a],u);h.processed&&(s[l]=h.value,a++)}else s[l]=this.fromASN(i[a],u.type),a++}return{result:s,verified:!0,isManualMapping:!0}}static processRepeatedField(e,t,n){let s=e.slice(t);if(s.length===1&&s[0].constructor.name==="Sequence"){const i=s[0];i.valueBlock&&i.valueBlock.value&&Array.isArray(i.valueBlock.value)&&(s=i.valueBlock.value)}if(typeof n.type=="number"){const i=Zh(n.type);if(!i)throw new Error(`No converter for ASN.1 type ${n.type}`);return s.filter(o=>o&&o.valueBlock).map(o=>{try{return i.fromASN(o)}catch{return}}).filter(o=>o!==void 0)}else return s.filter(i=>i&&i.valueBlock).map(i=>{try{return this.fromASN(i,n.type)}catch{return}}).filter(i=>i!==void 0)}static processPrimitiveField(e,t){const n=Zh(t.type);if(!n)throw new Error(`No converter for ASN.1 type ${t.type}`);return n.fromASN(e)}static isOptionalChoiceField(e){return e.optional&&typeof e.type=="function"&&or.has(e.type)&&or.get(e.type).type===ae.Choice}static processOptionalChoiceField(e,t){try{return{processed:!0,value:this.fromASN(e,t.type)}}catch(n){if(n instanceof Ju&&/Wrong values for Choice type/.test(n.message))return{processed:!1};throw n}}static handleArrayTypes(e,t,n){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const s=t.itemType;if(typeof s=="number"){const i=Zh(s);if(!i)throw new Error(`Cannot get default converter for array item of ${n.name} ASN1 schema`);return n.from(e.valueBlock.value,o=>i.fromASN(o))}else return n.from(e.valueBlock.value,i=>this.fromASN(i,s))}static processSchemaItems(e,t,n){for(const s in e.items){const i=t.result[s];if(!i)continue;const o=e.items[s],a=o.type;let c;typeof a=="number"||Ri(a)?c=this.processPrimitiveSchemaItem(i,o,a):c=this.processComplexSchemaItem(i,o,a),c&&typeof c=="object"&&"value"in c&&"raw"in c?(n[s]=c.value,n[`${s}Raw`]=c.raw):n[s]=c}}static processPrimitiveSchemaItem(e,t,n){var s;const i=(s=t.converter)!==null&&s!==void 0?s:Ri(n)?new n:null;if(!i)throw new Error("Converter is empty");return t.repeated?this.processRepeatedPrimitiveItem(e,t,i):this.processSinglePrimitiveItem(e,t,n,i)}static processRepeatedPrimitiveItem(e,t,n){if(t.implicit){const s=t.repeated==="sequence"?nr:ei,i=new s;i.valueBlock=e.valueBlock;const o=Bi(i.toBER(!1));if(o.offset===-1)throw new Error(`Cannot parse the child item. ${o.result.error}`);if(!("value"in o.result.valueBlock&&Array.isArray(o.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const a=o.result.valueBlock.value;return Array.from(a,c=>n.fromASN(c))}else return Array.from(e,s=>n.fromASN(s))}static processSinglePrimitiveItem(e,t,n,s){let i=e;if(t.implicit){let o;if(Ri(n))o=new n().toSchema("");else{const a=j[n],c=AP[a];if(!c)throw new Error(`Cannot get '${a}' class from asn1js module`);o=new c}o.valueBlock=i.valueBlock,i=Bi(o.toBER(!1)).result}return s.fromASN(i)}static processComplexSchemaItem(e,t,n){if(t.repeated){if(!Array.isArray(e))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");return Array.from(e,s=>this.fromASN(s,n))}else{const s=this.handleImplicitTagging(e,t,n);if(this.isOptionalChoiceField(t))try{return this.fromASN(s,n)}catch(i){if(i instanceof Ju&&/Wrong values for Choice type/.test(i.message))return;throw i}else{const i=this.fromASN(s,n);return t.raw?{value:i,raw:e.valueBeforeDecodeView}:i}}}static handleImplicitTagging(e,t,n){if(t.implicit&&typeof t.context=="number"){const s=or.get(n);if(s.type===ae.Sequence){const i=new nr;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}else if(s.type===ae.Set){const i=new ei;if("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)&&"value"in i.valueBlock)return i.valueBlock.value=e.valueBlock.value,i}}return e}}class L8{static serialize(e){return e instanceof Tr?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&Ri(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=or.get(t);or.cache(t);let s=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=Zh(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);s=e.map(a=>o.toASN(a))}else s=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&tue(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=L8.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||Ri(a.type))){const u={};u.valueHex=l instanceof qi?l.valueBeforeDecodeView:l.valueBlock.toBER(),s.push(new kf({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...u}))}else s.push(new tn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else s.push(new tn({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?s=s.concat(l):s.push(l)}let i;switch(n.type){case ae.Sequence:i=new nr({value:s});break;case ae.Set:i=new ei({value:s});break;case ae.Choice:if(!s[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);i=s[0];break}return i}static toAsnItem(e,t,n,s){let i;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${j[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(s,l=>o.toASN(l)),c=e.repeated==="sequence"?nr:ei;i=new c({value:a})}else i=o.toASN(s)}else if(e.repeated){if(!Array.isArray(s))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(s,c=>this.toASN(c)),a=e.repeated==="sequence"?nr:ei;i=new a({value:o})}else i=this.toASN(s);return i}}class _t extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class be{static serialize(e){return L8.serialize(e)}static parse(e,t){return nue.parse(e,t)}static toString(e){const t=ve.isBufferSource(e)?ve.toArrayBuffer(e):be.serialize(e),n=Bi(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function S(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function Xe(r,e,t,n){if(t==="a"&&!n)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?n:t==="a"?n.call(r):n?n.value:e.get(r)}function Vt(r,e,t,n,s){if(n==="m")throw new TypeError("Private method is not writable");if(n==="a"&&!s)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return n==="a"?s.call(r,t):s?s.value=t:e.set(r,t),t}class QE{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const s=parseInt(n,10);if(isNaN(s)||s<0||s>255)throw new Error("Invalid IPv4 address part");return s})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((s,i)=>{const o=parseInt(i,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return s.push(o>>8&255),s.push(o&255),s},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],s=t[1]?t[1].split(":"):[],i=8-(n.length+s.length);if(i<0)throw new Error("Invalid IPv6 address");return[...n,...Array(i).fill("0"),...s].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,s=0,i=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(i===-1&&(i=a),o++):(o>s&&(n=i,s=o),i=-1,o=0);if(o>s&&(n=i,s=o),s>1){const a=t.slice(0,n).join(":"),c=t.slice(n+s).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),s=parseInt(n,10);if(this.isIPv4(t)){if(s<0||s>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),s]}else{if(s<0||s>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),s]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((s,i)=>s+ +i,0);let n=e.slice(0,8).replace(/(.{2})/g,s=>`${parseInt(s,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,s=t.slice(0,n),i=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=i.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(s).join(".")}/${a}`:`${this.formatIPv6(s)}/${a}`}return this.decodeIP(Ne.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,s]=this.parseCIDR(e),i=new Uint8Array(n.length);let o=s;for(let c=0;c<i.length;c++)o>=8?(i[c]=255,o-=8):o>0&&(i[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(i,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var A4,C4,k4;let Rr=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};S([I({type:j.TeletexString})],Rr.prototype,"teletexString",void 0);S([I({type:j.PrintableString})],Rr.prototype,"printableString",void 0);S([I({type:j.UniversalString})],Rr.prototype,"universalString",void 0);S([I({type:j.Utf8String})],Rr.prototype,"utf8String",void 0);S([I({type:j.BmpString})],Rr.prototype,"bmpString",void 0);Rr=S([me({type:ae.Choice})],Rr);let Jl=class extends Rr{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ne.ToHex(this.anyValue):super.toString())}};S([I({type:j.IA5String})],Jl.prototype,"ia5String",void 0);S([I({type:j.Any})],Jl.prototype,"anyValue",void 0);Jl=S([me({type:ae.Choice})],Jl);class B2{constructor(e={}){this.type="",this.value=new Jl,Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],B2.prototype,"type",void 0);S([I({type:Jl})],B2.prototype,"value",void 0);let Zl=A4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,A4.prototype)}};Zl=A4=S([me({type:ae.Set,itemType:B2})],Zl);let I4=C4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,C4.prototype)}};I4=C4=S([me({type:ae.Sequence,itemType:Zl})],I4);let Jt=k4=class extends I4{constructor(e){super(e),Object.setPrototypeOf(this,k4.prototype)}};Jt=k4=S([me({type:ae.Sequence})],Jt);const sue={fromASN:r=>QE.toString(T0.fromASN(r)),toASN:r=>T0.toASN(QE.fromString(r))};class Wd{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],Wd.prototype,"typeId",void 0);S([I({type:j.Any,context:0})],Wd.prototype,"value",void 0);class B8{constructor(e={}){this.partyName=new Rr,Object.assign(this,e)}}S([I({type:Rr,optional:!0,context:0,implicit:!0})],B8.prototype,"nameAssigner",void 0);S([I({type:Rr,context:1,implicit:!0})],B8.prototype,"partyName",void 0);let We=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Wd,context:0,implicit:!0})],We.prototype,"otherName",void 0);S([I({type:j.IA5String,context:1,implicit:!0})],We.prototype,"rfc822Name",void 0);S([I({type:j.IA5String,context:2,implicit:!0})],We.prototype,"dNSName",void 0);S([I({type:j.Any,context:3,implicit:!0})],We.prototype,"x400Address",void 0);S([I({type:Jt,context:4,implicit:!1})],We.prototype,"directoryName",void 0);S([I({type:B8,context:5})],We.prototype,"ediPartyName",void 0);S([I({type:j.IA5String,context:6,implicit:!0})],We.prototype,"uniformResourceIdentifier",void 0);S([I({type:j.OctetString,context:7,implicit:!0,converter:sue})],We.prototype,"iPAddress",void 0);S([I({type:j.ObjectIdentifier,context:8,implicit:!0})],We.prototype,"registeredID",void 0);We=S([me({type:ae.Choice})],We);const M8="1.3.6.1.5.5.7",iue=`${M8}.1`,ku=`${M8}.3`,M2=`${M8}.48`,XE=`${M2}.1`,JE=`${M2}.2`,ZE=`${M2}.3`,eS=`${M2}.5`,so="2.5.29";var T4;const R4=`${iue}.1`;class Df{constructor(e={}){this.accessMethod="",this.accessLocation=new We,Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],Df.prototype,"accessMethod",void 0);S([I({type:We})],Df.prototype,"accessLocation",void 0);let el=T4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,T4.prototype)}};el=T4=S([me({type:ae.Sequence,itemType:Df})],el);const P4=`${so}.35`;class $8 extends ut{}class Ia{constructor(e={}){e&&Object.assign(this,e)}}S([I({type:$8,context:0,optional:!0,implicit:!0})],Ia.prototype,"keyIdentifier",void 0);S([I({type:We,context:1,optional:!0,implicit:!0,repeated:"sequence"})],Ia.prototype,"authorityCertIssuer",void 0);S([I({type:j.Integer,context:2,optional:!0,implicit:!0,converter:$t})],Ia.prototype,"authorityCertSerialNumber",void 0);const OD=`${so}.19`;class R0{constructor(e={}){this.cA=!1,Object.assign(this,e)}}S([I({type:j.Boolean,defaultValue:!1})],R0.prototype,"cA",void 0);S([I({type:j.Integer,optional:!0})],R0.prototype,"pathLenConstraint",void 0);var D4;let Kr=D4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,D4.prototype)}};Kr=D4=S([me({type:ae.Sequence,itemType:We})],Kr);var N4;let tS=N4=class extends Kr{constructor(e){super(e),Object.setPrototypeOf(this,N4.prototype)}};tS=N4=S([me({type:ae.Sequence})],tS);var O4;const LD=`${so}.32`;let ji=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};S([I({type:j.IA5String})],ji.prototype,"ia5String",void 0);S([I({type:j.VisibleString})],ji.prototype,"visibleString",void 0);S([I({type:j.BmpString})],ji.prototype,"bmpString",void 0);S([I({type:j.Utf8String})],ji.prototype,"utf8String",void 0);ji=S([me({type:ae.Choice})],ji);class U8{constructor(e={}){this.organization=new ji,this.noticeNumbers=[],Object.assign(this,e)}}S([I({type:ji})],U8.prototype,"organization",void 0);S([I({type:j.Integer,repeated:"sequence"})],U8.prototype,"noticeNumbers",void 0);class F8{constructor(e={}){Object.assign(this,e)}}S([I({type:U8,optional:!0})],F8.prototype,"noticeRef",void 0);S([I({type:ji,optional:!0})],F8.prototype,"explicitText",void 0);let P0=class{constructor(e={}){Object.assign(this,e)}};S([I({type:j.IA5String})],P0.prototype,"cPSuri",void 0);S([I({type:F8})],P0.prototype,"userNotice",void 0);P0=S([me({type:ae.Choice})],P0);class V8{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],V8.prototype,"policyQualifierId",void 0);S([I({type:j.Any})],V8.prototype,"qualifier",void 0);class $2{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],$2.prototype,"policyIdentifier",void 0);S([I({type:V8,repeated:"sequence",optional:!0})],$2.prototype,"policyQualifiers",void 0);let D0=O4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,O4.prototype)}};D0=O4=S([me({type:ae.Sequence,itemType:$2})],D0);let N0=class{constructor(e=0){this.value=e}};S([I({type:j.Integer})],N0.prototype,"value",void 0);N0=S([me({type:ae.Choice})],N0);let rS=class extends N0{};rS=S([me({type:ae.Choice})],rS);var L4;const B4=`${so}.31`;var hs;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(hs||(hs={}));class BD extends L2{toJSON(){const e=[],t=this.toNumber();return t&hs.aACompromise&&e.push("aACompromise"),t&hs.affiliationChanged&&e.push("affiliationChanged"),t&hs.cACompromise&&e.push("cACompromise"),t&hs.certificateHold&&e.push("certificateHold"),t&hs.cessationOfOperation&&e.push("cessationOfOperation"),t&hs.keyCompromise&&e.push("keyCompromise"),t&hs.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&hs.superseded&&e.push("superseded"),t&hs.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let tc=class{constructor(e={}){Object.assign(this,e)}};S([I({type:We,context:0,repeated:"sequence",implicit:!0})],tc.prototype,"fullName",void 0);S([I({type:Zl,context:1,implicit:!0})],tc.prototype,"nameRelativeToCRLIssuer",void 0);tc=S([me({type:ae.Choice})],tc);class Iu{constructor(e={}){Object.assign(this,e)}}S([I({type:tc,context:0,optional:!0})],Iu.prototype,"distributionPoint",void 0);S([I({type:BD,context:1,optional:!0,implicit:!0})],Iu.prototype,"reasons",void 0);S([I({type:We,context:2,optional:!0,repeated:"sequence",implicit:!0})],Iu.prototype,"cRLIssuer",void 0);let vl=L4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,L4.prototype)}};vl=L4=S([me({type:ae.Sequence,itemType:Iu})],vl);var M4;let nS=M4=class extends vl{constructor(e){super(e),Object.setPrototypeOf(this,M4.prototype)}};nS=M4=S([me({type:ae.Sequence,itemType:Iu})],nS);class Vr{constructor(e={}){this.onlyContainsUserCerts=Vr.ONLY,this.onlyContainsCACerts=Vr.ONLY,this.indirectCRL=Vr.ONLY,this.onlyContainsAttributeCerts=Vr.ONLY,Object.assign(this,e)}}Vr.ONLY=!1;S([I({type:tc,context:0,optional:!0})],Vr.prototype,"distributionPoint",void 0);S([I({type:j.Boolean,context:1,defaultValue:Vr.ONLY,implicit:!0})],Vr.prototype,"onlyContainsUserCerts",void 0);S([I({type:j.Boolean,context:2,defaultValue:Vr.ONLY,implicit:!0})],Vr.prototype,"onlyContainsCACerts",void 0);S([I({type:BD,context:3,optional:!0,implicit:!0})],Vr.prototype,"onlySomeReasons",void 0);S([I({type:j.Boolean,context:4,defaultValue:Vr.ONLY,implicit:!0})],Vr.prototype,"indirectCRL",void 0);S([I({type:j.Boolean,context:5,defaultValue:Vr.ONLY,implicit:!0})],Vr.prototype,"onlyContainsAttributeCerts",void 0);var ed;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(ed||(ed={}));let $4=class{constructor(e=ed.unspecified){this.reason=ed.unspecified,this.reason=e}toJSON(){return ed[this.reason]}toString(){return this.toJSON()}};S([I({type:j.Enumerated})],$4.prototype,"reason",void 0);$4=S([me({type:ae.Choice})],$4);var U4;const MD=`${so}.37`;let O0=U4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,U4.prototype)}};O0=U4=S([me({type:ae.Sequence,itemType:j.ObjectIdentifier})],O0);const oue=`${ku}.1`,aue=`${ku}.2`,cue=`${ku}.3`,lue=`${ku}.4`,uue=`${ku}.8`,hue=`${ku}.9`;let F4=class{constructor(e=new ArrayBuffer(0)){this.value=e}};S([I({type:j.Integer,converter:$t})],F4.prototype,"value",void 0);F4=S([me({type:ae.Choice})],F4);let V4=class{constructor(e){this.value=new Date,e&&(this.value=e)}};S([I({type:j.GeneralizedTime})],V4.prototype,"value",void 0);V4=S([me({type:ae.Choice})],V4);var z4;const $D=`${so}.18`;let sS=z4=class extends Kr{constructor(e){super(e),Object.setPrototypeOf(this,z4.prototype)}};sS=z4=S([me({type:ae.Sequence})],sS);const UD=`${so}.15`;var ds;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(ds||(ds={}));class Dy extends L2{toJSON(){const e=this.toNumber(),t=[];return e&ds.cRLSign&&t.push("crlSign"),e&ds.dataEncipherment&&t.push("dataEncipherment"),e&ds.decipherOnly&&t.push("decipherOnly"),e&ds.digitalSignature&&t.push("digitalSignature"),e&ds.encipherOnly&&t.push("encipherOnly"),e&ds.keyAgreement&&t.push("keyAgreement"),e&ds.keyCertSign&&t.push("keyCertSign"),e&ds.keyEncipherment&&t.push("keyEncipherment"),e&ds.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var H4;class U2{constructor(e={}){this.base=new We,this.minimum=0,Object.assign(this,e)}}S([I({type:We})],U2.prototype,"base",void 0);S([I({type:j.Integer,context:0,defaultValue:0,implicit:!0})],U2.prototype,"minimum",void 0);S([I({type:j.Integer,context:1,optional:!0,implicit:!0})],U2.prototype,"maximum",void 0);let L0=H4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,H4.prototype)}};L0=H4=S([me({type:ae.Sequence,itemType:U2})],L0);class FD{constructor(e={}){Object.assign(this,e)}}S([I({type:L0,context:0,optional:!0,implicit:!0})],FD.prototype,"permittedSubtrees",void 0);S([I({type:L0,context:1,optional:!0,implicit:!0})],FD.prototype,"excludedSubtrees",void 0);class VD{constructor(e={}){Object.assign(this,e)}}S([I({type:j.Integer,context:0,implicit:!0,optional:!0,converter:$t})],VD.prototype,"requireExplicitPolicy",void 0);S([I({type:j.Integer,context:1,implicit:!0,optional:!0,converter:$t})],VD.prototype,"inhibitPolicyMapping",void 0);var q4;class z8{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],z8.prototype,"issuerDomainPolicy",void 0);S([I({type:j.ObjectIdentifier})],z8.prototype,"subjectDomainPolicy",void 0);let iS=q4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,q4.prototype)}};iS=q4=S([me({type:ae.Sequence,itemType:z8})],iS);var K4;const zD=`${so}.17`;let j4=K4=class extends Kr{constructor(e){super(e),Object.setPrototypeOf(this,K4.prototype)}};j4=K4=S([me({type:ae.Sequence})],j4);let Wi=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};S([I({type:j.ObjectIdentifier})],Wi.prototype,"type",void 0);S([I({type:j.Any,repeated:"set"})],Wi.prototype,"values",void 0);var W4;let oS=W4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,W4.prototype)}};oS=W4=S([me({type:ae.Sequence,itemType:Wi})],oS);const HD=`${so}.14`;class Uo extends $8{}class qD{constructor(e={}){Object.assign(this,e)}}S([I({type:j.GeneralizedTime,context:0,implicit:!0,optional:!0})],qD.prototype,"notBefore",void 0);S([I({type:j.GeneralizedTime,context:1,implicit:!0,optional:!0})],qD.prototype,"notAfter",void 0);var td;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(td||(td={}));class KD extends L2{toJSON(){const e=[],t=this.toNumber();return t&td.pKIXCertificate&&e.push("pKIXCertificate"),t&td.newExtensions&&e.push("newExtensions"),t&td.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class jD{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new KD,Object.assign(this,e)}}S([I({type:j.GeneralString})],jD.prototype,"entrustVers",void 0);S([I({type:KD})],jD.prototype,"entrustInfoFlags",void 0);var G4;let aS=G4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,G4.prototype)}};aS=G4=S([me({type:ae.Sequence,itemType:Df})],aS);class ke{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ke&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&TR(e.parameters,this.parameters)||e.parameters===this.parameters)}}S([I({type:j.ObjectIdentifier})],ke.prototype,"algorithm",void 0);S([I({type:j.Any,optional:!0})],ke.prototype,"parameters",void 0);class ms{constructor(e={}){this.algorithm=new ke,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:ke})],ms.prototype,"algorithm",void 0);S([I({type:j.BitString})],ms.prototype,"subjectPublicKey",void 0);let Ar=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};S([I({type:j.UTCTime})],Ar.prototype,"utcTime",void 0);S([I({type:j.GeneralizedTime})],Ar.prototype,"generalTime",void 0);Ar=S([me({type:ae.Choice})],Ar);class Nf{constructor(e){this.notBefore=new Ar(new Date),this.notAfter=new Ar(new Date),e&&(this.notBefore=new Ar(e.notBefore),this.notAfter=new Ar(e.notAfter))}}S([I({type:Ar})],Nf.prototype,"notBefore",void 0);S([I({type:Ar})],Nf.prototype,"notAfter",void 0);var Y4;let ts=class WD{constructor(e={}){this.extnID="",this.critical=WD.CRITICAL,this.extnValue=new ut,Object.assign(this,e)}};ts.CRITICAL=!1;S([I({type:j.ObjectIdentifier})],ts.prototype,"extnID",void 0);S([I({type:j.Boolean,defaultValue:ts.CRITICAL})],ts.prototype,"critical",void 0);S([I({type:ut})],ts.prototype,"extnValue",void 0);let Zo=Y4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,Y4.prototype)}};Zo=Y4=S([me({type:ae.Sequence,itemType:ts})],Zo);var rc;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(rc||(rc={}));class Bn{constructor(e={}){this.version=rc.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ke,this.issuer=new Jt,this.validity=new Nf,this.subject=new Jt,this.subjectPublicKeyInfo=new ms,Object.assign(this,e)}}S([I({type:j.Integer,context:0,defaultValue:rc.v1})],Bn.prototype,"version",void 0);S([I({type:j.Integer,converter:$t})],Bn.prototype,"serialNumber",void 0);S([I({type:ke})],Bn.prototype,"signature",void 0);S([I({type:Jt})],Bn.prototype,"issuer",void 0);S([I({type:Nf})],Bn.prototype,"validity",void 0);S([I({type:Jt})],Bn.prototype,"subject",void 0);S([I({type:ms})],Bn.prototype,"subjectPublicKeyInfo",void 0);S([I({type:j.BitString,context:1,implicit:!0,optional:!0})],Bn.prototype,"issuerUniqueID",void 0);S([I({type:j.BitString,context:2,implicit:!0,optional:!0})],Bn.prototype,"subjectUniqueID",void 0);S([I({type:Zo,context:3,optional:!0})],Bn.prototype,"extensions",void 0);class nc{constructor(e={}){this.tbsCertificate=new Bn,this.signatureAlgorithm=new ke,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:Bn,raw:!0})],nc.prototype,"tbsCertificate",void 0);S([I({type:ke})],nc.prototype,"signatureAlgorithm",void 0);S([I({type:j.BitString})],nc.prototype,"signatureValue",void 0);class F2{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new Ar,Object.assign(this,e)}}S([I({type:j.Integer,converter:$t})],F2.prototype,"userCertificate",void 0);S([I({type:Ar})],F2.prototype,"revocationDate",void 0);S([I({type:ts,optional:!0,repeated:"sequence"})],F2.prototype,"crlEntryExtensions",void 0);class io{constructor(e={}){this.signature=new ke,this.issuer=new Jt,this.thisUpdate=new Ar,Object.assign(this,e)}}S([I({type:j.Integer,optional:!0})],io.prototype,"version",void 0);S([I({type:ke})],io.prototype,"signature",void 0);S([I({type:Jt})],io.prototype,"issuer",void 0);S([I({type:Ar})],io.prototype,"thisUpdate",void 0);S([I({type:Ar,optional:!0})],io.prototype,"nextUpdate",void 0);S([I({type:F2,repeated:"sequence",optional:!0})],io.prototype,"revokedCertificates",void 0);S([I({type:ts,optional:!0,context:0,repeated:"sequence"})],io.prototype,"crlExtensions",void 0);class H8{constructor(e={}){this.tbsCertList=new io,this.signatureAlgorithm=new ke,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:io,raw:!0})],H8.prototype,"tbsCertList",void 0);S([I({type:ke})],H8.prototype,"signatureAlgorithm",void 0);S([I({type:j.BitString})],H8.prototype,"signature",void 0);class Tu{constructor(e={}){this.issuer=new Jt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:Jt})],Tu.prototype,"issuer",void 0);S([I({type:j.Integer,converter:$t})],Tu.prototype,"serialNumber",void 0);let eu=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Uo,context:0,implicit:!0})],eu.prototype,"subjectKeyIdentifier",void 0);S([I({type:Tu})],eu.prototype,"issuerAndSerialNumber",void 0);eu=S([me({type:ae.Choice})],eu);var Gi;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(Gi||(Gi={}));let Gd=class extends ke{};Gd=S([me({type:ae.Sequence})],Gd);let B0=class extends ke{};B0=S([me({type:ae.Sequence})],B0);let ui=class extends ke{};ui=S([me({type:ae.Sequence})],ui);let M0=class extends ke{};M0=S([me({type:ae.Sequence})],M0);let cS=class extends ke{};cS=S([me({type:ae.Sequence})],cS);let Q4=class extends ke{};Q4=S([me({type:ae.Sequence})],Q4);let Ru=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};S([I({type:j.ObjectIdentifier})],Ru.prototype,"attrType",void 0);S([I({type:j.Any,repeated:"set"})],Ru.prototype,"attrValues",void 0);var X4;class gi{constructor(e={}){this.version=Gi.v0,this.sid=new eu,this.digestAlgorithm=new Gd,this.signatureAlgorithm=new B0,this.signature=new ut,Object.assign(this,e)}}S([I({type:j.Integer})],gi.prototype,"version",void 0);S([I({type:eu})],gi.prototype,"sid",void 0);S([I({type:Gd})],gi.prototype,"digestAlgorithm",void 0);S([I({type:Ru,repeated:"set",context:0,implicit:!0,optional:!0,raw:!0})],gi.prototype,"signedAttrs",void 0);S([I({type:B0})],gi.prototype,"signatureAlgorithm",void 0);S([I({type:ut})],gi.prototype,"signature",void 0);S([I({type:Ru,repeated:"set",context:1,implicit:!0,optional:!0})],gi.prototype,"unsignedAttrs",void 0);let $0=X4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,X4.prototype)}};$0=X4=S([me({type:ae.Set,itemType:gi})],$0);let lS=class extends Ar{};lS=S([me({type:ae.Choice})],lS);let uS=class extends gi{};uS=S([me({type:ae.Sequence})],uS);class q8{constructor(e={}){this.acIssuer=new We,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}S([I({type:We})],q8.prototype,"acIssuer",void 0);S([I({type:j.Integer})],q8.prototype,"acSerial",void 0);S([I({type:Wi,repeated:"sequence"})],q8.prototype,"attrs",void 0);var J4;let U0=J4=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,J4.prototype)}};U0=J4=S([me({type:ae.Sequence,itemType:j.ObjectIdentifier})],U0);class V2{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}S([I({type:j.Integer,optional:!0})],V2.prototype,"pathLenConstraint",void 0);S([I({type:U0,implicit:!0,context:0,optional:!0})],V2.prototype,"permittedAttrs",void 0);S([I({type:U0,implicit:!0,context:1,optional:!0})],V2.prototype,"excludedAttrs",void 0);S([I({type:j.Boolean,defaultValue:!0})],V2.prototype,"permitUnSpecified",void 0);class kc{constructor(e={}){this.issuer=new Kr,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:Kr})],kc.prototype,"issuer",void 0);S([I({type:j.Integer,converter:$t})],kc.prototype,"serial",void 0);S([I({type:j.BitString,optional:!0})],kc.prototype,"issuerUID",void 0);var Z4;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(Z4||(Z4={}));class Ic{constructor(e={}){this.digestedObjectType=Z4.publicKey,this.digestAlgorithm=new ke,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.Enumerated})],Ic.prototype,"digestedObjectType",void 0);S([I({type:j.ObjectIdentifier,optional:!0})],Ic.prototype,"otherObjectTypeID",void 0);S([I({type:ke})],Ic.prototype,"digestAlgorithm",void 0);S([I({type:j.BitString})],Ic.prototype,"objectDigest",void 0);class z2{constructor(e={}){Object.assign(this,e)}}S([I({type:Kr,optional:!0})],z2.prototype,"issuerName",void 0);S([I({type:kc,context:0,implicit:!0,optional:!0})],z2.prototype,"baseCertificateID",void 0);S([I({type:Ic,context:1,implicit:!0,optional:!0})],z2.prototype,"objectDigestInfo",void 0);let tu=class{constructor(e={}){Object.assign(this,e)}};S([I({type:We,repeated:"sequence"})],tu.prototype,"v1Form",void 0);S([I({type:z2,context:0,implicit:!0})],tu.prototype,"v2Form",void 0);tu=S([me({type:ae.Choice})],tu);class H2{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}S([I({type:j.GeneralizedTime})],H2.prototype,"notBeforeTime",void 0);S([I({type:j.GeneralizedTime})],H2.prototype,"notAfterTime",void 0);class Of{constructor(e={}){Object.assign(this,e)}}S([I({type:kc,implicit:!0,context:0,optional:!0})],Of.prototype,"baseCertificateID",void 0);S([I({type:Kr,implicit:!0,context:1,optional:!0})],Of.prototype,"entityName",void 0);S([I({type:Ic,implicit:!0,context:2,optional:!0})],Of.prototype,"objectDigestInfo",void 0);var e6;(function(r){r[r.v2=1]="v2"})(e6||(e6={}));class Ns{constructor(e={}){this.version=e6.v2,this.holder=new Of,this.issuer=new tu,this.signature=new ke,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new H2,this.attributes=[],Object.assign(this,e)}}S([I({type:j.Integer})],Ns.prototype,"version",void 0);S([I({type:Of})],Ns.prototype,"holder",void 0);S([I({type:tu})],Ns.prototype,"issuer",void 0);S([I({type:ke})],Ns.prototype,"signature",void 0);S([I({type:j.Integer,converter:$t})],Ns.prototype,"serialNumber",void 0);S([I({type:H2})],Ns.prototype,"attrCertValidityPeriod",void 0);S([I({type:Wi,repeated:"sequence"})],Ns.prototype,"attributes",void 0);S([I({type:j.BitString,optional:!0})],Ns.prototype,"issuerUniqueID",void 0);S([I({type:Zo,optional:!0})],Ns.prototype,"extensions",void 0);class q2{constructor(e={}){this.acinfo=new Ns,this.signatureAlgorithm=new ke,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:Ns})],q2.prototype,"acinfo",void 0);S([I({type:ke})],q2.prototype,"signatureAlgorithm",void 0);S([I({type:j.BitString})],q2.prototype,"signatureValue",void 0);var F0;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(F0||(F0={}));class t6 extends L2{}class K8{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier,implicit:!0,context:0})],K8.prototype,"type",void 0);S([I({type:j.Any,implicit:!0,context:1})],K8.prototype,"value",void 0);class j8{constructor(e={}){this.policyId="",this.classList=new t6(F0.unclassified),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],j8.prototype,"policyId",void 0);S([I({type:t6,defaultValue:new t6(F0.unclassified)})],j8.prototype,"classList",void 0);S([I({type:K8,repeated:"set"})],j8.prototype,"securityCategories",void 0);class K2{constructor(e={}){Object.assign(this,e)}}S([I({type:ut})],K2.prototype,"cotets",void 0);S([I({type:j.ObjectIdentifier})],K2.prototype,"oid",void 0);S([I({type:j.Utf8String})],K2.prototype,"string",void 0);class GD{constructor(e={}){this.values=[],Object.assign(this,e)}}S([I({type:Kr,implicit:!0,context:0,optional:!0})],GD.prototype,"policyAuthority",void 0);S([I({type:K2,repeated:"sequence"})],GD.prototype,"values",void 0);var r6;class j2{constructor(e={}){this.targetCertificate=new kc,Object.assign(this,e)}}S([I({type:kc})],j2.prototype,"targetCertificate",void 0);S([I({type:We,optional:!0})],j2.prototype,"targetName",void 0);S([I({type:Ic,optional:!0})],j2.prototype,"certDigestInfo",void 0);let ru=class{constructor(e={}){Object.assign(this,e)}};S([I({type:We,context:0,implicit:!0})],ru.prototype,"targetName",void 0);S([I({type:We,context:1,implicit:!0})],ru.prototype,"targetGroup",void 0);S([I({type:j2,context:2,implicit:!0})],ru.prototype,"targetCert",void 0);ru=S([me({type:ae.Choice})],ru);let n6=r6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,r6.prototype)}};n6=r6=S([me({type:ae.Sequence,itemType:ru})],n6);var s6;let hS=s6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,s6.prototype)}};hS=s6=S([me({type:ae.Sequence,itemType:n6})],hS);class YD{constructor(e={}){Object.assign(this,e)}}S([I({type:Kr,implicit:!0,context:0,optional:!0})],YD.prototype,"roleAuthority",void 0);S([I({type:We,implicit:!0,context:1})],YD.prototype,"roleName",void 0);class W8{constructor(e={}){this.service=new We,this.ident=new We,Object.assign(this,e)}}S([I({type:We})],W8.prototype,"service",void 0);S([I({type:We})],W8.prototype,"ident",void 0);S([I({type:ut,optional:!0})],W8.prototype,"authInfo",void 0);var i6;class G8{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],G8.prototype,"otherCertFormat",void 0);S([I({type:j.Any})],G8.prototype,"otherCert",void 0);let nu=class{constructor(e={}){Object.assign(this,e)}};S([I({type:nc})],nu.prototype,"certificate",void 0);S([I({type:q2,context:2,implicit:!0})],nu.prototype,"v2AttrCert",void 0);S([I({type:G8,context:3,implicit:!0})],nu.prototype,"other",void 0);nu=S([me({type:ae.Choice})],nu);let V0=i6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,i6.prototype)}};V0=i6=S([me({type:ae.Set,itemType:nu})],V0);class Pu{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],Pu.prototype,"contentType",void 0);S([I({type:j.Any,context:0})],Pu.prototype,"content",void 0);let Yd=class{constructor(e={}){Object.assign(this,e)}};S([I({type:ut})],Yd.prototype,"single",void 0);S([I({type:j.Any})],Yd.prototype,"any",void 0);Yd=S([me({type:ae.Choice})],Yd);class W2{constructor(e={}){this.eContentType="",Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],W2.prototype,"eContentType",void 0);S([I({type:Yd,context:0,optional:!0})],W2.prototype,"eContent",void 0);let Qd=class{constructor(e={}){Object.assign(this,e)}};S([I({type:ut,context:0,implicit:!0,optional:!0})],Qd.prototype,"value",void 0);S([I({type:ut,converter:Fle,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Qd.prototype,"constructedValue",void 0);Qd=S([me({type:ae.Choice})],Qd);class Lf{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new M0,Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],Lf.prototype,"contentType",void 0);S([I({type:M0})],Lf.prototype,"contentEncryptionAlgorithm",void 0);S([I({type:Qd,optional:!0})],Lf.prototype,"encryptedContent",void 0);class G2{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],G2.prototype,"keyAttrId",void 0);S([I({type:j.Any,optional:!0})],G2.prototype,"keyAttr",void 0);var o6;class Y2{constructor(e={}){this.subjectKeyIdentifier=new Uo,Object.assign(this,e)}}S([I({type:Uo})],Y2.prototype,"subjectKeyIdentifier",void 0);S([I({type:j.GeneralizedTime,optional:!0})],Y2.prototype,"date",void 0);S([I({type:G2,optional:!0})],Y2.prototype,"other",void 0);let su=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Y2,context:0,implicit:!0,optional:!0})],su.prototype,"rKeyId",void 0);S([I({type:Tu,optional:!0})],su.prototype,"issuerAndSerialNumber",void 0);su=S([me({type:ae.Choice})],su);class Y8{constructor(e={}){this.rid=new su,this.encryptedKey=new ut,Object.assign(this,e)}}S([I({type:su})],Y8.prototype,"rid",void 0);S([I({type:ut})],Y8.prototype,"encryptedKey",void 0);let z0=o6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,o6.prototype)}};z0=o6=S([me({type:ae.Sequence,itemType:Y8})],z0);class Q8{constructor(e={}){this.algorithm=new ke,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:ke})],Q8.prototype,"algorithm",void 0);S([I({type:j.BitString})],Q8.prototype,"publicKey",void 0);let sc=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Uo,context:0,implicit:!0,optional:!0})],sc.prototype,"subjectKeyIdentifier",void 0);S([I({type:Q8,context:1,implicit:!0,optional:!0})],sc.prototype,"originatorKey",void 0);S([I({type:Tu,optional:!0})],sc.prototype,"issuerAndSerialNumber",void 0);sc=S([me({type:ae.Choice})],sc);class Du{constructor(e={}){this.version=Gi.v3,this.originator=new sc,this.keyEncryptionAlgorithm=new ui,this.recipientEncryptedKeys=new z0,Object.assign(this,e)}}S([I({type:j.Integer})],Du.prototype,"version",void 0);S([I({type:sc,context:0})],Du.prototype,"originator",void 0);S([I({type:ut,context:1,optional:!0})],Du.prototype,"ukm",void 0);S([I({type:ui})],Du.prototype,"keyEncryptionAlgorithm",void 0);S([I({type:z0})],Du.prototype,"recipientEncryptedKeys",void 0);let iu=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Uo,context:0,implicit:!0})],iu.prototype,"subjectKeyIdentifier",void 0);S([I({type:Tu})],iu.prototype,"issuerAndSerialNumber",void 0);iu=S([me({type:ae.Choice})],iu);class Bf{constructor(e={}){this.version=Gi.v0,this.rid=new iu,this.keyEncryptionAlgorithm=new ui,this.encryptedKey=new ut,Object.assign(this,e)}}S([I({type:j.Integer})],Bf.prototype,"version",void 0);S([I({type:iu})],Bf.prototype,"rid",void 0);S([I({type:ui})],Bf.prototype,"keyEncryptionAlgorithm",void 0);S([I({type:ut})],Bf.prototype,"encryptedKey",void 0);class Mf{constructor(e={}){this.keyIdentifier=new ut,Object.assign(this,e)}}S([I({type:ut})],Mf.prototype,"keyIdentifier",void 0);S([I({type:j.GeneralizedTime,optional:!0})],Mf.prototype,"date",void 0);S([I({type:G2,optional:!0})],Mf.prototype,"other",void 0);class $f{constructor(e={}){this.version=Gi.v4,this.kekid=new Mf,this.keyEncryptionAlgorithm=new ui,this.encryptedKey=new ut,Object.assign(this,e)}}S([I({type:j.Integer})],$f.prototype,"version",void 0);S([I({type:Mf})],$f.prototype,"kekid",void 0);S([I({type:ui})],$f.prototype,"keyEncryptionAlgorithm",void 0);S([I({type:ut})],$f.prototype,"encryptedKey",void 0);class Uf{constructor(e={}){this.version=Gi.v0,this.keyEncryptionAlgorithm=new ui,this.encryptedKey=new ut,Object.assign(this,e)}}S([I({type:j.Integer})],Uf.prototype,"version",void 0);S([I({type:Q4,context:0,optional:!0})],Uf.prototype,"keyDerivationAlgorithm",void 0);S([I({type:ui})],Uf.prototype,"keyEncryptionAlgorithm",void 0);S([I({type:ut})],Uf.prototype,"encryptedKey",void 0);class X8{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],X8.prototype,"oriType",void 0);S([I({type:j.Any})],X8.prototype,"oriValue",void 0);let ea=class{constructor(e={}){Object.assign(this,e)}};S([I({type:Bf,optional:!0})],ea.prototype,"ktri",void 0);S([I({type:Du,context:1,implicit:!0,optional:!0})],ea.prototype,"kari",void 0);S([I({type:$f,context:2,implicit:!0,optional:!0})],ea.prototype,"kekri",void 0);S([I({type:Uf,context:3,implicit:!0,optional:!0})],ea.prototype,"pwri",void 0);S([I({type:X8,context:4,implicit:!0,optional:!0})],ea.prototype,"ori",void 0);ea=S([me({type:ae.Choice})],ea);var a6;let H0=a6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,a6.prototype)}};H0=a6=S([me({type:ae.Set,itemType:ea})],H0);var c6;class Q2{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],Q2.prototype,"otherRevInfoFormat",void 0);S([I({type:j.Any})],Q2.prototype,"otherRevInfo",void 0);let q0=class{constructor(e={}){this.other=new Q2,Object.assign(this,e)}};S([I({type:Q2,context:1,implicit:!0})],q0.prototype,"other",void 0);q0=S([me({type:ae.Choice})],q0);let K0=c6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,c6.prototype)}};K0=c6=S([me({type:ae.Set,itemType:q0})],K0);class J8{constructor(e={}){Object.assign(this,e)}}S([I({type:V0,context:0,implicit:!0,optional:!0})],J8.prototype,"certs",void 0);S([I({type:K0,context:1,implicit:!0,optional:!0})],J8.prototype,"crls",void 0);var l6;let u6=l6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,l6.prototype)}};u6=l6=S([me({type:ae.Set,itemType:Ru})],u6);class Ff{constructor(e={}){this.version=Gi.v0,this.recipientInfos=new H0,this.encryptedContentInfo=new Lf,Object.assign(this,e)}}S([I({type:j.Integer})],Ff.prototype,"version",void 0);S([I({type:J8,context:0,implicit:!0,optional:!0})],Ff.prototype,"originatorInfo",void 0);S([I({type:H0})],Ff.prototype,"recipientInfos",void 0);S([I({type:Lf})],Ff.prototype,"encryptedContentInfo",void 0);S([I({type:u6,context:1,implicit:!0,optional:!0})],Ff.prototype,"unprotectedAttrs",void 0);const due="1.2.840.113549.1.7.2";var h6;let j0=h6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,h6.prototype)}};j0=h6=S([me({type:ae.Set,itemType:Gd})],j0);class Nu{constructor(e={}){this.version=Gi.v0,this.digestAlgorithms=new j0,this.encapContentInfo=new W2,this.signerInfos=new $0,Object.assign(this,e)}}S([I({type:j.Integer})],Nu.prototype,"version",void 0);S([I({type:j0})],Nu.prototype,"digestAlgorithms",void 0);S([I({type:W2})],Nu.prototype,"encapContentInfo",void 0);S([I({type:V0,context:0,implicit:!0,optional:!0})],Nu.prototype,"certificates",void 0);S([I({type:K0,context:1,implicit:!0,optional:!0})],Nu.prototype,"crls",void 0);S([I({type:$0})],Nu.prototype,"signerInfos",void 0);const Xd="1.2.840.10045.2.1",Z8="1.2.840.10045.4.1",QD="1.2.840.10045.4.3.1",eb="1.2.840.10045.4.3.2",tb="1.2.840.10045.4.3.3",rb="1.2.840.10045.4.3.4",dS="1.2.840.10045.3.1.7",fS="1.3.132.0.34",pS="1.3.132.0.35";function Vf(r){return new ke({algorithm:r})}const fue=Vf(Z8);Vf(QD);const pue=Vf(eb),gue=Vf(tb),mue=Vf(rb);let Jd=class{constructor(e={}){Object.assign(this,e)}};S([I({type:j.ObjectIdentifier})],Jd.prototype,"fieldType",void 0);S([I({type:j.Any})],Jd.prototype,"parameters",void 0);Jd=S([me({type:ae.Sequence})],Jd);class yue extends ut{}let ou=class{constructor(e={}){Object.assign(this,e)}};S([I({type:j.OctetString})],ou.prototype,"a",void 0);S([I({type:j.OctetString})],ou.prototype,"b",void 0);S([I({type:j.BitString,optional:!0})],ou.prototype,"seed",void 0);ou=S([me({type:ae.Sequence})],ou);var d6;(function(r){r[r.ecpVer1=1]="ecpVer1"})(d6||(d6={}));let Yi=class{constructor(e={}){this.version=d6.ecpVer1,Object.assign(this,e)}};S([I({type:j.Integer})],Yi.prototype,"version",void 0);S([I({type:Jd})],Yi.prototype,"fieldID",void 0);S([I({type:ou})],Yi.prototype,"curve",void 0);S([I({type:yue})],Yi.prototype,"base",void 0);S([I({type:j.Integer,converter:$t})],Yi.prototype,"order",void 0);S([I({type:j.Integer,optional:!0})],Yi.prototype,"cofactor",void 0);Yi=S([me({type:ae.Sequence})],Yi);let ta=class{constructor(e={}){Object.assign(this,e)}};S([I({type:j.ObjectIdentifier})],ta.prototype,"namedCurve",void 0);S([I({type:j.Null})],ta.prototype,"implicitCurve",void 0);S([I({type:Yi})],ta.prototype,"specifiedCurve",void 0);ta=S([me({type:ae.Choice})],ta);class X2{constructor(e={}){this.version=1,this.privateKey=new ut,Object.assign(this,e)}}S([I({type:j.Integer})],X2.prototype,"version",void 0);S([I({type:ut})],X2.prototype,"privateKey",void 0);S([I({type:ta,context:0,optional:!0})],X2.prototype,"parameters",void 0);S([I({type:j.BitString,context:1,optional:!0})],X2.prototype,"publicKey",void 0);class W0{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.Integer,converter:$t})],W0.prototype,"r",void 0);S([I({type:j.Integer,converter:$t})],W0.prototype,"s",void 0);const wn="1.2.840.113549.1.1",ic=`${wn}.1`,wue=`${wn}.7`,bue=`${wn}.9`,rd=`${wn}.10`,vue=`${wn}.2`,Eue=`${wn}.4`,G0=`${wn}.5`,Sue=`${wn}.14`,f6=`${wn}.11`,Y0=`${wn}.12`,Q0=`${wn}.13`,XD=`${wn}.15`,JD=`${wn}.16`,X0="1.3.14.3.2.26",ZD="2.16.840.1.101.3.4.2.4",J0="2.16.840.1.101.3.4.2.1",Z0="2.16.840.1.101.3.4.2.2",eg="2.16.840.1.101.3.4.2.3",_ue="2.16.840.1.101.3.4.2.5",xue="2.16.840.1.101.3.4.2.6",Aue="1.2.840.113549.2.2",Cue="1.2.840.113549.2.5",J2=`${wn}.8`;function lr(r){return new ke({algorithm:r,parameters:null})}lr(Aue);lr(Cue);const oc=lr(X0);lr(ZD);lr(J0);lr(Z0);lr(eg);lr(_ue);lr(xue);const eN=new ke({algorithm:J2,parameters:be.serialize(oc)}),tN=new ke({algorithm:bue,parameters:be.serialize(T0.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});lr(ic);lr(vue);lr(Eue);lr(G0);lr(XD);lr(JD);lr(Y0);lr(Q0);lr(XD);lr(JD);class Z2{constructor(e={}){this.hashAlgorithm=new ke(oc),this.maskGenAlgorithm=new ke({algorithm:J2,parameters:be.serialize(oc)}),this.pSourceAlgorithm=new ke(tN),Object.assign(this,e)}}S([I({type:ke,context:0,defaultValue:oc})],Z2.prototype,"hashAlgorithm",void 0);S([I({type:ke,context:1,defaultValue:eN})],Z2.prototype,"maskGenAlgorithm",void 0);S([I({type:ke,context:2,defaultValue:tN})],Z2.prototype,"pSourceAlgorithm",void 0);new ke({algorithm:wue,parameters:be.serialize(new Z2)});class ac{constructor(e={}){this.hashAlgorithm=new ke(oc),this.maskGenAlgorithm=new ke({algorithm:J2,parameters:be.serialize(oc)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}S([I({type:ke,context:0,defaultValue:oc})],ac.prototype,"hashAlgorithm",void 0);S([I({type:ke,context:1,defaultValue:eN})],ac.prototype,"maskGenAlgorithm",void 0);S([I({type:j.Integer,context:2,defaultValue:20})],ac.prototype,"saltLength",void 0);S([I({type:j.Integer,context:3,defaultValue:1})],ac.prototype,"trailerField",void 0);new ke({algorithm:rd,parameters:be.serialize(new ac)});class em{constructor(e={}){this.digestAlgorithm=new ke,this.digest=new ut,Object.assign(this,e)}}S([I({type:ke})],em.prototype,"digestAlgorithm",void 0);S([I({type:ut})],em.prototype,"digest",void 0);var p6;class tm{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.Integer,converter:$t})],tm.prototype,"prime",void 0);S([I({type:j.Integer,converter:$t})],tm.prototype,"exponent",void 0);S([I({type:j.Integer,converter:$t})],tm.prototype,"coefficient",void 0);let g6=p6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,p6.prototype)}};g6=p6=S([me({type:ae.Sequence,itemType:tm})],g6);class mi{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.Integer})],mi.prototype,"version",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"modulus",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"publicExponent",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"privateExponent",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"prime1",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"prime2",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"exponent1",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"exponent2",void 0);S([I({type:j.Integer,converter:$t})],mi.prototype,"coefficient",void 0);S([I({type:g6,optional:!0})],mi.prototype,"otherPrimeInfos",void 0);class nb{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.Integer,converter:$t})],nb.prototype,"modulus",void 0);S([I({type:j.Integer,converter:$t})],nb.prototype,"publicExponent",void 0);var m6;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(m6||(m6={}));const an=m6;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var y6=function(r,e){return y6=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},y6(r,e)};function sb(r,e){y6(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function kue(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(r,[])).next())})}function Iue(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function M1(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function tg(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function va(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(tg(arguments[e]));return r}var Tue="injectionTokens";function Rue(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(Tue,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function rN(r){return!!r.useClass}function w6(r){return!!r.useFactory}var nN=(function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},s=!1,i,o=function(){return s||(i=e(t.wrap()),s=!0),i};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(s){t[s]=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];i[0]=e();var a=Reflect[s];return a.apply(void 0,va(i))}};return this.reflectMethods.forEach(n),t},r})();function $c(r){return typeof r=="string"||typeof r=="symbol"}function Pue(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function gS(r){return typeof r=="object"&&"token"in r&&"transform"in r}function Due(r){return typeof r=="function"||r instanceof nN}function op(r){return!!r.useToken}function ap(r){return r.useValue!=null}function Nue(r){return rN(r)||ap(r)||op(r)||w6(r)}var ib=(function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r})(),Oue=(function(r){sb(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(ib),$1=(function(){function r(){this.scopedResolutions=new Map}return r})();function Lue(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function Bue(r,e,t){return t===void 0&&(t="    "),va([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function Mue(r,e,t){var n=tg(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),s=n[1],i=s===void 0?null:s,o=Lue(i,e);return Bue("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function $ue(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var Uue=(function(r){sb(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(ib),Fue=(function(r){sb(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(ib),Vue=(function(){function r(){this.preResolution=new Uue,this.postResolution=new Fue}return r})(),sN=new Map,zue=(function(){function r(e){this.parent=e,this._registry=new Oue,this.interceptors=new Vue,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:an.Transient}),this.ensureNotDisposed();var s;if(Nue(t)?s=t:s={useClass:t},op(s))for(var i=[e],o=s;o!=null;){var a=o.useToken;if(i.includes(a))throw new Error("Token registration cycle detected! "+va(i,[a]).join(" -> "));i.push(a);var c=this._registry.get(a);c&&op(c.provider)?o=c.provider:o=null}if((n.lifecycle===an.Singleton||n.lifecycle==an.ContainerScoped||n.lifecycle==an.ResolutionScoped)&&(ap(s)||w6(s)))throw new Error('Cannot use lifecycle "'+an[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:s,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),$c(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),$c(e)){if($c(t))return this.register(e,{useToken:t},{lifecycle:an.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:an.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!$c(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:an.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new $1),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getRegistration(e);if(!s&&$c(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),s){var i=this.resolveRegistration(s,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}if(Due(e)){var i=this.construct(e,t);return this.executePostResolutionInterceptor(e,i,"Single"),i}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,s;if(this.interceptors.preResolution.has(e)){var i=[];try{for(var o=M1(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&i.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(s=o.return)&&s.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,i)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var s,i;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=M1(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(u){s={error:u}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(s)throw s.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===an.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===an.Singleton,s=e.options.lifecycle===an.ContainerScoped,i=n||s,o;return ap(e.provider)?o=e.provider.useValue:op(e.provider)?o=i?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):rN(e.provider)?o=i?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):w6(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===an.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var s=this;t===void 0&&(t=new $1),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getAllRegistrations(e);if(!i&&$c(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),i){var o=i.map(function(c){return s.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=M1(this._registry.entries()),s=n.next();!s.done;s=n.next()){var i=tg(s.value,2),o=i[0],a=i[1];this._registry.setAll(o,a.filter(function(c){return!ap(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var s=M1(this._registry.entries()),i=s.next();!i.done;i=s.next()){var o=tg(i.value,2),a=o[0],c=o[1];c.some(function(l){var u=l.options;return u.lifecycle===an.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===an.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{i&&!i.done&&(t=s.return)&&t.call(s)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return kue(this,void 0,void 0,function(){var e;return Iue(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var s=n.dispose();s&&e.push(s)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof nN)return e.createProxy(function(i){return n.resolve(i,t)});var s=(function(){var i=sN.get(e);if(!i||i.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=i.map(n.resolveParams(t,e));return new(e.bind.apply(e,va([void 0],o)))})();return $ue(s)&&this.disposables.add(s),s},r.prototype.resolveParams=function(e,t){var n=this;return function(s,i){var o,a,c;try{return Pue(s)?gS(s)?s.multiple?(o=n.resolve(s.transform)).transform.apply(o,va([n.resolveAll(s.token,new $1,s.isOptional)],s.transformArgs)):(a=n.resolve(s.transform)).transform.apply(a,va([n.resolve(s.token,e,s.isOptional)],s.transformArgs)):s.multiple?n.resolveAll(s.token,new $1,s.isOptional):n.resolve(s.token,e,s.isOptional):gS(s)?(c=n.resolve(s.transform,e)).transform.apply(c,va([n.resolve(s.token,e)],s.transformArgs)):n.resolve(s,e)}catch(l){throw new Error(Mue(t,i,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r})(),Pr=new zue;function rm(r){return function(e){sN.set(e,Rue(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var b6;class nm{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}S([I({type:j.ObjectIdentifier})],nm.prototype,"attrId",void 0);S([I({type:j.Any,repeated:"set"})],nm.prototype,"attrValues",void 0);let mS=b6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,b6.prototype)}};mS=b6=S([me({type:ae.Sequence,itemType:nm})],mS);var v6;let yS=v6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,v6.prototype)}};yS=v6=S([me({type:ae.Sequence,itemType:Pu})],yS);class iN{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],iN.prototype,"certId",void 0);S([I({type:j.Any,context:0})],iN.prototype,"certValue",void 0);class oN{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],oN.prototype,"crlId",void 0);S([I({type:j.Any,context:0})],oN.prototype,"crltValue",void 0);class aN extends ut{}let sm=class{constructor(e={}){this.encryptionAlgorithm=new ke,this.encryptedData=new aN,Object.assign(this,e)}};S([I({type:ke})],sm.prototype,"encryptionAlgorithm",void 0);S([I({type:aN})],sm.prototype,"encryptedData",void 0);var E6,S6;(function(r){r[r.v1=0]="v1"})(S6||(S6={}));class cN extends ut{}let _6=E6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,E6.prototype)}};_6=E6=S([me({type:ae.Sequence,itemType:Wi})],_6);class zf{constructor(e={}){this.version=S6.v1,this.privateKeyAlgorithm=new ke,this.privateKey=new cN,Object.assign(this,e)}}S([I({type:j.Integer})],zf.prototype,"version",void 0);S([I({type:ke})],zf.prototype,"privateKeyAlgorithm",void 0);S([I({type:cN})],zf.prototype,"privateKey",void 0);S([I({type:_6,implicit:!0,context:0,optional:!0})],zf.prototype,"attributes",void 0);let wS=class extends zf{};wS=S([me({type:ae.Sequence})],wS);let bS=class extends sm{};bS=S([me({type:ae.Sequence})],bS);class lN{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],lN.prototype,"secretTypeId",void 0);S([I({type:j.Any,context:0})],lN.prototype,"secretValue",void 0);class Hf{constructor(e={}){this.mac=new em,this.macSalt=new ut,this.iterations=1,Object.assign(this,e)}}S([I({type:em})],Hf.prototype,"mac",void 0);S([I({type:ut})],Hf.prototype,"macSalt",void 0);S([I({type:j.Integer,defaultValue:1})],Hf.prototype,"iterations",void 0);class im{constructor(e={}){this.version=3,this.authSafe=new Pu,this.macData=new Hf,Object.assign(this,e)}}S([I({type:j.Integer})],im.prototype,"version",void 0);S([I({type:Pu})],im.prototype,"authSafe",void 0);S([I({type:Hf,optional:!0})],im.prototype,"macData",void 0);var x6;class om{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:j.ObjectIdentifier})],om.prototype,"bagId",void 0);S([I({type:j.Any,context:0})],om.prototype,"bagValue",void 0);S([I({type:nm,repeated:"set",optional:!0})],om.prototype,"bagAttributes",void 0);let vS=x6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,x6.prototype)}};vS=x6=S([me({type:ae.Sequence,itemType:om})],vS);var A6,C6,k6;const uN="1.2.840.113549.1.9",hN=`${uN}.7`,ob=`${uN}.14`;let rg=class extends Rr{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};S([I({type:j.IA5String})],rg.prototype,"ia5String",void 0);rg=S([me({type:ae.Choice})],rg);let ES=class extends Pu{};ES=S([me({type:ae.Sequence})],ES);let SS=class extends im{};SS=S([me({type:ae.Sequence})],SS);let _S=class extends sm{};_S=S([me({type:ae.Sequence})],_S);let I6=class{constructor(e=""){this.value=e}toString(){return this.value}};S([I({type:j.IA5String})],I6.prototype,"value",void 0);I6=S([me({type:ae.Choice})],I6);let xS=class extends rg{};xS=S([me({type:ae.Choice})],xS);let AS=class extends Rr{};AS=S([me({type:ae.Choice})],AS);let T6=class{constructor(e=new Date){this.value=e}};S([I({type:j.GeneralizedTime})],T6.prototype,"value",void 0);T6=S([me({type:ae.Choice})],T6);let CS=class extends Rr{};CS=S([me({type:ae.Choice})],CS);let R6=class{constructor(e="M"){this.value=e}toString(){return this.value}};S([I({type:j.PrintableString})],R6.prototype,"value",void 0);R6=S([me({type:ae.Choice})],R6);let ng=class{constructor(e=""){this.value=e}toString(){return this.value}};S([I({type:j.PrintableString})],ng.prototype,"value",void 0);ng=S([me({type:ae.Choice})],ng);let kS=class extends ng{};kS=S([me({type:ae.Choice})],kS);let IS=class extends Rr{};IS=S([me({type:ae.Choice})],IS);let P6=class{constructor(e=""){this.value=e}toString(){return this.value}};S([I({type:j.ObjectIdentifier})],P6.prototype,"value",void 0);P6=S([me({type:ae.Choice})],P6);let TS=class extends Ar{};TS=S([me({type:ae.Choice})],TS);let D6=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};S([I({type:j.Integer})],D6.prototype,"value",void 0);D6=S([me({type:ae.Choice})],D6);let RS=class extends gi{};RS=S([me({type:ae.Sequence})],RS);let sg=class extends Rr{};sg=S([me({type:ae.Choice})],sg);let PS=A6=class extends Zo{constructor(e){super(e),Object.setPrototypeOf(this,A6.prototype)}};PS=A6=S([me({type:ae.Sequence})],PS);let DS=C6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,C6.prototype)}};DS=C6=S([me({type:ae.Set,itemType:Ru})],DS);let N6=class{constructor(e=""){this.value=e}toString(){return this.value}};S([I({type:j.BmpString})],N6.prototype,"value",void 0);N6=S([me({type:ae.Choice})],N6);let O6=class extends ke{};O6=S([me({type:ae.Sequence})],O6);let NS=k6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,k6.prototype)}};NS=k6=S([me({type:ae.Sequence,itemType:O6})],NS);var L6;let ig=L6=class extends _t{constructor(e){super(e),Object.setPrototypeOf(this,L6.prototype)}};ig=L6=S([me({type:ae.Sequence,itemType:Wi})],ig);class Ou{constructor(e={}){this.version=0,this.subject=new Jt,this.subjectPKInfo=new ms,this.attributes=new ig,Object.assign(this,e)}}S([I({type:j.Integer})],Ou.prototype,"version",void 0);S([I({type:Jt})],Ou.prototype,"subject",void 0);S([I({type:ms})],Ou.prototype,"subjectPKInfo",void 0);S([I({type:ig,implicit:!0,context:0})],Ou.prototype,"attributes",void 0);class Zd{constructor(e={}){this.certificationRequestInfo=new Ou,this.signatureAlgorithm=new ke,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}S([I({type:Ou,raw:!0})],Zd.prototype,"certificationRequestInfo",void 0);S([I({type:ke})],Zd.prototype,"signatureAlgorithm",void 0);S([I({type:j.BitString})],Zd.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const qf="crypto.algorithm";class Hue{getAlgorithms(){return Pr.resolveAll(qf)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new ke({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const s=n.toWebAlgorithm(e);if(s)return s}return{name:e.algorithm,parameters:e.parameters}}}const cc="crypto.algorithmProvider";Pr.registerSingleton(cc,Hue);var cp;const bn="1.3.36.3.3.2.8.1.1",OS=`${bn}.1`,LS=`${bn}.2`,BS=`${bn}.3`,MS=`${bn}.4`,$S=`${bn}.5`,US=`${bn}.6`,FS=`${bn}.7`,VS=`${bn}.8`,zS=`${bn}.9`,HS=`${bn}.10`,qS=`${bn}.11`,KS=`${bn}.12`,jS=`${bn}.13`,WS=`${bn}.14`,GS="brainpoolP160r1",YS="brainpoolP160t1",QS="brainpoolP192r1",XS="brainpoolP192t1",JS="brainpoolP224r1",ZS="brainpoolP224t1",e_="brainpoolP256r1",t_="brainpoolP256t1",r_="brainpoolP320r1",n_="brainpoolP320t1",s_="brainpoolP384r1",i_="brainpoolP384t1",o_="brainpoolP512r1",a_="brainpoolP512t1",qt="ECDSA";let ef=cp=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case qt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return fue;case"sha-256":return pue;case"sha-384":return gue;case"sha-512":return mue}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=dS;break;case"K-256":t=cp.SECP256K1;break;case"P-384":t=fS;break;case"P-521":t=pS;break;case GS:t=OS;break;case YS:t=LS;break;case QS:t=BS;break;case XS:t=MS;break;case JS:t=$S;break;case ZS:t=US;break;case e_:t=FS;break;case t_:t=VS;break;case r_:t=zS;break;case n_:t=HS;break;case s_:t=qS;break;case i_:t=KS;break;case o_:t=jS;break;case a_:t=WS;break}if(t)return new ke({algorithm:Xd,parameters:be.serialize(new ta({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case Z8:return{name:qt,hash:{name:"SHA-1"}};case eb:return{name:qt,hash:{name:"SHA-256"}};case tb:return{name:qt,hash:{name:"SHA-384"}};case rb:return{name:qt,hash:{name:"SHA-512"}};case Xd:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(be.parse(e.parameters,ta).namedCurve){case dS:return{name:qt,namedCurve:"P-256"};case cp.SECP256K1:return{name:qt,namedCurve:"K-256"};case fS:return{name:qt,namedCurve:"P-384"};case pS:return{name:qt,namedCurve:"P-521"};case OS:return{name:qt,namedCurve:GS};case LS:return{name:qt,namedCurve:YS};case BS:return{name:qt,namedCurve:QS};case MS:return{name:qt,namedCurve:XS};case $S:return{name:qt,namedCurve:JS};case US:return{name:qt,namedCurve:ZS};case FS:return{name:qt,namedCurve:e_};case VS:return{name:qt,namedCurve:t_};case zS:return{name:qt,namedCurve:r_};case HS:return{name:qt,namedCurve:n_};case qS:return{name:qt,namedCurve:s_};case KS:return{name:qt,namedCurve:i_};case jS:return{name:qt,namedCurve:o_};case WS:return{name:qt,namedCurve:a_}}}}return null}};ef.SECP256K1="1.3.132.0.10";ef=cp=S([rm()],ef);Pr.registerSingleton(qf,ef);const dN=Symbol("name"),fN=Symbol("value");class gt{constructor(e,t={},n=""){this[dN]=e,this[fN]=n;for(const s in t)this[s]=t[s]}}gt.NAME=dN;gt.VALUE=fN;class que{static toTextObject(e){const t=new gt("Algorithm Identifier",{},aa.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Xd:{const n=new ef().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class aa{static toString(e){const t=this.items[e];return t||e}}aa.items={[X0]:"sha1",[ZD]:"sha224",[J0]:"sha256",[Z0]:"sha384",[eg]:"sha512",[ic]:"rsaEncryption",[G0]:"sha1WithRSAEncryption",[Sue]:"sha224WithRSAEncryption",[f6]:"sha256WithRSAEncryption",[Y0]:"sha384WithRSAEncryption",[Q0]:"sha512WithRSAEncryption",[Xd]:"ecPublicKey",[Z8]:"ecdsaWithSHA1",[QD]:"ecdsaWithSHA224",[eb]:"ecdsaWithSHA256",[tb]:"ecdsaWithSHA384",[rb]:"ecdsaWithSHA512",[oue]:"TLS WWW server authentication",[aue]:"TLS WWW client authentication",[cue]:"Code Signing",[lue]:"E-mail Protection",[uue]:"Time Stamping",[hue]:"OCSP Signing",[due]:"Signed Data"};class lc{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let s=this.pad(t++),i="";const o=e[gt.VALUE];o&&(i=` ${o}`),n.push(`${s}${e[gt.NAME]}:${i}`),s=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${s}${l}${c}`);else if(c instanceof Date)n.push(`${s}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const u of c)u[gt.NAME]=a,n.push(...this.serializeObj(u,t));else if(c instanceof gt)c[gt.NAME]=a,n.push(...this.serializeObj(c,t));else if(ve.isBufferSource(c))a?(n.push(`${s}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const u=c.toTextObject();u[gt.NAME]=a,n.push(...this.serializeObj(u,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),s=ve.toUint8Array(e),i=[];for(let o=0;o<s.length;){const a=[];for(let c=0;c<16&&o<s.length;c++){c===8&&a.push("");const l=s[o++].toString(16).padStart(2,"0");a.push(l)}i.push(`${n}${a.join(" ")}`)}return i}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}lc.oidSerializer=aa;lc.algorithmSerializer=que;var Hc;class ca{get rawData(){return Xe(this,Hc,"f")||Vt(this,Hc,be.serialize(this.asn),"f"),Xe(this,Hc,"f")}constructor(...e){Hc.set(this,void 0),ve.isBufferSource(e[0])?(this.asn=be.parse(e[0],e[1]),Vt(this,Hc,ve.toArrayBuffer(e[0]),"f"),this.onInit(this.asn)):(this.asn=e[0],this.onInit(this.asn))}equal(e){return e instanceof ca?TR(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return be.toString(this.rawData);case"text":return lc.serialize(this.toTextObject());case"hex":return Ne.ToHex(this.rawData);case"base64":return Ne.ToBase64(this.rawData);case"base64url":return Ne.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new gt(this.getTextName(),{},e)}}Hc=new WeakMap;ca.NAME="ASN";class Mn extends ca{constructor(...e){let t;ve.isBufferSource(e[0])?t=ve.toArrayBuffer(e[0]):t=be.serialize(new ts({extnID:e[0],critical:e[1],extnValue:new ut(ve.toArrayBuffer(e[2]))})),super(t,ts)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[gt.NAME]===Mn.NAME&&(e[gt.NAME]=aa.toString(this.type)),e}}var pN;class Po{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[pN]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Po.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Po.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Po.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Po.DEFAULT,e);return this}}pN=Symbol.toStringTag;Po.DEFAULT="default";const gr=new Po,Kue=/^[0-2](?:\.[1-9][0-9]*)+$/;function jue(r){return new RegExp(Kue).test(r)}class gN{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return jue(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const mn=new gN;mn.register("CN","2.5.4.3");mn.register("L","2.5.4.7");mn.register("ST","2.5.4.8");mn.register("O","2.5.4.10");mn.register("OU","2.5.4.11");mn.register("C","2.5.4.6");mn.register("DC","0.9.2342.19200300.100.1.25");mn.register("E","1.2.840.113549.1.9.1");mn.register("G","2.5.4.42");mn.register("I","2.5.4.43");mn.register("SN","2.5.4.4");mn.register("T","2.5.4.12");function Wue(r,e){return`\\${Ne.ToHex(Ne.FromUtf8String(e)).toUpperCase()}`}function Gue(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,Wue)}class ys{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new gN,this.asn=new Jt;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const s=t[n];this.extraNames.register(n,s)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Jt?this.asn=e:ve.isBufferSource(e)?this.asn=be.parse(e,Jt):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||mn.findId(e),n=[];for(const s of this.asn)for(const i of s)i.type===t&&n.push(i.value.toString());return n}getName(e){return this.extraNames.get(e)||mn.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,s=t.value.anyValue?`#${Ne.ToHex(t.value.anyValue)}`:Gue(t.value.toString());return`${n}=${s}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const s={};for(const i of n){const o=this.getName(i.type)||i.type;(e=s[o])!==null&&e!==void 0||(s[o]=[]),s[o].push(i.value.anyValue?`#${Ne.ToHex(i.value.anyValue)}`:i.value.toString())}t.push(s)}return t}fromString(e){const t=new Jt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let s=null,i=",";for(;s=n.exec(`${e},`);){let[,o,a]=s;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),s[3]=c);const l=s[3];o=this.getTypeOid(o);const u=this.createAttribute(o,a);i==="+"?t[t.length-1].push(u):t.push(new Zl([u])),i=l}return t}fromJSON(e){const t=new Jt;for(const n of e){const s=new Zl;for(const i in n){const o=this.getTypeOid(i),a=n[i];for(const c of a){const l=this.createAttribute(o,c);s.push(l)}}t.push(s)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new B2({type:e});if(typeof t=="object")for(const s in t)switch(s){case"ia5String":n.value.ia5String=t[s];break;case"utf8String":n.value.utf8String=t[s];break;case"universalString":n.value.universalString=t[s];break;case"bmpString":n.value.bmpString=t[s];break;case"printableString":n.value.printableString=t[s];break}else if(t[0]==="#")n.value.anyValue=Ne.FromHex(t.slice(1));else{const s=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=s:ys.isPrintableString(s)?n.value.printableString=s:n.value.utf8String=s}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return be.serialize(this.asn)}async getThumbprint(...e){var t;let n,s="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(s=e[0]||s,n=e[1]||gr.get()):n=e[0]||gr.get(),await n.subtle.digest(s,this.toArrayBuffer())}}const mN="Cannot initialize GeneralName from ASN.1 data.",c_=`${mN} Unsupported string format in use.`,Yue=`${mN} Value doesn't match to GUID regular expression.`,l_=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,u_="1.3.6.1.4.1.311.25.1",h_="1.3.6.1.4.1.311.20.2.3",Ny="dns",Oy="dn",Ly="email",By="ip",My="url",$y="guid",Uy="upn",U1="id";class Do extends ca{constructor(...e){let t;if(e.length===2)switch(e[0]){case Oy:{const n=new ys(e[1]).toArrayBuffer(),s=be.parse(n,Jt);t=new We({directoryName:s});break}case Ny:t=new We({dNSName:e[1]});break;case Ly:t=new We({rfc822Name:e[1]});break;case $y:{const n=new RegExp(l_,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const s=n.slice(1).map((i,o)=>o<3?Ne.ToHex(new Uint8Array(Ne.FromHex(i)).reverse()):i).join("");t=new We({otherName:new Wd({typeId:u_,value:be.serialize(new ut(Ne.FromHex(s)))})});break}case By:t=new We({iPAddress:e[1]});break;case U1:t=new We({registeredID:e[1]});break;case Uy:{t=new We({otherName:new Wd({typeId:h_,value:be.serialize(DD.toASN(e[1]))})});break}case My:t=new We({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else ve.isBufferSource(e[0])?t=be.parse(e[0],We):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=Ny,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=Ly,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=By,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=My,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=U1,this.value=e.registeredID;else if(e.directoryName!=null)this.type=Oy,this.value=new ys(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===u_){this.type=$y;const t=be.parse(e.otherName.value,ut),n=new RegExp(l_,"i").exec(Ne.ToHex(t));if(!n)throw new Error(Yue);this.value=n.slice(1).map((s,i)=>i<3?Ne.ToHex(new Uint8Array(Ne.FromHex(s)).reverse()):s).join("-")}else if(e.otherName.typeId===h_)this.type=Uy,this.value=be.parse(e.otherName.value,Rr).toString();else throw new Error(c_);else throw new Error(c_)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case Oy:case Ny:case $y:case By:case U1:case Uy:case My:e=this.type.toUpperCase();break;case Ly:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===U1&&(t=aa.toString(t)),new gt(e,void 0,t)}}class uc extends ca{constructor(e){let t;if(e instanceof Kr)t=e;else if(Array.isArray(e)){const n=[];for(const s of e)if(s instanceof We)n.push(s);else{const i=be.parse(new Do(s.type,s.value).rawData,We);n.push(i)}t=new Kr(n)}else if(ve.isBufferSource(e))t=be.parse(e,Kr);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let s=null;try{s=new Do(n)}catch{continue}t.push(s)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let s=e[n[gt.NAME]];Array.isArray(s)||(s=[],e[n[gt.NAME]]=s),s.push(n)}return e}}uc.NAME="GeneralNames";const nd="-{5}",tf="\\n",Que=`[^${tf}]+`,Xue=`${nd}BEGIN (${Que}(?=${nd}))${nd}`,Jue=`${nd}END \\1${nd}`,au="\\n",Zue=`[^:${tf}]+`,ehe=`(?:[^${tf}]+${au}(?: +[^${tf}]+${au})*)`,the="[a-zA-Z0-9=+/]+",rhe=`(?:${the}${au})+`,d_=`${Xue}${au}(?:((?:${Zue}: ${ehe})+))?${au}?(${rhe})${Jue}`;class xn{static isPem(e){return typeof e=="string"&&new RegExp(d_,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(d_,"g"),n=[];let s=null;for(;s=t.exec(e);){const i=s[3].replace(new RegExp(`[${tf}]+`,"g"),""),o={type:s[1],headers:[],rawData:Ne.FromBase64(i)},a=s[2];if(a){const c=a.split(new RegExp(au,"g"));let l=null;for(const u of c){const[h,d]=u.split(/:(.*)/);if(d===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=h.trim()}else l&&o.headers.push(l),l={key:h,value:d.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(s=>{if(!ve.isBufferSource(s))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:ve.toArrayBuffer(s)}))}):e.forEach(s=>{if(!("type"in s))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(s))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:ve.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),s=[];if(s.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)s.push(`${l.key}: ${l.value}`);s.push("")}const i=Ne.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<i.length&&(i.length-a<64?o=i.substring(a):(o=i.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return s.push(...c),s.push(`-----END ${n}-----`),s.join(`
`)}}xn.CertificateTag="CERTIFICATE";xn.CrlTag="CRL";xn.CertificateRequestTag="CERTIFICATE REQUEST";xn.PublicKeyTag="PUBLIC KEY";xn.PrivateKeyTag="PRIVATE KEY";class Qi extends ca{static isAsnEncoded(e){return ve.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(xn.isPem(e))return xn.decode(e)[0];if(Ne.isHex(e))return Ne.FromHex(e);if(Ne.isBase64(e))return Ne.FromBase64(e);if(Ne.isBase64Url(e))return Ne.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=ve.toUint8Array(e);if(t.length>0&&t[0]===48)return ve.toArrayBuffer(e);const n=Ne.ToBinary(e);if(xn.isPem(n))return xn.decode(n)[0];if(Ne.isHex(n))return Ne.FromHex(n);if(Ne.isBase64(n))return Ne.FromBase64(n);if(Ne.isBase64Url(n))return Ne.FromBase64Url(n);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}}constructor(...e){Qi.isAsnEncoded(e[0])?super(Qi.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return xn.encode(this.rawData,this.tag);default:return super.toString(e)}}}class Ss extends Qi{static async create(e,t=gr.get()){if(e instanceof Ss)return e;if(Po.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new Ss(n)}else{if(e.publicKey)return e.publicKey;if(ve.isBufferSource(e))return new Ss(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){Qi.isAsnEncoded(e)?super(e,ms):super(e),this.tag=xn.PublicKeyTag}async export(...e){let t,n=["verify"],s={hash:"SHA-256",...this.algorithm};e.length>1?(s=e[0]||s,n=e[1]||n,t=e[2]||gr.get()):t=e[0]||gr.get();let i=this.rawData;const o=be.parse(this.rawData,ms);return o.algorithm.algorithm===rd&&(i=nhe(o,i)),t.subtle.importKey("spki",i,s,!0,n)}onInit(e){const t=Pr.resolve(cc),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case ic:{const s=be.parse(e.subjectPublicKey,nb),i=ve.toUint8Array(s.modulus);n.publicExponent=ve.toUint8Array(s.publicExponent),n.modulusLength=(i[0]?i:i.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,s="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(s=e[0]||s,n=e[1]||gr.get()):n=e[0]||gr.get(),await n.subtle.digest(s,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=gr.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=gr.get();const s=be.parse(this.rawData,ms);return await t.subtle.digest(n,s.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=be.parse(this.rawData,ms);switch(e.Algorithm=lc.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Xd:e["EC Point"]=t.subjectPublicKey;break;case ic:default:e["Raw Data"]=t.subjectPublicKey}return e}}function nhe(r,e){return r.algorithm=new ke({algorithm:ic,parameters:null}),e=be.serialize(r),e}class rf extends Mn{static async create(e,t=!1,n=gr.get()){if("name"in e&&"serialNumber"in e)return new rf(e,t);const i=await(await Ss.create(e,n)).getKeyIdentifier(n);return new rf(Ne.ToHex(i),t)}constructor(...e){if(ve.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new Ia({keyIdentifier:new $8(Ne.FromHex(e[0]))});super(P4,e[1],be.serialize(t))}else{const t=e[0],n=t.name instanceof uc?be.parse(t.name.rawData,Kr):t.name,s=new Ia({authorityCertIssuer:n,authorityCertSerialNumber:Ne.FromHex(t.serialNumber)});super(P4,e[1],be.serialize(s))}}onInit(e){super.onInit(e);const t=be.parse(e.extnValue,Ia);t.keyIdentifier&&(this.keyId=Ne.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ne.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=be.parse(this.value,Ia);return t.authorityCertIssuer&&(e["Authority Issuer"]=new uc(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}rf.NAME="Authority Key Identifier";class ab extends Mn{constructor(...e){if(ve.isBufferSource(e[0])){super(e[0]);const t=be.parse(this.value,R0);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new R0({cA:e[0],pathLenConstraint:e[1]});super(OD,e[2],be.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}ab.NAME="Basic Constraints";var f_;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(f_||(f_={}));class yN extends Mn{constructor(...e){if(ve.isBufferSource(e[0])){super(e[0]);const t=be.parse(this.value,O0);this.usages=t.map(n=>n)}else{const t=new O0(e[0]);super(MD,e[1],be.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>aa.toString(t)).join(", "),e}}yN.NAME="Extended Key Usages";var p_;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(p_||(p_={}));class wN extends Mn{constructor(...e){if(ve.isBufferSource(e[0])){super(e[0]);const t=be.parse(this.value,Dy);this.usages=t.toNumber()}else{const t=new Dy(e[0]);super(UD,e[1],be.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=be.parse(this.value,Dy);return e[""]=t.toJSON().join(", "),e}}wN.NAME="Key Usages";class am extends Mn{static async create(e,t=!1,n=gr.get()){const i=await(await Ss.create(e,n)).getKeyIdentifier(n);return new am(Ne.ToHex(i),t)}constructor(...e){if(ve.isBufferSource(e[0])){super(e[0]);const t=be.parse(this.value,Uo);this.keyId=Ne.ToHex(t)}else{const t=typeof e[0]=="string"?Ne.FromHex(e[0]):e[0],n=new Uo(t);super(HD,e[1],be.serialize(n)),this.keyId=Ne.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=be.parse(this.value,Uo);return e[""]=t,e}}am.NAME="Subject Key Identifier";class bN extends Mn{constructor(...e){ve.isBufferSource(e[0])?super(e[0]):super(zD,e[1],new uc(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=be.parse(e.extnValue,j4);this.names=new uc(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}bN.NAME="Subject Alternative Name";class $n{static register(e,t){this.items.set(e,t)}static create(e){const t=new Mn(e),n=this.items.get(t.type);return n?new n(e):t}}$n.items=new Map;class vN extends Mn{constructor(...e){var t;if(ve.isBufferSource(e[0])){super(e[0]);const n=be.parse(this.value,D0);this.policies=n.map(s=>s.policyIdentifier)}else{const n=e[0],s=(t=e[1])!==null&&t!==void 0?t:!1,i=new D0(n.map(o=>new $2({policyIdentifier:o})));super(LD,s,be.serialize(i)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new gt("",{},aa.toString(t))),e}}vN.NAME="Certificate Policies";$n.register(LD,vN);class EN extends Mn{constructor(...e){var t;if(ve.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const s=e[0].map(o=>new Iu({distributionPoint:new tc({fullName:[new We({uniformResourceIdentifier:o})]})})),i=new vl(s);super(B4,e[1],be.serialize(i))}else{const n=new vl(e[0]);super(B4,e[1],be.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=be.parse(e.extnValue,vl);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const s={};return t.distributionPoint&&(s[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(i=>new Do(i).toString()).join(", ")),t.reasons&&(s.Reasons=t.reasons.toString()),t.cRLIssuer&&(s["CRL Issuer"]=t.cRLIssuer.map(i=>i.toString()).join(", ")),s}),e}}EN.NAME="CRL Distribution Points";class SN extends Mn{constructor(...e){var t,n,s,i;if(ve.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof el){const o=new el(e[0]);super(R4,e[1],be.serialize(o))}else{const o=e[0],a=new el;V1(a,o,XE,"ocsp"),V1(a,o,JE,"caIssuers"),V1(a,o,ZE,"timeStamping"),V1(a,o,eS,"caRepository"),super(R4,e[1],be.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(s=this.timeStamping)!==null&&s!==void 0||(this.timeStamping=[]),(i=this.caRepository)!==null&&i!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],be.parse(e.extnValue,el).forEach(n=>{switch(n.accessMethod){case XE:this.ocsp.push(new Do(n.accessLocation));break;case JE:this.caIssuers.push(new Do(n.accessLocation));break;case ZE:this.timeStamping.push(new Do(n.accessLocation));break;case eS:this.caRepository.push(new Do(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&F1(e,"OCSP",this.ocsp),this.caIssuers.length&&F1(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&F1(e,"Time Stamping",this.timeStamping),this.caRepository.length&&F1(e,"CA Repository",this.caRepository),e}}SN.NAME="Authority Info Access";function F1(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new gt("");t.forEach((s,i)=>{const o=s.toTextObject(),a=`${o[gt.NAME]} ${i+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function V1(r,e,t,n){const s=e[n];s&&(Array.isArray(s)?s:[s]).forEach(o=>{typeof o=="string"&&(o=new Do("url",o)),r.push(new Df({accessMethod:t,accessLocation:be.parse(o.rawData,We)}))})}class _N extends Mn{constructor(...e){ve.isBufferSource(e[0])?super(e[0]):super($D,e[1],new uc(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=be.parse(e.extnValue,Kr);this.names=new uc(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}_N.NAME="Issuer Alternative Name";class Lu extends ca{constructor(...e){let t;if(ve.isBufferSource(e[0]))t=ve.toArrayBuffer(e[0]);else{const n=e[0],s=Array.isArray(e[1])?e[1].map(i=>ve.toArrayBuffer(i)):[];t=be.serialize(new Wi({type:n,values:s}))}super(t,Wi)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new gt("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[gt.NAME]===Lu.NAME&&(e[gt.NAME]=aa.toString(this.type)),e}}Lu.NAME="Attribute";class xN extends Lu{constructor(...e){var t;if(ve.isBufferSource(e[0]))super(e[0]);else{const n=new sg({printableString:e[0]});super(hN,[be.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=be.parse(this.values[0],sg);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[gt.VALUE]=this.password,e}}xN.NAME="Challenge Password";class cb extends Lu{constructor(...e){var t;if(ve.isBufferSource(e[0]))super(e[0]);else{const n=e[0],s=new Zo;for(const i of n)s.push(be.parse(i.rawData,ts));super(ob,[be.serialize(s)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=be.parse(this.values[0],Zo);this.items=t.map(n=>$n.create(be.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[gt.NAME]]=n;return e}}cb.NAME="Extensions";class cm{static register(e,t){this.items.set(e,t)}static create(e){const t=new Lu(e),n=this.items.get(t.type);return n?new n(e):t}}cm.items=new Map;const Kf="crypto.signatureFormatter";class she{toAsnSignature(e,t){return ve.toArrayBuffer(t)}toWebSignature(e,t){return ve.toArrayBuffer(t)}}var lp;let B6=lp=class{static createPssParams(e,t){const n=lp.getHashAlgorithm(e);return n?new ac({hashAlgorithm:n,maskGenAlgorithm:new ke({algorithm:J2,parameters:be.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=Pr.resolve(cc);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ke({algorithm:G0,parameters:null});case"sha-256":return new ke({algorithm:f6,parameters:null});case"sha-384":return new ke({algorithm:Y0,parameters:null});case"sha-512":return new ke({algorithm:Q0,parameters:null})}}else return new ke({algorithm:ic,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=lp.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ke({algorithm:rd,parameters:be.serialize(t)})}else return new ke({algorithm:rd,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case ic:return{name:"RSASSA-PKCS1-v1_5"};case G0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case f6:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case Y0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case Q0:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case rd:if(e.parameters){const t=be.parse(e.parameters,ac);return{name:"RSA-PSS",hash:Pr.resolve(cc).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};B6=lp=S([rm()],B6);Pr.registerSingleton(qf,B6);let M6=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ke({algorithm:X0});case"sha-256":return new ke({algorithm:J0});case"sha-384":return new ke({algorithm:Z0});case"sha-512":return new ke({algorithm:eg})}return null}toWebAlgorithm(e){switch(e.algorithm){case X0:return{name:"SHA-1"};case J0:return{name:"SHA-256"};case Z0:return{name:"SHA-384"};case eg:return{name:"SHA-512"}}return null}};M6=S([rm()],M6);Pr.registerSingleton(qf,M6);class Qn{addPadding(e,t){const n=ve.toUint8Array(t),s=new Uint8Array(e);return s.set(n,e-n.length),s.buffer}removePadding(e,t=!1){let n=ve.toUint8Array(e);for(let s=0;s<n.length;s++)if(n[s]){n=n.slice(s);break}if(t&&n[0]>127){const s=new Uint8Array(n.length+1);return s.set(n,1),s.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,s=Qn.namedCurveSize.get(n)||Qn.defaultNamedCurveSize,i=new W0,o=ve.toUint8Array(t);return i.r=this.removePadding(o.slice(0,s),!0),i.s=this.removePadding(o.slice(s,s+s),!0),be.serialize(i)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=be.parse(t,W0),s=e.namedCurve,i=Qn.namedCurveSize.get(s)||Qn.defaultNamedCurveSize,o=this.addPadding(i,this.removePadding(n.r)),a=this.addPadding(i,this.removePadding(n.s));return ere(o,a)}return null}}Qn.namedCurveSize=new Map;Qn.defaultNamedCurveSize=32;const Fy="1.3.101.110",g_="1.3.101.111",Vy="1.3.101.112",m_="1.3.101.113";let $6=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Vy;break;case"x25519":t=Fy;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Vy;break;case"ed448":t=m_;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=Fy;break;case"x448":t=g_;break}}return t?new ke({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Vy:return{name:"Ed25519"};case m_:return{name:"EdDSA",namedCurve:"Ed448"};case Fy:return{name:"X25519"};case g_:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};$6=S([rm()],$6);Pr.registerSingleton(qf,$6);var dh,fh,ph,gh,mh,yh,wh,qc;class ihe extends Qi{get subjectName(){return Xe(this,fh,"f")||Vt(this,fh,new ys(this.asn.certificationRequestInfo.subject),"f"),Xe(this,fh,"f")}get subject(){return Xe(this,ph,"f")||Vt(this,ph,this.subjectName.toString(),"f"),Xe(this,ph,"f")}get signatureAlgorithm(){if(!Xe(this,gh,"f")){const e=Pr.resolve(cc);Vt(this,gh,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return Xe(this,gh,"f")}get signature(){return Xe(this,mh,"f")||Vt(this,mh,this.asn.signature,"f"),Xe(this,mh,"f")}get publicKey(){return Xe(this,yh,"f")||Vt(this,yh,new Ss(this.asn.certificationRequestInfo.subjectPKInfo),"f"),Xe(this,yh,"f")}get attributes(){return Xe(this,wh,"f")||Vt(this,wh,this.asn.certificationRequestInfo.attributes.map(e=>cm.create(be.serialize(e))),"f"),Xe(this,wh,"f")}get extensions(){if(!Xe(this,qc,"f")){Vt(this,qc,[],"f");const e=this.getAttribute(ob);e instanceof cb&&Vt(this,qc,e.items,"f")}return Xe(this,qc,"f")}get tbs(){return Xe(this,dh,"f")||Vt(this,dh,this.asn.certificationRequestInfoRaw||be.serialize(this.asn.certificationRequestInfo),"f"),Xe(this,dh,"f")}constructor(e){const t=Qi.isAsnEncoded(e)?[e,Zd]:[e];super(t[0],t[1]),dh.set(this,void 0),fh.set(this,void 0),ph.set(this,void 0),gh.set(this,void 0),mh.set(this,void 0),yh.set(this,void 0),wh.set(this,void 0),qc.set(this,void 0),this.tag=xn.CertificateRequestTag}onInit(e){}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=gr.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),s=Pr.resolveAll(Kf).reverse();let i=null;for(const a of s)if(i=a.toWebSignature(t,this.signature),i)break;if(!i)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,i,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=be.parse(this.rawData,Zd),n=t.certificationRequestInfo,s=new gt("",{Version:`${rc[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const i=new gt("");for(const o of this.attributes){const a=o.toTextObject();i[a[gt.NAME]]=a}s.Attributes=i}return e.Data=s,e.Signature=new gt("",{Algorithm:lc.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}dh=new WeakMap,fh=new WeakMap,ph=new WeakMap,gh=new WeakMap,mh=new WeakMap,yh=new WeakMap,wh=new WeakMap,qc=new WeakMap;ihe.NAME="PKCS#10 Certificate Request";var bh,vh,Eh,Sh,_h,xh,Ah,Ch,kh,Ih,Kc,Th;class lb extends Qi{get publicKey(){return Xe(this,Th,"f")||Vt(this,Th,new Ss(this.asn.tbsCertificate.subjectPublicKeyInfo),"f"),Xe(this,Th,"f")}get serialNumber(){if(!Xe(this,vh,"f")){const e=this.asn.tbsCertificate;let t=new Uint8Array(e.serialNumber);t.length>1&&t[0]===0&&t[1]>127&&(t=t.slice(1)),Vt(this,vh,Ne.ToHex(t),"f")}return Xe(this,vh,"f")}get subjectName(){return Xe(this,Eh,"f")||Vt(this,Eh,new ys(this.asn.tbsCertificate.subject),"f"),Xe(this,Eh,"f")}get subject(){return Xe(this,Sh,"f")||Vt(this,Sh,this.subjectName.toString(),"f"),Xe(this,Sh,"f")}get issuerName(){return Xe(this,_h,"f")||Vt(this,_h,new ys(this.asn.tbsCertificate.issuer),"f"),Xe(this,_h,"f")}get issuer(){return Xe(this,xh,"f")||Vt(this,xh,this.issuerName.toString(),"f"),Xe(this,xh,"f")}get notBefore(){if(!Xe(this,Ah,"f")){const e=this.asn.tbsCertificate.validity.notBefore.utcTime||this.asn.tbsCertificate.validity.notBefore.generalTime;if(!e)throw new Error("Cannot get 'notBefore' value");Vt(this,Ah,e,"f")}return Xe(this,Ah,"f")}get notAfter(){if(!Xe(this,Ch,"f")){const e=this.asn.tbsCertificate.validity.notAfter.utcTime||this.asn.tbsCertificate.validity.notAfter.generalTime;if(!e)throw new Error("Cannot get 'notAfter' value");Vt(this,Ch,e,"f")}return Xe(this,Ch,"f")}get signatureAlgorithm(){if(!Xe(this,kh,"f")){const e=Pr.resolve(cc);Vt(this,kh,e.toWebAlgorithm(this.asn.signatureAlgorithm),"f")}return Xe(this,kh,"f")}get signature(){return Xe(this,Ih,"f")||Vt(this,Ih,this.asn.signatureValue,"f"),Xe(this,Ih,"f")}get extensions(){return Xe(this,Kc,"f")||(Vt(this,Kc,[],"f"),this.asn.tbsCertificate.extensions&&Vt(this,Kc,this.asn.tbsCertificate.extensions.map(e=>$n.create(be.serialize(e))),"f")),Xe(this,Kc,"f")}get tbs(){return Xe(this,bh,"f")||Vt(this,bh,this.asn.tbsCertificateRaw||be.serialize(this.asn.tbsCertificate),"f"),Xe(this,bh,"f")}constructor(e){const t=Qi.isAsnEncoded(e)?[e,nc]:[e];super(t[0],t[1]),bh.set(this,void 0),vh.set(this,void 0),Eh.set(this,void 0),Sh.set(this,void 0),_h.set(this,void 0),xh.set(this,void 0),Ah.set(this,void 0),Ch.set(this,void 0),kh.set(this,void 0),Ih.set(this,void 0),Kc.set(this,void 0),Th.set(this,void 0),this.tag=xn.CertificateTag}onInit(e){}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=gr.get()){let n,s;const i=e.publicKey;try{if(!i)n={...this.publicKey.algorithm,...this.signatureAlgorithm},s=await this.publicKey.export(n,["verify"],t);else if("publicKey"in i)n={...i.publicKey.algorithm,...this.signatureAlgorithm},s=await i.publicKey.export(n,["verify"],t);else if(i instanceof Ss)n={...i.algorithm,...this.signatureAlgorithm},s=await i.export(n,["verify"],t);else if(ve.isBufferSource(i)){const l=new Ss(i);n={...l.algorithm,...this.signatureAlgorithm},s=await l.export(n,["verify"],t)}else n={...i.algorithm,...this.signatureAlgorithm},s=i}catch{return!1}const o=Pr.resolveAll(Kf).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,s,a,this.tbs);if(e.signatureOnly)return c;{const u=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<u&&u<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=gr.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=gr.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=be.parse(this.rawData,nc),n=t.tbsCertificate,s=new gt("",{Version:`${rc[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":lc.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new gt("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(s["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(s["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const i=new gt("");for(const o of this.extensions){const a=o.toTextObject();i[a[gt.NAME]]=a}s.Extensions=i}return e.Data=s,e.Signature=new gt("",{Algorithm:lc.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}bh=new WeakMap,vh=new WeakMap,Eh=new WeakMap,Sh=new WeakMap,_h=new WeakMap,xh=new WeakMap,Ah=new WeakMap,Ch=new WeakMap,kh=new WeakMap,Ih=new WeakMap,Kc=new WeakMap,Th=new WeakMap;lb.NAME="Certificate";function ohe(r,e=gr.get()){const t=ve.toUint8Array(Ne.FromHex(r||""));let n=t&&t.length&&t.some(i=>i>0)?new Uint8Array(t):void 0;n||(n=e.getRandomValues(new Uint8Array(16)));let s=0;for(;s<n.length-1&&n[s]===0;)s++;if(n=n.slice(s),n[0]>127){const i=new Uint8Array(n.length+1);i[0]=0,i.set(n,1),n=i}return n.buffer}class ahe{static async createSelfSigned(e,t=gr.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=gr.get()){var n;let s;e.publicKey instanceof Ss?s=e.publicKey.rawData:"publicKey"in e.publicKey?s=e.publicKey.publicKey.rawData:ve.isBufferSource(e.publicKey)?s=e.publicKey:s=await t.subtle.exportKey("spki",e.publicKey);const i=ohe(e.serialNumber),o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new nc({tbsCertificate:new Bn({version:rc.v3,serialNumber:i,validity:new Nf({notBefore:o,notAfter:a}),extensions:new Zo(((n=e.extensions)===null||n===void 0?void 0:n.map(b=>be.parse(b.rawData,ts)))||[]),subjectPublicKeyInfo:be.parse(s,ms)})});if(e.subject){const b=e.subject instanceof ys?e.subject:new ys(e.subject);c.tbsCertificate.subject=be.parse(b.toArrayBuffer(),Jt)}if(e.issuer){const b=e.issuer instanceof ys?e.issuer:new ys(e.issuer);c.tbsCertificate.issuer=be.parse(b.toArrayBuffer(),Jt)}const l={hash:"SHA-256"},u="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},h=Pr.resolve(cc);c.tbsCertificate.signature=c.signatureAlgorithm=h.toAsnAlgorithm(u);const d=be.serialize(c.tbsCertificate),f="signingKey"in e?await t.subtle.sign(u,e.signingKey,d):e.signature,g=Pr.resolveAll(Kf).reverse();let m=null;for(const b of g)if(m=b.toAsnSignature(u,f),m)break;if(!m)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=m,new lb(be.serialize(c))}}var y_;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(y_||(y_={}));$n.register(OD,ab);$n.register(MD,yN);$n.register(UD,wN);$n.register(HD,am);$n.register(P4,rf);$n.register(zD,bN);$n.register(B4,EN);$n.register(R4,SN);$n.register($D,_N);cm.register(hN,xN);cm.register(ob,cb);Pr.registerSingleton(Kf,she);Pr.registerSingleton(Kf,Qn);Qn.namedCurveSize.set("P-256",32);Qn.namedCurveSize.set("K-256",32);Qn.namedCurveSize.set("P-384",48);Qn.namedCurveSize.set("P-521",66);class che extends Nt{async listen(){throw new Cle("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const AN=Object.values(Ll).map(r=>r.decoder).reduce((r,e)=>r.or(e)),lhe=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function uhe(r){return r?.match(lhe)?.groups?.fingerprint}function CN(r){const t=r.getComponents().find(n=>n.code===$l)?.value;if(t===void 0||t==="")throw new ue(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function hhe(r){return wr(AN.decode(r))}function dhe(r){const e=hhe(CN(r)),t=phe(e.code),n=e.digest.reduce((i,o)=>i+o.toString(16).padStart(2,"0"),""),s=n.match(/.{1,2}/g);if(s==null)throw new Ale(n,r.toString());return`${t} ${s.join(":").toUpperCase()}`}function fhe(r){const e=r.split(":").map(s=>parseInt(s,16)),t=Uint8Array.from(e),n=ia(Zt.code,t);return Ye(`/certhash/${mu.encode(n.bytes)}`)}function phe(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new kle(r)}}function ghe(r,e){const{host:t,port:n,type:s}=ct(r);if(s!=="ip4"&&s!=="ip6")throw new ue(`Multiaddr ${r} was not an IPv4 or IPv6 address`);const i=dhe(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${s==="ip4"?4:6} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${s==="ip4"?4:6} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${i}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${O2}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function mhe(r,e){const{host:t,port:n,type:s}=ct(r);if(s!=="ip4"&&s!=="ip6")throw new ue(`Multiaddr ${r} was not an IPv4 or IPv6 address`);return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${s==="ip4"?4:6} ${t}
s=-
c=IN IP${s==="ip4"?4:6} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${O2}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function w_(r,e){if(r.sdp===void 0)throw new ue("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;try{r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t)}catch{}return r}const zy=le("libp2p-webrtc-noise:");function yhe(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),s=le(n,"hex"),i=ia(Zt.code,s),o=AN.decode(CN(e)),a=zy.byteLength+i.bytes.byteLength+o.byteLength;return Wt(t==="server"?[zy,o,i.bytes]:[zy,i.bytes,o],a)}const whe=kD?"iceconnectionstatechange":"connectionstatechange";function bhe(r,e){return r.role==="server"}async function vhe(r,e,t,n){const s=r.createDataChannel("",{negotiated:!0,id:0});try{if(n.role==="client"){n.log.trace("client creating local offer");const h=await r.createOffer();n.log.trace("client created local offer %s",h.sdp);const d=w_(h,t);n.log.trace("client setting local offer %s",d.sdp),await r.setLocalDescription(d);const f=ghe(n.remoteAddr,t);n.log.trace("client setting server description %s",f.sdp),await r.setRemoteDescription(f)}else{const h=mhe(n.remoteAddr,t);n.log.trace("server setting client %s %s",h.type,h.sdp),await r.setRemoteDescription(h),n.log.trace("server creating local answer");const d=await r.createAnswer();n.log.trace("server created local answer");const f=w_(d,t);n.log.trace("server setting local description %s",d.sdp),await r.setLocalDescription(f)}if(s.readyState!=="open"&&(n.log.trace("%s wait for handshake channel to open, starting status %s",n.role,s.readyState),await sr(s,"open",n)),n.log.trace("%s handshake channel opened",n.role),bhe(n,r)){const h=r.remoteFingerprint()?.value??"";n.remoteAddr=n.remoteAddr.encapsulate(fhe(h))}const i=uhe(r.localDescription?.sdp);if(i==null)throw new Pf("Could not get fingerprint from local description sdp");n.log.trace("%s performing noise handshake",n.role);const o=yhe(i,n.remoteAddr,n.role),a=MP({prologueBytes:o})(n),c=_4({channel:s,direction:"outbound",isHandshake:!0,log:n.log,...n.dataChannel??{}}),l=x4({peerConnection:r,remoteAddr:n.remoteAddr,metrics:n.events,direction:n.role==="client"?"outbound":"inbound",log:n.logger.forComponent("libp2p:webrtc-direct:connection")});if(r.addEventListener(whe,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":l.close().catch(h=>{n.log.error("error closing connection - %e",h),l.abort(h)});break;default:break}}),n.events?.increment({peer_connection:!0}),n.role==="client"){n.log.trace("%s secure inbound",n.role);const h=await a.secureInbound(c,{remotePeer:n.remotePeer,signal:n.signal,skipStreamMuxerNegotiation:!0});return n.log.trace("%s upgrade outbound",n.role),await n.upgrader.upgradeOutbound(l,{skipProtection:!0,skipEncryption:!0,remotePeer:h.remotePeer,muxerFactory:e,signal:n.signal})}n.log.trace("%s secure outbound",n.role);const u=await a.secureOutbound(c,{remotePeer:n.remotePeer,signal:n.signal,skipStreamMuxerNegotiation:!0});l.remoteAddr=l.remoteAddr.encapsulate(`/p2p/${u.remotePeer}`),n.log.trace("%s upgrade inbound",n.role),await n.upgrader.upgradeInbound(l,{skipProtection:!0,skipEncryption:!0,remotePeer:u.remotePeer,muxerFactory:e,signal:n.signal})}catch(i){throw s.close(),r.close(),i}}async function Ehe(r,e,t={}){let n=t.certificate;n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const s=typeof t.rtcConfiguration=="function"?await t.rtcConfiguration():t.rtcConfiguration,i=new RTCPeerConnection({...s??{},certificates:[n]}),o=new N8({peerConnection:i,metrics:t.events,dataChannelOptions:t.dataChannel});return{peerConnection:i,muxerFactory:o}}async function She(r){const e=await Yk(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...he(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}class _he{log;metrics;components;init;certificate;privateKey;emitter;renewCertificateTask;constructor(e,t={}){if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new Nt,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new ue("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}[Fg]=!0;[Symbol.toStringTag]="@libp2p/webrtc-direct";[yr]=["@libp2p/transport"];async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){this.log("dial %a",e),t.signal.throwIfAborted();let n;const s=e.getComponents().findLast(c=>c.code===qe)?.value;s!=null&&(n=On(s));const i=vle(),{peerConnection:o,muxerFactory:a}=await Ehe("client",i,{rtcConfiguration:typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{},dataChannel:this.init.dataChannel});try{return await vhe(o,a,i,{role:"client",log:this.log,logger:this.components.logger,events:this.metrics?.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeer:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Rl;return new che(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(q3.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(xhe(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:s}=await this.loadOrCreateCertificate(t,e);return{privateKey:await She(t),pem:n,certhash:s}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??nle,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new dn;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await d5("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const s=new Pt(this.init.certificateDatastoreKey??rle),i=await Yk(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new dn;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(s,i)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(s,i)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??FE)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:mu.encode((await Zt.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),s=new lb(n),i=s.notAfter.getTime()-(this.init.certificateRenewalThreshold??FE);if(Date.now()>i)throw this.log("stored TLS certificate has expired"),new dn;this.log("loaded certificate, expires in %d ms",i);const o=await s.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!Qe(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new dn;return this.log("loaded certificate, expiry time is %o",i),s}async createCertificate(e,t){const n=new Date,s=new Date(Date.now()+(this.init.certificateLifespan??sle));n.setMilliseconds(0),s.setMilliseconds(0);const i=await ahe.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:s,keys:t,extensions:[new ab(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,le(i.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),i}getKeychain(){try{return this.components.keychain}catch{}}}function xhe(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function Ahe(r){return e=>new _he(e,r)}function Che(r){return e=>new Ple(e,r)}function khe(){throw new Error("WebSocket Servers can not be created in the browser!")}const Ihe=1024*1024*4,The=10;class Rhe extends w5{websocket;maxBufferedAmount;checkBufferedAmountTask;constructor(e){super(e),this.websocket=e.websocket,this.maxBufferedAmount=e.maxBufferedAmount??Ihe,this.checkBufferedAmountTask=V5(this.checkBufferedAmount.bind(this),e.bufferedAmountPollInterval??The),this.websocket.addEventListener("close",t=>{if(this.log('closed - code %d, reason "%s", wasClean %s',t.code,t.reason,t.wasClean),this.checkBufferedAmountTask.stop(),!t.wasClean){this.onRemoteReset();return}this.onTransportClosed()},{once:!0}),this.websocket.addEventListener("message",t=>{try{let n;if(typeof t.data=="string")n=le(t.data);else if(t.data instanceof ArrayBuffer)n=new Uint8Array(t.data,0,t.data.byteLength);else{this.abort(new Error("Incorrect binary type"));return}this.onData(n)}catch(n){this.log.error("error receiving data - %e",n)}})}sendData(e){for(const n of e)this.websocket.send(n);const t=this.websocket.bufferedAmount<this.maxBufferedAmount;return t||this.checkBufferedAmountTask.start(),{sentBytes:e.byteLength,canSendMore:t}}sendReset(){this.websocket.close(1006)}async sendClose(e){this.websocket.close(),e?.signal?.throwIfAborted()}sendPause(){}sendResume(){}checkBufferedAmount(){this.log("buffered amount now %d",this.websocket.bufferedAmount),this.websocket.bufferedAmount===0&&(this.checkBufferedAmountTask.stop(),this.safeDispatchEvent("drain"))}}function Phe(r){return new Rhe(r)}class Dhe{log;init;logger;metrics;components;constructor(e,t={}){this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}[Fg]=!0;[Symbol.toStringTag]="@libp2p/websockets";[yr]=["@libp2p/transport"];async dial(e,t){this.log("dialing %s",e),t=t??{};const n=Phe({websocket:await this._connect(e,t),remoteAddr:e,metrics:this.metrics?.dialerEvents,direction:"outbound",log:this.components.logger.forComponent("libp2p:websockets:connection"),maxBufferedAmount:this.init.maxBufferedAmount,bufferedAmountPollInterval:this.init.bufferedAmountPollInterval});this.log("new outbound connection %s",n.remoteAddr);const s=await t.upgrader.upgradeOutbound(n,t);return this.log("outbound connection %s upgraded",n.remoteAddr),s}async _connect(e,t){t?.signal?.throwIfAborted();const n=X5(e);this.log("create websocket connection to %s",n);const s=new WebSocket(n);s.binaryType="arraybuffer";try{t.onProgress?.(new Pe("websockets:open-connection")),await sr(s,"open",t)}catch(i){if(t.signal?.aborted)throw this.metrics?.dialerEvents.increment({abort:!0}),new PC(`Could not connect to ${n}`);this.metrics?.dialerEvents.increment({error:!0});try{s.close()}catch{}throw i}return this.log("connected %s",e),this.metrics?.dialerEvents.increment({connect:!0}),s}createListener(e){return khe({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){return e.filter(t=>Vd.exactMatch(t)||o0.exactMatch(t))}dialFilter(e){return this.listenFilter(e)}}function Nhe(r={}){return e=>new Dhe(e,r)}function Ohe(r,e){const t=e.map((n,s)=>({record:Cf(n),index:s}));return t.sort((n,s)=>{const i=n.record.sequence,o=s.record.sequence;if(i>o)return-1;if(i<o)return 1;if(n.record.validityType===Es.ValidityType.EOL&&s.record.validityType===Es.ValidityType.EOL){const a=Y3.fromString(n.record.validity).toDate(),c=Y3.fromString(s.record.validity).toDate();if(a.getTime()>c.getTime())return-1;if(a.getTime()<c.getTime())return 1}return 0}),t[0].index}const Lhe="6.0.1",Bhe="helia",Mhe={list:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dnsaddr/va1.bootstrap.libp2p.io/p2p/12D3KooWKnDdG3iXw9eTFijk3EWSunZcFi54Zka4wmtqtt6rPxc8","/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ"]};function $he(r={}){const e=`${Bhe}/${Lhe} ${CR()}`;return{privateKey:r.privateKey,dns:r.dns,nodeInfo:{userAgent:e},addresses:{listen:["/p2p-circuit","/webrtc"]},transports:[pse(),Che(),Ahe(),Nhe()],connectionEncrypters:[MP()],streamMuxers:[Dne(),Vce()],peerDiscovery:[Yne(Mhe)],services:{autoNAT:qne(),dcutr:mse(),delegatedRouting:()=>yZ("https://delegated-ipfs.dev",wZ()),dht:Tce({clientMode:!0,validators:{ipns:eR},selectors:{ipns:Ohe}}),identify:lae(),identifyPush:uae(),keychain:CP(r.keychain),ping:Yce(),http:Xoe()}}}async function Uhe(r){const e=r.libp2p??{};e.privateKey==null&&r.datastore!=null&&(e.privateKey=await Tre(r.datastore,r.keychain));const t=$he(e);return t.datastore=t.datastore??r.datastore,await Vte({...t,...e,start:!1})}async function Fhe(r={}){const e=r.datastore??new sR,t=r.blockstore??new KZ;let n;return Hte(r.libp2p)?n=r.libp2p:n=await Uhe({...r,libp2p:{dns:r.dns,...r.libp2p,start:void 0},datastore:e}),{...r,libp2p:n,datastore:e,blockstore:t,blockBrokers:r.blockBrokers??[kX(),iX()],routers:r.routers??[zZ(n),FZ()],metrics:n.metrics}}async function Vhe(r={}){const e=await Fhe(r),t=new yQ(e);return e.start!==!1&&await t.start(),t}function zhe(r){return r[Symbol.asyncIterator]!=null}function kN(r,e=1){return e=Number(e),zhe(r)?(async function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for await(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)})():(function*(){let t=[];if(e<1&&(e=1),e!==Math.round(e))throw new Error("Batch size must be an integer");for(const n of r)for(t.push(n);t.length>=e;)yield t.slice(0,e),t=t.slice(e);for(;t.length>0;)yield t.slice(0,e),t=t.slice(e)})()}async function*IN(r,e=1){for await(const t of kN(r,e)){const n=t.map(async s=>s().then(i=>({ok:!0,value:i}),i=>({ok:!1,err:i})));for(let s=0;s<n.length;s++){const i=await n[s];if(i.ok)yield i.value;else throw i.err}}}const Hhe=262144,TN=(r={})=>{const e=r.chunkSize??Hhe;return async function*(n){let s=new ze,i=0,o=!1;for await(const a of n)for(s.append(a),i+=a.length;i>=e;)if(yield s.slice(0,e),o=!0,e===s.length)s=new ze,i=0;else{const c=new ze;c.append(s.sublist(e)),s=c,i-=e}(!o||i>0)&&(yield s.subarray(0,i))}};class nf extends Error{static name="InvalidTypeError";static code="ERR_INVALID_TYPE";name=nf.name;code=nf.code;constructor(e="Invalid type"){super(e)}}class og extends Error{static name="InvalidUnixFSMessageError";static code="ERR_INVALID_MESSAGE";name=og.name;code=og.code;constructor(e="Invalid message"){super(e)}}var Fs;(function(r){(function(n){n.Raw="Raw",n.Directory="Directory",n.File="File",n.Metadata="Metadata",n.Symlink="Symlink",n.HAMTShard="HAMTShard"})(r.DataType||(r.DataType={}));let e;(function(n){n[n.Raw=0]="Raw",n[n.Directory=1]="Directory",n[n.File=2]="File",n[n.Metadata=3]="Metadata",n[n.Symlink=4]="Symlink",n[n.HAMTShard=5]="HAMTShard"})(e||(e={})),(function(n){n.codec=()=>nn(e)})(r.DataType||(r.DataType={}));let t;r.codec=()=>(t==null&&(t=tt((n,s,i={})=>{if(i.lengthDelimited!==!1&&s.fork(),n.Type!=null&&(s.uint32(8),r.DataType.codec().encode(n.Type,s)),n.Data!=null&&(s.uint32(18),s.bytes(n.Data)),n.filesize!=null&&(s.uint32(24),s.uint64(n.filesize)),n.blocksizes!=null)for(const o of n.blocksizes)s.uint32(32),s.uint64(o);n.hashType!=null&&(s.uint32(40),s.uint64(n.hashType)),n.fanout!=null&&(s.uint32(48),s.uint64(n.fanout)),n.mode!=null&&(s.uint32(56),s.uint32(n.mode)),n.mtime!=null&&(s.uint32(66),ag.codec().encode(n.mtime,s)),i.lengthDelimited!==!1&&s.ldelim()},(n,s)=>{const i={blocksizes:[]},o=s==null?n.len:n.pos+s;for(;n.pos<o;){const a=n.uint32();switch(a>>>3){case 1:i.Type=r.DataType.codec().decode(n);break;case 2:i.Data=n.bytes();break;case 3:i.filesize=n.uint64();break;case 4:i.blocksizes.push(n.uint64());break;case 5:i.hashType=n.uint64();break;case 6:i.fanout=n.uint64();break;case 7:i.mode=n.uint32();break;case 8:i.mtime=ag.codec().decode(n,n.uint32());break;default:n.skipType(a&7);break}}return i})),t),r.encode=n=>et(n,r.codec()),r.decode=n=>Ze(n,r.codec())})(Fs||(Fs={}));var ag;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.Seconds!=null&&(n.uint32(8),n.int64(t.Seconds)),t.FractionalNanoseconds!=null&&(n.uint32(21),n.fixed32(t.FractionalNanoseconds)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.Seconds=t.int64();break;case 2:s.FractionalNanoseconds=t.fixed32();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>et(t,r.codec()),r.decode=t=>Ze(t,r.codec())})(ag||(ag={}));var b_;(function(r){let e;r.codec=()=>(e==null&&(e=tt((t,n,s={})=>{s.lengthDelimited!==!1&&n.fork(),t.MimeType!=null&&(n.uint32(10),n.string(t.MimeType)),s.lengthDelimited!==!1&&n.ldelim()},(t,n)=>{const s={},i=n==null?t.len:t.pos+n;for(;t.pos<i;){const o=t.uint32();switch(o>>>3){case 1:s.MimeType=t.string();break;default:t.skipType(o&7);break}}return s})),e),r.encode=t=>et(t,r.codec()),r.decode=t=>Ze(t,r.codec())})(b_||(b_={}));const v_={Raw:"raw",Directory:"directory",File:"file",Metadata:"metadata",Symlink:"symlink",HAMTShard:"hamt-sharded-directory"},qhe=["directory","hamt-sharded-directory"],E_=parseInt("0644",8),S_=parseInt("0755",8),__=BigInt(1024);let dt=class RN{static unmarshal(e){const t=Fs.decode(e);if(t.fanout!=null&&t.fanout>__)throw new og(`Fanout size was too large - ${t.fanout} > ${__}`);const n=new RN({type:v_[t.Type!=null?t.Type.toString():"File"],data:t.Data,blockSizes:t.blocksizes,mode:t.mode,mtime:t.mtime!=null?{secs:t.mtime.Seconds??0n,nsecs:t.mtime.FractionalNanoseconds}:void 0,fanout:t.fanout});return n._originalMode=t.mode??0,n}type;data;blockSizes;hashType;fanout;mtime;_mode;_originalMode;constructor(e={type:"file"}){const{type:t,data:n,blockSizes:s,hashType:i,fanout:o,mtime:a,mode:c}=e;if(t!=null&&!Object.values(v_).includes(t))throw new nf("Type: "+t+" is not valid");this.type=t??"file",this.data=n,this.hashType=i,this.fanout=o,this.blockSizes=s??[],this._originalMode=0,this.mode=c,this.mtime=a}set mode(e){e==null?this._mode=this.isDirectory()?S_:E_:this._mode=e&4095}get mode(){return this._mode}isDirectory(){return qhe.includes(this.type)}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0n;let e=0n;return this.blockSizes.forEach(t=>{e+=t}),this.data!=null&&(e+=BigInt(this.data.length)),e}marshal(){let e;switch(this.type){case"raw":e=Fs.DataType.Raw;break;case"directory":e=Fs.DataType.Directory;break;case"file":e=Fs.DataType.File;break;case"metadata":e=Fs.DataType.Metadata;break;case"symlink":e=Fs.DataType.Symlink;break;case"hamt-sharded-directory":e=Fs.DataType.HAMTShard;break;default:throw new nf(`Type: ${e} is not valid`)}let t=this.data;(this.data==null||this.data.length===0)&&(t=void 0);let n;this.mode!=null&&(n=this._originalMode&4294963200|(this.mode??0),n===E_&&!this.isDirectory()&&(n=void 0),n===S_&&this.isDirectory()&&(n=void 0));let s;return this.mtime!=null&&(s={Seconds:this.mtime.secs,FractionalNanoseconds:this.mtime.nsecs}),Fs.encode({Type:e,Data:t,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:n,mtime:s})}};const cu=async(r,e,t)=>{t.codec==null&&(t.codec=xf);const n=await Zt.digest(r),s=Ee.create(t.cidVersion,t.codec.code,n);return await e.put(s,r,t),s};function Khe(r){return async function*(t,n){let s=0n;for await(let i of t.content)yield async()=>{let o;const a={codec:xf,cidVersion:r.cidVersion,onProgress:r.onProgress};r.rawLeaves?(a.codec=KC,a.cidVersion=1):(o=new dt({type:r.leafType,data:i}),i=er({Data:o.marshal(),Links:[]}));const c=await cu(i,n,a);return s+=BigInt(i.byteLength),r.onProgress?.(new Pe("unixfs:importer:progress:file:write",{bytesWritten:s,cid:c,path:t.path})),{cid:c,unixfs:o,size:BigInt(i.length),block:i}}}}let jhe=class U6 extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=U6.name;code=U6.code;constructor(e="Invalid parameters"){super(e)}};class hc extends Error{static name="InvalidContentError";static code="ERR_INVALID_CONTENT";name=hc.name;code=hc.code;constructor(e="Invalid content"){super(e)}}const Whe=async(r,e,t)=>{const n=new dt({type:"directory",mtime:r.mtime,mode:r.mode}),s=er(Nn({Data:n.marshal()})),i=await cu(s,e,t),o=r.path;return{cid:i,path:o,unixfs:n,size:BigInt(s.length),originalPath:r.originalPath,block:s}};async function*Ghe(r,e,t){let n=-1,s;for await(const i of IN(t.bufferImporter(r,e),t.blockWriteConcurrency)){if(n++,n===0){s={...i,single:!0};continue}else n===1&&s!=null&&(yield{...s,block:void 0,single:void 0},s=void 0);yield{...i,block:void 0}}s!=null&&(yield s)}function x_(r){return r.single===!0}const Yhe=(r,e,t)=>async function(s){if(s.length===1&&x_(s[0])&&t.reduceSingleLeafToSelf){const u=s[0];let h=u.block;return x_(u)&&(r.mtime!==void 0||r.mode!==void 0)&&(u.unixfs=new dt({type:"file",mtime:r.mtime,mode:r.mode,data:u.block}),h={Data:u.unixfs.marshal(),Links:[]},u.block=er(Nn(h)),u.cid=await cu(u.block,e,{...t,cidVersion:t.cidVersion}),u.size=BigInt(u.block.length)),t.onProgress?.(new Pe("unixfs:importer:progress:file:layout",{cid:u.cid,path:u.originalPath})),{cid:u.cid,path:r.path,unixfs:u.unixfs,size:u.size,originalPath:u.originalPath}}const i=new dt({type:"file",mtime:r.mtime,mode:r.mode}),o=s.filter(u=>u.cid.code===As&&u.size>0||u.unixfs!=null&&u.unixfs.data==null&&u.unixfs.fileSize()>0n?!0:!!u.unixfs?.data?.length).map(u=>u.cid.code===As?(i.addBlockSize(u.size),{Name:"",Tsize:Number(u.size),Hash:u.cid}):(u.unixfs?.data==null?i.addBlockSize(u.unixfs?.fileSize()??0n):i.addBlockSize(BigInt(u.unixfs.data.length)),{Name:"",Tsize:Number(u.size),Hash:u.cid})),a={Data:i.marshal(),Links:o},c=er(Nn(a)),l=await cu(c,e,t);return t.onProgress?.(new Pe("unixfs:importer:progress:file:layout",{cid:l,path:r.originalPath})),{cid:l,path:r.path,unixfs:i,size:BigInt(c.length+a.Links.reduce((u,h)=>u+(h.Tsize??0),0)),originalPath:r.originalPath,block:c}},Qhe=async(r,e,t)=>t.layout(Ghe(r,e,t),Yhe(r,e,t));function Xhe(r){return Symbol.iterator in r}function Jhe(r){return Symbol.asyncIterator in r}function Zhe(r){try{if(r instanceof Uint8Array)return(async function*(){yield r})();if(Xhe(r))return(async function*(){yield*r})();if(Jhe(r))return r}catch{throw new hc("Content was invalid")}throw new hc("Content was invalid")}function ede(r){return async function*(t,n){for await(const s of t){let i;if(s.path!=null&&(i=s.path,s.path=s.path.split("/").filter(o=>o!=null&&o!==".").join("/")),tde(s)){const o={path:s.path,mtime:s.mtime,mode:s.mode,content:(async function*(){let c=0n;for await(const l of r.chunker(r.chunkValidator(Zhe(s.content)))){const u=BigInt(l.byteLength);c+=u,r.onProgress?.(new Pe("unixfs:importer:progress:file:read",{bytesRead:c,chunkSize:u,path:s.path})),yield l}})(),originalPath:i},a=r.fileBuilder??Qhe;yield async()=>a(o,n,r)}else if(s.path!=null){const o={path:s.path,mtime:s.mtime,mode:s.mode,originalPath:i},a=r.dirBuilder??Whe;yield async()=>a(o,n,r)}else throw new Error("Import candidate must have content or path or both")}}}function tde(r){return r.content!=null}const rde=()=>async function*(e){for await(const t of e){if(t.length===void 0)throw new hc("Content was invalid");if(typeof t=="string"||t instanceof String)yield le(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else if(t instanceof Uint8Array)yield t;else throw new hc("Content was invalid")}},nde=174;function PN(r){const e=r?.maxChildrenPerNode??nde;return async function t(n,s){const i=[];for await(const o of kN(n,e))i.push(await s(o));return i.length>1?t(i,s):i[0]}}let sf=class{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}};const F6=Ee.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),V6=Ee.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi");class ub extends sf{_children;constructor(e,t){super(e,t),this._children=new Map}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,this._children.set(e,t)}async get(e){return Promise.resolve(this._children.get(e))}childCount(){return this._children.size}directChildrenCount(){return this.childCount()}onlyChild(){return this._children.values().next().value}*eachChildSeries(){for(const[e,t]of this._children.entries())yield{key:e,child:t}}estimateNodeSize(){if(this.nodeSize!==void 0)return this.nodeSize;this.nodeSize=0;for(const[e,t]of this._children.entries())t.size!=null&&t.cid!=null&&(this.nodeSize+=e.length+(this.options.cidVersion===1?V6.bytes.byteLength:F6.bytes.byteLength));return this.nodeSize}async*flush(e){const t=[];for(const[c,l]of this._children.entries()){let u=l;if(l instanceof sf)for await(const h of l.flush(e))u=h,yield h;u.size!=null&&u.cid!=null&&t.push({Name:c,Tsize:Number(u.size),Hash:u.cid})}const n=new dt({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:n.marshal(),Links:t},i=er(Nn(s)),o=await cu(i,e,this.options),a=i.length+s.Links.reduce((c,l)=>c+(l.Tsize??0),0);this.cid=o,this.size=a,yield{cid:o,unixfs:n,path:this.path,size:BigInt(a)}}}var z1={exports:{}},A_;function sde(){return A_||(A_=1,(function(r,e){(function(t,n){var s={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(m){if(!Array.isArray(m)&&!ArrayBuffer.isView(m))return!1;for(var b=0;b<m.length;b++)if(!Number.isInteger(m[b])||m[b]<0||m[b]>255)return!1;return!0}function o(m,b){return(m&65535)*b+(((m>>>16)*b&65535)<<16)}function a(m,b){return m<<b|m>>>32-b}function c(m){return m^=m>>>16,m=o(m,2246822507),m^=m>>>13,m=o(m,3266489909),m^=m>>>16,m}function l(m,b){m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535],b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535];var v=[0,0,0,0];return v[3]+=m[3]+b[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=m[2]+b[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=m[1]+b[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=m[0]+b[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function u(m,b){m=[m[0]>>>16,m[0]&65535,m[1]>>>16,m[1]&65535],b=[b[0]>>>16,b[0]&65535,b[1]>>>16,b[1]&65535];var v=[0,0,0,0];return v[3]+=m[3]*b[3],v[2]+=v[3]>>>16,v[3]&=65535,v[2]+=m[2]*b[3],v[1]+=v[2]>>>16,v[2]&=65535,v[2]+=m[3]*b[2],v[1]+=v[2]>>>16,v[2]&=65535,v[1]+=m[1]*b[3],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=m[2]*b[2],v[0]+=v[1]>>>16,v[1]&=65535,v[1]+=m[3]*b[1],v[0]+=v[1]>>>16,v[1]&=65535,v[0]+=m[0]*b[3]+m[1]*b[2]+m[2]*b[1]+m[3]*b[0],v[0]&=65535,[v[0]<<16|v[1],v[2]<<16|v[3]]}function h(m,b){return b%=64,b===32?[m[1],m[0]]:b<32?[m[0]<<b|m[1]>>>32-b,m[1]<<b|m[0]>>>32-b]:(b-=32,[m[1]<<b|m[0]>>>32-b,m[0]<<b|m[1]>>>32-b])}function d(m,b){return b%=64,b===0?m:b<32?[m[0]<<b|m[1]>>>32-b,m[1]<<b]:[m[1]<<b-32,0]}function f(m,b){return[m[0]^b[0],m[1]^b[1]]}function g(m){return m=f(m,[0,m[0]>>>1]),m=u(m,[4283543511,3981806797]),m=f(m,[0,m[0]>>>1]),m=u(m,[3301882366,444984403]),m=f(m,[0,m[0]>>>1]),m}s.x86.hash32=function(m,b){if(s.inputValidation&&!i(m))return n;b=b||0;for(var v=m.length%4,A=m.length-v,w=b,E=0,x=3432918353,P=461845907,T=0;T<A;T=T+4)E=m[T]|m[T+1]<<8|m[T+2]<<16|m[T+3]<<24,E=o(E,x),E=a(E,15),E=o(E,P),w^=E,w=a(w,13),w=o(w,5)+3864292196;switch(E=0,v){case 3:E^=m[T+2]<<16;case 2:E^=m[T+1]<<8;case 1:E^=m[T],E=o(E,x),E=a(E,15),E=o(E,P),w^=E}return w^=m.length,w=c(w),w>>>0},s.x86.hash128=function(m,b){if(s.inputValidation&&!i(m))return n;b=b||0;for(var v=m.length%16,A=m.length-v,w=b,E=b,x=b,P=b,T=0,D=0,C=0,R=0,O=597399067,V=2869860233,B=951274213,z=2716044179,$=0;$<A;$=$+16)T=m[$]|m[$+1]<<8|m[$+2]<<16|m[$+3]<<24,D=m[$+4]|m[$+5]<<8|m[$+6]<<16|m[$+7]<<24,C=m[$+8]|m[$+9]<<8|m[$+10]<<16|m[$+11]<<24,R=m[$+12]|m[$+13]<<8|m[$+14]<<16|m[$+15]<<24,T=o(T,O),T=a(T,15),T=o(T,V),w^=T,w=a(w,19),w+=E,w=o(w,5)+1444728091,D=o(D,V),D=a(D,16),D=o(D,B),E^=D,E=a(E,17),E+=x,E=o(E,5)+197830471,C=o(C,B),C=a(C,17),C=o(C,z),x^=C,x=a(x,15),x+=P,x=o(x,5)+2530024501,R=o(R,z),R=a(R,18),R=o(R,O),P^=R,P=a(P,13),P+=w,P=o(P,5)+850148119;switch(T=0,D=0,C=0,R=0,v){case 15:R^=m[$+14]<<16;case 14:R^=m[$+13]<<8;case 13:R^=m[$+12],R=o(R,z),R=a(R,18),R=o(R,O),P^=R;case 12:C^=m[$+11]<<24;case 11:C^=m[$+10]<<16;case 10:C^=m[$+9]<<8;case 9:C^=m[$+8],C=o(C,B),C=a(C,17),C=o(C,z),x^=C;case 8:D^=m[$+7]<<24;case 7:D^=m[$+6]<<16;case 6:D^=m[$+5]<<8;case 5:D^=m[$+4],D=o(D,V),D=a(D,16),D=o(D,B),E^=D;case 4:T^=m[$+3]<<24;case 3:T^=m[$+2]<<16;case 2:T^=m[$+1]<<8;case 1:T^=m[$],T=o(T,O),T=a(T,15),T=o(T,V),w^=T}return w^=m.length,E^=m.length,x^=m.length,P^=m.length,w+=E,w+=x,w+=P,E+=w,x+=w,P+=w,w=c(w),E=c(E),x=c(x),P=c(P),w+=E,w+=x,w+=P,E+=w,x+=w,P+=w,("00000000"+(w>>>0).toString(16)).slice(-8)+("00000000"+(E>>>0).toString(16)).slice(-8)+("00000000"+(x>>>0).toString(16)).slice(-8)+("00000000"+(P>>>0).toString(16)).slice(-8)},s.x64.hash128=function(m,b){if(s.inputValidation&&!i(m))return n;b=b||0;for(var v=m.length%16,A=m.length-v,w=[0,b],E=[0,b],x=[0,0],P=[0,0],T=[2277735313,289559509],D=[1291169091,658871167],C=0;C<A;C=C+16)x=[m[C+4]|m[C+5]<<8|m[C+6]<<16|m[C+7]<<24,m[C]|m[C+1]<<8|m[C+2]<<16|m[C+3]<<24],P=[m[C+12]|m[C+13]<<8|m[C+14]<<16|m[C+15]<<24,m[C+8]|m[C+9]<<8|m[C+10]<<16|m[C+11]<<24],x=u(x,T),x=h(x,31),x=u(x,D),w=f(w,x),w=h(w,27),w=l(w,E),w=l(u(w,[0,5]),[0,1390208809]),P=u(P,D),P=h(P,33),P=u(P,T),E=f(E,P),E=h(E,31),E=l(E,w),E=l(u(E,[0,5]),[0,944331445]);switch(x=[0,0],P=[0,0],v){case 15:P=f(P,d([0,m[C+14]],48));case 14:P=f(P,d([0,m[C+13]],40));case 13:P=f(P,d([0,m[C+12]],32));case 12:P=f(P,d([0,m[C+11]],24));case 11:P=f(P,d([0,m[C+10]],16));case 10:P=f(P,d([0,m[C+9]],8));case 9:P=f(P,[0,m[C+8]]),P=u(P,D),P=h(P,33),P=u(P,T),E=f(E,P);case 8:x=f(x,d([0,m[C+7]],56));case 7:x=f(x,d([0,m[C+6]],48));case 6:x=f(x,d([0,m[C+5]],40));case 5:x=f(x,d([0,m[C+4]],32));case 4:x=f(x,d([0,m[C+3]],24));case 3:x=f(x,d([0,m[C+2]],16));case 2:x=f(x,d([0,m[C+1]],8));case 1:x=f(x,[0,m[C]]),x=u(x,T),x=h(x,31),x=u(x,D),w=f(w,x)}return w=f(w,[0,m.length]),E=f(E,[0,m.length]),w=l(w,E),E=l(E,w),w=g(w),E=g(E),w=l(w,E),E=l(E,w),("00000000"+(w[0]>>>0).toString(16)).slice(-8)+("00000000"+(w[1]>>>0).toString(16)).slice(-8)+("00000000"+(E[0]>>>0).toString(16)).slice(-8)+("00000000"+(E[1]>>>0).toString(16)).slice(-8)},r.exports&&(e=r.exports=s),e.murmurHash3=s})()})(z1,z1.exports)),z1.exports}var Hy,C_;function ide(){return C_||(C_=1,Hy=sde()),Hy}var ode=ide();const ade=sa(ode),lm=Hg({name:"murmur3-128",code:34,encode:r=>SF(ade.x64.hash128(r))});var qy,k_;function cde(){if(k_)return qy;k_=1;const r=7;qy=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(o,a){let c=this._internalPositionFor(o,!1);if(a===void 0)c!==-1&&(this._unsetInternalPos(c),this._unsetBit(o),this._changedLength=!0,this._changedData=!0);else{let l=!1;c===-1?(c=this._data.length,this._setBit(o),this._changedData=!0):l=!0,this._setInternalPos(c,o,a,l),this._changedLength=!0}}unset(o){this.set(o,void 0)}get(o){this._sortData();const a=this._internalPositionFor(o,!0);if(a!==-1)return this._data[a][1]}push(o){return this.set(this.length,o),this.length}get length(){if(this._sortData(),this._changedLength){const o=this._data[this._data.length-1];this._length=o?o[0]+1:0,this._changedLength=!1}return this._length}forEach(o){let a=0;for(;a<this.length;)o(this.get(a),a,this),a++}map(o){let a=0,c=new Array(this.length);for(;a<this.length;)c[a]=o(this.get(a),a,this),a++;return c}reduce(o,a){let c=0,l=a;for(;c<this.length;){const u=this.get(c);l=o(l,u,c),c++}return l}find(o){let a=0,c,l;for(;a<this.length&&!c;)l=this.get(a),c=o(l),a++;return c?l:void 0}_internalPositionFor(o,a){const c=this._bytePosFor(o,a);if(c>=this._bitArrays.length)return-1;const l=this._bitArrays[c],u=o-c*r;if(!((l&1<<u)>0))return-1;const d=this._bitArrays.slice(0,c).reduce(e,0),f=~(4294967295<<u+1),g=t(l&f);return d+g-1}_bytePosFor(o,a){const c=Math.floor(o/r),l=c+1;for(;!a&&this._bitArrays.length<l;)this._bitArrays.push(0);return c}_setBit(o){const a=this._bytePosFor(o,!1);this._bitArrays[a]|=1<<o-a*r}_unsetBit(o){const a=this._bytePosFor(o,!1);this._bitArrays[a]&=~(1<<o-a*r)}_setInternalPos(o,a,c,l){const u=this._data,h=[a,c];if(l)this._sortData(),u[o]=h;else{if(u.length)if(u[u.length-1][0]>=a)u.push(h);else if(u[0][0]<=a)u.unshift(h);else{const d=Math.round(u.length/2);this._data=u.slice(0,d).concat(h).concat(u.slice(d))}else this._data.push(h);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(o){this._data.splice(o,1)}_sortData(){this._changedData&&this._data.sort(n),this._changedData=!1}bitField(){const o=[];let a=8,c=0,l=0,u;const h=this._bitArrays.slice();for(;h.length||c;){c===0&&(u=h.shift(),c=7);const f=Math.min(c,a),g=~(255<<f),m=u&g;l|=m<<8-a,u=u>>>f,c-=f,a-=f,(!a||!c&&!h.length)&&(o.push(l),l=0,a=8)}for(var d=o.length-1;d>0&&o[d]===0;d--)o.pop();return o}compactArray(){return this._sortData(),this._data.map(s)}};function e(i,o){return i+t(o)}function t(i){let o=i;return o=o-(o>>1&1431655765),o=(o&858993459)+(o>>2&858993459),(o+(o>>4)&252645135)*16843009>>24}function n(i,o){return i[0]-o[0]}function s(i){return i[1]}return qy}var lde=cde();const cg=sa(lde);class Qr{_options;_popCount;_parent;_posAtParent;_children;key;constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new cg,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(t!=null)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);n!=null&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){return this._children.compactArray().reduce((t,n)=>n instanceof Qr?t+n.leafCount():t+1,0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof Qr?yield*t.eachLeafSeries():yield t}serialize(e,t){const n=[];return t(this._children.reduce((s,i,o)=>(i!=null&&(i instanceof Qr?s.push(i.serialize(e,t)):s.push(e(i,o))),s),n))}async asyncTransform(e,t){return DN(this,e,t)}toJSON(){return this.serialize(hde,dde)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof Qr)&&n!=null&&n.key===e)return n}async _findPlace(e){const t=this._options.hash(typeof e=="string"?le(e):e),n=await t.take(this._options.bits),s=this._children.get(n);return s instanceof Qr?s._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:s}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(t.existingChild!=null&&t.existingChild.key!==e){const n=new Qr(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,n);const s=await n._findPlace(t.existingChild.hash);return s.bucket._putAt(s,t.existingChild.key,t.existingChild.value),n._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){this._children.get(e)==null&&this._popCount++,this._children.set(e,t)}_delAt(e){if(e===-1)throw new Error("Invalid position");this._children.get(e)!=null&&this._popCount--,this._children.unset(e),this._level()}_level(){if(this._parent!=null&&this._popCount<=1)if(this._popCount===1){const e=this._children.find(ude);if(e!=null&&!(e instanceof Qr)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function ude(r){return!!r}function hde(r,e){return r.key}function dde(r){return r}async function DN(r,e,t){const n=[];for(const s of r._children.compactArray())if(s instanceof Qr)await DN(s,e,t);else{const i=await e(s);n.push({bitField:r._children.bitField(),children:i})}return t(n)}const fde=[255,254,252,248,240,224,192,128],pde=[1,3,7,15,31,63,127,255];let gde=class{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const s=this._value[this._currentBytePos],i=this._currentBitPos+1,o=Math.min(i,t),a=mde(s,i-o,o);n=(n<<o)+a,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}};function mde(r,e,t){const n=yde(e,t);return(r&n)>>>e}function yde(r,e){return fde[r]&pde[Math.min(e+r-1,7)]}function wde(r){function e(t){return t instanceof I_?t:new I_(t,r)}return e}let I_=class{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const s=this._buffers[this._currentBufferIndex],i=Math.min(s.availableBits(),t),o=s.take(i);n=(n<<i)+o,t-=i,this._availableBits-=i,s.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const n=this._buffers[this._currentBufferIndex],s=Math.min(n.totalBits()-n.availableBits(),t);n.untake(s),t-=s,this._availableBits+=s,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?Wt([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new gde(t);this._buffers.push(n),this._availableBits+=n.availableBits()}};function hb(r){if(r==null||r.hashFn==null)throw new Error("please define an options.hashFn");const e={bits:r.bits??8,hash:wde(r.hashFn)};return new Qr(e)}async function bde(r){return(await lm.encode(r)).slice(0,8).reverse()}const NN=BigInt(34),vde=8;let Ede=class extends sf{_bucket;constructor(e,t){super(e,t),this._bucket=hb({hashFn:bde,bits:t.shardFanoutBits??vde})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}*eachChildSeries(){for(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=LN(this._bucket,this,this.options),this.nodeSize)}async*flush(e){for await(const t of ON(this._bucket,e,this,this.options))yield{...t,path:this.path}}};async function*ON(r,e,t,n){const s=r._children,i=(r.tableSize()-1).toString(16).length,o=[];let a=0n;for(let g=0;g<s.length;g++){const m=s.get(g);if(m==null)continue;const b=g.toString(16).toUpperCase().padStart(i,"0");if(m instanceof Qr){let v;for await(const A of ON(m,e,null,n))v=A;if(v==null)throw new Error("Could not flush sharded directory, no subshard found");o.push({Name:b,Tsize:Number(v.size),Hash:v.cid}),a+=v.size}else if(Sde(m.value)){const v=m.value;let A;for await(const E of v.flush(e))A=E,yield A;if(A==null)throw new Error("Did not flush dir");const w=b+m.key;o.push({Name:w,Tsize:Number(A.size),Hash:A.cid}),a+=A.size}else{const v=m.value;if(v.cid==null)continue;const A=b+m.key,w=v.size;o.push({Name:A,Tsize:Number(w),Hash:v.cid}),a+=BigInt(w??0)}}const c=Uint8Array.from(s.bitField().reverse()),l=new dt({type:"hamt-sharded-directory",data:c,fanout:BigInt(r.tableSize()),hashType:NN,mtime:t?.mtime,mode:t?.mode}),u={Data:l.marshal(),Links:o},h=er(Nn(u)),d=await cu(h,e,n),f=BigInt(h.byteLength)+a;yield{cid:d,unixfs:l,size:f}}function Sde(r){return typeof r.flush=="function"}function LN(r,e,t){const n=r._children,s=(r.tableSize()-1).toString(16).length,i=[];for(let l=0;l<n.length;l++){const u=n.get(l);if(u==null)continue;const h=l.toString(16).toUpperCase().padStart(s,"0");if(u instanceof Qr){const d=LN(u,null,t);i.push({Name:h,Tsize:Number(d),Hash:t.cidVersion===0?F6:V6})}else if(typeof u.value.flush=="function"){const f=u.value.nodeSize();i.push({Name:h+u.key,Tsize:Number(f),Hash:t.cidVersion===0?F6:V6})}else{const d=u.value;if(d.cid==null)continue;const f=h+u.key,g=d.size;i.push({Name:f,Tsize:Number(g),Hash:d.cid})}}const o=Uint8Array.from(n.bitField().reverse()),a=new dt({type:"hamt-sharded-directory",data:o,fanout:BigInt(r.tableSize()),hashType:NN,mtime:e?.mtime,mode:e?.mode});return er(Nn({Data:a.marshal(),Links:i})).length}async function BN(r,e,t,n){let s=e;e instanceof ub&&e.estimateNodeSize()>t&&(s=await _de(e,n));const i=s.parent;if(i!=null){if(s!==e){if(r!=null&&(r.parent=s),s.parentKey==null)throw new Error("No parent key found");await i.put(s.parentKey,s)}return BN(s,i,t,n)}return s}async function _de(r,e){const t=new Ede({root:r.root,dir:!0,parent:r.parent,parentKey:r.parentKey,path:r.path,dirty:r.dirty,flat:!1,mtime:r.mtime,mode:r.mode},e);for(const{key:n,child:s}of r.eachChildSeries())await t.put(n,s);return t}const xde=(r="")=>r.split(new RegExp("(?<!\\\\)\\/")).filter(Boolean);async function Ade(r,e,t){const n=xde(r.path??""),s=n.length-1;let i=e,o="";for(let a=0;a<n.length;a++){const c=n[a];o+=`${o!==""?"/":""}${c}`;const l=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,l)await i.put(c,r),e=await BN(null,i,t.shardSplitThresholdBytes,t);else{let u=await i.get(c);(u==null||!(u instanceof sf))&&(u=new ub({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:u?.unixfs?.mtime,mode:u?.unixfs?.mode},t)),await i.put(c,u),i=u}}return e}async function*T_(r,e){if(!(r instanceof sf)){r.unixfs?.isDirectory()===!0&&(yield r);return}yield*r.flush(e)}function Cde(r){return async function*(t,n){let s=new ub({root:!0,dir:!0,path:"",dirty:!0,flat:!0},r),i,o=!1;for await(const a of t){if(a==null)continue;const c=`${a.originalPath??""}`.split("/")[0];c!=null&&c!==""&&(i==null?(i=c,o=!0):i!==c&&(o=!1)),s=await Ade(a,s,r),a.unixfs?.isDirectory()!==!0&&(yield a)}if(r.wrapWithDirectory||o&&s.childCount()>1)yield*T_(s,n);else for(const a of s.eachChildSeries())a!=null&&(yield*T_(a.child,n))}}async function*um(r,e,t={}){let n;Symbol.asyncIterator in r||Symbol.iterator in r?n=r:n=[r];const s=t.wrapWithDirectory??!1,i=t.shardSplitThresholdBytes??262144,o=t.shardFanoutBits??8,a=t.cidVersion??1,c=t.rawLeaves??!0,l=t.leafType??"file",u=t.fileImportConcurrency??50,h=t.blockWriteConcurrency??10,d=t.reduceSingleLeafToSelf??!0,f=t.chunker??TN(),g=t.chunkValidator??rde(),m=t.dagBuilder??ede({chunker:f,chunkValidator:g,wrapWithDirectory:s,layout:t.layout??PN(),bufferImporter:t.bufferImporter??Khe({cidVersion:a,rawLeaves:c,leafType:l,onProgress:t.onProgress}),blockWriteConcurrency:h,reduceSingleLeafToSelf:d,cidVersion:a,onProgress:t.onProgress,dirBuilder:t.dirBuilder,fileBuilder:t.fileBuilder}),b=t.treeBuilder??Cde({wrapWithDirectory:s,shardSplitThresholdBytes:i,shardFanoutBits:o,cidVersion:a,onProgress:t.onProgress});for await(const v of b(IN(m(n,e),u),e))yield{cid:v.cid,path:v.path,unixfs:v.unixfs,size:v.size}}async function MN(r,e,t={}){const n=await o8(um([r],e,t));if(n==null)throw new jhe("Nothing imported");return n}async function kde(r,e,t={}){return MN({content:r},e,t)}async function Ide(r,e,t={}){return MN({content:r},e,t)}function Tde(r){return r[Symbol.asyncIterator]!=null}function Bu(r){if(Tde(r))return(async()=>{let t;for await(const n of r)t=n;return t})();let e;for(const t of r)e=t;return e}class oo extends Error{name;code;constructor(e,t,n){super(e),this.name=t,this.code=n}}let hm=class extends oo{constructor(e="not a Unixfs node"){super(e,"NotUnixFSError","ERR_NOT_UNIXFS")}};class dc extends oo{constructor(e="invalid PBNode"){super(e,"InvalidPBNodeError","ERR_INVALID_PB_NODE")}}class db extends oo{constructor(e="unknown error"){super(e,"InvalidPBNodeError","ERR_UNKNOWN_ERROR")}}class $N extends oo{constructor(e="path already exists"){super(e,"AlreadyExistsError","ERR_ALREADY_EXISTS")}}class Rde extends oo{constructor(e="path does not exist"){super(e,"DoesNotExistError","ERR_DOES_NOT_EXIST")}}class UN extends oo{constructor(e="no content"){super(e,"NoContentError","ERR_NO_CONTENT")}}class Pde extends oo{constructor(e="not a file"){super(e,"NotAFileError","ERR_NOT_A_FILE")}}class fb extends oo{constructor(e="not a directory"){super(e,"NotADirectoryError","ERR_NOT_A_DIRECTORY")}}let _s=class extends oo{constructor(e="invalid parameters"){super(e,"InvalidParametersError","ERR_INVALID_PARAMETERS")}};const jf={cidVersion:1,rawLeaves:!0,layout:PN({maxChildrenPerNode:1024}),chunker:TN({chunkSize:1048576})};async function*pb(r,e,t={}){yield*um(r,e,{...jf,...t})}async function Dde(r,e,t={}){const{cid:n}=await kde(r,e,{...jf,...t});return n}async function Nde(r,e,t={}){const{cid:n}=await Ide(r,e,{...jf,...t});return n}async function Ode(r,e,t={}){if(r.path==null)throw new _s("path is required");if(r.content==null)throw new _s("content is required");const n=await Bu(pb([r],e,{...jf,...t,wrapWithDirectory:!0}));if(n==null)throw new _s("Nothing imported");return n.cid}async function Lde(r,e,t={}){if(r.content!=null)throw new _s("Directories cannot have content, use addFile instead");const s=await(r.path==null?o8:Bu)(pb([{...r,path:r.path??"-"}],e,{...jf,...t,wrapWithDirectory:r.path!=null}));if(s==null)throw new _s("Nothing imported");return s.cid}class lg extends Error{static name="BadPathError";static code="ERR_BAD_PATH";name=lg.name;code=lg.code;constructor(e="Bad path"){super(e)}}class Xi extends Error{static name="NotFoundError";static code="ERR_NOT_FOUND";name=Xi.name;code=Xi.code;constructor(e="Not found"){super(e)}}class ug extends Error{static name="NoResolverError";static code="ERR_NO_RESOLVER";name=ug.name;code=ug.code;constructor(e="No resolver"){super(e)}}class zr extends Error{static name="NotUnixFSError";static code="ERR_NOT_UNIXFS";name=zr.name;code=zr.code;constructor(e="Not UnixFS"){super(e)}}class hg extends Error{static name="OverReadError";static code="ERR_OVER_READ";name=hg.name;code=hg.code;constructor(e="Over read"){super(e)}}class dg extends Error{static name="UnderReadError";static code="ERR_UNDER_READ";name=dg.name;code=dg.code;constructor(e="Under read"){super(e)}}class fg extends Error{static name="NoPropError";static code="ERR_NO_PROP";name=fg.name;code=fg.code;constructor(e="No Property found"){super(e)}}class Ta extends Error{static name="InvalidParametersError";static code="ERR_INVALID_PARAMS";name=Ta.name;code=Ta.code;constructor(e="Invalid parameters"){super(e)}}function gb(r,e,t,n,s,i,o){let a=r,c=s;for(;i.length>0;){const l=i[0];if(l in a){i.shift(),c=`${c}/${l}`;const u=Ee.asCID(a[l]);if(u!=null)return{entry:{type:"object",name:n,path:s,cid:t,node:e,depth:o,size:BigInt(e.length),content:async function*(){yield r}},next:{cid:u,name:l,path:c,toResolve:i}};a=a[l]}else throw new fg(`No property named ${l} found in node ${t}`)}return{entry:{type:"object",name:n,path:s,cid:t,node:e,depth:o,size:BigInt(e.length),content:async function*(){yield r}}}}const Bde=async(r,e,t,n,s,i,o,a)=>{const c=await Gr(o.get(r,a)),l=sT(c);return gb(l,c,r,e,t,n,i)},Mde=async(r,e,t,n,s,i,o,a)=>{const c=await Gr(o.get(r,a)),l=q5(c);return gb(l,c,r,e,t,n,i)};function pg(r,e,t,n){const s=BigInt(r.length),i=BigInt(e+s);return t>=i||n<e?new Uint8Array(0):(n>=e&&n<i&&(r=r.subarray(0,Number(n-e))),t>=e&&t<i&&(r=r.subarray(Number(t-e))),r)}const mb=(r,e=0,t=r)=>{const n=BigInt(r),s=BigInt(e??0);let i=BigInt(t);if(i!==n&&(i=s+i),i>n&&(i=n),s<0n)throw new Ta("Offset must be greater than or equal to 0");if(s>n)throw new Ta("Offset must be less than the file size");if(i<0n)throw new Ta("Length must be greater than or equal to 0");if(i>n)throw new Ta("Length must be less than the file size");return{start:s,end:i}},$de=r=>{async function*e(t={}){const{start:n,end:s}=mb(r.length,t.offset,t.length),i=pg(r,0n,n,s);t.onProgress?.(new Pe("unixfs:exporter:progress:identity",{bytesRead:BigInt(i.byteLength),totalBytes:s-n,fileSize:BigInt(r.byteLength)})),yield i}return e},Ude=async(r,e,t,n,s,i,o,a)=>{if(n.length>0)throw new Xi(`No link named ${t} found in raw node ${r}`);const c=wr(r.multihash.bytes);return{entry:{type:"identity",name:e,path:t,cid:r,content:$de(c.digest),depth:i,size:BigInt(c.digest.length),node:c.digest}}},Fde=async(r,e,t,n,s,i,o,a)=>{const c=await Gr(o.get(r,a)),l=qC(c);return gb(l,c,r,e,t,n,i)},Vde=r=>{async function*e(t={}){const{start:n,end:s}=mb(r.length,t.offset,t.length),i=pg(r,0n,n,s);t.onProgress?.(new Pe("unixfs:exporter:progress:raw",{bytesRead:BigInt(i.byteLength),totalBytes:s-n,fileSize:BigInt(r.byteLength)})),yield i}return e},zde=async(r,e,t,n,s,i,o,a)=>{if(n.length>0)throw new Xi(`No link named ${t} found in raw node ${r}`);const c=await Gr(o.get(r,a));return{entry:{type:"raw",name:e,path:t,cid:r,content:Vde(c),depth:i,size:BigInt(c.length),node:c}}},Hde=async function(r){return(await lm.encode(r)).slice(0,8).reverse()},qde=async(r,e,t)=>{const n=(e.tableSize()-1).toString(16).length;await Promise.all(r.map(async s=>{if(s.Name==null)throw new Error("Unexpected Link without a Name");if(s.Name.length===n){const i=parseInt(s.Name,16);e._putObjectAt(i,new Qr({hash:t._options.hash,bits:t._options.bits},e,i));return}await t.put(s.Name.substring(2),!0)}))},R_=(r,e)=>r.toString(16).toUpperCase().padStart(e,"0").substring(0,e),Kde=r=>{let e=r.bucket;const t=[];for(;e._parent!=null;)t.push(e),e=e._parent;return t.push(e),t.reverse()},FN=async(r,e,t,n,s)=>{if(n==null){if(r.Data==null)throw new zr("no data in PBNode");let h;try{h=dt.unmarshal(r.Data)}catch(f){throw new zr(f.message)}if(h.type!=="hamt-sharded-directory")throw new zr("not a HAMT");if(h.fanout==null)throw new zr("missing fanout");const d=hb({hashFn:Hde,bits:Math.log2(Number(h.fanout))});n={rootBucket:d,hamtDepth:1,lastBucket:d}}const i=(n.lastBucket.tableSize()-1).toString(16).length;await qde(r.Links,n.lastBucket,n.rootBucket);const o=await n.rootBucket._findNewBucketAndPos(e);let a=R_(o.pos,i);const c=Kde(o);c.length>n.hamtDepth&&(n.lastBucket=c[n.hamtDepth],a=R_(n.lastBucket._posAtParent,i));const l=r.Links.find(h=>{if(h.Name==null)return!1;const d=h.Name.substring(0,i),f=h.Name.substring(i);return!(d!==a||f!==""&&f!==e)});if(l==null)return;if(l.Name!=null&&l.Name.substring(i)===e)return l.Hash;n.hamtDepth++;const u=await Gr(t.get(l.Hash,s));return r=Rs(u),FN(r,e,t,n,s)};function yb(r){return r?.extended===!1}const jde=(r,e,t,n,s,i,o)=>{async function*a(c={}){const l=c.offset??0,u=c.length??e.Links.length,h=e.Links.slice(l,u);c.onProgress?.(new Pe("unixfs:exporter:walk:directory",{cid:r})),yield*wc(h,d=>oa(d,f=>async()=>{const g=f.Name??"",m=`${n}/${g}`;return yb(c)?{cid:f.Hash,name:g,path:m}:(await s(f.Hash,g,m,[],i+1,o,c)).entry}),d=>Ac(d,{ordered:!0,concurrency:c.blockReadConcurrency}),d=>Eo(d,f=>f!=null))}return a};function Wde(r,e,t){let n=0,s=r.length;for(;s>0;){const i=Math.trunc(s/2);let o=n+i;t(r[o],e)<=0?(n=++o,s-=i+1):s=i}return n}class Gde{#e=[];enqueue(e,t){const{priority:n=0,id:s}=t??{},i={priority:n,id:s,run:e};if(this.size===0||this.#e[this.size-1].priority>=n){this.#e.push(i);return}const o=Wde(this.#e,i,(a,c)=>c.priority-a.priority);this.#e.splice(o,0,i)}setPriority(e,t){const n=this.#e.findIndex(i=>i.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[s]=this.#e.splice(n,1);this.enqueue(s.run,{priority:t,id:e})}dequeue(){return this.#e.shift()?.run}filter(e){return this.#e.filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return this.#e.length}}class Yde extends UC{#e;#t;#r=0;#l;#c=!1;#d=!1;#a;#p=0;#s=0;#u;#i;#n;#h;#o=0;#g;#f;#A=1n;#m=new Map;timeout;constructor(e){if(super(),e={carryoverIntervalCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Gde,...e},!(typeof e.intervalCap=="number"&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${e.intervalCap?.toString()??""}\` (${typeof e.intervalCap})`);if(e.interval===void 0||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${e.interval?.toString()??""}\` (${typeof e.interval})`);if(this.#e=e.carryoverIntervalCount??e.carryoverConcurrencyCount??!1,this.#t=e.intervalCap===Number.POSITIVE_INFINITY||e.interval===0,this.#l=e.intervalCap,this.#a=e.interval,this.#n=new e.queueClass,this.#h=e.queueClass,this.concurrency=e.concurrency,e.timeout!==void 0&&!(Number.isFinite(e.timeout)&&e.timeout>0))throw new TypeError(`Expected \`timeout\` to be a positive finite number, got \`${e.timeout}\` (${typeof e.timeout})`);this.timeout=e.timeout,this.#f=e.autoStart===!1,this.#O()}get#C(){return this.#t||this.#r<this.#l}get#k(){return this.#o<this.#g}#b(){this.#o--,this.#o===0&&this.emit("pendingZero"),this.#I(),this.emit("next")}#E(){this.#P(),this.#R(),this.#i=void 0}get#S(){const e=Date.now();if(this.#u===void 0){const t=this.#p-e;if(t<0){if(this.#s>0){const n=e-this.#s;if(n<this.#a)return this.#y(this.#a-n),!0}this.#r=this.#e?this.#o:0}else return this.#y(t),!0}return!1}#y(e){this.#i===void 0&&(this.#i=setTimeout(()=>{this.#E()},e))}#_(){this.#u&&(clearInterval(this.#u),this.#u=void 0)}#v(){this.#i&&(clearTimeout(this.#i),this.#i=void 0)}#I(){if(this.#n.size===0)return this.#_(),this.emit("empty"),this.#o===0&&(this.#v(),this.emit("idle")),!1;let e=!1;if(!this.#f){const t=!this.#S;if(this.#C&&this.#k){const n=this.#n.dequeue();this.#t||(this.#r++,this.#x()),this.emit("active"),this.#s=Date.now(),n(),t&&this.#R(),e=!0}}return e}#R(){this.#t||this.#u!==void 0||(this.#u=setInterval(()=>{this.#P()},this.#a),this.#p=Date.now()+this.#a)}#P(){this.#r===0&&this.#o===0&&this.#u&&this.#_(),this.#r=this.#e?this.#o:0,this.#T(),this.#x()}#T(){for(;this.#I(););}get concurrency(){return this.#g}set concurrency(e){if(!(typeof e=="number"&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this.#g=e,this.#T()}async#N(e){return new Promise((t,n)=>{e.addEventListener("abort",()=>{n(e.reason)},{once:!0})})}setPriority(e,t){if(typeof t!="number"||!Number.isFinite(t))throw new TypeError(`Expected \`priority\` to be a finite number, got \`${t}\` (${typeof t})`);this.#n.setPriority(e,t)}async add(e,t={}){return t.id??=(this.#A++).toString(),t={timeout:this.timeout,...t},new Promise((n,s)=>{const i=Symbol(`task-${t.id}`);this.#n.enqueue(async()=>{this.#o++,this.#m.set(i,{id:t.id,priority:t.priority??0,startTime:Date.now(),timeout:t.timeout});try{try{t.signal?.throwIfAborted()}catch(c){throw this.#t||this.#r--,this.#m.delete(i),c}let o=e({signal:t.signal});t.timeout&&(o=ble(Promise.resolve(o),{milliseconds:t.timeout,message:`Task timed out after ${t.timeout}ms (queue has ${this.#o} running, ${this.#n.size} waiting)`})),t.signal&&(o=Promise.race([o,this.#N(t.signal)]));const a=await o;n(a),this.emit("completed",a)}catch(o){s(o),this.emit("error",o)}finally{this.#m.delete(i),queueMicrotask(()=>{this.#b()})}},t),this.emit("add"),this.#I()})}async addAll(e,t){return Promise.all(e.map(async n=>this.add(n,t)))}start(){return this.#f?(this.#f=!1,this.#T(),this):this}pause(){this.#f=!0}clear(){this.#n=new this.#h,this.#D()}async onEmpty(){this.#n.size!==0&&await this.#w("empty")}async onSizeLessThan(e){this.#n.size<e||await this.#w("next",()=>this.#n.size<e)}async onIdle(){this.#o===0&&this.#n.size===0||await this.#w("idle")}async onPendingZero(){this.#o!==0&&await this.#w("pendingZero")}async onRateLimit(){this.isRateLimited||await this.#w("rateLimit")}async onRateLimitCleared(){this.isRateLimited&&await this.#w("rateLimitCleared")}async onError(){return new Promise((e,t)=>{const n=s=>{this.off("error",n),t(s)};this.on("error",n)})}async#w(e,t){return new Promise(n=>{const s=()=>{t&&!t()||(this.off(e,s),n())};this.on(e,s)})}get size(){return this.#n.size}sizeBy(e){return this.#n.filter(e).length}get pending(){return this.#o}get isPaused(){return this.#f}#O(){this.#t||(this.on("add",()=>{this.#n.size>0&&this.#x()}),this.on("next",()=>{this.#x()}))}#x(){this.#t||this.#d||(this.#d=!0,queueMicrotask(()=>{this.#d=!1,this.#D()}))}#D(){const e=this.#c,t=!this.#t&&this.#r>=this.#l&&this.#n.size>0;t!==e&&(this.#c=t,this.emit(t?"rateLimit":"rateLimitCleared"))}get isRateLimited(){return this.#c}get isSaturated(){return this.#o===this.#g&&this.#n.size>0||this.isRateLimited&&this.#n.size>0}get runningTasks(){return[...this.#m.values()].map(e=>({...e}))}}async function VN(r,e,t,n,s,i,o){if(e instanceof Uint8Array){const l=pg(e,n,s,i);t.push(l);return}if(e.Data==null)throw new zr("no data in PBNode");let a;try{a=dt.unmarshal(e.Data)}catch(l){throw new zr(l.message)}if(a.data!=null){const l=a.data,u=pg(l,n,s,i);t.push(u),n+=BigInt(u.byteLength)}const c=[];if(e.Links.length!==a.blockSizes.length)throw new zr("Inconsistent block sizes and dag links");for(let l=0;l<e.Links.length;l++){const u=e.Links[l],h=n,d=h+a.blockSizes[l];if((s>=h&&s<d||i>=h&&i<=d||s<h&&i>d)&&c.push({link:u,blockStart:n}),n=d,n>i)break}await wc(c,l=>oa(l,u=>async()=>{const h=await Gr(r.get(u.link.Hash,o));return{...u,block:h}}),l=>Ac(l,{ordered:!0,concurrency:o.blockReadConcurrency}),async l=>{for await(const{link:u,block:h,blockStart:d}of l){let f;switch(u.Hash.code){case fi:f=Rs(h);break;case As:f=h;break;default:t.end(new zr(`Unsupported codec: ${u.Hash.code}`));return}const g=new Yde({concurrency:1});g.on("error",m=>{t.end(m)}),g.add(async()=>{o.onProgress?.(new Pe("unixfs:exporter:walk:file",{cid:u.Hash})),await VN(r,f,t,d,s,i,o)}),await g.onIdle()}}),n>=i&&t.end()}const P_=(r,e,t,n,s,i,o)=>{async function*a(c={}){const l=t.fileSize();if(l===void 0)throw new Error("File was a directory");const{start:u,end:h}=mb(l,c.offset,c.length);if(h===0n)return;let d=0n;const f=h-u,g=to();c.onProgress?.(new Pe("unixfs:exporter:walk:file",{cid:r})),VN(o,e,g,0n,u,h,c).catch(m=>{g.end(m)});for await(const m of g)if(m!=null){if(d+=BigInt(m.byteLength),d>f)throw g.end(),new hg("Read too many bytes - the file size reported by the UnixFS data in the root node may be incorrect");d===f&&g.end(),c.onProgress?.(new Pe("unixfs:exporter:progress:unixfs:file",{bytesRead:d,totalBytes:f,fileSize:l})),yield m}if(d<f)throw new dg("Traversed entire DAG but did not read enough bytes")}return a},Qde=(r,e,t,n,s,i,o)=>{function a(c={}){return c.onProgress?.(new Pe("unixfs:exporter:walk:hamt-sharded-directory",{cid:r})),zN(e,n,s,i,o,c)}return a};async function*zN(r,e,t,n,s,i){const o=r.Links;if(r.Data==null)throw new zr("no data in PBNode");let a;try{a=dt.unmarshal(r.Data)}catch(u){throw new zr(u.message)}if(a.fanout==null)throw new zr("missing fanout");const c=(a.fanout-1n).toString(16).length,l=wc(o,u=>oa(u,h=>async()=>{const d=h.Name!=null?h.Name.substring(c):null;if(d!=null&&d!==""){const f=`${e}/${d}`;return yb(i)?{entries:[{cid:h.Hash,name:d,path:f}]}:{entries:[(await t(h.Hash,d,f,[],n+1,s,i)).entry].filter(Boolean)}}else{const f=await Gr(s.get(h.Hash,i));return r=Rs(f),i.onProgress?.(new Pe("unixfs:exporter:walk:hamt-sharded-directory",{cid:h.Hash})),{entries:zN(r,e,t,n,s,i)}}}),u=>Ac(u,{ordered:!0,concurrency:i.blockReadConcurrency}));for await(const{entries:u}of l)yield*u}const Xde=(r,e)=>r.Links.find(n=>n.Name===e)?.Hash,Jde={raw:P_,file:P_,directory:jde,"hamt-sharded-directory":Qde,metadata:(r,e,t,n,s,i,o)=>()=>[],symlink:(r,e,t,n,s,i,o)=>()=>[]},Zde=async(r,e,t,n,s,i,o,a)=>{if(yb(a)&&n.length===0)return{entry:{cid:r,name:e,path:t}};const c=await Gr(o.get(r,a)),l=Rs(c);let u,h;if(e==null&&(e=r.toString()),l.Data==null)throw new zr("no data in PBNode");try{u=dt.unmarshal(l.Data)}catch(f){throw new zr(f.message)}if(t==null&&(t=e),n.length>0){let f;if(u?.type==="hamt-sharded-directory"?f=await FN(l,n[0],o):f=Xde(l,n[0]),f==null)throw new Xi("file does not exist");const g=n.shift(),m=`${t}/${g}`;h={cid:f,toResolve:n,name:g??"",path:m}}const d=Jde[u.type](r,l,u,t,s,i,o);if(d==null)throw new Xi("could not find content exporter");return u.isDirectory()?{entry:{type:"directory",name:e,path:t,cid:r,content:d,unixfs:u,depth:i,node:l,size:u.fileSize()},next:h}:{entry:{type:"file",name:e,path:t,cid:r,content:d,unixfs:u,depth:i,node:l,size:u.fileSize()},next:h}},efe={[fi]:Zde,[As]:zde,[z5]:Bde,[H5]:Mde,[Pn.code]:Ude,[Kw]:Fde},HN=async(r,e,t,n,s,i,o)=>{const a=efe[r.code];if(a==null)throw new ug(`No resolver for code ${r.code}`);return a(r,e,t,n,HN,s,i,o)},tfe=(r="")=>(r.trim().match(/([^\\^/]|\\\/)+/g)??[]).filter(Boolean),rfe=r=>{if(r instanceof Uint8Array)return{cid:Ee.decode(r),toResolve:[]};const e=Ee.asCID(r);if(e!=null)return{cid:e,toResolve:[]};if(typeof r=="string"){r.indexOf("/ipfs/")===0&&(r=r.substring(6));const t=tfe(r);return{cid:Ee.parse(t[0]),toResolve:t.slice(1)}}throw new lg(`Unknown path type ${r}`)};async function*qN(r,e,t={}){let{cid:n,toResolve:s}=rfe(r),i=n.toString(),o=i;const a=s.length;for(;;){const c=await HN(n,i,o,s,a,e,t);if(c.entry==null&&c.next==null)throw new Xi(`Could not resolve ${r}`);if(c.entry!=null&&(yield c.entry),c.next==null)return;s=c.next.toResolve,n=c.next.cid,i=c.next.name,o=c.next.path}}async function la(r,e,t={}){const n=await Bu(qN(r,e,t));if(n==null)throw new Xi(`Could not resolve ${r}`);return n}async function*KN(r,e,t={}){const n=await la(r,e,t);if(n==null)return;if(yield n,n.type==="directory")for await(const i of s(n,t))yield i;async function*s(i,o){for await(const a of i.content(o))yield a,!(a instanceof Uint8Array)&&a.type==="directory"&&(yield*s(a,o))}}const jN=1,WN=262144;function GN(r){function e(t){return t instanceof D_?t:new D_(t,r)}return e}class D_{_value;_hashFn;_depth;_availableBits;_currentBufferIndex;_buffers;constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;for(;this._availableBits<t;)await this._produceMoreBits();let n=0;for(;t>0;){const s=this._buffers[this._currentBufferIndex],i=Math.min(s.availableBits(),t),o=s.take(i);n=(n<<i)+o,t-=i,this._availableBits-=i,s.availableBits()===0&&this._currentBufferIndex++}return n}untake(e){let t=e;for(;t>0;){const n=this._buffers[this._currentBufferIndex],s=Math.min(n.totalBits()-n.availableBits(),t);n.untake(s),t-=s,this._availableBits+=s,this._currentBufferIndex>0&&n.totalBits()===n.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?Wt([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new ife(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}const nfe=[255,254,252,248,240,224,192,128],sfe=[1,3,7,15,31,63,127,255];class ife{_value;_currentBytePos;_currentBitPos;constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+this._currentBytePos*8}totalBits(){return this._value.length*8}take(e){let t=e,n=0;for(;t>0&&this._haveBits();){const s=this._value[this._currentBytePos],i=this._currentBitPos+1,o=Math.min(i,t),a=ofe(s,i-o,o);n=(n<<o)+a,t-=o,this._currentBitPos-=o,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){for(this._currentBitPos+=e;this._currentBitPos>7;)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function ofe(r,e,t){const n=afe(e,t);return(r&n)>>>e}function afe(r,e){return nfe[r]&sfe[Math.min(e+r-1,7)]}const wb=BigInt(lm.code),sd=8;async function bb(r){return(await lm.encode(r)).subarray(0,8).reverse()}const Mu=async(r,e,t)=>{t.codec==null&&(t.codec=xf);const n=await Zt.digest(r),s=Ee.create(t.cidVersion??jN,t.codec.code,n);return await e.put(s,r,{...t,signal:t.signal}),s};class cfe{options;root;dir;path;dirty;flat;parent;parentKey;unixfs;mode;mtime;cid;size;nodeSize;constructor(e,t){this.options=t??{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime}}class lfe extends cfe{_bucket;constructor(e,t){super(e,t),this._bucket=hb({hashFn:bb,bits:8})}async put(e,t){this.cid=void 0,this.size=void 0,this.nodeSize=void 0,await this._bucket.put(e,t)}async get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}estimateNodeSize(){return this.nodeSize!==void 0?this.nodeSize:(this.nodeSize=QN(this._bucket,this,this.options),this.nodeSize)}async*flush(e){for await(const t of YN(this._bucket,e,this,this.options))yield{...t,path:this.path}}}async function*YN(r,e,t,n){const s=r._children,i=[];let o=0n;for(let f=0;f<s.length;f++){const g=s.get(f);if(g==null)continue;const m=f.toString(16).toUpperCase().padStart(2,"0");if(g instanceof Qr){let b;for await(const v of YN(g,e,null,n))b=v;if(b==null)throw new Error("Could not flush sharded directory, no sub-shard found");i.push({Name:m,Tsize:Number(b.size),Hash:b.cid}),o+=b.size}else if(ufe(g.value)){const b=g.value;let v;for await(const w of b.flush(e))v=w,yield v;if(v==null)throw new Error("Did not flush dir");const A=m+g.key;i.push({Name:A,Tsize:Number(v.size),Hash:v.cid}),o+=v.size}else{const b=g.value;if(b.cid==null)continue;const v=m+g.key,A=b.size;i.push({Name:v,Tsize:Number(A),Hash:b.cid}),o+=BigInt(A??0)}}const a=Uint8Array.from(s.bitField().reverse()),c=new dt({type:"hamt-sharded-directory",data:a,fanout:BigInt(r.tableSize()),hashType:wb,mtime:t?.mtime,mode:t?.mode}),l={Data:c.marshal(),Links:i},u=er(Nn(l)),h=await Mu(u,e,n),d=BigInt(u.byteLength)+o;yield{cid:h,unixfs:c,size:d}}function ufe(r){return typeof r.flush=="function"}function QN(r,e,t){const n=r._children,s=[];for(let c=0;c<n.length;c++){const l=n.get(c);if(l==null)continue;const u=c.toString(16).toUpperCase().padStart(2,"0");if(l instanceof Qr){const h=QN(l,null,t);s.push({Name:u,Tsize:Number(h),Hash:t.cidVersion===0?z6:H6})}else if(typeof l.value.flush=="function"){const d=l.value.nodeSize();s.push({Name:u+l.key,Tsize:Number(d),Hash:t.cidVersion===0?z6:H6})}else{const h=l.value;if(h.cid==null)continue;const d=u+l.key,f=h.size;s.push({Name:d,Tsize:Number(f),Hash:h.cid})}}const i=Uint8Array.from(n.bitField().reverse()),o=new dt({type:"hamt-sharded-directory",data:i,fanout:BigInt(r.tableSize()),hashType:wb,mtime:e?.mtime,mode:e?.mode});return er(Nn({Data:o.marshal(),Links:s})).length}const z6=Ee.parse("QmUNLLsPACCz1vLxQVkXqqLX5R1X345qqfHbsf67hvA3Nn"),H6=Ee.parse("zdj7WbTaiJT1fgatdet9Ei9iDB5hdCxkbVyhyh8YTUnXMiwYi"),q6=yn("helia:unixfs:commands:utils:hamt-utils"),K6=r=>r.toString(16).toUpperCase().padStart(2,"0").substring(0,2),hfe=async(r,e,t)=>{const n=new lfe({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:t.mtime,mode:t.mode},t);for(let i=0;i<e.length;i++)await n._bucket.put(e[i].name,{size:e[i].size,cid:e[i].cid});const s=await Bu(n.flush(r));if(s==null)throw new Error("Flushing shard yielded no result");return s},XN=async(r,e,t)=>{const n=dt.unmarshal(r[0].node.Data??new Uint8Array(0)),s=BigInt(Math.pow(2,sd));r.reverse();let i,o;for(let a=0;a<r.length;a++){const c=a===r.length-1,l=r[a],u=Uint8Array.from(l.children.bitField().reverse()),h=new dt({type:"hamt-sharded-directory",data:u,fanout:s,hashType:wb});c&&(h.mtime=n.mtime,h.mode=n.mode),o={Data:h.marshal(),Links:l.node.Links};const d=er(Nn(o));if(i=await Mu(d,e,t),!c){const f=r[a+1];if(f==null)throw new Error("Was not operating on shard root but also had no parent?");q6("updating link in parent sub-shard with prefix %s",f.prefix),f.node.Links=f.node.Links.filter(g=>g.Name!==f.prefix),f.node.Links.push({Name:f.prefix,Hash:i,Tsize:l.node.Links.reduce((g,m)=>g+(m.Tsize??0),d.byteLength)})}}if(i==null||o==null)throw new Error("Noting persisted");return{cid:i,node:o}},JN=async(r,e,t,n)=>{const i=GN(bb)(le(e)),o=[];for(;;){const a=await Gr(t.get(r,n)),c=Rs(a),l=new cg,u=await i.take(sd),h=K6(u);o.push({prefix:h,children:l,node:c});let d;for(const g of c.Links){const m=g.Name??"";if(m.length<2)throw new Error("Invalid HAMT - link name was too short");const b=parseInt(m.substring(0,2),16);l.set(b,!0),m.startsWith(h)&&(d=g)}if(d==null){q6("no link found with prefix %s for %s",h,e);break}const f=d.Name??"";if(f.length<2)throw new Error("Invalid HAMT - link name was too short");if(f.length===2){r=d.Hash,q6("descend into sub-shard with prefix %s",f);continue}break}return{path:o,hash:i}};async function ZN(r,e,t,n){if(r.Data==null)throw new Error("DagPB node had no data");const s=dt.unmarshal(r.Data);let i;if(s.type==="directory")i=dfe(r);else if(s.type==="hamt-sharded-directory")i=await eO(r,0,t,e,n);else throw new Error("Can only estimate the size of directories or shards");return i>t}function dfe(r){let e=0;for(const t of r.Links)e+=(t.Name??"").length,e+=t.Hash.version===1?H6.bytes.byteLength:z6.bytes.byteLength;return e}async function eO(r,e,t,n,s){if(e>t)return t;if(r.Data==null||!dt.unmarshal(r.Data).isDirectory())return e;for(const o of r.Links){let a=o.Name??"";if(a=a.substring(2),e+=a.length,e+=o.Hash.bytes.byteLength,o.Hash.code===fi){const c=await Gr(n.get(o.Hash,s)),l=Rs(c);e+=await eO(l,e,t,n,s)}}return e}const qs=yn("helia:unixfs:components:utils:add-link");async function vb(r,e,t,n){if(r.node.Data==null)throw new _s("Invalid parent passed to addLink");if(dt.unmarshal(r.node.Data).type==="hamt-sharded-directory")return qs("adding link to sharded directory"),gfe(r,e,t,n);qs(`adding ${e.Name} (${e.Hash}) to regular directory`);const i=await pfe(r,e,t,n);if(await ZN(i.node,t,n.shardSplitThresholdBytes??WN,n)){qs("converting directory to sharded directory");const o=await ffe(i,t);i.cid=o.cid,i.node=Rs(await Gr(t.get(o.cid,n)))}return i}const ffe=async(r,e)=>{if(r.node.Data==null)throw new _s("Invalid parent passed to convertToShardedDirectory");const t=dt.unmarshal(r.node.Data),n=await hfe(e,r.node.Links.map(s=>({name:s.Name??"",size:BigInt(s.Tsize??0),cid:s.Hash})),{mode:t.mode,mtime:t.mtime,cidVersion:r.cid.version});return qs(`converted directory to sharded directory ${n.cid}`),n},pfe=async(r,e,t,n)=>{const s=r.node.Links.filter(u=>{const h=u.Name===e.Name;if(h&&!n.allowOverwriting)throw new $N;return!h});if(s.push(e),r.node.Data==null)throw new dc("Parent node with no data passed to addToDirectory");const i=dt.unmarshal(r.node.Data);let o;if(i.mtime!=null){const u=Date.now(),h=Math.floor(u/1e3);i.mtime={secs:BigInt(h),nsecs:(u-h*1e3)*1e3},o=i.marshal()}else o=r.node.Data;r.node=Nn({Data:o,Links:s});const a=er(r.node),c=await Zt.digest(a),l=Ee.create(r.cid.version,fi,c);return await t.put(l,a),{node:r.node,cid:l}},gfe=async(r,e,t,n)=>{const{path:s,hash:i}=await JN(r.cid,e.Name,t,n),o=s[s.length-1];if(o==null)throw new Error("Invalid HAMT, could not generate path");const a=o.prefix,c=parseInt(a,16);qs("next prefix for %s is %s",e.Name,a);const l=`${a}${e.Name}`,u=o.node.Links.find(h=>(h.Name??"").startsWith(a));if(u!=null)if(qs("link %s was present in shard",l),u.Name===l){if(!n.allowOverwriting)throw new $N;qs("overwriting %s in sub-shard",e.Name),o.node.Links=o.node.Links.filter(h=>h.Name!==l),o.node.Links.push({Name:l,Hash:e.Hash,Tsize:e.Tsize})}else{if(u.Name?.length===2)throw new Error("Existing link was sub-shard?!");{qs("prefix %s already exists, creating new sub-shard",a);const h=o.node.Links.findIndex(b=>b.Name?.startsWith(a)),d=o.node.Links.splice(h,1)[0],f=(d.Name??"").substring(2),m=GN(bb)(le(f));for(let b=0;b<s.length;b++)await m.take(sd);for(;;){const b=await m.take(sd),v=K6(b);d.Name=`${v}${f}`;const A=await i.take(sd),w=K6(A);if(v===w){const x=new cg;x.set(A,!0),s.push({prefix:w,children:x,node:{Links:[]}});continue}const E=new cg;E.set(A,!0),E.set(b,!0),s.push({prefix:a,children:E,node:{Links:[d,{Name:`${w}${e.Name}`,Hash:e.Hash,Tsize:e.Tsize}]}});break}}}else qs("link %s was not present in sub-shard",l),e.Name=l,o.node.Links.push(e),o.children.set(c,!0),qs("adding %s to existing sub-shard",l);return XN(s,t,n)};async function dm(r,e,t={}){const n=await la(r,e,t);if(n.type!=="directory")throw new fb(`${r.toString()} was not a UnixFS directory`);return{cid:r,node:n.node}}async function Eb(r,e,t,n){const s=await la(r,t,n);if(s.type!=="directory"&&s.type!=="file"&&s.type!=="raw")throw new hm(`${r.toString()} was not a UnixFS node`);return{Name:e,Tsize:s.node instanceof Uint8Array?s.node.byteLength:mfe(s.node),Hash:r}}function mfe(r){const e=r.Links.reduce((t,n)=>t+(n.Tsize??0),0);return er(r).byteLength+e}const yfe=yn("helia:unixfs:components:utils:resolve");async function Wf(r,e,t,n){if(e==null||e==="")return{cid:r};const s=`/ipfs/${r}${e==null?"":`/${e}`}`,i=await Vl(qN(s,t,n));if(i.length===0)throw new Rde("Could not find path in directory");return yfe("resolved %s to %c",e,r),{cid:i[i.length-1].cid,path:e,segments:i}}async function gg(r,e,t,n){if(e.segments==null||e.segments.length===0)return r;let s=e.segments.pop();if(s==null)throw new Error("Insufficient segments");s.cid=r,e.segments.reverse();for(const i of e.segments){const[o,a]=await Promise.all([dm(i.cid,t,n),Eb(s.cid,s.name,t,n)]);r=(await vb(o,a,t,{...n,allowOverwriting:!0,cidVersion:r.version})).cid,i.cid=r,s=i}return r}async function*wfe(r,e,t={}){const n=await Wf(r,t.path,e,t),s=await la(n.cid,e,t);if(s.type!=="file"&&s.type!=="raw")throw new Pde;if(s.content==null)throw new UN;yield*s.content(t)}const bfe=yn("helia:unixfs:chmod");async function vfe(r,e,t,n={}){const s=await Wf(r,n.path,t,n);if(bfe("chmod %c %d",s.cid,e),n.recursive===!0){const h=await wc(async function*(){for await(const d of KN(s.cid,t,n)){let f,g=[];if(d.type==="raw")f=new dt({type:"file",data:d.node});else if(d.type==="file"||d.type==="directory")f=d.unixfs,g=d.node.Links;else throw new hm;f.mode=e;const m={Data:f.marshal(),Links:g};yield{path:d.path,content:m}}},d=>um(d,t,{...n,dagBuilder:async function*(f,g){for await(const m of f)yield async function(){const b=m.content,v=er(b),A=await Mu(v,g,{...n,cidVersion:r.version});if(b.Data==null)throw new dc(`${A} had no data`);const w=dt.unmarshal(b.Data);return{cid:A,size:BigInt(v.length),path:m.path,unixfs:w}}}}),async d=>Bu(d));if(h==null)throw new db(`Could not chmod ${s.cid.toString()}`);return gg(h.cid,s,t,n)}const i=await Gr(t.get(s.cid,n));let o,a=[];if(s.cid.code===As)o=new dt({type:"file",data:i});else{const h=Rs(i);if(h.Data==null)throw new dc(`${s.cid.toString()} had no data`);a=h.Links,o=dt.unmarshal(h.Data)}o.mode=e;const c=er({Data:o.marshal(),Links:a}),l=await Zt.digest(c),u=Ee.create(s.cid.version,fi,l);return await t.put(u,c),gg(u,s,t,n)}const Efe=yn("helia:unixfs:cp");async function Sfe(r,e,t,n,s={}){if(t.includes("/"))throw new _s("Name must not have slashes");const[i,o]=await Promise.all([dm(e,n,s),Eb(r,t,n,s)]);return Efe('Adding %c as "%s" to %c',r,t,e),(await vb(i,o,n,{allowOverwriting:s.force,cidVersion:e.version,...s})).cid}async function*_fe(r,e,t={}){const n=await Wf(r,t.path,e,t),s=await la(n.cid,e,{...t,extended:!0});if(s.type==="file"||s.type==="raw"){t.extended===!1?yield{name:s.name,path:s.path,cid:s.cid}:yield s;return}if(s.content==null)throw new UN;if(s.type!=="directory")throw new fb;yield*s.content(t)}const N_=yn("helia:unixfs:mkdir");async function xfe(r,e,t,n={}){if(e.includes("/"))throw new _s("Path must not have slashes");if((await la(r,t,n)).type!=="directory")throw new fb(`${r.toString()} was not a UnixFS directory`);N_("creating %s",e);const o={Data:new dt({type:"directory",mode:n.mode,mtime:n.mtime}).marshal(),Links:[]},a=er(o),c=await Zt.digest(a),l=Ee.create(n.cidVersion??jN,fi,c);await t.put(l,a);const[u,h]=await Promise.all([dm(r,t,n),Eb(l,e,t,n)]);return N_("adding empty dir called %s to %c",e,r),(await vb(u,h,t,{...n,allowOverwriting:n.force})).cid}const up=yn("helia:unixfs:utils:remove-link");async function Afe(r,e,t,n){if(r.node.Data==null)throw new dc("Parent node had no data");if(dt.unmarshal(r.node.Data).type==="hamt-sharded-directory"){up(`removing ${e} from sharded directory`);const i=await kfe(r,e,t,n);return await ZN(i.node,t,n.shardSplitThresholdBytes??WN,n)?i:(up("converting shard to flat directory %c",r.cid),Ife(i,t,n))}return up(`removing link ${e} regular directory`),Cfe(r,e,t,n)}const Cfe=async(r,e,t,n)=>{r.node.Links=r.node.Links.filter(o=>o.Name!==e);const s=er(r.node),i=await Mu(s,t,{...n,cidVersion:r.cid.version});return up(`Updated regular directory ${i}`),{node:r.node,cid:i}},kfe=async(r,e,t,n)=>{const{path:s}=await JN(r.cid,e,t,n),i=s[s.length-1];if(i==null)throw new Error("Invalid HAMT, could not generate path");const o=i.node.Links.filter(l=>(l.Name??"").substring(2)===e).map(l=>l.Name).pop();if(o==null)throw new Error("File not found");const a=o.substring(0,2),c=parseInt(a,16);if(i.node.Links=i.node.Links.filter(l=>l.Name!==o),i.children.unset(c),i.node.Links.length===1)for(;s.length!==1;){const l=s[s.length-1];if(l==null||l.node.Links.length>1)break;s.pop();const u=s[s.length-1];if(u==null)break;const h=l.node.Links[0];u.node.Links=u.node.Links.filter(d=>!(d.Name??"").startsWith(u.prefix)),u.node.Links.push({Hash:h.Hash,Name:`${u.prefix}${(h.Name??"").substring(2)}`,Tsize:h.Tsize})}return XN(s,t,n)},Ife=async(r,e,t)=>{if(r.node.Data==null)throw new _s("Invalid parent passed to convertToFlatDirectory");const n={Links:[]},s=await la(r.cid,e);if(s.type!=="directory")throw new Error("Unexpected node type");for await(const c of s.content()){let l=0;c.node instanceof Uint8Array?l=c.node.byteLength:l=er(c.node).length,n.Links.push({Hash:c.cid,Name:c.name,Tsize:l})}const i=dt.unmarshal(r.node.Data);n.Data=new dt({type:"directory",mode:i.mode,mtime:i.mtime}).marshal();const o=er(Nn(n));return{cid:await Mu(o,e,{codec:xf,cidVersion:r.cid.version,signal:t.signal}),node:n}},Tfe=yn("helia:unixfs:rm");async function Rfe(r,e,t,n={}){if(e.includes("/"))throw new _s("Name must not have slashes");const s=await dm(r,t,n);return Tfe("Removing %s from %c",e,r),(await Afe(s,e,t,{...n,cidVersion:r.version})).cid}const tO=1877,fm=1604,Pfe=yn("helia:unixfs:stat");async function Dfe(r,e,t={}){const n=await Wf(r,t.path,e,t);Pfe("stat %c",n.cid);const s=await la(n.cid,e,t);if(s.type==="raw")return t.extended===!0?Bfe(s):Lfe(s);if(s.type==="file"||s.type==="directory")return t.extended===!0?Ofe(s,e,t.filter??new rI({filterSize:1024}),t):Nfe(s);throw new hm}function Nfe(r){return{type:r.type,cid:r.cid,unixfs:r.unixfs,mode:r.unixfs.mode??(r.unixfs.isDirectory()?tO:fm),mtime:r.unixfs.mtime,size:r.unixfs.fileSize()}}async function Ofe(r,e,t,n){const s=await rO(r.cid,e,!1,t,n);return{type:r.type,cid:r.cid,unixfs:r.unixfs,size:r.unixfs.isDirectory()?s.dirSize:r.unixfs.fileSize(),mode:r.unixfs.mode??(r.unixfs.isDirectory()?tO:fm),mtime:r.unixfs.mtime,localSize:s.localSize,dagSize:s.dagSize,deduplicatedDagSize:s.deduplicatedDagSize,blocks:s.blocks,uniqueBlocks:s.uniqueBlocks}}function Lfe(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:fm,mtime:void 0,size:BigInt(r.node.byteLength)}}function Bfe(r){return{type:r.type,cid:r.cid,unixfs:void 0,mode:fm,mtime:void 0,size:BigInt(r.node.byteLength),localSize:BigInt(r.node.byteLength),dagSize:BigInt(r.node.byteLength),deduplicatedDagSize:BigInt(r.node.byteLength),blocks:1n,uniqueBlocks:1n}}async function rO(r,e,t,n,s){const i={dirSize:0n,localSize:0n,dagSize:0n,deduplicatedDagSize:0n,blocks:0n,uniqueBlocks:0n};try{const o=n.has(r.bytes);n.add(r.bytes);const a=await Gr(e.get(r,s));if(i.blocks++,i.dagSize+=BigInt(a.byteLength),o||(i.uniqueBlocks++,i.deduplicatedDagSize+=BigInt(a.byteLength)),r.code===As)i.localSize+=BigInt(a.byteLength),t&&(i.dirSize+=BigInt(a.byteLength));else if(r.code===fi){const c=Rs(a);let l;if(c.Data!=null&&(l=dt.unmarshal(c.Data)),c.Links.length>0){for(const u of c.Links){const h=await rO(u.Hash,e,Mfe(u,l),n,s);i.localSize+=h.localSize,i.dagSize+=h.dagSize,i.deduplicatedDagSize+=h.deduplicatedDagSize,i.blocks+=h.blocks,i.uniqueBlocks+=h.uniqueBlocks,i.dirSize+=h.dirSize}t&&l!=null&&(i.dirSize+=l.fileSize())}else{if(l==null)throw new dc(`PBNode ${r.toString()} had no data`);l.data!=null&&(i.localSize+=BigInt(l.data.byteLength??0)),t&&(i.dirSize+=l.fileSize())}}else throw new db(`${r.toString()} was neither DAG_PB nor RAW`)}catch(o){if(o.name!=="NotFoundError"||s.offline!==!0)throw o}return i}function Mfe(r,e){if(e==null)return!1;const t=r.Name;return t==null?!1:e.type==="directory"?!0:e.type==="hamt-sharded-directory"&&t.length>2}const $fe=yn("helia:unixfs:touch");async function Ufe(r,e,t={}){const n=await Wf(r,t.path,e,t),s=t.mtime??{secs:BigInt(Math.round(Date.now()/1e3)),nsecs:0};if($fe("touch %c %o",n.cid,s),t.recursive){const h=await wc(async function*(){for await(const d of KN(n.cid,e)){let f,g;if(d.type==="raw")f=new dt({data:d.node}),g=[];else if(d.type==="file"||d.type==="directory")f=d.unixfs,g=d.node.Links;else throw new hm;f.mtime=s;const m={Data:f.marshal(),Links:g};yield{path:d.path,content:m}}},d=>um(d,e,{...t,dagBuilder:async function*(f,g){for await(const m of f)yield async function(){const b=m.content,v=er(b),A=await Mu(v,g,{...t,cidVersion:r.version});if(b.Data==null)throw new dc(`${A} had no data`);const w=dt.unmarshal(b.Data);return{cid:A,size:BigInt(v.length),path:m.path,unixfs:w}}}}),async d=>Bu(d));if(h==null)throw new db(`Could not chmod ${n.cid.toString()}`);return gg(h.cid,n,e,t)}const i=await Gr(e.get(n.cid,t));let o,a=[];if(n.cid.code===As)o=new dt({data:i});else{const h=Rs(i);if(a=h.Links,h.Data==null)throw new dc(`${n.cid.toString()} had no data`);o=dt.unmarshal(h.Data)}o.mtime=s;const c=er({Data:o.marshal(),Links:a}),l=await Zt.digest(c),u=Ee.create(n.cid.version,fi,l);return await e.put(u,c),gg(u,n,e,t)}class Ffe{components;constructor(e){this.components=e}async*addAll(e,t={}){yield*pb(e,this.components.blockstore,t)}async addBytes(e,t={}){return Dde(e,this.components.blockstore,t)}async addByteStream(e,t={}){return Nde(e,this.components.blockstore,t)}async addFile(e,t={}){return Ode(e,this.components.blockstore,t)}async addDirectory(e={},t={}){return Lde(e,this.components.blockstore,t)}async*cat(e,t={}){yield*wfe(e,this.components.blockstore,t)}async chmod(e,t,n={}){return vfe(e,t,this.components.blockstore,n)}async cp(e,t,n,s={}){return Sfe(e,t,n,this.components.blockstore,s)}async*ls(e,t={}){yield*_fe(e,this.components.blockstore,t)}async mkdir(e,t,n={}){return xfe(e,t,this.components.blockstore,n)}async rm(e,t,n={}){return Rfe(e,t,this.components.blockstore,n)}async stat(e,t={}){return Dfe(e,this.components.blockstore,t)}async touch(e,t={}){return Ufe(e,this.components.blockstore,t)}}function O_(r){return new Ffe(r)}function Vfe(r){const e=r.getReader();return{async*[Symbol.asyncIterator](){for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}}}let Ky=null;async function L_(){return Ky||(Ky=Vhe()),Ky}function zfe(){async function r(t){const n=await L_();return{cid:(await O_(n).addFile({content:Vfe(t.stream()),path:t.name})).toString(),name:t.name,size:t.size,type:t.type}}async function e(t){const n=await L_(),s=O_(n),i=Ee.parse(t),o=s.cat(i),a=[];for await(const l of o)a.push(l);const c=a.map(l=>new Uint8Array(l).buffer);return new Blob(c)}return{addFile:r,getFile:e}}const Hfe={style:{height:"100%",width:"100%",padding:"12px",display:"flex","flex-direction":"column"}},qfe={key:0,style:{"font-size":"14px",color:"#888"}},Kfe={style:{color:"#888","font-family":"monospace"}},jfe={style:{"margin-left":"6px"}},Wfe={key:0},Gfe=["onClick"],Yfe={style:{display:"flex",gap:"8px","margin-top":"12px"}},Qfe=["disabled"],Xfe=["disabled"],Jfe=["disabled"],Zfe=hw({__name:"App",setup(r){const{addFile:e,getFile:t}=zfe(),n="user-"+crypto.randomUUID().slice(0,4),s=Nh(""),i=Nh(!1),{messagesRef:o,files:a,sendTextMessage:c,attachFileMeta:l,provider:u}=hF(),h=async()=>{i.value&&(c(n,s.value),s.value="")},d=async v=>{if(!i.value)return;const A=v.target.files?.[0];if(!A)return;const w=await e(A);l(w.cid,w,n)},f=zn(()=>o.value),g=Nh(null),m=()=>{g.value&&(g.value.scrollTop=g.value.scrollHeight)};Mh(o,async()=>{await cw(),console.log("feed updated, scroll to bottom"),m()}),Ox(()=>{u.connected&&(i.value=!0),u.on("status",v=>{i.value=v.connected,console.log("Yjs status",v)})});const b=async v=>{if(!v)return;const A=await t(v),w=URL.createObjectURL(A),E=document.createElement("a");E.href=w,E.download=a.get(v)?.name??v,E.click(),URL.revokeObjectURL(w)};return(v,A)=>(ya(),Rc("div",Hfe,[A[1]||(A[1]=ls("div",null,[ls("h1",null,"P2P Chat + Files (Vue SPA)")],-1)),ls("ul",{ref_key:"feedContainer",ref:g,style:{height:"80%","list-style":"none",padding:"0",margin:"0",display:"flex","flex-direction":"column",gap:"6px","overflow-y":"scroll"}},[i.value?$b("",!0):(ya(),Rc("li",qfe,"Yjs 네트워크 연결 중…")),(ya(!0),Rc(Vs,null,_L(f.value,w=>(ya(),Rc("li",{key:w.id,style:{"font-size":"14px"}},[ls("span",Kfe,eh(new Date(w.ts).toLocaleTimeString()),1),ls("strong",jfe,eh(w.author)+":",1),w.text?(ya(),Rc("span",Wfe,eh(w.text),1)):w.cid?(ya(),Rc("button",{key:1,onClick:E=>b(w.cid),style:{"margin-left":"6px"}}," 파일 받기 ("+eh(Pa(a).get(w.cid)?.name||w.cid)+") ",9,Gfe)):$b("",!0)]))),128))],512),ls("div",Yfe,[aL(ls("input",{"onUpdate:modelValue":A[0]||(A[0]=w=>s.value=w),placeholder:"메시지…",style:{flex:"1",padding:"6px",border:"1px solid #ccc"},onKeyup:MB(h,["enter"]),disabled:!i.value},null,40,Qfe),[[LB,s.value]]),ls("button",{onClick:h,disabled:!i.value},"Send",8,Xfe),ls("input",{type:"file",onChange:d,disabled:!i.value},null,40,Jfe)])]))}});/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const jc=typeof document<"u";function nO(r){return typeof r=="object"||"displayName"in r||"props"in r||"__vccOpts"in r}function e1e(r){return r.__esModule||r[Symbol.toStringTag]==="Module"||r.default&&nO(r.default)}const yt=Object.assign;function jy(r,e){const t={};for(const n in e){const s=e[n];t[n]=Is(s)?s.map(r):r(s)}return t}const id=()=>{},Is=Array.isArray,sO=/#/g,t1e=/&/g,r1e=/\//g,n1e=/=/g,s1e=/\?/g,iO=/\+/g,i1e=/%5B/g,o1e=/%5D/g,oO=/%5E/g,a1e=/%60/g,aO=/%7B/g,c1e=/%7C/g,cO=/%7D/g,l1e=/%20/g;function Sb(r){return encodeURI(""+r).replace(c1e,"|").replace(i1e,"[").replace(o1e,"]")}function u1e(r){return Sb(r).replace(aO,"{").replace(cO,"}").replace(oO,"^")}function j6(r){return Sb(r).replace(iO,"%2B").replace(l1e,"+").replace(sO,"%23").replace(t1e,"%26").replace(a1e,"`").replace(aO,"{").replace(cO,"}").replace(oO,"^")}function h1e(r){return j6(r).replace(n1e,"%3D")}function d1e(r){return Sb(r).replace(sO,"%23").replace(s1e,"%3F")}function f1e(r){return r==null?"":d1e(r).replace(r1e,"%2F")}function of(r){try{return decodeURIComponent(""+r)}catch{}return""+r}const p1e=/\/$/,g1e=r=>r.replace(p1e,"");function Wy(r,e,t="/"){let n,s={},i="",o="";const a=e.indexOf("#");let c=e.indexOf("?");return a<c&&a>=0&&(c=-1),c>-1&&(n=e.slice(0,c),i=e.slice(c+1,a>-1?a:e.length),s=r(i)),a>-1&&(n=n||e.slice(0,a),o=e.slice(a,e.length)),n=b1e(n??e,t),{fullPath:n+(i&&"?")+i+o,path:n,query:s,hash:of(o)}}function m1e(r,e){const t=e.query?r(e.query):"";return e.path+(t&&"?")+t+(e.hash||"")}function B_(r,e){return!e||!r.toLowerCase().startsWith(e.toLowerCase())?r:r.slice(e.length)||"/"}function y1e(r,e,t){const n=e.matched.length-1,s=t.matched.length-1;return n>-1&&n===s&&lu(e.matched[n],t.matched[s])&&lO(e.params,t.params)&&r(e.query)===r(t.query)&&e.hash===t.hash}function lu(r,e){return(r.aliasOf||r)===(e.aliasOf||e)}function lO(r,e){if(Object.keys(r).length!==Object.keys(e).length)return!1;for(const t in r)if(!w1e(r[t],e[t]))return!1;return!0}function w1e(r,e){return Is(r)?M_(r,e):Is(e)?M_(e,r):r===e}function M_(r,e){return Is(e)?r.length===e.length&&r.every((t,n)=>t===e[n]):r.length===1&&r[0]===e}function b1e(r,e){if(r.startsWith("/"))return r;if(!r)return e;const t=e.split("/"),n=r.split("/"),s=n[n.length-1];(s===".."||s===".")&&n.push("");let i=t.length-1,o,a;for(o=0;o<n.length;o++)if(a=n[o],a!==".")if(a==="..")i>1&&i--;else break;return t.slice(0,i).join("/")+"/"+n.slice(o).join("/")}const mo={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var af;(function(r){r.pop="pop",r.push="push"})(af||(af={}));var od;(function(r){r.back="back",r.forward="forward",r.unknown=""})(od||(od={}));function v1e(r){if(!r)if(jc){const e=document.querySelector("base");r=e&&e.getAttribute("href")||"/",r=r.replace(/^\w+:\/\/[^\/]+/,"")}else r="/";return r[0]!=="/"&&r[0]!=="#"&&(r="/"+r),g1e(r)}const E1e=/^[^#]+#/;function S1e(r,e){return r.replace(E1e,"#")+e}function _1e(r,e){const t=document.documentElement.getBoundingClientRect(),n=r.getBoundingClientRect();return{behavior:e.behavior,left:n.left-t.left-(e.left||0),top:n.top-t.top-(e.top||0)}}const pm=()=>({left:window.scrollX,top:window.scrollY});function x1e(r){let e;if("el"in r){const t=r.el,n=typeof t=="string"&&t.startsWith("#"),s=typeof t=="string"?n?document.getElementById(t.slice(1)):document.querySelector(t):t;if(!s)return;e=_1e(s,r)}else e=r;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(e.left!=null?e.left:window.scrollX,e.top!=null?e.top:window.scrollY)}function $_(r,e){return(history.state?history.state.position-e:-1)+r}const W6=new Map;function A1e(r,e){W6.set(r,e)}function C1e(r){const e=W6.get(r);return W6.delete(r),e}let k1e=()=>location.protocol+"//"+location.host;function uO(r,e){const{pathname:t,search:n,hash:s}=e,i=r.indexOf("#");if(i>-1){let a=s.includes(r.slice(i))?r.slice(i).length:1,c=s.slice(a);return c[0]!=="/"&&(c="/"+c),B_(c,"")}return B_(t,r)+n+s}function I1e(r,e,t,n){let s=[],i=[],o=null;const a=({state:d})=>{const f=uO(r,location),g=t.value,m=e.value;let b=0;if(d){if(t.value=f,e.value=d,o&&o===g){o=null;return}b=m?d.position-m.position:0}else n(f);s.forEach(v=>{v(t.value,g,{delta:b,type:af.pop,direction:b?b>0?od.forward:od.back:od.unknown})})};function c(){o=t.value}function l(d){s.push(d);const f=()=>{const g=s.indexOf(d);g>-1&&s.splice(g,1)};return i.push(f),f}function u(){const{history:d}=window;d.state&&d.replaceState(yt({},d.state,{scroll:pm()}),"")}function h(){for(const d of i)d();i=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",u)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",u,{passive:!0}),{pauseListeners:c,listen:l,destroy:h}}function U_(r,e,t,n=!1,s=!1){return{back:r,current:e,forward:t,replaced:n,position:window.history.length,scroll:s?pm():null}}function T1e(r){const{history:e,location:t}=window,n={value:uO(r,t)},s={value:e.state};s.value||i(n.value,{back:null,current:n.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0);function i(c,l,u){const h=r.indexOf("#"),d=h>-1?(t.host&&document.querySelector("base")?r:r.slice(h))+c:k1e()+r+c;try{e[u?"replaceState":"pushState"](l,"",d),s.value=l}catch(f){console.error(f),t[u?"replace":"assign"](d)}}function o(c,l){const u=yt({},e.state,U_(s.value.back,c,s.value.forward,!0),l,{position:s.value.position});i(c,u,!0),n.value=c}function a(c,l){const u=yt({},s.value,e.state,{forward:c,scroll:pm()});i(u.current,u,!0);const h=yt({},U_(n.value,c,null),{position:u.position+1},l);i(c,h,!1),n.value=c}return{location:n,state:s,push:a,replace:o}}function R1e(r){r=v1e(r);const e=T1e(r),t=I1e(r,e.state,e.location,e.replace);function n(i,o=!0){o||t.pauseListeners(),history.go(i)}const s=yt({location:"",base:r,go:n,createHref:S1e.bind(null,r)},e,t);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>e.state.value}),s}function P1e(r){return typeof r=="string"||r&&typeof r=="object"}function hO(r){return typeof r=="string"||typeof r=="symbol"}const dO=Symbol("");var F_;(function(r){r[r.aborted=4]="aborted",r[r.cancelled=8]="cancelled",r[r.duplicated=16]="duplicated"})(F_||(F_={}));function uu(r,e){return yt(new Error,{type:r,[dO]:!0},e)}function Si(r,e){return r instanceof Error&&dO in r&&(e==null||!!(r.type&e))}const V_="[^/]+?",D1e={sensitive:!1,strict:!1,start:!0,end:!0},N1e=/[.+*?^${}()[\]/\\]/g;function O1e(r,e){const t=yt({},D1e,e),n=[];let s=t.start?"^":"";const i=[];for(const l of r){const u=l.length?[]:[90];t.strict&&!l.length&&(s+="/");for(let h=0;h<l.length;h++){const d=l[h];let f=40+(t.sensitive?.25:0);if(d.type===0)h||(s+="/"),s+=d.value.replace(N1e,"\\$&"),f+=40;else if(d.type===1){const{value:g,repeatable:m,optional:b,regexp:v}=d;i.push({name:g,repeatable:m,optional:b});const A=v||V_;if(A!==V_){f+=10;try{new RegExp(`(${A})`)}catch(E){throw new Error(`Invalid custom RegExp for param "${g}" (${A}): `+E.message)}}let w=m?`((?:${A})(?:/(?:${A}))*)`:`(${A})`;h||(w=b&&l.length<2?`(?:/${w})`:"/"+w),b&&(w+="?"),s+=w,f+=20,b&&(f+=-8),m&&(f+=-20),A===".*"&&(f+=-50)}u.push(f)}n.push(u)}if(t.strict&&t.end){const l=n.length-1;n[l][n[l].length-1]+=.7000000000000001}t.strict||(s+="/?"),t.end?s+="$":t.strict&&!s.endsWith("/")&&(s+="(?:/|$)");const o=new RegExp(s,t.sensitive?"":"i");function a(l){const u=l.match(o),h={};if(!u)return null;for(let d=1;d<u.length;d++){const f=u[d]||"",g=i[d-1];h[g.name]=f&&g.repeatable?f.split("/"):f}return h}function c(l){let u="",h=!1;for(const d of r){(!h||!u.endsWith("/"))&&(u+="/"),h=!1;for(const f of d)if(f.type===0)u+=f.value;else if(f.type===1){const{value:g,repeatable:m,optional:b}=f,v=g in l?l[g]:"";if(Is(v)&&!m)throw new Error(`Provided param "${g}" is an array but it is not repeatable (* or + modifiers)`);const A=Is(v)?v.join("/"):v;if(!A)if(b)d.length<2&&(u.endsWith("/")?u=u.slice(0,-1):h=!0);else throw new Error(`Missing required param "${g}"`);u+=A}}return u||"/"}return{re:o,score:n,keys:i,parse:a,stringify:c}}function L1e(r,e){let t=0;for(;t<r.length&&t<e.length;){const n=e[t]-r[t];if(n)return n;t++}return r.length<e.length?r.length===1&&r[0]===80?-1:1:r.length>e.length?e.length===1&&e[0]===80?1:-1:0}function fO(r,e){let t=0;const n=r.score,s=e.score;for(;t<n.length&&t<s.length;){const i=L1e(n[t],s[t]);if(i)return i;t++}if(Math.abs(s.length-n.length)===1){if(z_(n))return 1;if(z_(s))return-1}return s.length-n.length}function z_(r){const e=r[r.length-1];return r.length>0&&e[e.length-1]<0}const B1e={type:0,value:""},M1e=/[a-zA-Z0-9_]/;function $1e(r){if(!r)return[[]];if(r==="/")return[[B1e]];if(!r.startsWith("/"))throw new Error(`Invalid path "${r}"`);function e(f){throw new Error(`ERR (${t})/"${l}": ${f}`)}let t=0,n=t;const s=[];let i;function o(){i&&s.push(i),i=[]}let a=0,c,l="",u="";function h(){l&&(t===0?i.push({type:0,value:l}):t===1||t===2||t===3?(i.length>1&&(c==="*"||c==="+")&&e(`A repeatable param (${l}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:l,regexp:u,repeatable:c==="*"||c==="+",optional:c==="*"||c==="?"})):e("Invalid state to consume buffer"),l="")}function d(){l+=c}for(;a<r.length;){if(c=r[a++],c==="\\"&&t!==2){n=t,t=4;continue}switch(t){case 0:c==="/"?(l&&h(),o()):c===":"?(h(),t=1):d();break;case 4:d(),t=n;break;case 1:c==="("?t=2:M1e.test(c)?d():(h(),t=0,c!=="*"&&c!=="?"&&c!=="+"&&a--);break;case 2:c===")"?u[u.length-1]=="\\"?u=u.slice(0,-1)+c:t=3:u+=c;break;case 3:h(),t=0,c!=="*"&&c!=="?"&&c!=="+"&&a--,u="";break;default:e("Unknown state");break}}return t===2&&e(`Unfinished custom RegExp for param "${l}"`),h(),o(),s}function U1e(r,e,t){const n=O1e($1e(r.path),t),s=yt(n,{record:r,parent:e,children:[],alias:[]});return e&&!s.record.aliasOf==!e.record.aliasOf&&e.children.push(s),s}function F1e(r,e){const t=[],n=new Map;e=j_({strict:!1,end:!0,sensitive:!1},e);function s(h){return n.get(h)}function i(h,d,f){const g=!f,m=q_(h);m.aliasOf=f&&f.record;const b=j_(e,h),v=[m];if("alias"in h){const E=typeof h.alias=="string"?[h.alias]:h.alias;for(const x of E)v.push(q_(yt({},m,{components:f?f.record.components:m.components,path:x,aliasOf:f?f.record:m})))}let A,w;for(const E of v){const{path:x}=E;if(d&&x[0]!=="/"){const P=d.record.path,T=P[P.length-1]==="/"?"":"/";E.path=d.record.path+(x&&T+x)}if(A=U1e(E,d,b),f?f.alias.push(A):(w=w||A,w!==A&&w.alias.push(A),g&&h.name&&!K_(A)&&o(h.name)),pO(A)&&c(A),m.children){const P=m.children;for(let T=0;T<P.length;T++)i(P[T],A,f&&f.children[T])}f=f||A}return w?()=>{o(w)}:id}function o(h){if(hO(h)){const d=n.get(h);d&&(n.delete(h),t.splice(t.indexOf(d),1),d.children.forEach(o),d.alias.forEach(o))}else{const d=t.indexOf(h);d>-1&&(t.splice(d,1),h.record.name&&n.delete(h.record.name),h.children.forEach(o),h.alias.forEach(o))}}function a(){return t}function c(h){const d=H1e(h,t);t.splice(d,0,h),h.record.name&&!K_(h)&&n.set(h.record.name,h)}function l(h,d){let f,g={},m,b;if("name"in h&&h.name){if(f=n.get(h.name),!f)throw uu(1,{location:h});b=f.record.name,g=yt(H_(d.params,f.keys.filter(w=>!w.optional).concat(f.parent?f.parent.keys.filter(w=>w.optional):[]).map(w=>w.name)),h.params&&H_(h.params,f.keys.map(w=>w.name))),m=f.stringify(g)}else if(h.path!=null)m=h.path,f=t.find(w=>w.re.test(m)),f&&(g=f.parse(m),b=f.record.name);else{if(f=d.name?n.get(d.name):t.find(w=>w.re.test(d.path)),!f)throw uu(1,{location:h,currentLocation:d});b=f.record.name,g=yt({},d.params,h.params),m=f.stringify(g)}const v=[];let A=f;for(;A;)v.unshift(A.record),A=A.parent;return{name:b,path:m,params:g,matched:v,meta:z1e(v)}}r.forEach(h=>i(h));function u(){t.length=0,n.clear()}return{addRoute:i,resolve:l,removeRoute:o,clearRoutes:u,getRoutes:a,getRecordMatcher:s}}function H_(r,e){const t={};for(const n of e)n in r&&(t[n]=r[n]);return t}function q_(r){const e={path:r.path,redirect:r.redirect,name:r.name,meta:r.meta||{},aliasOf:r.aliasOf,beforeEnter:r.beforeEnter,props:V1e(r),children:r.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in r?r.components||null:r.component&&{default:r.component}};return Object.defineProperty(e,"mods",{value:{}}),e}function V1e(r){const e={},t=r.props||!1;if("component"in r)e.default=t;else for(const n in r.components)e[n]=typeof t=="object"?t[n]:t;return e}function K_(r){for(;r;){if(r.record.aliasOf)return!0;r=r.parent}return!1}function z1e(r){return r.reduce((e,t)=>yt(e,t.meta),{})}function j_(r,e){const t={};for(const n in r)t[n]=n in e?e[n]:r[n];return t}function H1e(r,e){let t=0,n=e.length;for(;t!==n;){const i=t+n>>1;fO(r,e[i])<0?n=i:t=i+1}const s=q1e(r);return s&&(n=e.lastIndexOf(s,n-1)),n}function q1e(r){let e=r;for(;e=e.parent;)if(pO(e)&&fO(r,e)===0)return e}function pO({record:r}){return!!(r.name||r.components&&Object.keys(r.components).length||r.redirect)}function K1e(r){const e={};if(r===""||r==="?")return e;const n=(r[0]==="?"?r.slice(1):r).split("&");for(let s=0;s<n.length;++s){const i=n[s].replace(iO," "),o=i.indexOf("="),a=of(o<0?i:i.slice(0,o)),c=o<0?null:of(i.slice(o+1));if(a in e){let l=e[a];Is(l)||(l=e[a]=[l]),l.push(c)}else e[a]=c}return e}function W_(r){let e="";for(let t in r){const n=r[t];if(t=h1e(t),n==null){n!==void 0&&(e+=(e.length?"&":"")+t);continue}(Is(n)?n.map(i=>i&&j6(i)):[n&&j6(n)]).forEach(i=>{i!==void 0&&(e+=(e.length?"&":"")+t,i!=null&&(e+="="+i))})}return e}function j1e(r){const e={};for(const t in r){const n=r[t];n!==void 0&&(e[t]=Is(n)?n.map(s=>s==null?null:""+s):n==null?n:""+n)}return e}const W1e=Symbol(""),G_=Symbol(""),_b=Symbol(""),gO=Symbol(""),G6=Symbol("");function Zu(){let r=[];function e(n){return r.push(n),()=>{const s=r.indexOf(n);s>-1&&r.splice(s,1)}}function t(){r=[]}return{add:e,list:()=>r.slice(),reset:t}}function So(r,e,t,n,s,i=o=>o()){const o=n&&(n.enterCallbacks[s]=n.enterCallbacks[s]||[]);return()=>new Promise((a,c)=>{const l=d=>{d===!1?c(uu(4,{from:t,to:e})):d instanceof Error?c(d):P1e(d)?c(uu(2,{from:e,to:d})):(o&&n.enterCallbacks[s]===o&&typeof d=="function"&&o.push(d),a())},u=i(()=>r.call(n&&n.instances[s],e,t,l));let h=Promise.resolve(u);r.length<3&&(h=h.then(l)),h.catch(d=>c(d))})}function Gy(r,e,t,n,s=i=>i()){const i=[];for(const o of r)for(const a in o.components){let c=o.components[a];if(!(e!=="beforeRouteEnter"&&!o.instances[a]))if(nO(c)){const u=(c.__vccOpts||c)[e];u&&i.push(So(u,t,n,o,a,s))}else{let l=c();i.push(()=>l.then(u=>{if(!u)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const h=e1e(u)?u.default:u;o.mods[a]=u,o.components[a]=h;const f=(h.__vccOpts||h)[e];return f&&So(f,t,n,o,a,s)()}))}}return i}function Y_(r){const e=Pi(_b),t=Pi(gO),n=zn(()=>{const c=Pa(r.to);return e.resolve(c)}),s=zn(()=>{const{matched:c}=n.value,{length:l}=c,u=c[l-1],h=t.matched;if(!u||!h.length)return-1;const d=h.findIndex(lu.bind(null,u));if(d>-1)return d;const f=Q_(c[l-2]);return l>1&&Q_(u)===f&&h[h.length-1].path!==f?h.findIndex(lu.bind(null,c[l-2])):d}),i=zn(()=>s.value>-1&&J1e(t.params,n.value.params)),o=zn(()=>s.value>-1&&s.value===t.matched.length-1&&lO(t.params,n.value.params));function a(c={}){if(X1e(c)){const l=e[Pa(r.replace)?"replace":"push"](Pa(r.to)).catch(id);return r.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>l),l}return Promise.resolve()}return{route:n,href:zn(()=>n.value.href),isActive:i,isExactActive:o,navigate:a}}function G1e(r){return r.length===1?r[0]:r}const Y1e=hw({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:Y_,setup(r,{slots:e}){const t=Eg(Y_(r)),{options:n}=Pi(_b),s=zn(()=>({[X_(r.activeClass,n.linkActiveClass,"router-link-active")]:t.isActive,[X_(r.exactActiveClass,n.linkExactActiveClass,"router-link-exact-active")]:t.isExactActive}));return()=>{const i=e.default&&G1e(e.default(t));return r.custom?i:nA("a",{"aria-current":t.isExactActive?r.ariaCurrentValue:null,href:t.href,onClick:t.navigate,class:s.value},i)}}}),Q1e=Y1e;function X1e(r){if(!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)&&!r.defaultPrevented&&!(r.button!==void 0&&r.button!==0)){if(r.currentTarget&&r.currentTarget.getAttribute){const e=r.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return r.preventDefault&&r.preventDefault(),!0}}function J1e(r,e){for(const t in e){const n=e[t],s=r[t];if(typeof n=="string"){if(n!==s)return!1}else if(!Is(s)||s.length!==n.length||n.some((i,o)=>i!==s[o]))return!1}return!0}function Q_(r){return r?r.aliasOf?r.aliasOf.path:r.path:""}const X_=(r,e,t)=>r??e??t,Z1e=hw({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(r,{attrs:e,slots:t}){const n=Pi(G6),s=zn(()=>r.route||n.value),i=Pi(G_,0),o=zn(()=>{let l=Pa(i);const{matched:u}=s.value;let h;for(;(h=u[l])&&!h.components;)l++;return l}),a=zn(()=>s.value.matched[o.value]);q1(G_,zn(()=>o.value+1)),q1(W1e,a),q1(G6,s);const c=Nh();return Mh(()=>[c.value,a.value,r.name],([l,u,h],[d,f,g])=>{u&&(u.instances[h]=l,f&&f!==u&&l&&l===d&&(u.leaveGuards.size||(u.leaveGuards=f.leaveGuards),u.updateGuards.size||(u.updateGuards=f.updateGuards))),l&&u&&(!f||!lu(u,f)||!d)&&(u.enterCallbacks[h]||[]).forEach(m=>m(l))},{flush:"post"}),()=>{const l=s.value,u=r.name,h=a.value,d=h&&h.components[u];if(!d)return J_(t.default,{Component:d,route:l});const f=h.props[u],g=f?f===!0?l.params:typeof f=="function"?f(l):f:null,b=nA(d,yt({},g,e,{onVnodeUnmounted:v=>{v.component.isUnmounted&&(h.instances[u]=null)},ref:c}));return J_(t.default,{Component:b,route:l})||b}}});function J_(r,e){if(!r)return null;const t=r(e);return t.length===1?t[0]:t}const epe=Z1e;function tpe(r){const e=F1e(r.routes,r),t=r.parseQuery||K1e,n=r.stringifyQuery||W_,s=r.history,i=Zu(),o=Zu(),a=Zu(),c=QO(mo);let l=mo;jc&&r.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const u=jy.bind(null,ee=>""+ee),h=jy.bind(null,f1e),d=jy.bind(null,of);function f(ee,pe){let se,ye;return hO(ee)?(se=e.getRecordMatcher(ee),ye=pe):ye=ee,e.addRoute(ye,se)}function g(ee){const pe=e.getRecordMatcher(ee);pe&&e.removeRoute(pe)}function m(){return e.getRoutes().map(ee=>ee.record)}function b(ee){return!!e.getRecordMatcher(ee)}function v(ee,pe){if(pe=yt({},pe||c.value),typeof ee=="string"){const G=Wy(t,ee,pe.path),L=e.resolve({path:G.path},pe),U=s.createHref(G.fullPath);return yt(G,L,{params:d(L.params),hash:of(G.hash),redirectedFrom:void 0,href:U})}let se;if(ee.path!=null)se=yt({},ee,{path:Wy(t,ee.path,pe.path).path});else{const G=yt({},ee.params);for(const L in G)G[L]==null&&delete G[L];se=yt({},ee,{params:h(G)}),pe.params=h(pe.params)}const ye=e.resolve(se,pe),He=ee.hash||"";ye.params=u(d(ye.params));const M=m1e(n,yt({},ee,{hash:u1e(He),path:ye.path})),F=s.createHref(M);return yt({fullPath:M,hash:He,query:n===W_?j1e(ee.query):ee.query||{}},ye,{redirectedFrom:void 0,href:F})}function A(ee){return typeof ee=="string"?Wy(t,ee,c.value.path):yt({},ee)}function w(ee,pe){if(l!==ee)return uu(8,{from:pe,to:ee})}function E(ee){return T(ee)}function x(ee){return E(yt(A(ee),{replace:!0}))}function P(ee){const pe=ee.matched[ee.matched.length-1];if(pe&&pe.redirect){const{redirect:se}=pe;let ye=typeof se=="function"?se(ee):se;return typeof ye=="string"&&(ye=ye.includes("?")||ye.includes("#")?ye=A(ye):{path:ye},ye.params={}),yt({query:ee.query,hash:ee.hash,params:ye.path!=null?{}:ee.params},ye)}}function T(ee,pe){const se=l=v(ee),ye=c.value,He=ee.state,M=ee.force,F=ee.replace===!0,G=P(se);if(G)return T(yt(A(G),{state:typeof G=="object"?yt({},He,G.state):He,force:M,replace:F}),pe||se);const L=se;L.redirectedFrom=pe;let U;return!M&&y1e(n,ye,se)&&(U=uu(16,{to:L,from:ye}),ce(ye,ye,!0,!1)),(U?Promise.resolve(U):R(L,ye)).catch(q=>Si(q)?Si(q,2)?q:ie(q):te(q,L,ye)).then(q=>{if(q){if(Si(q,2))return T(yt({replace:F},A(q.to),{state:typeof q.to=="object"?yt({},He,q.to.state):He,force:M}),pe||L)}else q=V(L,ye,!0,F,He);return O(L,ye,q),q})}function D(ee,pe){const se=w(ee,pe);return se?Promise.reject(se):Promise.resolve()}function C(ee){const pe=Se.values().next().value;return pe&&typeof pe.runWithContext=="function"?pe.runWithContext(ee):ee()}function R(ee,pe){let se;const[ye,He,M]=rpe(ee,pe);se=Gy(ye.reverse(),"beforeRouteLeave",ee,pe);for(const G of ye)G.leaveGuards.forEach(L=>{se.push(So(L,ee,pe))});const F=D.bind(null,ee,pe);return se.push(F),xe(se).then(()=>{se=[];for(const G of i.list())se.push(So(G,ee,pe));return se.push(F),xe(se)}).then(()=>{se=Gy(He,"beforeRouteUpdate",ee,pe);for(const G of He)G.updateGuards.forEach(L=>{se.push(So(L,ee,pe))});return se.push(F),xe(se)}).then(()=>{se=[];for(const G of M)if(G.beforeEnter)if(Is(G.beforeEnter))for(const L of G.beforeEnter)se.push(So(L,ee,pe));else se.push(So(G.beforeEnter,ee,pe));return se.push(F),xe(se)}).then(()=>(ee.matched.forEach(G=>G.enterCallbacks={}),se=Gy(M,"beforeRouteEnter",ee,pe,C),se.push(F),xe(se))).then(()=>{se=[];for(const G of o.list())se.push(So(G,ee,pe));return se.push(F),xe(se)}).catch(G=>Si(G,8)?G:Promise.reject(G))}function O(ee,pe,se){a.list().forEach(ye=>C(()=>ye(ee,pe,se)))}function V(ee,pe,se,ye,He){const M=w(ee,pe);if(M)return M;const F=pe===mo,G=jc?history.state:{};se&&(ye||F?s.replace(ee.fullPath,yt({scroll:F&&G&&G.scroll},He)):s.push(ee.fullPath,He)),c.value=ee,ce(ee,pe,se,F),ie()}let B;function z(){B||(B=s.listen((ee,pe,se)=>{if(!Le.listening)return;const ye=v(ee),He=P(ye);if(He){T(yt(He,{replace:!0,force:!0}),ye).catch(id);return}l=ye;const M=c.value;jc&&A1e($_(M.fullPath,se.delta),pm()),R(ye,M).catch(F=>Si(F,12)?F:Si(F,2)?(T(yt(A(F.to),{force:!0}),ye).then(G=>{Si(G,20)&&!se.delta&&se.type===af.pop&&s.go(-1,!1)}).catch(id),Promise.reject()):(se.delta&&s.go(-se.delta,!1),te(F,ye,M))).then(F=>{F=F||V(ye,M,!1),F&&(se.delta&&!Si(F,8)?s.go(-se.delta,!1):se.type===af.pop&&Si(F,20)&&s.go(-1,!1)),O(ye,M,F)}).catch(id)}))}let $=Zu(),K=Zu(),X;function te(ee,pe,se){ie(ee);const ye=K.list();return ye.length?ye.forEach(He=>He(ee,pe,se)):console.error(ee),Promise.reject(ee)}function W(){return X&&c.value!==mo?Promise.resolve():new Promise((ee,pe)=>{$.add([ee,pe])})}function ie(ee){return X||(X=!ee,z(),$.list().forEach(([pe,se])=>ee?se(ee):pe()),$.reset()),ee}function ce(ee,pe,se,ye){const{scrollBehavior:He}=r;if(!jc||!He)return Promise.resolve();const M=!se&&C1e($_(ee.fullPath,0))||(ye||!se)&&history.state&&history.state.scroll||null;return cw().then(()=>He(ee,pe,M)).then(F=>F&&x1e(F)).catch(F=>te(F,ee,pe))}const de=ee=>s.go(ee);let oe;const Se=new Set,Le={currentRoute:c,listening:!0,addRoute:f,removeRoute:g,clearRoutes:e.clearRoutes,hasRoute:b,getRoutes:m,resolve:v,options:r,push:E,replace:x,go:de,back:()=>de(-1),forward:()=>de(1),beforeEach:i.add,beforeResolve:o.add,afterEach:a.add,onError:K.add,isReady:W,install(ee){const pe=this;ee.component("RouterLink",Q1e),ee.component("RouterView",epe),ee.config.globalProperties.$router=pe,Object.defineProperty(ee.config.globalProperties,"$route",{enumerable:!0,get:()=>Pa(c)}),jc&&!oe&&c.value===mo&&(oe=!0,E(s.location).catch(He=>{}));const se={};for(const He in mo)Object.defineProperty(se,He,{get:()=>c.value[He],enumerable:!0});ee.provide(_b,pe),ee.provide(gO,_x(se)),ee.provide(G6,c);const ye=ee.unmount;Se.add(ee),ee.unmount=function(){Se.delete(ee),Se.size<1&&(l=mo,B&&B(),B=null,c.value=mo,oe=!1,X=!1),ye()}}};function xe(ee){return ee.reduce((pe,se)=>pe.then(()=>C(se)),Promise.resolve())}return Le}function rpe(r,e){const t=[],n=[],s=[],i=Math.max(e.matched.length,r.matched.length);for(let o=0;o<i;o++){const a=e.matched[o];a&&(r.matched.find(l=>lu(l,a))?n.push(a):t.push(a));const c=r.matched[o];c&&(e.matched.find(l=>lu(l,c))||s.push(c))}return[t,n,s]}const npe=tpe({history:R1e("/chitchat-web/"),routes:[]}),mO=FB(Zfe);mO.use(npe);mO.mount("#app");
